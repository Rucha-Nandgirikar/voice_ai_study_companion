(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();function nm(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var pl={exports:{}},os={},ml={exports:{}},ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bf;function $y(){if(Bf)return ye;Bf=1;var s=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),v=Symbol.iterator;function k(S){return S===null||typeof S!="object"?null:(S=v&&S[v]||S["@@iterator"],typeof S=="function"?S:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},P=Object.assign,_={};function U(S,D,te){this.props=S,this.context=D,this.refs=_,this.updater=te||C}U.prototype.isReactComponent={},U.prototype.setState=function(S,D){if(typeof S!="object"&&typeof S!="function"&&S!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,S,D,"setState")},U.prototype.forceUpdate=function(S){this.updater.enqueueForceUpdate(this,S,"forceUpdate")};function A(){}A.prototype=U.prototype;function Y(S,D,te){this.props=S,this.context=D,this.refs=_,this.updater=te||C}var H=Y.prototype=new A;H.constructor=Y,P(H,U.prototype),H.isPureReactComponent=!0;var R=Array.isArray,M=Object.prototype.hasOwnProperty,F={current:null},J={key:!0,ref:!0,__self:!0,__source:!0};function L(S,D,te){var de,Se={},be=null,Ne=null;if(D!=null)for(de in D.ref!==void 0&&(Ne=D.ref),D.key!==void 0&&(be=""+D.key),D)M.call(D,de)&&!J.hasOwnProperty(de)&&(Se[de]=D[de]);var Ie=arguments.length-2;if(Ie===1)Se.children=te;else if(1<Ie){for(var Be=Array(Ie),At=0;At<Ie;At++)Be[At]=arguments[At+2];Se.children=Be}if(S&&S.defaultProps)for(de in Ie=S.defaultProps,Ie)Se[de]===void 0&&(Se[de]=Ie[de]);return{$$typeof:s,type:S,key:be,ref:Ne,props:Se,_owner:F.current}}function Z(S,D){return{$$typeof:s,type:S.type,key:D,ref:S.ref,props:S.props,_owner:S._owner}}function Q(S){return typeof S=="object"&&S!==null&&S.$$typeof===s}function se(S){var D={"=":"=0",":":"=2"};return"$"+S.replace(/[=:]/g,function(te){return D[te]})}var ge=/\/+/g;function Re(S,D){return typeof S=="object"&&S!==null&&S.key!=null?se(""+S.key):D.toString(36)}function qe(S,D,te,de,Se){var be=typeof S;(be==="undefined"||be==="boolean")&&(S=null);var Ne=!1;if(S===null)Ne=!0;else switch(be){case"string":case"number":Ne=!0;break;case"object":switch(S.$$typeof){case s:case e:Ne=!0}}if(Ne)return Ne=S,Se=Se(Ne),S=de===""?"."+Re(Ne,0):de,R(Se)?(te="",S!=null&&(te=S.replace(ge,"$&/")+"/"),qe(Se,D,te,"",function(At){return At})):Se!=null&&(Q(Se)&&(Se=Z(Se,te+(!Se.key||Ne&&Ne.key===Se.key?"":(""+Se.key).replace(ge,"$&/")+"/")+S)),D.push(Se)),1;if(Ne=0,de=de===""?".":de+":",R(S))for(var Ie=0;Ie<S.length;Ie++){be=S[Ie];var Be=de+Re(be,Ie);Ne+=qe(be,D,te,Be,Se)}else if(Be=k(S),typeof Be=="function")for(S=Be.call(S),Ie=0;!(be=S.next()).done;)be=be.value,Be=de+Re(be,Ie++),Ne+=qe(be,D,te,Be,Se);else if(be==="object")throw D=String(S),Error("Objects are not valid as a React child (found: "+(D==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":D)+"). If you meant to render a collection of children, use an array instead.");return Ne}function tt(S,D,te){if(S==null)return S;var de=[],Se=0;return qe(S,de,"","",function(be){return D.call(te,be,Se++)}),de}function nt(S){if(S._status===-1){var D=S._result;D=D(),D.then(function(te){(S._status===0||S._status===-1)&&(S._status=1,S._result=te)},function(te){(S._status===0||S._status===-1)&&(S._status=2,S._result=te)}),S._status===-1&&(S._status=0,S._result=D)}if(S._status===1)return S._result.default;throw S._result}var De={current:null},ee={transition:null},ue={ReactCurrentDispatcher:De,ReactCurrentBatchConfig:ee,ReactCurrentOwner:F};function ie(){throw Error("act(...) is not supported in production builds of React.")}return ye.Children={map:tt,forEach:function(S,D,te){tt(S,function(){D.apply(this,arguments)},te)},count:function(S){var D=0;return tt(S,function(){D++}),D},toArray:function(S){return tt(S,function(D){return D})||[]},only:function(S){if(!Q(S))throw Error("React.Children.only expected to receive a single React element child.");return S}},ye.Component=U,ye.Fragment=n,ye.Profiler=o,ye.PureComponent=Y,ye.StrictMode=r,ye.Suspense=h,ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ue,ye.act=ie,ye.cloneElement=function(S,D,te){if(S==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+S+".");var de=P({},S.props),Se=S.key,be=S.ref,Ne=S._owner;if(D!=null){if(D.ref!==void 0&&(be=D.ref,Ne=F.current),D.key!==void 0&&(Se=""+D.key),S.type&&S.type.defaultProps)var Ie=S.type.defaultProps;for(Be in D)M.call(D,Be)&&!J.hasOwnProperty(Be)&&(de[Be]=D[Be]===void 0&&Ie!==void 0?Ie[Be]:D[Be])}var Be=arguments.length-2;if(Be===1)de.children=te;else if(1<Be){Ie=Array(Be);for(var At=0;At<Be;At++)Ie[At]=arguments[At+2];de.children=Ie}return{$$typeof:s,type:S.type,key:Se,ref:be,props:de,_owner:Ne}},ye.createContext=function(S){return S={$$typeof:l,_currentValue:S,_currentValue2:S,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},S.Provider={$$typeof:c,_context:S},S.Consumer=S},ye.createElement=L,ye.createFactory=function(S){var D=L.bind(null,S);return D.type=S,D},ye.createRef=function(){return{current:null}},ye.forwardRef=function(S){return{$$typeof:u,render:S}},ye.isValidElement=Q,ye.lazy=function(S){return{$$typeof:g,_payload:{_status:-1,_result:S},_init:nt}},ye.memo=function(S,D){return{$$typeof:p,type:S,compare:D===void 0?null:D}},ye.startTransition=function(S){var D=ee.transition;ee.transition={};try{S()}finally{ee.transition=D}},ye.unstable_act=ie,ye.useCallback=function(S,D){return De.current.useCallback(S,D)},ye.useContext=function(S){return De.current.useContext(S)},ye.useDebugValue=function(){},ye.useDeferredValue=function(S){return De.current.useDeferredValue(S)},ye.useEffect=function(S,D){return De.current.useEffect(S,D)},ye.useId=function(){return De.current.useId()},ye.useImperativeHandle=function(S,D,te){return De.current.useImperativeHandle(S,D,te)},ye.useInsertionEffect=function(S,D){return De.current.useInsertionEffect(S,D)},ye.useLayoutEffect=function(S,D){return De.current.useLayoutEffect(S,D)},ye.useMemo=function(S,D){return De.current.useMemo(S,D)},ye.useReducer=function(S,D,te){return De.current.useReducer(S,D,te)},ye.useRef=function(S){return De.current.useRef(S)},ye.useState=function(S){return De.current.useState(S)},ye.useSyncExternalStore=function(S,D,te){return De.current.useSyncExternalStore(S,D,te)},ye.useTransition=function(){return De.current.useTransition()},ye.version="18.3.1",ye}var Vf;function fu(){return Vf||(Vf=1,ml.exports=$y()),ml.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zf;function Yy(){if(zf)return os;zf=1;var s=fu(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(u,h,p){var g,v={},k=null,C=null;p!==void 0&&(k=""+p),h.key!==void 0&&(k=""+h.key),h.ref!==void 0&&(C=h.ref);for(g in h)r.call(h,g)&&!c.hasOwnProperty(g)&&(v[g]=h[g]);if(u&&u.defaultProps)for(g in h=u.defaultProps,h)v[g]===void 0&&(v[g]=h[g]);return{$$typeof:e,type:u,key:k,ref:C,props:v,_owner:o.current}}return os.Fragment=n,os.jsx=l,os.jsxs=l,os}var qf;function Xy(){return qf||(qf=1,pl.exports=Yy()),pl.exports}var ne=Xy(),Fe=fu();const Zy=nm(Fe);var Uo={},gl={exports:{}},Ot={},vl={exports:{}},yl={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wf;function e0(){return Wf||(Wf=1,(function(s){function e(ee,ue){var ie=ee.length;ee.push(ue);e:for(;0<ie;){var S=ie-1>>>1,D=ee[S];if(0<o(D,ue))ee[S]=ue,ee[ie]=D,ie=S;else break e}}function n(ee){return ee.length===0?null:ee[0]}function r(ee){if(ee.length===0)return null;var ue=ee[0],ie=ee.pop();if(ie!==ue){ee[0]=ie;e:for(var S=0,D=ee.length,te=D>>>1;S<te;){var de=2*(S+1)-1,Se=ee[de],be=de+1,Ne=ee[be];if(0>o(Se,ie))be<D&&0>o(Ne,Se)?(ee[S]=Ne,ee[be]=ie,S=be):(ee[S]=Se,ee[de]=ie,S=de);else if(be<D&&0>o(Ne,ie))ee[S]=Ne,ee[be]=ie,S=be;else break e}}return ue}function o(ee,ue){var ie=ee.sortIndex-ue.sortIndex;return ie!==0?ie:ee.id-ue.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;s.unstable_now=function(){return c.now()}}else{var l=Date,u=l.now();s.unstable_now=function(){return l.now()-u}}var h=[],p=[],g=1,v=null,k=3,C=!1,P=!1,_=!1,U=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function H(ee){for(var ue=n(p);ue!==null;){if(ue.callback===null)r(p);else if(ue.startTime<=ee)r(p),ue.sortIndex=ue.expirationTime,e(h,ue);else break;ue=n(p)}}function R(ee){if(_=!1,H(ee),!P)if(n(h)!==null)P=!0,nt(M);else{var ue=n(p);ue!==null&&De(R,ue.startTime-ee)}}function M(ee,ue){P=!1,_&&(_=!1,A(L),L=-1),C=!0;var ie=k;try{for(H(ue),v=n(h);v!==null&&(!(v.expirationTime>ue)||ee&&!se());){var S=v.callback;if(typeof S=="function"){v.callback=null,k=v.priorityLevel;var D=S(v.expirationTime<=ue);ue=s.unstable_now(),typeof D=="function"?v.callback=D:v===n(h)&&r(h),H(ue)}else r(h);v=n(h)}if(v!==null)var te=!0;else{var de=n(p);de!==null&&De(R,de.startTime-ue),te=!1}return te}finally{v=null,k=ie,C=!1}}var F=!1,J=null,L=-1,Z=5,Q=-1;function se(){return!(s.unstable_now()-Q<Z)}function ge(){if(J!==null){var ee=s.unstable_now();Q=ee;var ue=!0;try{ue=J(!0,ee)}finally{ue?Re():(F=!1,J=null)}}else F=!1}var Re;if(typeof Y=="function")Re=function(){Y(ge)};else if(typeof MessageChannel<"u"){var qe=new MessageChannel,tt=qe.port2;qe.port1.onmessage=ge,Re=function(){tt.postMessage(null)}}else Re=function(){U(ge,0)};function nt(ee){J=ee,F||(F=!0,Re())}function De(ee,ue){L=U(function(){ee(s.unstable_now())},ue)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(ee){ee.callback=null},s.unstable_continueExecution=function(){P||C||(P=!0,nt(M))},s.unstable_forceFrameRate=function(ee){0>ee||125<ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<ee?Math.floor(1e3/ee):5},s.unstable_getCurrentPriorityLevel=function(){return k},s.unstable_getFirstCallbackNode=function(){return n(h)},s.unstable_next=function(ee){switch(k){case 1:case 2:case 3:var ue=3;break;default:ue=k}var ie=k;k=ue;try{return ee()}finally{k=ie}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(ee,ue){switch(ee){case 1:case 2:case 3:case 4:case 5:break;default:ee=3}var ie=k;k=ee;try{return ue()}finally{k=ie}},s.unstable_scheduleCallback=function(ee,ue,ie){var S=s.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?S+ie:S):ie=S,ee){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=ie+D,ee={id:g++,callback:ue,priorityLevel:ee,startTime:ie,expirationTime:D,sortIndex:-1},ie>S?(ee.sortIndex=ie,e(p,ee),n(h)===null&&ee===n(p)&&(_?(A(L),L=-1):_=!0,De(R,ie-S))):(ee.sortIndex=D,e(h,ee),P||C||(P=!0,nt(M))),ee},s.unstable_shouldYield=se,s.unstable_wrapCallback=function(ee){var ue=k;return function(){var ie=k;k=ue;try{return ee.apply(this,arguments)}finally{k=ie}}}})(yl)),yl}var Hf;function t0(){return Hf||(Hf=1,vl.exports=e0()),vl.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kf;function n0(){if(Kf)return Ot;Kf=1;var s=fu(),e=t0();function n(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,o={};function c(t,i){l(t,i),l(t+"Capture",i)}function l(t,i){for(o[t]=i,t=0;t<i.length;t++)r.add(i[t])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},v={};function k(t){return h.call(v,t)?!0:h.call(g,t)?!1:p.test(t)?v[t]=!0:(g[t]=!0,!1)}function C(t,i,a,d){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:a!==null?!a.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function P(t,i,a,d){if(i===null||typeof i>"u"||C(t,i,a,d))return!0;if(d)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function _(t,i,a,d,f,m,y){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=f,this.mustUseProperty=a,this.propertyName=t,this.type=i,this.sanitizeURL=m,this.removeEmptyString=y}var U={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){U[t]=new _(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];U[i]=new _(i,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){U[t]=new _(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){U[t]=new _(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){U[t]=new _(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){U[t]=new _(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){U[t]=new _(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){U[t]=new _(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){U[t]=new _(t,5,!1,t.toLowerCase(),null,!1,!1)});var A=/[\-:]([a-z])/g;function Y(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(A,Y);U[i]=new _(i,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(A,Y);U[i]=new _(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(A,Y);U[i]=new _(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){U[t]=new _(t,1,!1,t.toLowerCase(),null,!1,!1)}),U.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){U[t]=new _(t,1,!1,t.toLowerCase(),null,!0,!0)});function H(t,i,a,d){var f=U.hasOwnProperty(i)?U[i]:null;(f!==null?f.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(P(i,a,f,d)&&(a=null),d||f===null?k(i)&&(a===null?t.removeAttribute(i):t.setAttribute(i,""+a)):f.mustUseProperty?t[f.propertyName]=a===null?f.type===3?!1:"":a:(i=f.attributeName,d=f.attributeNamespace,a===null?t.removeAttribute(i):(f=f.type,a=f===3||f===4&&a===!0?"":""+a,d?t.setAttributeNS(d,i,a):t.setAttribute(i,a))))}var R=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),F=Symbol.for("react.portal"),J=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),se=Symbol.for("react.context"),ge=Symbol.for("react.forward_ref"),Re=Symbol.for("react.suspense"),qe=Symbol.for("react.suspense_list"),tt=Symbol.for("react.memo"),nt=Symbol.for("react.lazy"),De=Symbol.for("react.offscreen"),ee=Symbol.iterator;function ue(t){return t===null||typeof t!="object"?null:(t=ee&&t[ee]||t["@@iterator"],typeof t=="function"?t:null)}var ie=Object.assign,S;function D(t){if(S===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);S=i&&i[1]||""}return`
`+S+t}var te=!1;function de(t,i){if(!t||te)return"";te=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(N){var d=N}Reflect.construct(t,[],i)}else{try{i.call()}catch(N){d=N}t.call(i.prototype)}else{try{throw Error()}catch(N){d=N}t()}}catch(N){if(N&&d&&typeof N.stack=="string"){for(var f=N.stack.split(`
`),m=d.stack.split(`
`),y=f.length-1,T=m.length-1;1<=y&&0<=T&&f[y]!==m[T];)T--;for(;1<=y&&0<=T;y--,T--)if(f[y]!==m[T]){if(y!==1||T!==1)do if(y--,T--,0>T||f[y]!==m[T]){var w=`
`+f[y].replace(" at new "," at ");return t.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",t.displayName)),w}while(1<=y&&0<=T);break}}}finally{te=!1,Error.prepareStackTrace=a}return(t=t?t.displayName||t.name:"")?D(t):""}function Se(t){switch(t.tag){case 5:return D(t.type);case 16:return D("Lazy");case 13:return D("Suspense");case 19:return D("SuspenseList");case 0:case 2:case 15:return t=de(t.type,!1),t;case 11:return t=de(t.type.render,!1),t;case 1:return t=de(t.type,!0),t;default:return""}}function be(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case J:return"Fragment";case F:return"Portal";case Z:return"Profiler";case L:return"StrictMode";case Re:return"Suspense";case qe:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case se:return(t.displayName||"Context")+".Consumer";case Q:return(t._context.displayName||"Context")+".Provider";case ge:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case tt:return i=t.displayName||null,i!==null?i:be(t.type)||"Memo";case nt:i=t._payload,t=t._init;try{return be(t(i))}catch{}}return null}function Ne(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return be(i);case 8:return i===L?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Ie(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Be(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function At(t){var i=Be(t)?"checked":"value",a=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),d=""+t[i];if(!t.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var f=a.get,m=a.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return f.call(this)},set:function(y){d=""+y,m.call(this,y)}}),Object.defineProperty(t,i,{enumerable:a.enumerable}),{getValue:function(){return d},setValue:function(y){d=""+y},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function _s(t){t._valueTracker||(t._valueTracker=At(t))}function Hu(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var a=i.getValue(),d="";return t&&(d=Be(t)?t.checked?"true":"false":t.value),t=d,t!==a?(i.setValue(t),!0):!1}function Ps(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ta(t,i){var a=i.checked;return ie({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??t._wrapperState.initialChecked})}function Ku(t,i){var a=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;a=Ie(i.value!=null?i.value:a),t._wrapperState={initialChecked:d,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Gu(t,i){i=i.checked,i!=null&&H(t,"checked",i,!1)}function Ca(t,i){Gu(t,i);var a=Ie(i.value),d=i.type;if(a!=null)d==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+a):t.value!==""+a&&(t.value=""+a);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?ba(t,i.type,a):i.hasOwnProperty("defaultValue")&&ba(t,i.type,Ie(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function Ju(t,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,a||i===t.value||(t.value=i),t.defaultValue=i}a=t.name,a!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,a!==""&&(t.name=a)}function ba(t,i,a){(i!=="number"||Ps(t.ownerDocument)!==t)&&(a==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+a&&(t.defaultValue=""+a))}var Tr=Array.isArray;function Ni(t,i,a,d){if(t=t.options,i){i={};for(var f=0;f<a.length;f++)i["$"+a[f]]=!0;for(a=0;a<t.length;a++)f=i.hasOwnProperty("$"+t[a].value),t[a].selected!==f&&(t[a].selected=f),f&&d&&(t[a].defaultSelected=!0)}else{for(a=""+Ie(a),i=null,f=0;f<t.length;f++){if(t[f].value===a){t[f].selected=!0,d&&(t[f].defaultSelected=!0);return}i!==null||t[f].disabled||(i=t[f])}i!==null&&(i.selected=!0)}}function wa(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(n(91));return ie({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Qu(t,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(n(92));if(Tr(a)){if(1<a.length)throw Error(n(93));a=a[0]}i=a}i==null&&(i=""),a=i}t._wrapperState={initialValue:Ie(a)}}function $u(t,i){var a=Ie(i.value),d=Ie(i.defaultValue);a!=null&&(a=""+a,a!==t.value&&(t.value=a),i.defaultValue==null&&t.defaultValue!==a&&(t.defaultValue=a)),d!=null&&(t.defaultValue=""+d)}function Yu(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function Xu(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ea(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?Xu(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Rs,Zu=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,d,f){MSApp.execUnsafeLocalFunction(function(){return t(i,a,d,f)})}:t})(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(Rs=Rs||document.createElement("div"),Rs.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Rs.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function Cr(t,i){if(i){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=i;return}}t.textContent=i}var br={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ev=["Webkit","ms","Moz","O"];Object.keys(br).forEach(function(t){ev.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),br[i]=br[t]})});function ed(t,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||br.hasOwnProperty(t)&&br[t]?(""+i).trim():i+"px"}function td(t,i){t=t.style;for(var a in i)if(i.hasOwnProperty(a)){var d=a.indexOf("--")===0,f=ed(a,i[a],d);a==="float"&&(a="cssFloat"),d?t.setProperty(a,f):t[a]=f}}var tv=ie({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _a(t,i){if(i){if(tv[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(n(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(n(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(n(61))}if(i.style!=null&&typeof i.style!="object")throw Error(n(62))}}function Pa(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ra=null;function Ia(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var xa=null,Ai=null,Li=null;function nd(t){if(t=Hr(t)){if(typeof xa!="function")throw Error(n(280));var i=t.stateNode;i&&(i=Ys(i),xa(t.stateNode,t.type,i))}}function id(t){Ai?Li?Li.push(t):Li=[t]:Ai=t}function rd(){if(Ai){var t=Ai,i=Li;if(Li=Ai=null,nd(t),i)for(t=0;t<i.length;t++)nd(i[t])}}function sd(t,i){return t(i)}function od(){}var Oa=!1;function ad(t,i,a){if(Oa)return t(i,a);Oa=!0;try{return sd(t,i,a)}finally{Oa=!1,(Ai!==null||Li!==null)&&(od(),rd())}}function wr(t,i){var a=t.stateNode;if(a===null)return null;var d=Ys(a);if(d===null)return null;a=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(n(231,i,typeof a));return a}var Da=!1;if(u)try{var Er={};Object.defineProperty(Er,"passive",{get:function(){Da=!0}}),window.addEventListener("test",Er,Er),window.removeEventListener("test",Er,Er)}catch{Da=!1}function nv(t,i,a,d,f,m,y,T,w){var N=Array.prototype.slice.call(arguments,3);try{i.apply(a,N)}catch(z){this.onError(z)}}var _r=!1,Is=null,xs=!1,Ma=null,iv={onError:function(t){_r=!0,Is=t}};function rv(t,i,a,d,f,m,y,T,w){_r=!1,Is=null,nv.apply(iv,arguments)}function sv(t,i,a,d,f,m,y,T,w){if(rv.apply(this,arguments),_r){if(_r){var N=Is;_r=!1,Is=null}else throw Error(n(198));xs||(xs=!0,Ma=N)}}function mi(t){var i=t,a=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(a=i.return),t=i.return;while(t)}return i.tag===3?a:null}function cd(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function ld(t){if(mi(t)!==t)throw Error(n(188))}function ov(t){var i=t.alternate;if(!i){if(i=mi(t),i===null)throw Error(n(188));return i!==t?null:t}for(var a=t,d=i;;){var f=a.return;if(f===null)break;var m=f.alternate;if(m===null){if(d=f.return,d!==null){a=d;continue}break}if(f.child===m.child){for(m=f.child;m;){if(m===a)return ld(f),t;if(m===d)return ld(f),i;m=m.sibling}throw Error(n(188))}if(a.return!==d.return)a=f,d=m;else{for(var y=!1,T=f.child;T;){if(T===a){y=!0,a=f,d=m;break}if(T===d){y=!0,d=f,a=m;break}T=T.sibling}if(!y){for(T=m.child;T;){if(T===a){y=!0,a=m,d=f;break}if(T===d){y=!0,d=m,a=f;break}T=T.sibling}if(!y)throw Error(n(189))}}if(a.alternate!==d)throw Error(n(190))}if(a.tag!==3)throw Error(n(188));return a.stateNode.current===a?t:i}function ud(t){return t=ov(t),t!==null?dd(t):null}function dd(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=dd(t);if(i!==null)return i;t=t.sibling}return null}var hd=e.unstable_scheduleCallback,fd=e.unstable_cancelCallback,av=e.unstable_shouldYield,cv=e.unstable_requestPaint,$e=e.unstable_now,lv=e.unstable_getCurrentPriorityLevel,Na=e.unstable_ImmediatePriority,pd=e.unstable_UserBlockingPriority,Os=e.unstable_NormalPriority,uv=e.unstable_LowPriority,md=e.unstable_IdlePriority,Ds=null,dn=null;function dv(t){if(dn&&typeof dn.onCommitFiberRoot=="function")try{dn.onCommitFiberRoot(Ds,t,void 0,(t.current.flags&128)===128)}catch{}}var $t=Math.clz32?Math.clz32:pv,hv=Math.log,fv=Math.LN2;function pv(t){return t>>>=0,t===0?32:31-(hv(t)/fv|0)|0}var Ms=64,Ns=4194304;function Pr(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function As(t,i){var a=t.pendingLanes;if(a===0)return 0;var d=0,f=t.suspendedLanes,m=t.pingedLanes,y=a&268435455;if(y!==0){var T=y&~f;T!==0?d=Pr(T):(m&=y,m!==0&&(d=Pr(m)))}else y=a&~f,y!==0?d=Pr(y):m!==0&&(d=Pr(m));if(d===0)return 0;if(i!==0&&i!==d&&(i&f)===0&&(f=d&-d,m=i&-i,f>=m||f===16&&(m&4194240)!==0))return i;if((d&4)!==0&&(d|=a&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=d;0<i;)a=31-$t(i),f=1<<a,d|=t[a],i&=~f;return d}function mv(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gv(t,i){for(var a=t.suspendedLanes,d=t.pingedLanes,f=t.expirationTimes,m=t.pendingLanes;0<m;){var y=31-$t(m),T=1<<y,w=f[y];w===-1?((T&a)===0||(T&d)!==0)&&(f[y]=mv(T,i)):w<=i&&(t.expiredLanes|=T),m&=~T}}function Aa(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function gd(){var t=Ms;return Ms<<=1,(Ms&4194240)===0&&(Ms=64),t}function La(t){for(var i=[],a=0;31>a;a++)i.push(t);return i}function Rr(t,i,a){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-$t(i),t[i]=a}function vv(t,i){var a=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<a;){var f=31-$t(a),m=1<<f;i[f]=0,d[f]=-1,t[f]=-1,a&=~m}}function Ua(t,i){var a=t.entangledLanes|=i;for(t=t.entanglements;a;){var d=31-$t(a),f=1<<d;f&i|t[d]&i&&(t[d]|=i),a&=~f}}var xe=0;function vd(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var yd,Fa,kd,Sd,Td,ja=!1,Ls=[],Fn=null,jn=null,Bn=null,Ir=new Map,xr=new Map,Vn=[],yv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Cd(t,i){switch(t){case"focusin":case"focusout":Fn=null;break;case"dragenter":case"dragleave":jn=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":Ir.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":xr.delete(i.pointerId)}}function Or(t,i,a,d,f,m){return t===null||t.nativeEvent!==m?(t={blockedOn:i,domEventName:a,eventSystemFlags:d,nativeEvent:m,targetContainers:[f]},i!==null&&(i=Hr(i),i!==null&&Fa(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,f!==null&&i.indexOf(f)===-1&&i.push(f),t)}function kv(t,i,a,d,f){switch(i){case"focusin":return Fn=Or(Fn,t,i,a,d,f),!0;case"dragenter":return jn=Or(jn,t,i,a,d,f),!0;case"mouseover":return Bn=Or(Bn,t,i,a,d,f),!0;case"pointerover":var m=f.pointerId;return Ir.set(m,Or(Ir.get(m)||null,t,i,a,d,f)),!0;case"gotpointercapture":return m=f.pointerId,xr.set(m,Or(xr.get(m)||null,t,i,a,d,f)),!0}return!1}function bd(t){var i=gi(t.target);if(i!==null){var a=mi(i);if(a!==null){if(i=a.tag,i===13){if(i=cd(a),i!==null){t.blockedOn=i,Td(t.priority,function(){kd(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Us(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var a=Va(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(a===null){a=t.nativeEvent;var d=new a.constructor(a.type,a);Ra=d,a.target.dispatchEvent(d),Ra=null}else return i=Hr(a),i!==null&&Fa(i),t.blockedOn=a,!1;i.shift()}return!0}function wd(t,i,a){Us(t)&&a.delete(i)}function Sv(){ja=!1,Fn!==null&&Us(Fn)&&(Fn=null),jn!==null&&Us(jn)&&(jn=null),Bn!==null&&Us(Bn)&&(Bn=null),Ir.forEach(wd),xr.forEach(wd)}function Dr(t,i){t.blockedOn===i&&(t.blockedOn=null,ja||(ja=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Sv)))}function Mr(t){function i(f){return Dr(f,t)}if(0<Ls.length){Dr(Ls[0],t);for(var a=1;a<Ls.length;a++){var d=Ls[a];d.blockedOn===t&&(d.blockedOn=null)}}for(Fn!==null&&Dr(Fn,t),jn!==null&&Dr(jn,t),Bn!==null&&Dr(Bn,t),Ir.forEach(i),xr.forEach(i),a=0;a<Vn.length;a++)d=Vn[a],d.blockedOn===t&&(d.blockedOn=null);for(;0<Vn.length&&(a=Vn[0],a.blockedOn===null);)bd(a),a.blockedOn===null&&Vn.shift()}var Ui=R.ReactCurrentBatchConfig,Fs=!0;function Tv(t,i,a,d){var f=xe,m=Ui.transition;Ui.transition=null;try{xe=1,Ba(t,i,a,d)}finally{xe=f,Ui.transition=m}}function Cv(t,i,a,d){var f=xe,m=Ui.transition;Ui.transition=null;try{xe=4,Ba(t,i,a,d)}finally{xe=f,Ui.transition=m}}function Ba(t,i,a,d){if(Fs){var f=Va(t,i,a,d);if(f===null)rc(t,i,d,js,a),Cd(t,d);else if(kv(f,t,i,a,d))d.stopPropagation();else if(Cd(t,d),i&4&&-1<yv.indexOf(t)){for(;f!==null;){var m=Hr(f);if(m!==null&&yd(m),m=Va(t,i,a,d),m===null&&rc(t,i,d,js,a),m===f)break;f=m}f!==null&&d.stopPropagation()}else rc(t,i,d,null,a)}}var js=null;function Va(t,i,a,d){if(js=null,t=Ia(d),t=gi(t),t!==null)if(i=mi(t),i===null)t=null;else if(a=i.tag,a===13){if(t=cd(i),t!==null)return t;t=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return js=t,null}function Ed(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lv()){case Na:return 1;case pd:return 4;case Os:case uv:return 16;case md:return 536870912;default:return 16}default:return 16}}var zn=null,za=null,Bs=null;function _d(){if(Bs)return Bs;var t,i=za,a=i.length,d,f="value"in zn?zn.value:zn.textContent,m=f.length;for(t=0;t<a&&i[t]===f[t];t++);var y=a-t;for(d=1;d<=y&&i[a-d]===f[m-d];d++);return Bs=f.slice(t,1<d?1-d:void 0)}function Vs(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function zs(){return!0}function Pd(){return!1}function Lt(t){function i(a,d,f,m,y){this._reactName=a,this._targetInst=f,this.type=d,this.nativeEvent=m,this.target=y,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(a=t[T],this[T]=a?a(m):m[T]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?zs:Pd,this.isPropagationStopped=Pd,this}return ie(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=zs)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=zs)},persist:function(){},isPersistent:zs}),i}var Fi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qa=Lt(Fi),Nr=ie({},Fi,{view:0,detail:0}),bv=Lt(Nr),Wa,Ha,Ar,qs=ie({},Nr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ga,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ar&&(Ar&&t.type==="mousemove"?(Wa=t.screenX-Ar.screenX,Ha=t.screenY-Ar.screenY):Ha=Wa=0,Ar=t),Wa)},movementY:function(t){return"movementY"in t?t.movementY:Ha}}),Rd=Lt(qs),wv=ie({},qs,{dataTransfer:0}),Ev=Lt(wv),_v=ie({},Nr,{relatedTarget:0}),Ka=Lt(_v),Pv=ie({},Fi,{animationName:0,elapsedTime:0,pseudoElement:0}),Rv=Lt(Pv),Iv=ie({},Fi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xv=Lt(Iv),Ov=ie({},Fi,{data:0}),Id=Lt(Ov),Dv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Av(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Nv[t])?!!i[t]:!1}function Ga(){return Av}var Lv=ie({},Nr,{key:function(t){if(t.key){var i=Dv[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Vs(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Mv[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ga,charCode:function(t){return t.type==="keypress"?Vs(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Vs(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Uv=Lt(Lv),Fv=ie({},qs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xd=Lt(Fv),jv=ie({},Nr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ga}),Bv=Lt(jv),Vv=ie({},Fi,{propertyName:0,elapsedTime:0,pseudoElement:0}),zv=Lt(Vv),qv=ie({},qs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Wv=Lt(qv),Hv=[9,13,27,32],Ja=u&&"CompositionEvent"in window,Lr=null;u&&"documentMode"in document&&(Lr=document.documentMode);var Kv=u&&"TextEvent"in window&&!Lr,Od=u&&(!Ja||Lr&&8<Lr&&11>=Lr),Dd=" ",Md=!1;function Nd(t,i){switch(t){case"keyup":return Hv.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ad(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ji=!1;function Gv(t,i){switch(t){case"compositionend":return Ad(i);case"keypress":return i.which!==32?null:(Md=!0,Dd);case"textInput":return t=i.data,t===Dd&&Md?null:t;default:return null}}function Jv(t,i){if(ji)return t==="compositionend"||!Ja&&Nd(t,i)?(t=_d(),Bs=za=zn=null,ji=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Od&&i.locale!=="ko"?null:i.data;default:return null}}var Qv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ld(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Qv[t.type]:i==="textarea"}function Ud(t,i,a,d){id(d),i=Js(i,"onChange"),0<i.length&&(a=new qa("onChange","change",null,a,d),t.push({event:a,listeners:i}))}var Ur=null,Fr=null;function $v(t){th(t,0)}function Ws(t){var i=Wi(t);if(Hu(i))return t}function Yv(t,i){if(t==="change")return i}var Fd=!1;if(u){var Qa;if(u){var $a="oninput"in document;if(!$a){var jd=document.createElement("div");jd.setAttribute("oninput","return;"),$a=typeof jd.oninput=="function"}Qa=$a}else Qa=!1;Fd=Qa&&(!document.documentMode||9<document.documentMode)}function Bd(){Ur&&(Ur.detachEvent("onpropertychange",Vd),Fr=Ur=null)}function Vd(t){if(t.propertyName==="value"&&Ws(Fr)){var i=[];Ud(i,Fr,t,Ia(t)),ad($v,i)}}function Xv(t,i,a){t==="focusin"?(Bd(),Ur=i,Fr=a,Ur.attachEvent("onpropertychange",Vd)):t==="focusout"&&Bd()}function Zv(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ws(Fr)}function ey(t,i){if(t==="click")return Ws(i)}function ty(t,i){if(t==="input"||t==="change")return Ws(i)}function ny(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var Yt=typeof Object.is=="function"?Object.is:ny;function jr(t,i){if(Yt(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var a=Object.keys(t),d=Object.keys(i);if(a.length!==d.length)return!1;for(d=0;d<a.length;d++){var f=a[d];if(!h.call(i,f)||!Yt(t[f],i[f]))return!1}return!0}function zd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function qd(t,i){var a=zd(t);t=0;for(var d;a;){if(a.nodeType===3){if(d=t+a.textContent.length,t<=i&&d>=i)return{node:a,offset:i-t};t=d}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=zd(a)}}function Wd(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?Wd(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function Hd(){for(var t=window,i=Ps();i instanceof t.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)t=i.contentWindow;else break;i=Ps(t.document)}return i}function Ya(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function iy(t){var i=Hd(),a=t.focusedElem,d=t.selectionRange;if(i!==a&&a&&a.ownerDocument&&Wd(a.ownerDocument.documentElement,a)){if(d!==null&&Ya(a)){if(i=d.start,t=d.end,t===void 0&&(t=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(t,a.value.length);else if(t=(i=a.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var f=a.textContent.length,m=Math.min(d.start,f);d=d.end===void 0?m:Math.min(d.end,f),!t.extend&&m>d&&(f=d,d=m,m=f),f=qd(a,m);var y=qd(a,d);f&&y&&(t.rangeCount!==1||t.anchorNode!==f.node||t.anchorOffset!==f.offset||t.focusNode!==y.node||t.focusOffset!==y.offset)&&(i=i.createRange(),i.setStart(f.node,f.offset),t.removeAllRanges(),m>d?(t.addRange(i),t.extend(y.node,y.offset)):(i.setEnd(y.node,y.offset),t.addRange(i)))}}for(i=[],t=a;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)t=i[a],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ry=u&&"documentMode"in document&&11>=document.documentMode,Bi=null,Xa=null,Br=null,Za=!1;function Kd(t,i,a){var d=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Za||Bi==null||Bi!==Ps(d)||(d=Bi,"selectionStart"in d&&Ya(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Br&&jr(Br,d)||(Br=d,d=Js(Xa,"onSelect"),0<d.length&&(i=new qa("onSelect","select",null,i,a),t.push({event:i,listeners:d}),i.target=Bi)))}function Hs(t,i){var a={};return a[t.toLowerCase()]=i.toLowerCase(),a["Webkit"+t]="webkit"+i,a["Moz"+t]="moz"+i,a}var Vi={animationend:Hs("Animation","AnimationEnd"),animationiteration:Hs("Animation","AnimationIteration"),animationstart:Hs("Animation","AnimationStart"),transitionend:Hs("Transition","TransitionEnd")},ec={},Gd={};u&&(Gd=document.createElement("div").style,"AnimationEvent"in window||(delete Vi.animationend.animation,delete Vi.animationiteration.animation,delete Vi.animationstart.animation),"TransitionEvent"in window||delete Vi.transitionend.transition);function Ks(t){if(ec[t])return ec[t];if(!Vi[t])return t;var i=Vi[t],a;for(a in i)if(i.hasOwnProperty(a)&&a in Gd)return ec[t]=i[a];return t}var Jd=Ks("animationend"),Qd=Ks("animationiteration"),$d=Ks("animationstart"),Yd=Ks("transitionend"),Xd=new Map,Zd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qn(t,i){Xd.set(t,i),c(i,[t])}for(var tc=0;tc<Zd.length;tc++){var nc=Zd[tc],sy=nc.toLowerCase(),oy=nc[0].toUpperCase()+nc.slice(1);qn(sy,"on"+oy)}qn(Jd,"onAnimationEnd"),qn(Qd,"onAnimationIteration"),qn($d,"onAnimationStart"),qn("dblclick","onDoubleClick"),qn("focusin","onFocus"),qn("focusout","onBlur"),qn(Yd,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ay=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vr));function eh(t,i,a){var d=t.type||"unknown-event";t.currentTarget=a,sv(d,i,void 0,t),t.currentTarget=null}function th(t,i){i=(i&4)!==0;for(var a=0;a<t.length;a++){var d=t[a],f=d.event;d=d.listeners;e:{var m=void 0;if(i)for(var y=d.length-1;0<=y;y--){var T=d[y],w=T.instance,N=T.currentTarget;if(T=T.listener,w!==m&&f.isPropagationStopped())break e;eh(f,T,N),m=w}else for(y=0;y<d.length;y++){if(T=d[y],w=T.instance,N=T.currentTarget,T=T.listener,w!==m&&f.isPropagationStopped())break e;eh(f,T,N),m=w}}}if(xs)throw t=Ma,xs=!1,Ma=null,t}function Le(t,i){var a=i[uc];a===void 0&&(a=i[uc]=new Set);var d=t+"__bubble";a.has(d)||(nh(i,t,2,!1),a.add(d))}function ic(t,i,a){var d=0;i&&(d|=4),nh(a,t,d,i)}var Gs="_reactListening"+Math.random().toString(36).slice(2);function zr(t){if(!t[Gs]){t[Gs]=!0,r.forEach(function(a){a!=="selectionchange"&&(ay.has(a)||ic(a,!1,t),ic(a,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Gs]||(i[Gs]=!0,ic("selectionchange",!1,i))}}function nh(t,i,a,d){switch(Ed(i)){case 1:var f=Tv;break;case 4:f=Cv;break;default:f=Ba}a=f.bind(null,i,a,t),f=void 0,!Da||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(f=!0),d?f!==void 0?t.addEventListener(i,a,{capture:!0,passive:f}):t.addEventListener(i,a,!0):f!==void 0?t.addEventListener(i,a,{passive:f}):t.addEventListener(i,a,!1)}function rc(t,i,a,d,f){var m=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var y=d.tag;if(y===3||y===4){var T=d.stateNode.containerInfo;if(T===f||T.nodeType===8&&T.parentNode===f)break;if(y===4)for(y=d.return;y!==null;){var w=y.tag;if((w===3||w===4)&&(w=y.stateNode.containerInfo,w===f||w.nodeType===8&&w.parentNode===f))return;y=y.return}for(;T!==null;){if(y=gi(T),y===null)return;if(w=y.tag,w===5||w===6){d=m=y;continue e}T=T.parentNode}}d=d.return}ad(function(){var N=m,z=Ia(a),W=[];e:{var V=Xd.get(t);if(V!==void 0){var re=qa,ae=t;switch(t){case"keypress":if(Vs(a)===0)break e;case"keydown":case"keyup":re=Uv;break;case"focusin":ae="focus",re=Ka;break;case"focusout":ae="blur",re=Ka;break;case"beforeblur":case"afterblur":re=Ka;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=Rd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=Ev;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=Bv;break;case Jd:case Qd:case $d:re=Rv;break;case Yd:re=zv;break;case"scroll":re=bv;break;case"wheel":re=Wv;break;case"copy":case"cut":case"paste":re=xv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=xd}var ce=(i&4)!==0,Ye=!ce&&t==="scroll",I=ce?V!==null?V+"Capture":null:V;ce=[];for(var E=N,O;E!==null;){O=E;var K=O.stateNode;if(O.tag===5&&K!==null&&(O=K,I!==null&&(K=wr(E,I),K!=null&&ce.push(qr(E,K,O)))),Ye)break;E=E.return}0<ce.length&&(V=new re(V,ae,null,a,z),W.push({event:V,listeners:ce}))}}if((i&7)===0){e:{if(V=t==="mouseover"||t==="pointerover",re=t==="mouseout"||t==="pointerout",V&&a!==Ra&&(ae=a.relatedTarget||a.fromElement)&&(gi(ae)||ae[bn]))break e;if((re||V)&&(V=z.window===z?z:(V=z.ownerDocument)?V.defaultView||V.parentWindow:window,re?(ae=a.relatedTarget||a.toElement,re=N,ae=ae?gi(ae):null,ae!==null&&(Ye=mi(ae),ae!==Ye||ae.tag!==5&&ae.tag!==6)&&(ae=null)):(re=null,ae=N),re!==ae)){if(ce=Rd,K="onMouseLeave",I="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(ce=xd,K="onPointerLeave",I="onPointerEnter",E="pointer"),Ye=re==null?V:Wi(re),O=ae==null?V:Wi(ae),V=new ce(K,E+"leave",re,a,z),V.target=Ye,V.relatedTarget=O,K=null,gi(z)===N&&(ce=new ce(I,E+"enter",ae,a,z),ce.target=O,ce.relatedTarget=Ye,K=ce),Ye=K,re&&ae)t:{for(ce=re,I=ae,E=0,O=ce;O;O=zi(O))E++;for(O=0,K=I;K;K=zi(K))O++;for(;0<E-O;)ce=zi(ce),E--;for(;0<O-E;)I=zi(I),O--;for(;E--;){if(ce===I||I!==null&&ce===I.alternate)break t;ce=zi(ce),I=zi(I)}ce=null}else ce=null;re!==null&&ih(W,V,re,ce,!1),ae!==null&&Ye!==null&&ih(W,Ye,ae,ce,!0)}}e:{if(V=N?Wi(N):window,re=V.nodeName&&V.nodeName.toLowerCase(),re==="select"||re==="input"&&V.type==="file")var le=Yv;else if(Ld(V))if(Fd)le=ty;else{le=Zv;var he=Xv}else(re=V.nodeName)&&re.toLowerCase()==="input"&&(V.type==="checkbox"||V.type==="radio")&&(le=ey);if(le&&(le=le(t,N))){Ud(W,le,a,z);break e}he&&he(t,V,N),t==="focusout"&&(he=V._wrapperState)&&he.controlled&&V.type==="number"&&ba(V,"number",V.value)}switch(he=N?Wi(N):window,t){case"focusin":(Ld(he)||he.contentEditable==="true")&&(Bi=he,Xa=N,Br=null);break;case"focusout":Br=Xa=Bi=null;break;case"mousedown":Za=!0;break;case"contextmenu":case"mouseup":case"dragend":Za=!1,Kd(W,a,z);break;case"selectionchange":if(ry)break;case"keydown":case"keyup":Kd(W,a,z)}var fe;if(Ja)e:{switch(t){case"compositionstart":var pe="onCompositionStart";break e;case"compositionend":pe="onCompositionEnd";break e;case"compositionupdate":pe="onCompositionUpdate";break e}pe=void 0}else ji?Nd(t,a)&&(pe="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(pe="onCompositionStart");pe&&(Od&&a.locale!=="ko"&&(ji||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&ji&&(fe=_d()):(zn=z,za="value"in zn?zn.value:zn.textContent,ji=!0)),he=Js(N,pe),0<he.length&&(pe=new Id(pe,t,null,a,z),W.push({event:pe,listeners:he}),fe?pe.data=fe:(fe=Ad(a),fe!==null&&(pe.data=fe)))),(fe=Kv?Gv(t,a):Jv(t,a))&&(N=Js(N,"onBeforeInput"),0<N.length&&(z=new Id("onBeforeInput","beforeinput",null,a,z),W.push({event:z,listeners:N}),z.data=fe))}th(W,i)})}function qr(t,i,a){return{instance:t,listener:i,currentTarget:a}}function Js(t,i){for(var a=i+"Capture",d=[];t!==null;){var f=t,m=f.stateNode;f.tag===5&&m!==null&&(f=m,m=wr(t,a),m!=null&&d.unshift(qr(t,m,f)),m=wr(t,i),m!=null&&d.push(qr(t,m,f))),t=t.return}return d}function zi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ih(t,i,a,d,f){for(var m=i._reactName,y=[];a!==null&&a!==d;){var T=a,w=T.alternate,N=T.stateNode;if(w!==null&&w===d)break;T.tag===5&&N!==null&&(T=N,f?(w=wr(a,m),w!=null&&y.unshift(qr(a,w,T))):f||(w=wr(a,m),w!=null&&y.push(qr(a,w,T)))),a=a.return}y.length!==0&&t.push({event:i,listeners:y})}var cy=/\r\n?/g,ly=/\u0000|\uFFFD/g;function rh(t){return(typeof t=="string"?t:""+t).replace(cy,`
`).replace(ly,"")}function Qs(t,i,a){if(i=rh(i),rh(t)!==i&&a)throw Error(n(425))}function $s(){}var sc=null,oc=null;function ac(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var cc=typeof setTimeout=="function"?setTimeout:void 0,uy=typeof clearTimeout=="function"?clearTimeout:void 0,sh=typeof Promise=="function"?Promise:void 0,dy=typeof queueMicrotask=="function"?queueMicrotask:typeof sh<"u"?function(t){return sh.resolve(null).then(t).catch(hy)}:cc;function hy(t){setTimeout(function(){throw t})}function lc(t,i){var a=i,d=0;do{var f=a.nextSibling;if(t.removeChild(a),f&&f.nodeType===8)if(a=f.data,a==="/$"){if(d===0){t.removeChild(f),Mr(i);return}d--}else a!=="$"&&a!=="$?"&&a!=="$!"||d++;a=f}while(a);Mr(i)}function Wn(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function oh(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return t;i--}else a==="/$"&&i++}t=t.previousSibling}return null}var qi=Math.random().toString(36).slice(2),hn="__reactFiber$"+qi,Wr="__reactProps$"+qi,bn="__reactContainer$"+qi,uc="__reactEvents$"+qi,fy="__reactListeners$"+qi,py="__reactHandles$"+qi;function gi(t){var i=t[hn];if(i)return i;for(var a=t.parentNode;a;){if(i=a[bn]||a[hn]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(t=oh(t);t!==null;){if(a=t[hn])return a;t=oh(t)}return i}t=a,a=t.parentNode}return null}function Hr(t){return t=t[hn]||t[bn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Wi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(n(33))}function Ys(t){return t[Wr]||null}var dc=[],Hi=-1;function Hn(t){return{current:t}}function Ue(t){0>Hi||(t.current=dc[Hi],dc[Hi]=null,Hi--)}function Ae(t,i){Hi++,dc[Hi]=t.current,t.current=i}var Kn={},gt=Hn(Kn),_t=Hn(!1),vi=Kn;function Ki(t,i){var a=t.type.contextTypes;if(!a)return Kn;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var f={},m;for(m in a)f[m]=i[m];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=f),f}function Pt(t){return t=t.childContextTypes,t!=null}function Xs(){Ue(_t),Ue(gt)}function ah(t,i,a){if(gt.current!==Kn)throw Error(n(168));Ae(gt,i),Ae(_t,a)}function ch(t,i,a){var d=t.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return a;d=d.getChildContext();for(var f in d)if(!(f in i))throw Error(n(108,Ne(t)||"Unknown",f));return ie({},a,d)}function Zs(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Kn,vi=gt.current,Ae(gt,t),Ae(_t,_t.current),!0}function lh(t,i,a){var d=t.stateNode;if(!d)throw Error(n(169));a?(t=ch(t,i,vi),d.__reactInternalMemoizedMergedChildContext=t,Ue(_t),Ue(gt),Ae(gt,t)):Ue(_t),Ae(_t,a)}var wn=null,eo=!1,hc=!1;function uh(t){wn===null?wn=[t]:wn.push(t)}function my(t){eo=!0,uh(t)}function Gn(){if(!hc&&wn!==null){hc=!0;var t=0,i=xe;try{var a=wn;for(xe=1;t<a.length;t++){var d=a[t];do d=d(!0);while(d!==null)}wn=null,eo=!1}catch(f){throw wn!==null&&(wn=wn.slice(t+1)),hd(Na,Gn),f}finally{xe=i,hc=!1}}return null}var Gi=[],Ji=0,to=null,no=0,Vt=[],zt=0,yi=null,En=1,_n="";function ki(t,i){Gi[Ji++]=no,Gi[Ji++]=to,to=t,no=i}function dh(t,i,a){Vt[zt++]=En,Vt[zt++]=_n,Vt[zt++]=yi,yi=t;var d=En;t=_n;var f=32-$t(d)-1;d&=~(1<<f),a+=1;var m=32-$t(i)+f;if(30<m){var y=f-f%5;m=(d&(1<<y)-1).toString(32),d>>=y,f-=y,En=1<<32-$t(i)+f|a<<f|d,_n=m+t}else En=1<<m|a<<f|d,_n=t}function fc(t){t.return!==null&&(ki(t,1),dh(t,1,0))}function pc(t){for(;t===to;)to=Gi[--Ji],Gi[Ji]=null,no=Gi[--Ji],Gi[Ji]=null;for(;t===yi;)yi=Vt[--zt],Vt[zt]=null,_n=Vt[--zt],Vt[zt]=null,En=Vt[--zt],Vt[zt]=null}var Ut=null,Ft=null,Ve=!1,Xt=null;function hh(t,i){var a=Kt(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=t,i=t.deletions,i===null?(t.deletions=[a],t.flags|=16):i.push(a)}function fh(t,i){switch(t.tag){case 5:var a=t.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,Ut=t,Ft=Wn(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,Ut=t,Ft=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=yi!==null?{id:En,overflow:_n}:null,t.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=Kt(18,null,null,0),a.stateNode=i,a.return=t,t.child=a,Ut=t,Ft=null,!0):!1;default:return!1}}function mc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function gc(t){if(Ve){var i=Ft;if(i){var a=i;if(!fh(t,i)){if(mc(t))throw Error(n(418));i=Wn(a.nextSibling);var d=Ut;i&&fh(t,i)?hh(d,a):(t.flags=t.flags&-4097|2,Ve=!1,Ut=t)}}else{if(mc(t))throw Error(n(418));t.flags=t.flags&-4097|2,Ve=!1,Ut=t}}}function ph(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ut=t}function io(t){if(t!==Ut)return!1;if(!Ve)return ph(t),Ve=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!ac(t.type,t.memoizedProps)),i&&(i=Ft)){if(mc(t))throw mh(),Error(n(418));for(;i;)hh(t,i),i=Wn(i.nextSibling)}if(ph(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(n(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"){if(i===0){Ft=Wn(t.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}t=t.nextSibling}Ft=null}}else Ft=Ut?Wn(t.stateNode.nextSibling):null;return!0}function mh(){for(var t=Ft;t;)t=Wn(t.nextSibling)}function Qi(){Ft=Ut=null,Ve=!1}function vc(t){Xt===null?Xt=[t]:Xt.push(t)}var gy=R.ReactCurrentBatchConfig;function Kr(t,i,a){if(t=a.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(n(309));var d=a.stateNode}if(!d)throw Error(n(147,t));var f=d,m=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===m?i.ref:(i=function(y){var T=f.refs;y===null?delete T[m]:T[m]=y},i._stringRef=m,i)}if(typeof t!="string")throw Error(n(284));if(!a._owner)throw Error(n(290,t))}return t}function ro(t,i){throw t=Object.prototype.toString.call(i),Error(n(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function gh(t){var i=t._init;return i(t._payload)}function vh(t){function i(I,E){if(t){var O=I.deletions;O===null?(I.deletions=[E],I.flags|=16):O.push(E)}}function a(I,E){if(!t)return null;for(;E!==null;)i(I,E),E=E.sibling;return null}function d(I,E){for(I=new Map;E!==null;)E.key!==null?I.set(E.key,E):I.set(E.index,E),E=E.sibling;return I}function f(I,E){return I=ti(I,E),I.index=0,I.sibling=null,I}function m(I,E,O){return I.index=O,t?(O=I.alternate,O!==null?(O=O.index,O<E?(I.flags|=2,E):O):(I.flags|=2,E)):(I.flags|=1048576,E)}function y(I){return t&&I.alternate===null&&(I.flags|=2),I}function T(I,E,O,K){return E===null||E.tag!==6?(E=cl(O,I.mode,K),E.return=I,E):(E=f(E,O),E.return=I,E)}function w(I,E,O,K){var le=O.type;return le===J?z(I,E,O.props.children,K,O.key):E!==null&&(E.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===nt&&gh(le)===E.type)?(K=f(E,O.props),K.ref=Kr(I,E,O),K.return=I,K):(K=Io(O.type,O.key,O.props,null,I.mode,K),K.ref=Kr(I,E,O),K.return=I,K)}function N(I,E,O,K){return E===null||E.tag!==4||E.stateNode.containerInfo!==O.containerInfo||E.stateNode.implementation!==O.implementation?(E=ll(O,I.mode,K),E.return=I,E):(E=f(E,O.children||[]),E.return=I,E)}function z(I,E,O,K,le){return E===null||E.tag!==7?(E=Pi(O,I.mode,K,le),E.return=I,E):(E=f(E,O),E.return=I,E)}function W(I,E,O){if(typeof E=="string"&&E!==""||typeof E=="number")return E=cl(""+E,I.mode,O),E.return=I,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case M:return O=Io(E.type,E.key,E.props,null,I.mode,O),O.ref=Kr(I,null,E),O.return=I,O;case F:return E=ll(E,I.mode,O),E.return=I,E;case nt:var K=E._init;return W(I,K(E._payload),O)}if(Tr(E)||ue(E))return E=Pi(E,I.mode,O,null),E.return=I,E;ro(I,E)}return null}function V(I,E,O,K){var le=E!==null?E.key:null;if(typeof O=="string"&&O!==""||typeof O=="number")return le!==null?null:T(I,E,""+O,K);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case M:return O.key===le?w(I,E,O,K):null;case F:return O.key===le?N(I,E,O,K):null;case nt:return le=O._init,V(I,E,le(O._payload),K)}if(Tr(O)||ue(O))return le!==null?null:z(I,E,O,K,null);ro(I,O)}return null}function re(I,E,O,K,le){if(typeof K=="string"&&K!==""||typeof K=="number")return I=I.get(O)||null,T(E,I,""+K,le);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case M:return I=I.get(K.key===null?O:K.key)||null,w(E,I,K,le);case F:return I=I.get(K.key===null?O:K.key)||null,N(E,I,K,le);case nt:var he=K._init;return re(I,E,O,he(K._payload),le)}if(Tr(K)||ue(K))return I=I.get(O)||null,z(E,I,K,le,null);ro(E,K)}return null}function ae(I,E,O,K){for(var le=null,he=null,fe=E,pe=E=0,lt=null;fe!==null&&pe<O.length;pe++){fe.index>pe?(lt=fe,fe=null):lt=fe.sibling;var _e=V(I,fe,O[pe],K);if(_e===null){fe===null&&(fe=lt);break}t&&fe&&_e.alternate===null&&i(I,fe),E=m(_e,E,pe),he===null?le=_e:he.sibling=_e,he=_e,fe=lt}if(pe===O.length)return a(I,fe),Ve&&ki(I,pe),le;if(fe===null){for(;pe<O.length;pe++)fe=W(I,O[pe],K),fe!==null&&(E=m(fe,E,pe),he===null?le=fe:he.sibling=fe,he=fe);return Ve&&ki(I,pe),le}for(fe=d(I,fe);pe<O.length;pe++)lt=re(fe,I,pe,O[pe],K),lt!==null&&(t&&lt.alternate!==null&&fe.delete(lt.key===null?pe:lt.key),E=m(lt,E,pe),he===null?le=lt:he.sibling=lt,he=lt);return t&&fe.forEach(function(ni){return i(I,ni)}),Ve&&ki(I,pe),le}function ce(I,E,O,K){var le=ue(O);if(typeof le!="function")throw Error(n(150));if(O=le.call(O),O==null)throw Error(n(151));for(var he=le=null,fe=E,pe=E=0,lt=null,_e=O.next();fe!==null&&!_e.done;pe++,_e=O.next()){fe.index>pe?(lt=fe,fe=null):lt=fe.sibling;var ni=V(I,fe,_e.value,K);if(ni===null){fe===null&&(fe=lt);break}t&&fe&&ni.alternate===null&&i(I,fe),E=m(ni,E,pe),he===null?le=ni:he.sibling=ni,he=ni,fe=lt}if(_e.done)return a(I,fe),Ve&&ki(I,pe),le;if(fe===null){for(;!_e.done;pe++,_e=O.next())_e=W(I,_e.value,K),_e!==null&&(E=m(_e,E,pe),he===null?le=_e:he.sibling=_e,he=_e);return Ve&&ki(I,pe),le}for(fe=d(I,fe);!_e.done;pe++,_e=O.next())_e=re(fe,I,pe,_e.value,K),_e!==null&&(t&&_e.alternate!==null&&fe.delete(_e.key===null?pe:_e.key),E=m(_e,E,pe),he===null?le=_e:he.sibling=_e,he=_e);return t&&fe.forEach(function(Qy){return i(I,Qy)}),Ve&&ki(I,pe),le}function Ye(I,E,O,K){if(typeof O=="object"&&O!==null&&O.type===J&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case M:e:{for(var le=O.key,he=E;he!==null;){if(he.key===le){if(le=O.type,le===J){if(he.tag===7){a(I,he.sibling),E=f(he,O.props.children),E.return=I,I=E;break e}}else if(he.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===nt&&gh(le)===he.type){a(I,he.sibling),E=f(he,O.props),E.ref=Kr(I,he,O),E.return=I,I=E;break e}a(I,he);break}else i(I,he);he=he.sibling}O.type===J?(E=Pi(O.props.children,I.mode,K,O.key),E.return=I,I=E):(K=Io(O.type,O.key,O.props,null,I.mode,K),K.ref=Kr(I,E,O),K.return=I,I=K)}return y(I);case F:e:{for(he=O.key;E!==null;){if(E.key===he)if(E.tag===4&&E.stateNode.containerInfo===O.containerInfo&&E.stateNode.implementation===O.implementation){a(I,E.sibling),E=f(E,O.children||[]),E.return=I,I=E;break e}else{a(I,E);break}else i(I,E);E=E.sibling}E=ll(O,I.mode,K),E.return=I,I=E}return y(I);case nt:return he=O._init,Ye(I,E,he(O._payload),K)}if(Tr(O))return ae(I,E,O,K);if(ue(O))return ce(I,E,O,K);ro(I,O)}return typeof O=="string"&&O!==""||typeof O=="number"?(O=""+O,E!==null&&E.tag===6?(a(I,E.sibling),E=f(E,O),E.return=I,I=E):(a(I,E),E=cl(O,I.mode,K),E.return=I,I=E),y(I)):a(I,E)}return Ye}var $i=vh(!0),yh=vh(!1),so=Hn(null),oo=null,Yi=null,yc=null;function kc(){yc=Yi=oo=null}function Sc(t){var i=so.current;Ue(so),t._currentValue=i}function Tc(t,i,a){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===a)break;t=t.return}}function Xi(t,i){oo=t,yc=Yi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&i)!==0&&(Rt=!0),t.firstContext=null)}function qt(t){var i=t._currentValue;if(yc!==t)if(t={context:t,memoizedValue:i,next:null},Yi===null){if(oo===null)throw Error(n(308));Yi=t,oo.dependencies={lanes:0,firstContext:t}}else Yi=Yi.next=t;return i}var Si=null;function Cc(t){Si===null?Si=[t]:Si.push(t)}function kh(t,i,a,d){var f=i.interleaved;return f===null?(a.next=a,Cc(i)):(a.next=f.next,f.next=a),i.interleaved=a,Pn(t,d)}function Pn(t,i){t.lanes|=i;var a=t.alternate;for(a!==null&&(a.lanes|=i),a=t,t=t.return;t!==null;)t.childLanes|=i,a=t.alternate,a!==null&&(a.childLanes|=i),a=t,t=t.return;return a.tag===3?a.stateNode:null}var Jn=!1;function bc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sh(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Rn(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function Qn(t,i,a){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,(we&2)!==0){var f=d.pending;return f===null?i.next=i:(i.next=f.next,f.next=i),d.pending=i,Pn(t,a)}return f=d.interleaved,f===null?(i.next=i,Cc(d)):(i.next=f.next,f.next=i),d.interleaved=i,Pn(t,a)}function ao(t,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var d=i.lanes;d&=t.pendingLanes,a|=d,i.lanes=a,Ua(t,a)}}function Th(t,i){var a=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,a===d)){var f=null,m=null;if(a=a.firstBaseUpdate,a!==null){do{var y={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};m===null?f=m=y:m=m.next=y,a=a.next}while(a!==null);m===null?f=m=i:m=m.next=i}else f=m=i;a={baseState:d.baseState,firstBaseUpdate:f,lastBaseUpdate:m,shared:d.shared,effects:d.effects},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=i:t.next=i,a.lastBaseUpdate=i}function co(t,i,a,d){var f=t.updateQueue;Jn=!1;var m=f.firstBaseUpdate,y=f.lastBaseUpdate,T=f.shared.pending;if(T!==null){f.shared.pending=null;var w=T,N=w.next;w.next=null,y===null?m=N:y.next=N,y=w;var z=t.alternate;z!==null&&(z=z.updateQueue,T=z.lastBaseUpdate,T!==y&&(T===null?z.firstBaseUpdate=N:T.next=N,z.lastBaseUpdate=w))}if(m!==null){var W=f.baseState;y=0,z=N=w=null,T=m;do{var V=T.lane,re=T.eventTime;if((d&V)===V){z!==null&&(z=z.next={eventTime:re,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var ae=t,ce=T;switch(V=i,re=a,ce.tag){case 1:if(ae=ce.payload,typeof ae=="function"){W=ae.call(re,W,V);break e}W=ae;break e;case 3:ae.flags=ae.flags&-65537|128;case 0:if(ae=ce.payload,V=typeof ae=="function"?ae.call(re,W,V):ae,V==null)break e;W=ie({},W,V);break e;case 2:Jn=!0}}T.callback!==null&&T.lane!==0&&(t.flags|=64,V=f.effects,V===null?f.effects=[T]:V.push(T))}else re={eventTime:re,lane:V,tag:T.tag,payload:T.payload,callback:T.callback,next:null},z===null?(N=z=re,w=W):z=z.next=re,y|=V;if(T=T.next,T===null){if(T=f.shared.pending,T===null)break;V=T,T=V.next,V.next=null,f.lastBaseUpdate=V,f.shared.pending=null}}while(!0);if(z===null&&(w=W),f.baseState=w,f.firstBaseUpdate=N,f.lastBaseUpdate=z,i=f.shared.interleaved,i!==null){f=i;do y|=f.lane,f=f.next;while(f!==i)}else m===null&&(f.shared.lanes=0);bi|=y,t.lanes=y,t.memoizedState=W}}function Ch(t,i,a){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var d=t[i],f=d.callback;if(f!==null){if(d.callback=null,d=a,typeof f!="function")throw Error(n(191,f));f.call(d)}}}var Gr={},fn=Hn(Gr),Jr=Hn(Gr),Qr=Hn(Gr);function Ti(t){if(t===Gr)throw Error(n(174));return t}function wc(t,i){switch(Ae(Qr,i),Ae(Jr,t),Ae(fn,Gr),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Ea(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=Ea(i,t)}Ue(fn),Ae(fn,i)}function Zi(){Ue(fn),Ue(Jr),Ue(Qr)}function bh(t){Ti(Qr.current);var i=Ti(fn.current),a=Ea(i,t.type);i!==a&&(Ae(Jr,t),Ae(fn,a))}function Ec(t){Jr.current===t&&(Ue(fn),Ue(Jr))}var We=Hn(0);function lo(t){for(var i=t;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var _c=[];function Pc(){for(var t=0;t<_c.length;t++)_c[t]._workInProgressVersionPrimary=null;_c.length=0}var uo=R.ReactCurrentDispatcher,Rc=R.ReactCurrentBatchConfig,Ci=0,He=null,it=null,at=null,ho=!1,$r=!1,Yr=0,vy=0;function vt(){throw Error(n(321))}function Ic(t,i){if(i===null)return!1;for(var a=0;a<i.length&&a<t.length;a++)if(!Yt(t[a],i[a]))return!1;return!0}function xc(t,i,a,d,f,m){if(Ci=m,He=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,uo.current=t===null||t.memoizedState===null?Ty:Cy,t=a(d,f),$r){m=0;do{if($r=!1,Yr=0,25<=m)throw Error(n(301));m+=1,at=it=null,i.updateQueue=null,uo.current=by,t=a(d,f)}while($r)}if(uo.current=mo,i=it!==null&&it.next!==null,Ci=0,at=it=He=null,ho=!1,i)throw Error(n(300));return t}function Oc(){var t=Yr!==0;return Yr=0,t}function pn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return at===null?He.memoizedState=at=t:at=at.next=t,at}function Wt(){if(it===null){var t=He.alternate;t=t!==null?t.memoizedState:null}else t=it.next;var i=at===null?He.memoizedState:at.next;if(i!==null)at=i,it=t;else{if(t===null)throw Error(n(310));it=t,t={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},at===null?He.memoizedState=at=t:at=at.next=t}return at}function Xr(t,i){return typeof i=="function"?i(t):i}function Dc(t){var i=Wt(),a=i.queue;if(a===null)throw Error(n(311));a.lastRenderedReducer=t;var d=it,f=d.baseQueue,m=a.pending;if(m!==null){if(f!==null){var y=f.next;f.next=m.next,m.next=y}d.baseQueue=f=m,a.pending=null}if(f!==null){m=f.next,d=d.baseState;var T=y=null,w=null,N=m;do{var z=N.lane;if((Ci&z)===z)w!==null&&(w=w.next={lane:0,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),d=N.hasEagerState?N.eagerState:t(d,N.action);else{var W={lane:z,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null};w===null?(T=w=W,y=d):w=w.next=W,He.lanes|=z,bi|=z}N=N.next}while(N!==null&&N!==m);w===null?y=d:w.next=T,Yt(d,i.memoizedState)||(Rt=!0),i.memoizedState=d,i.baseState=y,i.baseQueue=w,a.lastRenderedState=d}if(t=a.interleaved,t!==null){f=t;do m=f.lane,He.lanes|=m,bi|=m,f=f.next;while(f!==t)}else f===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function Mc(t){var i=Wt(),a=i.queue;if(a===null)throw Error(n(311));a.lastRenderedReducer=t;var d=a.dispatch,f=a.pending,m=i.memoizedState;if(f!==null){a.pending=null;var y=f=f.next;do m=t(m,y.action),y=y.next;while(y!==f);Yt(m,i.memoizedState)||(Rt=!0),i.memoizedState=m,i.baseQueue===null&&(i.baseState=m),a.lastRenderedState=m}return[m,d]}function wh(){}function Eh(t,i){var a=He,d=Wt(),f=i(),m=!Yt(d.memoizedState,f);if(m&&(d.memoizedState=f,Rt=!0),d=d.queue,Nc(Rh.bind(null,a,d,t),[t]),d.getSnapshot!==i||m||at!==null&&at.memoizedState.tag&1){if(a.flags|=2048,Zr(9,Ph.bind(null,a,d,f,i),void 0,null),ct===null)throw Error(n(349));(Ci&30)!==0||_h(a,i,f)}return f}function _h(t,i,a){t.flags|=16384,t={getSnapshot:i,value:a},i=He.updateQueue,i===null?(i={lastEffect:null,stores:null},He.updateQueue=i,i.stores=[t]):(a=i.stores,a===null?i.stores=[t]:a.push(t))}function Ph(t,i,a,d){i.value=a,i.getSnapshot=d,Ih(i)&&xh(t)}function Rh(t,i,a){return a(function(){Ih(i)&&xh(t)})}function Ih(t){var i=t.getSnapshot;t=t.value;try{var a=i();return!Yt(t,a)}catch{return!0}}function xh(t){var i=Pn(t,1);i!==null&&nn(i,t,1,-1)}function Oh(t){var i=pn();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xr,lastRenderedState:t},i.queue=t,t=t.dispatch=Sy.bind(null,He,t),[i.memoizedState,t]}function Zr(t,i,a,d){return t={tag:t,create:i,destroy:a,deps:d,next:null},i=He.updateQueue,i===null?(i={lastEffect:null,stores:null},He.updateQueue=i,i.lastEffect=t.next=t):(a=i.lastEffect,a===null?i.lastEffect=t.next=t:(d=a.next,a.next=t,t.next=d,i.lastEffect=t)),t}function Dh(){return Wt().memoizedState}function fo(t,i,a,d){var f=pn();He.flags|=t,f.memoizedState=Zr(1|i,a,void 0,d===void 0?null:d)}function po(t,i,a,d){var f=Wt();d=d===void 0?null:d;var m=void 0;if(it!==null){var y=it.memoizedState;if(m=y.destroy,d!==null&&Ic(d,y.deps)){f.memoizedState=Zr(i,a,m,d);return}}He.flags|=t,f.memoizedState=Zr(1|i,a,m,d)}function Mh(t,i){return fo(8390656,8,t,i)}function Nc(t,i){return po(2048,8,t,i)}function Nh(t,i){return po(4,2,t,i)}function Ah(t,i){return po(4,4,t,i)}function Lh(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function Uh(t,i,a){return a=a!=null?a.concat([t]):null,po(4,4,Lh.bind(null,i,t),a)}function Ac(){}function Fh(t,i){var a=Wt();i=i===void 0?null:i;var d=a.memoizedState;return d!==null&&i!==null&&Ic(i,d[1])?d[0]:(a.memoizedState=[t,i],t)}function jh(t,i){var a=Wt();i=i===void 0?null:i;var d=a.memoizedState;return d!==null&&i!==null&&Ic(i,d[1])?d[0]:(t=t(),a.memoizedState=[t,i],t)}function Bh(t,i,a){return(Ci&21)===0?(t.baseState&&(t.baseState=!1,Rt=!0),t.memoizedState=a):(Yt(a,i)||(a=gd(),He.lanes|=a,bi|=a,t.baseState=!0),i)}function yy(t,i){var a=xe;xe=a!==0&&4>a?a:4,t(!0);var d=Rc.transition;Rc.transition={};try{t(!1),i()}finally{xe=a,Rc.transition=d}}function Vh(){return Wt().memoizedState}function ky(t,i,a){var d=Zn(t);if(a={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null},zh(t))qh(i,a);else if(a=kh(t,i,a,d),a!==null){var f=Tt();nn(a,t,d,f),Wh(a,i,d)}}function Sy(t,i,a){var d=Zn(t),f={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null};if(zh(t))qh(i,f);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=i.lastRenderedReducer,m!==null))try{var y=i.lastRenderedState,T=m(y,a);if(f.hasEagerState=!0,f.eagerState=T,Yt(T,y)){var w=i.interleaved;w===null?(f.next=f,Cc(i)):(f.next=w.next,w.next=f),i.interleaved=f;return}}catch{}finally{}a=kh(t,i,f,d),a!==null&&(f=Tt(),nn(a,t,d,f),Wh(a,i,d))}}function zh(t){var i=t.alternate;return t===He||i!==null&&i===He}function qh(t,i){$r=ho=!0;var a=t.pending;a===null?i.next=i:(i.next=a.next,a.next=i),t.pending=i}function Wh(t,i,a){if((a&4194240)!==0){var d=i.lanes;d&=t.pendingLanes,a|=d,i.lanes=a,Ua(t,a)}}var mo={readContext:qt,useCallback:vt,useContext:vt,useEffect:vt,useImperativeHandle:vt,useInsertionEffect:vt,useLayoutEffect:vt,useMemo:vt,useReducer:vt,useRef:vt,useState:vt,useDebugValue:vt,useDeferredValue:vt,useTransition:vt,useMutableSource:vt,useSyncExternalStore:vt,useId:vt,unstable_isNewReconciler:!1},Ty={readContext:qt,useCallback:function(t,i){return pn().memoizedState=[t,i===void 0?null:i],t},useContext:qt,useEffect:Mh,useImperativeHandle:function(t,i,a){return a=a!=null?a.concat([t]):null,fo(4194308,4,Lh.bind(null,i,t),a)},useLayoutEffect:function(t,i){return fo(4194308,4,t,i)},useInsertionEffect:function(t,i){return fo(4,2,t,i)},useMemo:function(t,i){var a=pn();return i=i===void 0?null:i,t=t(),a.memoizedState=[t,i],t},useReducer:function(t,i,a){var d=pn();return i=a!==void 0?a(i):i,d.memoizedState=d.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},d.queue=t,t=t.dispatch=ky.bind(null,He,t),[d.memoizedState,t]},useRef:function(t){var i=pn();return t={current:t},i.memoizedState=t},useState:Oh,useDebugValue:Ac,useDeferredValue:function(t){return pn().memoizedState=t},useTransition:function(){var t=Oh(!1),i=t[0];return t=yy.bind(null,t[1]),pn().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,a){var d=He,f=pn();if(Ve){if(a===void 0)throw Error(n(407));a=a()}else{if(a=i(),ct===null)throw Error(n(349));(Ci&30)!==0||_h(d,i,a)}f.memoizedState=a;var m={value:a,getSnapshot:i};return f.queue=m,Mh(Rh.bind(null,d,m,t),[t]),d.flags|=2048,Zr(9,Ph.bind(null,d,m,a,i),void 0,null),a},useId:function(){var t=pn(),i=ct.identifierPrefix;if(Ve){var a=_n,d=En;a=(d&~(1<<32-$t(d)-1)).toString(32)+a,i=":"+i+"R"+a,a=Yr++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=vy++,i=":"+i+"r"+a.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},Cy={readContext:qt,useCallback:Fh,useContext:qt,useEffect:Nc,useImperativeHandle:Uh,useInsertionEffect:Nh,useLayoutEffect:Ah,useMemo:jh,useReducer:Dc,useRef:Dh,useState:function(){return Dc(Xr)},useDebugValue:Ac,useDeferredValue:function(t){var i=Wt();return Bh(i,it.memoizedState,t)},useTransition:function(){var t=Dc(Xr)[0],i=Wt().memoizedState;return[t,i]},useMutableSource:wh,useSyncExternalStore:Eh,useId:Vh,unstable_isNewReconciler:!1},by={readContext:qt,useCallback:Fh,useContext:qt,useEffect:Nc,useImperativeHandle:Uh,useInsertionEffect:Nh,useLayoutEffect:Ah,useMemo:jh,useReducer:Mc,useRef:Dh,useState:function(){return Mc(Xr)},useDebugValue:Ac,useDeferredValue:function(t){var i=Wt();return it===null?i.memoizedState=t:Bh(i,it.memoizedState,t)},useTransition:function(){var t=Mc(Xr)[0],i=Wt().memoizedState;return[t,i]},useMutableSource:wh,useSyncExternalStore:Eh,useId:Vh,unstable_isNewReconciler:!1};function Zt(t,i){if(t&&t.defaultProps){i=ie({},i),t=t.defaultProps;for(var a in t)i[a]===void 0&&(i[a]=t[a]);return i}return i}function Lc(t,i,a,d){i=t.memoizedState,a=a(d,i),a=a==null?i:ie({},i,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var go={isMounted:function(t){return(t=t._reactInternals)?mi(t)===t:!1},enqueueSetState:function(t,i,a){t=t._reactInternals;var d=Tt(),f=Zn(t),m=Rn(d,f);m.payload=i,a!=null&&(m.callback=a),i=Qn(t,m,f),i!==null&&(nn(i,t,f,d),ao(i,t,f))},enqueueReplaceState:function(t,i,a){t=t._reactInternals;var d=Tt(),f=Zn(t),m=Rn(d,f);m.tag=1,m.payload=i,a!=null&&(m.callback=a),i=Qn(t,m,f),i!==null&&(nn(i,t,f,d),ao(i,t,f))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var a=Tt(),d=Zn(t),f=Rn(a,d);f.tag=2,i!=null&&(f.callback=i),i=Qn(t,f,d),i!==null&&(nn(i,t,d,a),ao(i,t,d))}};function Hh(t,i,a,d,f,m,y){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,m,y):i.prototype&&i.prototype.isPureReactComponent?!jr(a,d)||!jr(f,m):!0}function Kh(t,i,a){var d=!1,f=Kn,m=i.contextType;return typeof m=="object"&&m!==null?m=qt(m):(f=Pt(i)?vi:gt.current,d=i.contextTypes,m=(d=d!=null)?Ki(t,f):Kn),i=new i(a,m),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=go,t.stateNode=i,i._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=f,t.__reactInternalMemoizedMaskedChildContext=m),i}function Gh(t,i,a,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,d),i.state!==t&&go.enqueueReplaceState(i,i.state,null)}function Uc(t,i,a,d){var f=t.stateNode;f.props=a,f.state=t.memoizedState,f.refs={},bc(t);var m=i.contextType;typeof m=="object"&&m!==null?f.context=qt(m):(m=Pt(i)?vi:gt.current,f.context=Ki(t,m)),f.state=t.memoizedState,m=i.getDerivedStateFromProps,typeof m=="function"&&(Lc(t,i,m,a),f.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(i=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),i!==f.state&&go.enqueueReplaceState(f,f.state,null),co(t,a,f,d),f.state=t.memoizedState),typeof f.componentDidMount=="function"&&(t.flags|=4194308)}function er(t,i){try{var a="",d=i;do a+=Se(d),d=d.return;while(d);var f=a}catch(m){f=`
Error generating stack: `+m.message+`
`+m.stack}return{value:t,source:i,stack:f,digest:null}}function Fc(t,i,a){return{value:t,source:null,stack:a??null,digest:i??null}}function jc(t,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var wy=typeof WeakMap=="function"?WeakMap:Map;function Jh(t,i,a){a=Rn(-1,a),a.tag=3,a.payload={element:null};var d=i.value;return a.callback=function(){bo||(bo=!0,el=d),jc(t,i)},a}function Qh(t,i,a){a=Rn(-1,a),a.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var f=i.value;a.payload=function(){return d(f)},a.callback=function(){jc(t,i)}}var m=t.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(a.callback=function(){jc(t,i),typeof d!="function"&&(Yn===null?Yn=new Set([this]):Yn.add(this));var y=i.stack;this.componentDidCatch(i.value,{componentStack:y!==null?y:""})}),a}function $h(t,i,a){var d=t.pingCache;if(d===null){d=t.pingCache=new wy;var f=new Set;d.set(i,f)}else f=d.get(i),f===void 0&&(f=new Set,d.set(i,f));f.has(a)||(f.add(a),t=Fy.bind(null,t,i,a),i.then(t,t))}function Yh(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function Xh(t,i,a,d,f){return(t.mode&1)===0?(t===i?t.flags|=65536:(t.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=Rn(-1,1),i.tag=2,Qn(a,i,1))),a.lanes|=1),t):(t.flags|=65536,t.lanes=f,t)}var Ey=R.ReactCurrentOwner,Rt=!1;function St(t,i,a,d){i.child=t===null?yh(i,null,a,d):$i(i,t.child,a,d)}function Zh(t,i,a,d,f){a=a.render;var m=i.ref;return Xi(i,f),d=xc(t,i,a,d,m,f),a=Oc(),t!==null&&!Rt?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~f,In(t,i,f)):(Ve&&a&&fc(i),i.flags|=1,St(t,i,d,f),i.child)}function ef(t,i,a,d,f){if(t===null){var m=a.type;return typeof m=="function"&&!al(m)&&m.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=m,tf(t,i,m,d,f)):(t=Io(a.type,null,d,i,i.mode,f),t.ref=i.ref,t.return=i,i.child=t)}if(m=t.child,(t.lanes&f)===0){var y=m.memoizedProps;if(a=a.compare,a=a!==null?a:jr,a(y,d)&&t.ref===i.ref)return In(t,i,f)}return i.flags|=1,t=ti(m,d),t.ref=i.ref,t.return=i,i.child=t}function tf(t,i,a,d,f){if(t!==null){var m=t.memoizedProps;if(jr(m,d)&&t.ref===i.ref)if(Rt=!1,i.pendingProps=d=m,(t.lanes&f)!==0)(t.flags&131072)!==0&&(Rt=!0);else return i.lanes=t.lanes,In(t,i,f)}return Bc(t,i,a,d,f)}function nf(t,i,a){var d=i.pendingProps,f=d.children,m=t!==null?t.memoizedState:null;if(d.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ae(nr,jt),jt|=a;else{if((a&1073741824)===0)return t=m!==null?m.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,Ae(nr,jt),jt|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=m!==null?m.baseLanes:a,Ae(nr,jt),jt|=d}else m!==null?(d=m.baseLanes|a,i.memoizedState=null):d=a,Ae(nr,jt),jt|=d;return St(t,i,f,a),i.child}function rf(t,i){var a=i.ref;(t===null&&a!==null||t!==null&&t.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function Bc(t,i,a,d,f){var m=Pt(a)?vi:gt.current;return m=Ki(i,m),Xi(i,f),a=xc(t,i,a,d,m,f),d=Oc(),t!==null&&!Rt?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~f,In(t,i,f)):(Ve&&d&&fc(i),i.flags|=1,St(t,i,a,f),i.child)}function sf(t,i,a,d,f){if(Pt(a)){var m=!0;Zs(i)}else m=!1;if(Xi(i,f),i.stateNode===null)yo(t,i),Kh(i,a,d),Uc(i,a,d,f),d=!0;else if(t===null){var y=i.stateNode,T=i.memoizedProps;y.props=T;var w=y.context,N=a.contextType;typeof N=="object"&&N!==null?N=qt(N):(N=Pt(a)?vi:gt.current,N=Ki(i,N));var z=a.getDerivedStateFromProps,W=typeof z=="function"||typeof y.getSnapshotBeforeUpdate=="function";W||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==d||w!==N)&&Gh(i,y,d,N),Jn=!1;var V=i.memoizedState;y.state=V,co(i,d,y,f),w=i.memoizedState,T!==d||V!==w||_t.current||Jn?(typeof z=="function"&&(Lc(i,a,z,d),w=i.memoizedState),(T=Jn||Hh(i,a,T,d,V,w,N))?(W||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(i.flags|=4194308)):(typeof y.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=w),y.props=d,y.state=w,y.context=N,d=T):(typeof y.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{y=i.stateNode,Sh(t,i),T=i.memoizedProps,N=i.type===i.elementType?T:Zt(i.type,T),y.props=N,W=i.pendingProps,V=y.context,w=a.contextType,typeof w=="object"&&w!==null?w=qt(w):(w=Pt(a)?vi:gt.current,w=Ki(i,w));var re=a.getDerivedStateFromProps;(z=typeof re=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==W||V!==w)&&Gh(i,y,d,w),Jn=!1,V=i.memoizedState,y.state=V,co(i,d,y,f);var ae=i.memoizedState;T!==W||V!==ae||_t.current||Jn?(typeof re=="function"&&(Lc(i,a,re,d),ae=i.memoizedState),(N=Jn||Hh(i,a,N,d,V,ae,w)||!1)?(z||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(d,ae,w),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(d,ae,w)),typeof y.componentDidUpdate=="function"&&(i.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(i.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=ae),y.props=d,y.state=ae,y.context=w,d=N):(typeof y.componentDidUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(i.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(i.flags|=1024),d=!1)}return Vc(t,i,a,d,m,f)}function Vc(t,i,a,d,f,m){rf(t,i);var y=(i.flags&128)!==0;if(!d&&!y)return f&&lh(i,a,!1),In(t,i,m);d=i.stateNode,Ey.current=i;var T=y&&typeof a.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,t!==null&&y?(i.child=$i(i,t.child,null,m),i.child=$i(i,null,T,m)):St(t,i,T,m),i.memoizedState=d.state,f&&lh(i,a,!0),i.child}function of(t){var i=t.stateNode;i.pendingContext?ah(t,i.pendingContext,i.pendingContext!==i.context):i.context&&ah(t,i.context,!1),wc(t,i.containerInfo)}function af(t,i,a,d,f){return Qi(),vc(f),i.flags|=256,St(t,i,a,d),i.child}var zc={dehydrated:null,treeContext:null,retryLane:0};function qc(t){return{baseLanes:t,cachePool:null,transitions:null}}function cf(t,i,a){var d=i.pendingProps,f=We.current,m=!1,y=(i.flags&128)!==0,T;if((T=y)||(T=t!==null&&t.memoizedState===null?!1:(f&2)!==0),T?(m=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(f|=1),Ae(We,f&1),t===null)return gc(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((i.mode&1)===0?i.lanes=1:t.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(y=d.children,t=d.fallback,m?(d=i.mode,m=i.child,y={mode:"hidden",children:y},(d&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=y):m=xo(y,d,0,null),t=Pi(t,d,a,null),m.return=i,t.return=i,m.sibling=t,i.child=m,i.child.memoizedState=qc(a),i.memoizedState=zc,t):Wc(i,y));if(f=t.memoizedState,f!==null&&(T=f.dehydrated,T!==null))return _y(t,i,y,d,T,f,a);if(m){m=d.fallback,y=i.mode,f=t.child,T=f.sibling;var w={mode:"hidden",children:d.children};return(y&1)===0&&i.child!==f?(d=i.child,d.childLanes=0,d.pendingProps=w,i.deletions=null):(d=ti(f,w),d.subtreeFlags=f.subtreeFlags&14680064),T!==null?m=ti(T,m):(m=Pi(m,y,a,null),m.flags|=2),m.return=i,d.return=i,d.sibling=m,i.child=d,d=m,m=i.child,y=t.child.memoizedState,y=y===null?qc(a):{baseLanes:y.baseLanes|a,cachePool:null,transitions:y.transitions},m.memoizedState=y,m.childLanes=t.childLanes&~a,i.memoizedState=zc,d}return m=t.child,t=m.sibling,d=ti(m,{mode:"visible",children:d.children}),(i.mode&1)===0&&(d.lanes=a),d.return=i,d.sibling=null,t!==null&&(a=i.deletions,a===null?(i.deletions=[t],i.flags|=16):a.push(t)),i.child=d,i.memoizedState=null,d}function Wc(t,i){return i=xo({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function vo(t,i,a,d){return d!==null&&vc(d),$i(i,t.child,null,a),t=Wc(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function _y(t,i,a,d,f,m,y){if(a)return i.flags&256?(i.flags&=-257,d=Fc(Error(n(422))),vo(t,i,y,d)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(m=d.fallback,f=i.mode,d=xo({mode:"visible",children:d.children},f,0,null),m=Pi(m,f,y,null),m.flags|=2,d.return=i,m.return=i,d.sibling=m,i.child=d,(i.mode&1)!==0&&$i(i,t.child,null,y),i.child.memoizedState=qc(y),i.memoizedState=zc,m);if((i.mode&1)===0)return vo(t,i,y,null);if(f.data==="$!"){if(d=f.nextSibling&&f.nextSibling.dataset,d)var T=d.dgst;return d=T,m=Error(n(419)),d=Fc(m,d,void 0),vo(t,i,y,d)}if(T=(y&t.childLanes)!==0,Rt||T){if(d=ct,d!==null){switch(y&-y){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=(f&(d.suspendedLanes|y))!==0?0:f,f!==0&&f!==m.retryLane&&(m.retryLane=f,Pn(t,f),nn(d,t,f,-1))}return ol(),d=Fc(Error(n(421))),vo(t,i,y,d)}return f.data==="$?"?(i.flags|=128,i.child=t.child,i=jy.bind(null,t),f._reactRetry=i,null):(t=m.treeContext,Ft=Wn(f.nextSibling),Ut=i,Ve=!0,Xt=null,t!==null&&(Vt[zt++]=En,Vt[zt++]=_n,Vt[zt++]=yi,En=t.id,_n=t.overflow,yi=i),i=Wc(i,d.children),i.flags|=4096,i)}function lf(t,i,a){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),Tc(t.return,i,a)}function Hc(t,i,a,d,f){var m=t.memoizedState;m===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:a,tailMode:f}:(m.isBackwards=i,m.rendering=null,m.renderingStartTime=0,m.last=d,m.tail=a,m.tailMode=f)}function uf(t,i,a){var d=i.pendingProps,f=d.revealOrder,m=d.tail;if(St(t,i,d.children,a),d=We.current,(d&2)!==0)d=d&1|2,i.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&lf(t,a,i);else if(t.tag===19)lf(t,a,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(Ae(We,d),(i.mode&1)===0)i.memoizedState=null;else switch(f){case"forwards":for(a=i.child,f=null;a!==null;)t=a.alternate,t!==null&&lo(t)===null&&(f=a),a=a.sibling;a=f,a===null?(f=i.child,i.child=null):(f=a.sibling,a.sibling=null),Hc(i,!1,f,a,m);break;case"backwards":for(a=null,f=i.child,i.child=null;f!==null;){if(t=f.alternate,t!==null&&lo(t)===null){i.child=f;break}t=f.sibling,f.sibling=a,a=f,f=t}Hc(i,!0,a,null,m);break;case"together":Hc(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function yo(t,i){(i.mode&1)===0&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function In(t,i,a){if(t!==null&&(i.dependencies=t.dependencies),bi|=i.lanes,(a&i.childLanes)===0)return null;if(t!==null&&i.child!==t.child)throw Error(n(153));if(i.child!==null){for(t=i.child,a=ti(t,t.pendingProps),i.child=a,a.return=i;t.sibling!==null;)t=t.sibling,a=a.sibling=ti(t,t.pendingProps),a.return=i;a.sibling=null}return i.child}function Py(t,i,a){switch(i.tag){case 3:of(i),Qi();break;case 5:bh(i);break;case 1:Pt(i.type)&&Zs(i);break;case 4:wc(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,f=i.memoizedProps.value;Ae(so,d._currentValue),d._currentValue=f;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(Ae(We,We.current&1),i.flags|=128,null):(a&i.child.childLanes)!==0?cf(t,i,a):(Ae(We,We.current&1),t=In(t,i,a),t!==null?t.sibling:null);Ae(We,We.current&1);break;case 19:if(d=(a&i.childLanes)!==0,(t.flags&128)!==0){if(d)return uf(t,i,a);i.flags|=128}if(f=i.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Ae(We,We.current),d)break;return null;case 22:case 23:return i.lanes=0,nf(t,i,a)}return In(t,i,a)}var df,Kc,hf,ff;df=function(t,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)t.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},Kc=function(){},hf=function(t,i,a,d){var f=t.memoizedProps;if(f!==d){t=i.stateNode,Ti(fn.current);var m=null;switch(a){case"input":f=Ta(t,f),d=Ta(t,d),m=[];break;case"select":f=ie({},f,{value:void 0}),d=ie({},d,{value:void 0}),m=[];break;case"textarea":f=wa(t,f),d=wa(t,d),m=[];break;default:typeof f.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=$s)}_a(a,d);var y;a=null;for(N in f)if(!d.hasOwnProperty(N)&&f.hasOwnProperty(N)&&f[N]!=null)if(N==="style"){var T=f[N];for(y in T)T.hasOwnProperty(y)&&(a||(a={}),a[y]="")}else N!=="dangerouslySetInnerHTML"&&N!=="children"&&N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(o.hasOwnProperty(N)?m||(m=[]):(m=m||[]).push(N,null));for(N in d){var w=d[N];if(T=f!=null?f[N]:void 0,d.hasOwnProperty(N)&&w!==T&&(w!=null||T!=null))if(N==="style")if(T){for(y in T)!T.hasOwnProperty(y)||w&&w.hasOwnProperty(y)||(a||(a={}),a[y]="");for(y in w)w.hasOwnProperty(y)&&T[y]!==w[y]&&(a||(a={}),a[y]=w[y])}else a||(m||(m=[]),m.push(N,a)),a=w;else N==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,T=T?T.__html:void 0,w!=null&&T!==w&&(m=m||[]).push(N,w)):N==="children"?typeof w!="string"&&typeof w!="number"||(m=m||[]).push(N,""+w):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&(o.hasOwnProperty(N)?(w!=null&&N==="onScroll"&&Le("scroll",t),m||T===w||(m=[])):(m=m||[]).push(N,w))}a&&(m=m||[]).push("style",a);var N=m;(i.updateQueue=N)&&(i.flags|=4)}},ff=function(t,i,a,d){a!==d&&(i.flags|=4)};function es(t,i){if(!Ve)switch(t.tailMode){case"hidden":i=t.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function yt(t){var i=t.alternate!==null&&t.alternate.child===t.child,a=0,d=0;if(i)for(var f=t.child;f!==null;)a|=f.lanes|f.childLanes,d|=f.subtreeFlags&14680064,d|=f.flags&14680064,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)a|=f.lanes|f.childLanes,d|=f.subtreeFlags,d|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=d,t.childLanes=a,i}function Ry(t,i,a){var d=i.pendingProps;switch(pc(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yt(i),null;case 1:return Pt(i.type)&&Xs(),yt(i),null;case 3:return d=i.stateNode,Zi(),Ue(_t),Ue(gt),Pc(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(io(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Xt!==null&&(il(Xt),Xt=null))),Kc(t,i),yt(i),null;case 5:Ec(i);var f=Ti(Qr.current);if(a=i.type,t!==null&&i.stateNode!=null)hf(t,i,a,d,f),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(n(166));return yt(i),null}if(t=Ti(fn.current),io(i)){d=i.stateNode,a=i.type;var m=i.memoizedProps;switch(d[hn]=i,d[Wr]=m,t=(i.mode&1)!==0,a){case"dialog":Le("cancel",d),Le("close",d);break;case"iframe":case"object":case"embed":Le("load",d);break;case"video":case"audio":for(f=0;f<Vr.length;f++)Le(Vr[f],d);break;case"source":Le("error",d);break;case"img":case"image":case"link":Le("error",d),Le("load",d);break;case"details":Le("toggle",d);break;case"input":Ku(d,m),Le("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!m.multiple},Le("invalid",d);break;case"textarea":Qu(d,m),Le("invalid",d)}_a(a,m),f=null;for(var y in m)if(m.hasOwnProperty(y)){var T=m[y];y==="children"?typeof T=="string"?d.textContent!==T&&(m.suppressHydrationWarning!==!0&&Qs(d.textContent,T,t),f=["children",T]):typeof T=="number"&&d.textContent!==""+T&&(m.suppressHydrationWarning!==!0&&Qs(d.textContent,T,t),f=["children",""+T]):o.hasOwnProperty(y)&&T!=null&&y==="onScroll"&&Le("scroll",d)}switch(a){case"input":_s(d),Ju(d,m,!0);break;case"textarea":_s(d),Yu(d);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(d.onclick=$s)}d=f,i.updateQueue=d,d!==null&&(i.flags|=4)}else{y=f.nodeType===9?f:f.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Xu(a)),t==="http://www.w3.org/1999/xhtml"?a==="script"?(t=y.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=y.createElement(a,{is:d.is}):(t=y.createElement(a),a==="select"&&(y=t,d.multiple?y.multiple=!0:d.size&&(y.size=d.size))):t=y.createElementNS(t,a),t[hn]=i,t[Wr]=d,df(t,i,!1,!1),i.stateNode=t;e:{switch(y=Pa(a,d),a){case"dialog":Le("cancel",t),Le("close",t),f=d;break;case"iframe":case"object":case"embed":Le("load",t),f=d;break;case"video":case"audio":for(f=0;f<Vr.length;f++)Le(Vr[f],t);f=d;break;case"source":Le("error",t),f=d;break;case"img":case"image":case"link":Le("error",t),Le("load",t),f=d;break;case"details":Le("toggle",t),f=d;break;case"input":Ku(t,d),f=Ta(t,d),Le("invalid",t);break;case"option":f=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},f=ie({},d,{value:void 0}),Le("invalid",t);break;case"textarea":Qu(t,d),f=wa(t,d),Le("invalid",t);break;default:f=d}_a(a,f),T=f;for(m in T)if(T.hasOwnProperty(m)){var w=T[m];m==="style"?td(t,w):m==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&Zu(t,w)):m==="children"?typeof w=="string"?(a!=="textarea"||w!=="")&&Cr(t,w):typeof w=="number"&&Cr(t,""+w):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(o.hasOwnProperty(m)?w!=null&&m==="onScroll"&&Le("scroll",t):w!=null&&H(t,m,w,y))}switch(a){case"input":_s(t),Ju(t,d,!1);break;case"textarea":_s(t),Yu(t);break;case"option":d.value!=null&&t.setAttribute("value",""+Ie(d.value));break;case"select":t.multiple=!!d.multiple,m=d.value,m!=null?Ni(t,!!d.multiple,m,!1):d.defaultValue!=null&&Ni(t,!!d.multiple,d.defaultValue,!0);break;default:typeof f.onClick=="function"&&(t.onclick=$s)}switch(a){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return yt(i),null;case 6:if(t&&i.stateNode!=null)ff(t,i,t.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(n(166));if(a=Ti(Qr.current),Ti(fn.current),io(i)){if(d=i.stateNode,a=i.memoizedProps,d[hn]=i,(m=d.nodeValue!==a)&&(t=Ut,t!==null))switch(t.tag){case 3:Qs(d.nodeValue,a,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Qs(d.nodeValue,a,(t.mode&1)!==0)}m&&(i.flags|=4)}else d=(a.nodeType===9?a:a.ownerDocument).createTextNode(d),d[hn]=i,i.stateNode=d}return yt(i),null;case 13:if(Ue(We),d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ve&&Ft!==null&&(i.mode&1)!==0&&(i.flags&128)===0)mh(),Qi(),i.flags|=98560,m=!1;else if(m=io(i),d!==null&&d.dehydrated!==null){if(t===null){if(!m)throw Error(n(318));if(m=i.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(n(317));m[hn]=i}else Qi(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;yt(i),m=!1}else Xt!==null&&(il(Xt),Xt=null),m=!0;if(!m)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=a,i):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(i.child.flags|=8192,(i.mode&1)!==0&&(t===null||(We.current&1)!==0?rt===0&&(rt=3):ol())),i.updateQueue!==null&&(i.flags|=4),yt(i),null);case 4:return Zi(),Kc(t,i),t===null&&zr(i.stateNode.containerInfo),yt(i),null;case 10:return Sc(i.type._context),yt(i),null;case 17:return Pt(i.type)&&Xs(),yt(i),null;case 19:if(Ue(We),m=i.memoizedState,m===null)return yt(i),null;if(d=(i.flags&128)!==0,y=m.rendering,y===null)if(d)es(m,!1);else{if(rt!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(y=lo(t),y!==null){for(i.flags|=128,es(m,!1),d=y.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=a,a=i.child;a!==null;)m=a,t=d,m.flags&=14680066,y=m.alternate,y===null?(m.childLanes=0,m.lanes=t,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=y.childLanes,m.lanes=y.lanes,m.child=y.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=y.memoizedProps,m.memoizedState=y.memoizedState,m.updateQueue=y.updateQueue,m.type=y.type,t=y.dependencies,m.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),a=a.sibling;return Ae(We,We.current&1|2),i.child}t=t.sibling}m.tail!==null&&$e()>ir&&(i.flags|=128,d=!0,es(m,!1),i.lanes=4194304)}else{if(!d)if(t=lo(y),t!==null){if(i.flags|=128,d=!0,a=t.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),es(m,!0),m.tail===null&&m.tailMode==="hidden"&&!y.alternate&&!Ve)return yt(i),null}else 2*$e()-m.renderingStartTime>ir&&a!==1073741824&&(i.flags|=128,d=!0,es(m,!1),i.lanes=4194304);m.isBackwards?(y.sibling=i.child,i.child=y):(a=m.last,a!==null?a.sibling=y:i.child=y,m.last=y)}return m.tail!==null?(i=m.tail,m.rendering=i,m.tail=i.sibling,m.renderingStartTime=$e(),i.sibling=null,a=We.current,Ae(We,d?a&1|2:a&1),i):(yt(i),null);case 22:case 23:return sl(),d=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(i.flags|=8192),d&&(i.mode&1)!==0?(jt&1073741824)!==0&&(yt(i),i.subtreeFlags&6&&(i.flags|=8192)):yt(i),null;case 24:return null;case 25:return null}throw Error(n(156,i.tag))}function Iy(t,i){switch(pc(i),i.tag){case 1:return Pt(i.type)&&Xs(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return Zi(),Ue(_t),Ue(gt),Pc(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 5:return Ec(i),null;case 13:if(Ue(We),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(n(340));Qi()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return Ue(We),null;case 4:return Zi(),null;case 10:return Sc(i.type._context),null;case 22:case 23:return sl(),null;case 24:return null;default:return null}}var ko=!1,kt=!1,xy=typeof WeakSet=="function"?WeakSet:Set,oe=null;function tr(t,i){var a=t.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(d){Ke(t,i,d)}else a.current=null}function Gc(t,i,a){try{a()}catch(d){Ke(t,i,d)}}var pf=!1;function Oy(t,i){if(sc=Fs,t=Hd(),Ya(t)){if("selectionStart"in t)var a={start:t.selectionStart,end:t.selectionEnd};else e:{a=(a=t.ownerDocument)&&a.defaultView||window;var d=a.getSelection&&a.getSelection();if(d&&d.rangeCount!==0){a=d.anchorNode;var f=d.anchorOffset,m=d.focusNode;d=d.focusOffset;try{a.nodeType,m.nodeType}catch{a=null;break e}var y=0,T=-1,w=-1,N=0,z=0,W=t,V=null;t:for(;;){for(var re;W!==a||f!==0&&W.nodeType!==3||(T=y+f),W!==m||d!==0&&W.nodeType!==3||(w=y+d),W.nodeType===3&&(y+=W.nodeValue.length),(re=W.firstChild)!==null;)V=W,W=re;for(;;){if(W===t)break t;if(V===a&&++N===f&&(T=y),V===m&&++z===d&&(w=y),(re=W.nextSibling)!==null)break;W=V,V=W.parentNode}W=re}a=T===-1||w===-1?null:{start:T,end:w}}else a=null}a=a||{start:0,end:0}}else a=null;for(oc={focusedElem:t,selectionRange:a},Fs=!1,oe=i;oe!==null;)if(i=oe,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,oe=t;else for(;oe!==null;){i=oe;try{var ae=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ae!==null){var ce=ae.memoizedProps,Ye=ae.memoizedState,I=i.stateNode,E=I.getSnapshotBeforeUpdate(i.elementType===i.type?ce:Zt(i.type,ce),Ye);I.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var O=i.stateNode.containerInfo;O.nodeType===1?O.textContent="":O.nodeType===9&&O.documentElement&&O.removeChild(O.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(K){Ke(i,i.return,K)}if(t=i.sibling,t!==null){t.return=i.return,oe=t;break}oe=i.return}return ae=pf,pf=!1,ae}function ts(t,i,a){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var f=d=d.next;do{if((f.tag&t)===t){var m=f.destroy;f.destroy=void 0,m!==void 0&&Gc(i,a,m)}f=f.next}while(f!==d)}}function So(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&t)===t){var d=a.create;a.destroy=d()}a=a.next}while(a!==i)}}function Jc(t){var i=t.ref;if(i!==null){var a=t.stateNode;switch(t.tag){case 5:t=a;break;default:t=a}typeof i=="function"?i(t):i.current=t}}function mf(t){var i=t.alternate;i!==null&&(t.alternate=null,mf(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[hn],delete i[Wr],delete i[uc],delete i[fy],delete i[py])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function gf(t){return t.tag===5||t.tag===3||t.tag===4}function vf(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||gf(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Qc(t,i,a){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(t,i):a.insertBefore(t,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(t,a)):(i=a,i.appendChild(t)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=$s));else if(d!==4&&(t=t.child,t!==null))for(Qc(t,i,a),t=t.sibling;t!==null;)Qc(t,i,a),t=t.sibling}function $c(t,i,a){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?a.insertBefore(t,i):a.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for($c(t,i,a),t=t.sibling;t!==null;)$c(t,i,a),t=t.sibling}var ht=null,en=!1;function $n(t,i,a){for(a=a.child;a!==null;)yf(t,i,a),a=a.sibling}function yf(t,i,a){if(dn&&typeof dn.onCommitFiberUnmount=="function")try{dn.onCommitFiberUnmount(Ds,a)}catch{}switch(a.tag){case 5:kt||tr(a,i);case 6:var d=ht,f=en;ht=null,$n(t,i,a),ht=d,en=f,ht!==null&&(en?(t=ht,a=a.stateNode,t.nodeType===8?t.parentNode.removeChild(a):t.removeChild(a)):ht.removeChild(a.stateNode));break;case 18:ht!==null&&(en?(t=ht,a=a.stateNode,t.nodeType===8?lc(t.parentNode,a):t.nodeType===1&&lc(t,a),Mr(t)):lc(ht,a.stateNode));break;case 4:d=ht,f=en,ht=a.stateNode.containerInfo,en=!0,$n(t,i,a),ht=d,en=f;break;case 0:case 11:case 14:case 15:if(!kt&&(d=a.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){f=d=d.next;do{var m=f,y=m.destroy;m=m.tag,y!==void 0&&((m&2)!==0||(m&4)!==0)&&Gc(a,i,y),f=f.next}while(f!==d)}$n(t,i,a);break;case 1:if(!kt&&(tr(a,i),d=a.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=a.memoizedProps,d.state=a.memoizedState,d.componentWillUnmount()}catch(T){Ke(a,i,T)}$n(t,i,a);break;case 21:$n(t,i,a);break;case 22:a.mode&1?(kt=(d=kt)||a.memoizedState!==null,$n(t,i,a),kt=d):$n(t,i,a);break;default:$n(t,i,a)}}function kf(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var a=t.stateNode;a===null&&(a=t.stateNode=new xy),i.forEach(function(d){var f=By.bind(null,t,d);a.has(d)||(a.add(d),d.then(f,f))})}}function tn(t,i){var a=i.deletions;if(a!==null)for(var d=0;d<a.length;d++){var f=a[d];try{var m=t,y=i,T=y;e:for(;T!==null;){switch(T.tag){case 5:ht=T.stateNode,en=!1;break e;case 3:ht=T.stateNode.containerInfo,en=!0;break e;case 4:ht=T.stateNode.containerInfo,en=!0;break e}T=T.return}if(ht===null)throw Error(n(160));yf(m,y,f),ht=null,en=!1;var w=f.alternate;w!==null&&(w.return=null),f.return=null}catch(N){Ke(f,i,N)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Sf(i,t),i=i.sibling}function Sf(t,i){var a=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(tn(i,t),mn(t),d&4){try{ts(3,t,t.return),So(3,t)}catch(ce){Ke(t,t.return,ce)}try{ts(5,t,t.return)}catch(ce){Ke(t,t.return,ce)}}break;case 1:tn(i,t),mn(t),d&512&&a!==null&&tr(a,a.return);break;case 5:if(tn(i,t),mn(t),d&512&&a!==null&&tr(a,a.return),t.flags&32){var f=t.stateNode;try{Cr(f,"")}catch(ce){Ke(t,t.return,ce)}}if(d&4&&(f=t.stateNode,f!=null)){var m=t.memoizedProps,y=a!==null?a.memoizedProps:m,T=t.type,w=t.updateQueue;if(t.updateQueue=null,w!==null)try{T==="input"&&m.type==="radio"&&m.name!=null&&Gu(f,m),Pa(T,y);var N=Pa(T,m);for(y=0;y<w.length;y+=2){var z=w[y],W=w[y+1];z==="style"?td(f,W):z==="dangerouslySetInnerHTML"?Zu(f,W):z==="children"?Cr(f,W):H(f,z,W,N)}switch(T){case"input":Ca(f,m);break;case"textarea":$u(f,m);break;case"select":var V=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!m.multiple;var re=m.value;re!=null?Ni(f,!!m.multiple,re,!1):V!==!!m.multiple&&(m.defaultValue!=null?Ni(f,!!m.multiple,m.defaultValue,!0):Ni(f,!!m.multiple,m.multiple?[]:"",!1))}f[Wr]=m}catch(ce){Ke(t,t.return,ce)}}break;case 6:if(tn(i,t),mn(t),d&4){if(t.stateNode===null)throw Error(n(162));f=t.stateNode,m=t.memoizedProps;try{f.nodeValue=m}catch(ce){Ke(t,t.return,ce)}}break;case 3:if(tn(i,t),mn(t),d&4&&a!==null&&a.memoizedState.isDehydrated)try{Mr(i.containerInfo)}catch(ce){Ke(t,t.return,ce)}break;case 4:tn(i,t),mn(t);break;case 13:tn(i,t),mn(t),f=t.child,f.flags&8192&&(m=f.memoizedState!==null,f.stateNode.isHidden=m,!m||f.alternate!==null&&f.alternate.memoizedState!==null||(Zc=$e())),d&4&&kf(t);break;case 22:if(z=a!==null&&a.memoizedState!==null,t.mode&1?(kt=(N=kt)||z,tn(i,t),kt=N):tn(i,t),mn(t),d&8192){if(N=t.memoizedState!==null,(t.stateNode.isHidden=N)&&!z&&(t.mode&1)!==0)for(oe=t,z=t.child;z!==null;){for(W=oe=z;oe!==null;){switch(V=oe,re=V.child,V.tag){case 0:case 11:case 14:case 15:ts(4,V,V.return);break;case 1:tr(V,V.return);var ae=V.stateNode;if(typeof ae.componentWillUnmount=="function"){d=V,a=V.return;try{i=d,ae.props=i.memoizedProps,ae.state=i.memoizedState,ae.componentWillUnmount()}catch(ce){Ke(d,a,ce)}}break;case 5:tr(V,V.return);break;case 22:if(V.memoizedState!==null){bf(W);continue}}re!==null?(re.return=V,oe=re):bf(W)}z=z.sibling}e:for(z=null,W=t;;){if(W.tag===5){if(z===null){z=W;try{f=W.stateNode,N?(m=f.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(T=W.stateNode,w=W.memoizedProps.style,y=w!=null&&w.hasOwnProperty("display")?w.display:null,T.style.display=ed("display",y))}catch(ce){Ke(t,t.return,ce)}}}else if(W.tag===6){if(z===null)try{W.stateNode.nodeValue=N?"":W.memoizedProps}catch(ce){Ke(t,t.return,ce)}}else if((W.tag!==22&&W.tag!==23||W.memoizedState===null||W===t)&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===t)break e;for(;W.sibling===null;){if(W.return===null||W.return===t)break e;z===W&&(z=null),W=W.return}z===W&&(z=null),W.sibling.return=W.return,W=W.sibling}}break;case 19:tn(i,t),mn(t),d&4&&kf(t);break;case 21:break;default:tn(i,t),mn(t)}}function mn(t){var i=t.flags;if(i&2){try{e:{for(var a=t.return;a!==null;){if(gf(a)){var d=a;break e}a=a.return}throw Error(n(160))}switch(d.tag){case 5:var f=d.stateNode;d.flags&32&&(Cr(f,""),d.flags&=-33);var m=vf(t);$c(t,m,f);break;case 3:case 4:var y=d.stateNode.containerInfo,T=vf(t);Qc(t,T,y);break;default:throw Error(n(161))}}catch(w){Ke(t,t.return,w)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function Dy(t,i,a){oe=t,Tf(t)}function Tf(t,i,a){for(var d=(t.mode&1)!==0;oe!==null;){var f=oe,m=f.child;if(f.tag===22&&d){var y=f.memoizedState!==null||ko;if(!y){var T=f.alternate,w=T!==null&&T.memoizedState!==null||kt;T=ko;var N=kt;if(ko=y,(kt=w)&&!N)for(oe=f;oe!==null;)y=oe,w=y.child,y.tag===22&&y.memoizedState!==null?wf(f):w!==null?(w.return=y,oe=w):wf(f);for(;m!==null;)oe=m,Tf(m),m=m.sibling;oe=f,ko=T,kt=N}Cf(t)}else(f.subtreeFlags&8772)!==0&&m!==null?(m.return=f,oe=m):Cf(t)}}function Cf(t){for(;oe!==null;){var i=oe;if((i.flags&8772)!==0){var a=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:kt||So(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!kt)if(a===null)d.componentDidMount();else{var f=i.elementType===i.type?a.memoizedProps:Zt(i.type,a.memoizedProps);d.componentDidUpdate(f,a.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var m=i.updateQueue;m!==null&&Ch(i,m,d);break;case 3:var y=i.updateQueue;if(y!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}Ch(i,y,a)}break;case 5:var T=i.stateNode;if(a===null&&i.flags&4){a=T;var w=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&a.focus();break;case"img":w.src&&(a.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var N=i.alternate;if(N!==null){var z=N.memoizedState;if(z!==null){var W=z.dehydrated;W!==null&&Mr(W)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}kt||i.flags&512&&Jc(i)}catch(V){Ke(i,i.return,V)}}if(i===t){oe=null;break}if(a=i.sibling,a!==null){a.return=i.return,oe=a;break}oe=i.return}}function bf(t){for(;oe!==null;){var i=oe;if(i===t){oe=null;break}var a=i.sibling;if(a!==null){a.return=i.return,oe=a;break}oe=i.return}}function wf(t){for(;oe!==null;){var i=oe;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{So(4,i)}catch(w){Ke(i,a,w)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var f=i.return;try{d.componentDidMount()}catch(w){Ke(i,f,w)}}var m=i.return;try{Jc(i)}catch(w){Ke(i,m,w)}break;case 5:var y=i.return;try{Jc(i)}catch(w){Ke(i,y,w)}}}catch(w){Ke(i,i.return,w)}if(i===t){oe=null;break}var T=i.sibling;if(T!==null){T.return=i.return,oe=T;break}oe=i.return}}var My=Math.ceil,To=R.ReactCurrentDispatcher,Yc=R.ReactCurrentOwner,Ht=R.ReactCurrentBatchConfig,we=0,ct=null,Ze=null,ft=0,jt=0,nr=Hn(0),rt=0,ns=null,bi=0,Co=0,Xc=0,is=null,It=null,Zc=0,ir=1/0,xn=null,bo=!1,el=null,Yn=null,wo=!1,Xn=null,Eo=0,rs=0,tl=null,_o=-1,Po=0;function Tt(){return(we&6)!==0?$e():_o!==-1?_o:_o=$e()}function Zn(t){return(t.mode&1)===0?1:(we&2)!==0&&ft!==0?ft&-ft:gy.transition!==null?(Po===0&&(Po=gd()),Po):(t=xe,t!==0||(t=window.event,t=t===void 0?16:Ed(t.type)),t)}function nn(t,i,a,d){if(50<rs)throw rs=0,tl=null,Error(n(185));Rr(t,a,d),((we&2)===0||t!==ct)&&(t===ct&&((we&2)===0&&(Co|=a),rt===4&&ei(t,ft)),xt(t,d),a===1&&we===0&&(i.mode&1)===0&&(ir=$e()+500,eo&&Gn()))}function xt(t,i){var a=t.callbackNode;gv(t,i);var d=As(t,t===ct?ft:0);if(d===0)a!==null&&fd(a),t.callbackNode=null,t.callbackPriority=0;else if(i=d&-d,t.callbackPriority!==i){if(a!=null&&fd(a),i===1)t.tag===0?my(_f.bind(null,t)):uh(_f.bind(null,t)),dy(function(){(we&6)===0&&Gn()}),a=null;else{switch(vd(d)){case 1:a=Na;break;case 4:a=pd;break;case 16:a=Os;break;case 536870912:a=md;break;default:a=Os}a=Nf(a,Ef.bind(null,t))}t.callbackPriority=i,t.callbackNode=a}}function Ef(t,i){if(_o=-1,Po=0,(we&6)!==0)throw Error(n(327));var a=t.callbackNode;if(rr()&&t.callbackNode!==a)return null;var d=As(t,t===ct?ft:0);if(d===0)return null;if((d&30)!==0||(d&t.expiredLanes)!==0||i)i=Ro(t,d);else{i=d;var f=we;we|=2;var m=Rf();(ct!==t||ft!==i)&&(xn=null,ir=$e()+500,Ei(t,i));do try{Ly();break}catch(T){Pf(t,T)}while(!0);kc(),To.current=m,we=f,Ze!==null?i=0:(ct=null,ft=0,i=rt)}if(i!==0){if(i===2&&(f=Aa(t),f!==0&&(d=f,i=nl(t,f))),i===1)throw a=ns,Ei(t,0),ei(t,d),xt(t,$e()),a;if(i===6)ei(t,d);else{if(f=t.current.alternate,(d&30)===0&&!Ny(f)&&(i=Ro(t,d),i===2&&(m=Aa(t),m!==0&&(d=m,i=nl(t,m))),i===1))throw a=ns,Ei(t,0),ei(t,d),xt(t,$e()),a;switch(t.finishedWork=f,t.finishedLanes=d,i){case 0:case 1:throw Error(n(345));case 2:_i(t,It,xn);break;case 3:if(ei(t,d),(d&130023424)===d&&(i=Zc+500-$e(),10<i)){if(As(t,0)!==0)break;if(f=t.suspendedLanes,(f&d)!==d){Tt(),t.pingedLanes|=t.suspendedLanes&f;break}t.timeoutHandle=cc(_i.bind(null,t,It,xn),i);break}_i(t,It,xn);break;case 4:if(ei(t,d),(d&4194240)===d)break;for(i=t.eventTimes,f=-1;0<d;){var y=31-$t(d);m=1<<y,y=i[y],y>f&&(f=y),d&=~m}if(d=f,d=$e()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*My(d/1960))-d,10<d){t.timeoutHandle=cc(_i.bind(null,t,It,xn),d);break}_i(t,It,xn);break;case 5:_i(t,It,xn);break;default:throw Error(n(329))}}}return xt(t,$e()),t.callbackNode===a?Ef.bind(null,t):null}function nl(t,i){var a=is;return t.current.memoizedState.isDehydrated&&(Ei(t,i).flags|=256),t=Ro(t,i),t!==2&&(i=It,It=a,i!==null&&il(i)),t}function il(t){It===null?It=t:It.push.apply(It,t)}function Ny(t){for(var i=t;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var d=0;d<a.length;d++){var f=a[d],m=f.getSnapshot;f=f.value;try{if(!Yt(m(),f))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ei(t,i){for(i&=~Xc,i&=~Co,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var a=31-$t(i),d=1<<a;t[a]=-1,i&=~d}}function _f(t){if((we&6)!==0)throw Error(n(327));rr();var i=As(t,0);if((i&1)===0)return xt(t,$e()),null;var a=Ro(t,i);if(t.tag!==0&&a===2){var d=Aa(t);d!==0&&(i=d,a=nl(t,d))}if(a===1)throw a=ns,Ei(t,0),ei(t,i),xt(t,$e()),a;if(a===6)throw Error(n(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,_i(t,It,xn),xt(t,$e()),null}function rl(t,i){var a=we;we|=1;try{return t(i)}finally{we=a,we===0&&(ir=$e()+500,eo&&Gn())}}function wi(t){Xn!==null&&Xn.tag===0&&(we&6)===0&&rr();var i=we;we|=1;var a=Ht.transition,d=xe;try{if(Ht.transition=null,xe=1,t)return t()}finally{xe=d,Ht.transition=a,we=i,(we&6)===0&&Gn()}}function sl(){jt=nr.current,Ue(nr)}function Ei(t,i){t.finishedWork=null,t.finishedLanes=0;var a=t.timeoutHandle;if(a!==-1&&(t.timeoutHandle=-1,uy(a)),Ze!==null)for(a=Ze.return;a!==null;){var d=a;switch(pc(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Xs();break;case 3:Zi(),Ue(_t),Ue(gt),Pc();break;case 5:Ec(d);break;case 4:Zi();break;case 13:Ue(We);break;case 19:Ue(We);break;case 10:Sc(d.type._context);break;case 22:case 23:sl()}a=a.return}if(ct=t,Ze=t=ti(t.current,null),ft=jt=i,rt=0,ns=null,Xc=Co=bi=0,It=is=null,Si!==null){for(i=0;i<Si.length;i++)if(a=Si[i],d=a.interleaved,d!==null){a.interleaved=null;var f=d.next,m=a.pending;if(m!==null){var y=m.next;m.next=f,d.next=y}a.pending=d}Si=null}return t}function Pf(t,i){do{var a=Ze;try{if(kc(),uo.current=mo,ho){for(var d=He.memoizedState;d!==null;){var f=d.queue;f!==null&&(f.pending=null),d=d.next}ho=!1}if(Ci=0,at=it=He=null,$r=!1,Yr=0,Yc.current=null,a===null||a.return===null){rt=1,ns=i,Ze=null;break}e:{var m=t,y=a.return,T=a,w=i;if(i=ft,T.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var N=w,z=T,W=z.tag;if((z.mode&1)===0&&(W===0||W===11||W===15)){var V=z.alternate;V?(z.updateQueue=V.updateQueue,z.memoizedState=V.memoizedState,z.lanes=V.lanes):(z.updateQueue=null,z.memoizedState=null)}var re=Yh(y);if(re!==null){re.flags&=-257,Xh(re,y,T,m,i),re.mode&1&&$h(m,N,i),i=re,w=N;var ae=i.updateQueue;if(ae===null){var ce=new Set;ce.add(w),i.updateQueue=ce}else ae.add(w);break e}else{if((i&1)===0){$h(m,N,i),ol();break e}w=Error(n(426))}}else if(Ve&&T.mode&1){var Ye=Yh(y);if(Ye!==null){(Ye.flags&65536)===0&&(Ye.flags|=256),Xh(Ye,y,T,m,i),vc(er(w,T));break e}}m=w=er(w,T),rt!==4&&(rt=2),is===null?is=[m]:is.push(m),m=y;do{switch(m.tag){case 3:m.flags|=65536,i&=-i,m.lanes|=i;var I=Jh(m,w,i);Th(m,I);break e;case 1:T=w;var E=m.type,O=m.stateNode;if((m.flags&128)===0&&(typeof E.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(Yn===null||!Yn.has(O)))){m.flags|=65536,i&=-i,m.lanes|=i;var K=Qh(m,T,i);Th(m,K);break e}}m=m.return}while(m!==null)}xf(a)}catch(le){i=le,Ze===a&&a!==null&&(Ze=a=a.return);continue}break}while(!0)}function Rf(){var t=To.current;return To.current=mo,t===null?mo:t}function ol(){(rt===0||rt===3||rt===2)&&(rt=4),ct===null||(bi&268435455)===0&&(Co&268435455)===0||ei(ct,ft)}function Ro(t,i){var a=we;we|=2;var d=Rf();(ct!==t||ft!==i)&&(xn=null,Ei(t,i));do try{Ay();break}catch(f){Pf(t,f)}while(!0);if(kc(),we=a,To.current=d,Ze!==null)throw Error(n(261));return ct=null,ft=0,rt}function Ay(){for(;Ze!==null;)If(Ze)}function Ly(){for(;Ze!==null&&!av();)If(Ze)}function If(t){var i=Mf(t.alternate,t,jt);t.memoizedProps=t.pendingProps,i===null?xf(t):Ze=i,Yc.current=null}function xf(t){var i=t;do{var a=i.alternate;if(t=i.return,(i.flags&32768)===0){if(a=Ry(a,i,jt),a!==null){Ze=a;return}}else{if(a=Iy(a,i),a!==null){a.flags&=32767,Ze=a;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{rt=6,Ze=null;return}}if(i=i.sibling,i!==null){Ze=i;return}Ze=i=t}while(i!==null);rt===0&&(rt=5)}function _i(t,i,a){var d=xe,f=Ht.transition;try{Ht.transition=null,xe=1,Uy(t,i,a,d)}finally{Ht.transition=f,xe=d}return null}function Uy(t,i,a,d){do rr();while(Xn!==null);if((we&6)!==0)throw Error(n(327));a=t.finishedWork;var f=t.finishedLanes;if(a===null)return null;if(t.finishedWork=null,t.finishedLanes=0,a===t.current)throw Error(n(177));t.callbackNode=null,t.callbackPriority=0;var m=a.lanes|a.childLanes;if(vv(t,m),t===ct&&(Ze=ct=null,ft=0),(a.subtreeFlags&2064)===0&&(a.flags&2064)===0||wo||(wo=!0,Nf(Os,function(){return rr(),null})),m=(a.flags&15990)!==0,(a.subtreeFlags&15990)!==0||m){m=Ht.transition,Ht.transition=null;var y=xe;xe=1;var T=we;we|=4,Yc.current=null,Oy(t,a),Sf(a,t),iy(oc),Fs=!!sc,oc=sc=null,t.current=a,Dy(a),cv(),we=T,xe=y,Ht.transition=m}else t.current=a;if(wo&&(wo=!1,Xn=t,Eo=f),m=t.pendingLanes,m===0&&(Yn=null),dv(a.stateNode),xt(t,$e()),i!==null)for(d=t.onRecoverableError,a=0;a<i.length;a++)f=i[a],d(f.value,{componentStack:f.stack,digest:f.digest});if(bo)throw bo=!1,t=el,el=null,t;return(Eo&1)!==0&&t.tag!==0&&rr(),m=t.pendingLanes,(m&1)!==0?t===tl?rs++:(rs=0,tl=t):rs=0,Gn(),null}function rr(){if(Xn!==null){var t=vd(Eo),i=Ht.transition,a=xe;try{if(Ht.transition=null,xe=16>t?16:t,Xn===null)var d=!1;else{if(t=Xn,Xn=null,Eo=0,(we&6)!==0)throw Error(n(331));var f=we;for(we|=4,oe=t.current;oe!==null;){var m=oe,y=m.child;if((oe.flags&16)!==0){var T=m.deletions;if(T!==null){for(var w=0;w<T.length;w++){var N=T[w];for(oe=N;oe!==null;){var z=oe;switch(z.tag){case 0:case 11:case 15:ts(8,z,m)}var W=z.child;if(W!==null)W.return=z,oe=W;else for(;oe!==null;){z=oe;var V=z.sibling,re=z.return;if(mf(z),z===N){oe=null;break}if(V!==null){V.return=re,oe=V;break}oe=re}}}var ae=m.alternate;if(ae!==null){var ce=ae.child;if(ce!==null){ae.child=null;do{var Ye=ce.sibling;ce.sibling=null,ce=Ye}while(ce!==null)}}oe=m}}if((m.subtreeFlags&2064)!==0&&y!==null)y.return=m,oe=y;else e:for(;oe!==null;){if(m=oe,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:ts(9,m,m.return)}var I=m.sibling;if(I!==null){I.return=m.return,oe=I;break e}oe=m.return}}var E=t.current;for(oe=E;oe!==null;){y=oe;var O=y.child;if((y.subtreeFlags&2064)!==0&&O!==null)O.return=y,oe=O;else e:for(y=E;oe!==null;){if(T=oe,(T.flags&2048)!==0)try{switch(T.tag){case 0:case 11:case 15:So(9,T)}}catch(le){Ke(T,T.return,le)}if(T===y){oe=null;break e}var K=T.sibling;if(K!==null){K.return=T.return,oe=K;break e}oe=T.return}}if(we=f,Gn(),dn&&typeof dn.onPostCommitFiberRoot=="function")try{dn.onPostCommitFiberRoot(Ds,t)}catch{}d=!0}return d}finally{xe=a,Ht.transition=i}}return!1}function Of(t,i,a){i=er(a,i),i=Jh(t,i,1),t=Qn(t,i,1),i=Tt(),t!==null&&(Rr(t,1,i),xt(t,i))}function Ke(t,i,a){if(t.tag===3)Of(t,t,a);else for(;i!==null;){if(i.tag===3){Of(i,t,a);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Yn===null||!Yn.has(d))){t=er(a,t),t=Qh(i,t,1),i=Qn(i,t,1),t=Tt(),i!==null&&(Rr(i,1,t),xt(i,t));break}}i=i.return}}function Fy(t,i,a){var d=t.pingCache;d!==null&&d.delete(i),i=Tt(),t.pingedLanes|=t.suspendedLanes&a,ct===t&&(ft&a)===a&&(rt===4||rt===3&&(ft&130023424)===ft&&500>$e()-Zc?Ei(t,0):Xc|=a),xt(t,i)}function Df(t,i){i===0&&((t.mode&1)===0?i=1:(i=Ns,Ns<<=1,(Ns&130023424)===0&&(Ns=4194304)));var a=Tt();t=Pn(t,i),t!==null&&(Rr(t,i,a),xt(t,a))}function jy(t){var i=t.memoizedState,a=0;i!==null&&(a=i.retryLane),Df(t,a)}function By(t,i){var a=0;switch(t.tag){case 13:var d=t.stateNode,f=t.memoizedState;f!==null&&(a=f.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(n(314))}d!==null&&d.delete(i),Df(t,a)}var Mf;Mf=function(t,i,a){if(t!==null)if(t.memoizedProps!==i.pendingProps||_t.current)Rt=!0;else{if((t.lanes&a)===0&&(i.flags&128)===0)return Rt=!1,Py(t,i,a);Rt=(t.flags&131072)!==0}else Rt=!1,Ve&&(i.flags&1048576)!==0&&dh(i,no,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;yo(t,i),t=i.pendingProps;var f=Ki(i,gt.current);Xi(i,a),f=xc(null,i,d,t,f,a);var m=Oc();return i.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Pt(d)?(m=!0,Zs(i)):m=!1,i.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,bc(i),f.updater=go,i.stateNode=f,f._reactInternals=i,Uc(i,d,t,a),i=Vc(null,i,d,!0,m,a)):(i.tag=0,Ve&&m&&fc(i),St(null,i,f,a),i=i.child),i;case 16:d=i.elementType;e:{switch(yo(t,i),t=i.pendingProps,f=d._init,d=f(d._payload),i.type=d,f=i.tag=zy(d),t=Zt(d,t),f){case 0:i=Bc(null,i,d,t,a);break e;case 1:i=sf(null,i,d,t,a);break e;case 11:i=Zh(null,i,d,t,a);break e;case 14:i=ef(null,i,d,Zt(d.type,t),a);break e}throw Error(n(306,d,""))}return i;case 0:return d=i.type,f=i.pendingProps,f=i.elementType===d?f:Zt(d,f),Bc(t,i,d,f,a);case 1:return d=i.type,f=i.pendingProps,f=i.elementType===d?f:Zt(d,f),sf(t,i,d,f,a);case 3:e:{if(of(i),t===null)throw Error(n(387));d=i.pendingProps,m=i.memoizedState,f=m.element,Sh(t,i),co(i,d,null,a);var y=i.memoizedState;if(d=y.element,m.isDehydrated)if(m={element:d,isDehydrated:!1,cache:y.cache,pendingSuspenseBoundaries:y.pendingSuspenseBoundaries,transitions:y.transitions},i.updateQueue.baseState=m,i.memoizedState=m,i.flags&256){f=er(Error(n(423)),i),i=af(t,i,d,a,f);break e}else if(d!==f){f=er(Error(n(424)),i),i=af(t,i,d,a,f);break e}else for(Ft=Wn(i.stateNode.containerInfo.firstChild),Ut=i,Ve=!0,Xt=null,a=yh(i,null,d,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Qi(),d===f){i=In(t,i,a);break e}St(t,i,d,a)}i=i.child}return i;case 5:return bh(i),t===null&&gc(i),d=i.type,f=i.pendingProps,m=t!==null?t.memoizedProps:null,y=f.children,ac(d,f)?y=null:m!==null&&ac(d,m)&&(i.flags|=32),rf(t,i),St(t,i,y,a),i.child;case 6:return t===null&&gc(i),null;case 13:return cf(t,i,a);case 4:return wc(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=$i(i,null,d,a):St(t,i,d,a),i.child;case 11:return d=i.type,f=i.pendingProps,f=i.elementType===d?f:Zt(d,f),Zh(t,i,d,f,a);case 7:return St(t,i,i.pendingProps,a),i.child;case 8:return St(t,i,i.pendingProps.children,a),i.child;case 12:return St(t,i,i.pendingProps.children,a),i.child;case 10:e:{if(d=i.type._context,f=i.pendingProps,m=i.memoizedProps,y=f.value,Ae(so,d._currentValue),d._currentValue=y,m!==null)if(Yt(m.value,y)){if(m.children===f.children&&!_t.current){i=In(t,i,a);break e}}else for(m=i.child,m!==null&&(m.return=i);m!==null;){var T=m.dependencies;if(T!==null){y=m.child;for(var w=T.firstContext;w!==null;){if(w.context===d){if(m.tag===1){w=Rn(-1,a&-a),w.tag=2;var N=m.updateQueue;if(N!==null){N=N.shared;var z=N.pending;z===null?w.next=w:(w.next=z.next,z.next=w),N.pending=w}}m.lanes|=a,w=m.alternate,w!==null&&(w.lanes|=a),Tc(m.return,a,i),T.lanes|=a;break}w=w.next}}else if(m.tag===10)y=m.type===i.type?null:m.child;else if(m.tag===18){if(y=m.return,y===null)throw Error(n(341));y.lanes|=a,T=y.alternate,T!==null&&(T.lanes|=a),Tc(y,a,i),y=m.sibling}else y=m.child;if(y!==null)y.return=m;else for(y=m;y!==null;){if(y===i){y=null;break}if(m=y.sibling,m!==null){m.return=y.return,y=m;break}y=y.return}m=y}St(t,i,f.children,a),i=i.child}return i;case 9:return f=i.type,d=i.pendingProps.children,Xi(i,a),f=qt(f),d=d(f),i.flags|=1,St(t,i,d,a),i.child;case 14:return d=i.type,f=Zt(d,i.pendingProps),f=Zt(d.type,f),ef(t,i,d,f,a);case 15:return tf(t,i,i.type,i.pendingProps,a);case 17:return d=i.type,f=i.pendingProps,f=i.elementType===d?f:Zt(d,f),yo(t,i),i.tag=1,Pt(d)?(t=!0,Zs(i)):t=!1,Xi(i,a),Kh(i,d,f),Uc(i,d,f,a),Vc(null,i,d,!0,t,a);case 19:return uf(t,i,a);case 22:return nf(t,i,a)}throw Error(n(156,i.tag))};function Nf(t,i){return hd(t,i)}function Vy(t,i,a,d){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kt(t,i,a,d){return new Vy(t,i,a,d)}function al(t){return t=t.prototype,!(!t||!t.isReactComponent)}function zy(t){if(typeof t=="function")return al(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ge)return 11;if(t===tt)return 14}return 2}function ti(t,i){var a=t.alternate;return a===null?(a=Kt(t.tag,i,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=i,a.type=t.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=t.flags&14680064,a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,i=t.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a}function Io(t,i,a,d,f,m){var y=2;if(d=t,typeof t=="function")al(t)&&(y=1);else if(typeof t=="string")y=5;else e:switch(t){case J:return Pi(a.children,f,m,i);case L:y=8,f|=8;break;case Z:return t=Kt(12,a,i,f|2),t.elementType=Z,t.lanes=m,t;case Re:return t=Kt(13,a,i,f),t.elementType=Re,t.lanes=m,t;case qe:return t=Kt(19,a,i,f),t.elementType=qe,t.lanes=m,t;case De:return xo(a,f,m,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Q:y=10;break e;case se:y=9;break e;case ge:y=11;break e;case tt:y=14;break e;case nt:y=16,d=null;break e}throw Error(n(130,t==null?t:typeof t,""))}return i=Kt(y,a,i,f),i.elementType=t,i.type=d,i.lanes=m,i}function Pi(t,i,a,d){return t=Kt(7,t,d,i),t.lanes=a,t}function xo(t,i,a,d){return t=Kt(22,t,d,i),t.elementType=De,t.lanes=a,t.stateNode={isHidden:!1},t}function cl(t,i,a){return t=Kt(6,t,null,i),t.lanes=a,t}function ll(t,i,a){return i=Kt(4,t.children!==null?t.children:[],t.key,i),i.lanes=a,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function qy(t,i,a,d,f){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=La(0),this.expirationTimes=La(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=La(0),this.identifierPrefix=d,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function ul(t,i,a,d,f,m,y,T,w){return t=new qy(t,i,a,T,w),i===1?(i=1,m===!0&&(i|=8)):i=0,m=Kt(3,null,null,i),t.current=m,m.stateNode=t,m.memoizedState={element:d,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},bc(m),t}function Wy(t,i,a){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:F,key:d==null?null:""+d,children:t,containerInfo:i,implementation:a}}function Af(t){if(!t)return Kn;t=t._reactInternals;e:{if(mi(t)!==t||t.tag!==1)throw Error(n(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Pt(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(n(171))}if(t.tag===1){var a=t.type;if(Pt(a))return ch(t,a,i)}return i}function Lf(t,i,a,d,f,m,y,T,w){return t=ul(a,d,!0,t,f,m,y,T,w),t.context=Af(null),a=t.current,d=Tt(),f=Zn(a),m=Rn(d,f),m.callback=i??null,Qn(a,m,f),t.current.lanes=f,Rr(t,f,d),xt(t,d),t}function Oo(t,i,a,d){var f=i.current,m=Tt(),y=Zn(f);return a=Af(a),i.context===null?i.context=a:i.pendingContext=a,i=Rn(m,y),i.payload={element:t},d=d===void 0?null:d,d!==null&&(i.callback=d),t=Qn(f,i,y),t!==null&&(nn(t,f,y,m),ao(t,f,y)),y}function Do(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Uf(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<i?a:i}}function dl(t,i){Uf(t,i),(t=t.alternate)&&Uf(t,i)}function Hy(){return null}var Ff=typeof reportError=="function"?reportError:function(t){console.error(t)};function hl(t){this._internalRoot=t}Mo.prototype.render=hl.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(n(409));Oo(t,i,null,null)},Mo.prototype.unmount=hl.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;wi(function(){Oo(null,t,null,null)}),i[bn]=null}};function Mo(t){this._internalRoot=t}Mo.prototype.unstable_scheduleHydration=function(t){if(t){var i=Sd();t={blockedOn:null,target:t,priority:i};for(var a=0;a<Vn.length&&i!==0&&i<Vn[a].priority;a++);Vn.splice(a,0,t),a===0&&bd(t)}};function fl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function No(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jf(){}function Ky(t,i,a,d,f){if(f){if(typeof d=="function"){var m=d;d=function(){var N=Do(y);m.call(N)}}var y=Lf(i,d,t,0,null,!1,!1,"",jf);return t._reactRootContainer=y,t[bn]=y.current,zr(t.nodeType===8?t.parentNode:t),wi(),y}for(;f=t.lastChild;)t.removeChild(f);if(typeof d=="function"){var T=d;d=function(){var N=Do(w);T.call(N)}}var w=ul(t,0,!1,null,null,!1,!1,"",jf);return t._reactRootContainer=w,t[bn]=w.current,zr(t.nodeType===8?t.parentNode:t),wi(function(){Oo(i,w,a,d)}),w}function Ao(t,i,a,d,f){var m=a._reactRootContainer;if(m){var y=m;if(typeof f=="function"){var T=f;f=function(){var w=Do(y);T.call(w)}}Oo(i,y,t,f)}else y=Ky(a,i,t,f,d);return Do(y)}yd=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var a=Pr(i.pendingLanes);a!==0&&(Ua(i,a|1),xt(i,$e()),(we&6)===0&&(ir=$e()+500,Gn()))}break;case 13:wi(function(){var d=Pn(t,1);if(d!==null){var f=Tt();nn(d,t,1,f)}}),dl(t,1)}},Fa=function(t){if(t.tag===13){var i=Pn(t,134217728);if(i!==null){var a=Tt();nn(i,t,134217728,a)}dl(t,134217728)}},kd=function(t){if(t.tag===13){var i=Zn(t),a=Pn(t,i);if(a!==null){var d=Tt();nn(a,t,i,d)}dl(t,i)}},Sd=function(){return xe},Td=function(t,i){var a=xe;try{return xe=t,i()}finally{xe=a}},xa=function(t,i,a){switch(i){case"input":if(Ca(t,a),i=a.name,a.type==="radio"&&i!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var d=a[i];if(d!==t&&d.form===t.form){var f=Ys(d);if(!f)throw Error(n(90));Hu(d),Ca(d,f)}}}break;case"textarea":$u(t,a);break;case"select":i=a.value,i!=null&&Ni(t,!!a.multiple,i,!1)}},sd=rl,od=wi;var Gy={usingClientEntryPoint:!1,Events:[Hr,Wi,Ys,id,rd,rl]},ss={findFiberByHostInstance:gi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Jy={bundleType:ss.bundleType,version:ss.version,rendererPackageName:ss.rendererPackageName,rendererConfig:ss.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ud(t),t===null?null:t.stateNode},findFiberByHostInstance:ss.findFiberByHostInstance||Hy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lo.isDisabled&&Lo.supportsFiber)try{Ds=Lo.inject(Jy),dn=Lo}catch{}}return Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gy,Ot.createPortal=function(t,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fl(i))throw Error(n(200));return Wy(t,i,null,a)},Ot.createRoot=function(t,i){if(!fl(t))throw Error(n(299));var a=!1,d="",f=Ff;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(f=i.onRecoverableError)),i=ul(t,1,!1,null,null,a,!1,d,f),t[bn]=i.current,zr(t.nodeType===8?t.parentNode:t),new hl(i)},Ot.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(n(188)):(t=Object.keys(t).join(","),Error(n(268,t)));return t=ud(i),t=t===null?null:t.stateNode,t},Ot.flushSync=function(t){return wi(t)},Ot.hydrate=function(t,i,a){if(!No(i))throw Error(n(200));return Ao(null,t,i,!0,a)},Ot.hydrateRoot=function(t,i,a){if(!fl(t))throw Error(n(405));var d=a!=null&&a.hydratedSources||null,f=!1,m="",y=Ff;if(a!=null&&(a.unstable_strictMode===!0&&(f=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onRecoverableError!==void 0&&(y=a.onRecoverableError)),i=Lf(i,null,t,1,a??null,f,!1,m,y),t[bn]=i.current,zr(t),d)for(t=0;t<d.length;t++)a=d[t],f=a._getVersion,f=f(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,f]:i.mutableSourceEagerHydrationData.push(a,f);return new Mo(i)},Ot.render=function(t,i,a){if(!No(i))throw Error(n(200));return Ao(null,t,i,!1,a)},Ot.unmountComponentAtNode=function(t){if(!No(t))throw Error(n(40));return t._reactRootContainer?(wi(function(){Ao(null,null,t,!1,function(){t._reactRootContainer=null,t[bn]=null})}),!0):!1},Ot.unstable_batchedUpdates=rl,Ot.unstable_renderSubtreeIntoContainer=function(t,i,a,d){if(!No(a))throw Error(n(200));if(t==null||t._reactInternals===void 0)throw Error(n(38));return Ao(t,i,a,!1,d)},Ot.version="18.3.1-next-f1338f8080-20240426",Ot}var Gf;function i0(){if(Gf)return gl.exports;Gf=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),gl.exports=n0(),gl.exports}var Jf;function r0(){if(Jf)return Uo;Jf=1;var s=i0();return Uo.createRoot=s.createRoot,Uo.hydrateRoot=s.hydrateRoot,Uo}var s0=r0();const o0=nm(s0);var Qf={};function a0(s,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in s)){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(s,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(s)}var c0=Object.defineProperty,l0=(s,e,n)=>e in s?c0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,$f=(s,e,n)=>l0(s,typeof e!="symbol"?e+"":e,n);let wt=class{constructor(){$f(this,"_locking"),$f(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(o=>e=()=>{this._locks-=1,o()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}};function Je(s,e){if(!s)throw new Error(e)}const u0=34028234663852886e22,d0=-34028234663852886e22,h0=4294967295,f0=2147483647,p0=-2147483648;function Bo(s){if(typeof s!="number")throw new Error("invalid int 32: "+typeof s);if(!Number.isInteger(s)||s>f0||s<p0)throw new Error("invalid int 32: "+s)}function jl(s){if(typeof s!="number")throw new Error("invalid uint 32: "+typeof s);if(!Number.isInteger(s)||s>h0||s<0)throw new Error("invalid uint 32: "+s)}function im(s){if(typeof s!="number")throw new Error("invalid float 32: "+typeof s);if(Number.isFinite(s)&&(s>u0||s<d0))throw new Error("invalid float 32: "+s)}const rm=Symbol("@bufbuild/protobuf/enum-type");function m0(s){const e=s[rm];return Je(e,"missing enum type on enum object"),e}function sm(s,e,n,r){s[rm]=om(e,n.map(o=>({no:o.no,name:o.name,localName:s[o.no]})))}function om(s,e,n){const r=Object.create(null),o=Object.create(null),c=[];for(const l of e){const u=am(l);c.push(u),r[l.name]=u,o[l.no]=u}return{typeName:s,values:c,findName(l){return r[l]},findNumber(l){return o[l]}}}function g0(s,e,n){const r={};for(const o of e){const c=am(o);r[c.localName]=c.no,r[c.no]=c.localName}return sm(r,s,e),r}function am(s){return"localName"in s?s:Object.assign(Object.assign({},s),{localName:s.name})}class pu{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),o=r.runtime.bin,c=o.makeReadOptions(n);return o.readMessage(this,c.readerFactory(e),e.byteLength,c),this}fromJson(e,n){const r=this.getType(),o=r.runtime.json,c=o.makeReadOptions(n);return o.readMessage(r,e,c,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,o=r.makeWriteOptions(e),c=o.writerFactory();return r.writeMessage(this,c,o),c.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,o=r.makeWriteOptions(e);return r.writeMessage(this,o)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function v0(s,e,n,r){var o;const c=(o=r==null?void 0:r.localName)!==null&&o!==void 0?o:e.substring(e.lastIndexOf(".")+1),l={[c]:function(u){s.util.initFields(this),s.util.initPartial(u,this)}}[c];return Object.setPrototypeOf(l.prototype,new pu),Object.assign(l,{runtime:s,typeName:e,fields:s.util.newFieldList(n),fromBinary(u,h){return new l().fromBinary(u,h)},fromJson(u,h){return new l().fromJson(u,h)},fromJsonString(u,h){return new l().fromJsonString(u,h)},equals(u,h){return s.util.equals(l,u,h)}}),l}function y0(){let s=0,e=0;for(let r=0;r<28;r+=7){let o=this.buf[this.pos++];if(s|=(o&127)<<r,(o&128)==0)return this.assertBounds(),[s,e]}let n=this.buf[this.pos++];if(s|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[s,e];for(let r=3;r<=31;r+=7){let o=this.buf[this.pos++];if(e|=(o&127)<<r,(o&128)==0)return this.assertBounds(),[s,e]}throw new Error("invalid varint")}function kl(s,e,n){for(let c=0;c<28;c=c+7){const l=s>>>c,u=!(!(l>>>7)&&e==0),h=(u?l|128:l)&255;if(n.push(h),!u)return}const r=s>>>28&15|(e&7)<<4,o=e>>3!=0;if(n.push((o?r|128:r)&255),!!o){for(let c=3;c<31;c=c+7){const l=e>>>c,u=!!(l>>>7),h=(u?l|128:l)&255;if(n.push(h),!u)return}n.push(e>>>31&1)}}const Vo=4294967296;function Yf(s){const e=s[0]==="-";e&&(s=s.slice(1));const n=1e6;let r=0,o=0;function c(l,u){const h=Number(s.slice(l,u));o*=n,r=r*n+h,r>=Vo&&(o=o+(r/Vo|0),r=r%Vo)}return c(-24,-18),c(-18,-12),c(-12,-6),c(-6),e?lm(r,o):mu(r,o)}function k0(s,e){let n=mu(s,e);const r=n.hi&2147483648;r&&(n=lm(n.lo,n.hi));const o=cm(n.lo,n.hi);return r?"-"+o:o}function cm(s,e){if({lo:s,hi:e}=S0(s,e),e<=2097151)return String(Vo*e+s);const n=s&16777215,r=(s>>>24|e<<8)&16777215,o=e>>16&65535;let c=n+r*6777216+o*6710656,l=r+o*8147497,u=o*2;const h=1e7;return c>=h&&(l+=Math.floor(c/h),c%=h),l>=h&&(u+=Math.floor(l/h),l%=h),u.toString()+Xf(l)+Xf(c)}function S0(s,e){return{lo:s>>>0,hi:e>>>0}}function mu(s,e){return{lo:s|0,hi:e|0}}function lm(s,e){return e=~e,s?s=~s+1:e+=1,mu(s,e)}const Xf=s=>{const e=String(s);return"0000000".slice(e.length)+e};function Zf(s,e){if(s>=0){for(;s>127;)e.push(s&127|128),s=s>>>7;e.push(s)}else{for(let n=0;n<9;n++)e.push(s&127|128),s=s>>7;e.push(1)}}function T0(){let s=this.buf[this.pos++],e=s&127;if((s&128)==0)return this.assertBounds(),e;if(s=this.buf[this.pos++],e|=(s&127)<<7,(s&128)==0)return this.assertBounds(),e;if(s=this.buf[this.pos++],e|=(s&127)<<14,(s&128)==0)return this.assertBounds(),e;if(s=this.buf[this.pos++],e|=(s&127)<<21,(s&128)==0)return this.assertBounds(),e;s=this.buf[this.pos++],e|=(s&15)<<28;for(let n=5;(s&128)!==0&&n<10;n++)s=this.buf[this.pos++];if((s&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function C0(){const s=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof s.getBigInt64=="function"&&typeof s.getBigUint64=="function"&&typeof s.setBigInt64=="function"&&typeof s.setBigUint64=="function"&&(typeof process!="object"||typeof Qf!="object"||Qf.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),c=BigInt("9223372036854775807"),l=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const p=typeof h=="bigint"?h:BigInt(h);if(p>c||p<o)throw new Error("int64 invalid: ".concat(h));return p},uParse(h){const p=typeof h=="bigint"?h:BigInt(h);if(p>u||p<l)throw new Error("uint64 invalid: ".concat(h));return p},enc(h){return s.setBigInt64(0,this.parse(h),!0),{lo:s.getInt32(0,!0),hi:s.getInt32(4,!0)}},uEnc(h){return s.setBigInt64(0,this.uParse(h),!0),{lo:s.getInt32(0,!0),hi:s.getInt32(4,!0)}},dec(h,p){return s.setInt32(0,h,!0),s.setInt32(4,p,!0),s.getBigInt64(0,!0)},uDec(h,p){return s.setInt32(0,h,!0),s.setInt32(4,p,!0),s.getBigUint64(0,!0)}}}const n=o=>Je(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),r=o=>Je(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),n(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),r(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),n(o),Yf(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),r(o),Yf(o)},dec(o,c){return k0(o,c)},uDec(o,c){return cm(o,c)}}}const ze=C0();var B;(function(s){s[s.DOUBLE=1]="DOUBLE",s[s.FLOAT=2]="FLOAT",s[s.INT64=3]="INT64",s[s.UINT64=4]="UINT64",s[s.INT32=5]="INT32",s[s.FIXED64=6]="FIXED64",s[s.FIXED32=7]="FIXED32",s[s.BOOL=8]="BOOL",s[s.STRING=9]="STRING",s[s.BYTES=12]="BYTES",s[s.UINT32=13]="UINT32",s[s.SFIXED32=15]="SFIXED32",s[s.SFIXED64=16]="SFIXED64",s[s.SINT32=17]="SINT32",s[s.SINT64=18]="SINT64"})(B||(B={}));var di;(function(s){s[s.BIGINT=0]="BIGINT",s[s.STRING=1]="STRING"})(di||(di={}));function ii(s,e,n){if(e===n)return!0;if(s==B.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(s){case B.UINT64:case B.FIXED64:case B.INT64:case B.SFIXED64:case B.SINT64:return e==n}return!1}function yr(s,e){switch(s){case B.BOOL:return!1;case B.UINT64:case B.FIXED64:case B.INT64:case B.SFIXED64:case B.SINT64:return e==0?ze.zero:"0";case B.DOUBLE:case B.FLOAT:return 0;case B.BYTES:return new Uint8Array(0);case B.STRING:return"";default:return 0}}function um(s,e){switch(s){case B.BOOL:return e===!1;case B.STRING:return e==="";case B.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Xe;(function(s){s[s.Varint=0]="Varint",s[s.Bit64=1]="Bit64",s[s.LengthDelimited=2]="LengthDelimited",s[s.StartGroup=3]="StartGroup",s[s.EndGroup=4]="EndGroup",s[s.Bit32=5]="Bit32"})(Xe||(Xe={}));class b0{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let o=0;o<this.chunks.length;o++)e+=this.chunks[o].length;let n=new Uint8Array(e),r=0;for(let o=0;o<this.chunks.length;o++)n.set(this.chunks[o],r),r+=this.chunks[o].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(jl(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Bo(e),Zf(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){im(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){jl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Bo(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Bo(e),e=(e<<1^e>>31)>>>0,Zf(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),o=ze.enc(e);return r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),o=ze.uEnc(e);return r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),this.raw(n)}int64(e){let n=ze.enc(e);return kl(n.lo,n.hi,this.buf),this}sint64(e){let n=ze.enc(e),r=n.hi>>31,o=n.lo<<1^r,c=(n.hi<<1|n.lo>>>31)^r;return kl(o,c,this.buf),this}uint64(e){let n=ze.uEnc(e);return kl(n.lo,n.hi,this.buf),this}}class w0{constructor(e,n){this.varint64=y0,this.uint32=T0,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case Xe.Varint:for(;this.buf[this.pos++]&128;);break;case Xe.Bit64:this.pos+=4;case Xe.Bit32:this.pos+=4;break;case Xe.LengthDelimited:let o=this.uint32();this.pos+=o;break;case Xe.StartGroup:for(;;){const[c,l]=this.tag();if(l===Xe.EndGroup){if(n!==void 0&&c!==n)throw new Error("invalid end group tag");break}this.skip(l,c)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ze.dec(...this.varint64())}uint64(){return ze.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,ze.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ze.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ze.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function E0(s,e,n,r){let o;return{typeName:e,extendee:n,get field(){if(!o){const c=typeof r=="function"?r():r;c.name=e.split(".").pop(),c.jsonName="[".concat(e,"]"),o=s.util.newFieldList([c]).list()[0]}return o},runtime:s}}function dm(s){const e=s.field.localName,n=Object.create(null);return n[e]=_0(s),[n,()=>n[e]]}function _0(s){const e=s.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return yr(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function P0(s,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=s.length-1;n>=0;--n)if(s[n].no==e.no)return[s[n]];return[]}return s.filter(n=>n.no===e.no)}let Mn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ha=[];for(let s=0;s<Mn.length;s++)ha[Mn[s].charCodeAt(0)]=s;ha[45]=Mn.indexOf("+");ha[95]=Mn.indexOf("/");const hm={dec(s){let e=s.length*3/4;s[s.length-2]=="="?e-=2:s[s.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,o=0,c,l=0;for(let u=0;u<s.length;u++){if(c=ha[s.charCodeAt(u)],c===void 0)switch(s[u]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:l=c,o=1;break;case 1:n[r++]=l<<2|(c&48)>>4,l=c,o=2;break;case 2:n[r++]=(l&15)<<4|(c&60)>>2,l=c,o=3;break;case 3:n[r++]=(l&3)<<6|c,o=0;break}}if(o==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(s){let e="",n=0,r,o=0;for(let c=0;c<s.length;c++)switch(r=s[c],n){case 0:e+=Mn[r>>2],o=(r&3)<<4,n=1;break;case 1:e+=Mn[o|r>>4],o=(r&15)<<2,n=2;break;case 2:e+=Mn[o|r>>6],e+=Mn[r&63],n=0;break}return n&&(e+=Mn[o],e+="=",n==1&&(e+="=")),e}};function R0(s,e,n){pm(e,s);const r=e.runtime.bin.makeReadOptions(n),o=P0(s.getType().runtime.bin.listUnknownFields(s),e.field),[c,l]=dm(e);for(const u of o)e.runtime.bin.readField(c,r.readerFactory(u.data),e.field,u.wireType,r);return l()}function I0(s,e,n,r){pm(e,s);const o=e.runtime.bin.makeReadOptions(r),c=e.runtime.bin.makeWriteOptions(r);if(fm(s,e)){const p=s.getType().runtime.bin.listUnknownFields(s).filter(g=>g.no!=e.field.no);s.getType().runtime.bin.discardUnknownFields(s);for(const g of p)s.getType().runtime.bin.onUnknownField(s,g.no,g.wireType,g.data)}const l=c.writerFactory();let u=e.field;!u.opt&&!u.repeated&&(u.kind=="enum"||u.kind=="scalar")&&(u=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(u,n,l,c);const h=o.readerFactory(l.finish());for(;h.pos<h.len;){const[p,g]=h.tag(),v=h.skip(g,p);s.getType().runtime.bin.onUnknownField(s,p,g,v)}}function fm(s,e){const n=s.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(s).find(r=>r.no==e.field.no)}function pm(s,e){Je(s.extendee.typeName==e.getType().typeName,"extension ".concat(s.typeName," can only be applied to message ").concat(s.extendee.typeName))}function mm(s,e){const n=s.localName;if(s.repeated)return e[n].length>0;if(s.oneof)return e[s.oneof.localName].case===n;switch(s.kind){case"enum":case"scalar":return s.opt||s.req?e[n]!==void 0:s.kind=="enum"?e[n]!==s.T.values[0].no:!um(s.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function ep(s,e){const n=s.localName,r=!s.opt&&!s.req;if(s.repeated)e[n]=[];else if(s.oneof)e[s.oneof.localName]={case:void 0};else switch(s.kind){case"map":e[n]={};break;case"enum":e[n]=r?s.T.values[0].no:void 0;break;case"scalar":e[n]=r?yr(s.T,s.L):void 0;break;case"message":e[n]=void 0;break}}function Nn(s,e){if(s===null||typeof s!="object"||!Object.getOwnPropertyNames(pu.prototype).every(r=>r in s&&typeof s[r]=="function"))return!1;const n=s.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function gm(s,e){return Nn(e)||!s.fieldWrapper?e:s.fieldWrapper.wrapField(e)}B.DOUBLE,B.FLOAT,B.INT64,B.UINT64,B.INT32,B.UINT32,B.BOOL,B.STRING,B.BYTES;const tp={ignoreUnknownFields:!1},np={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function x0(s){return s?Object.assign(Object.assign({},tp),s):tp}function O0(s){return s?Object.assign(Object.assign({},np),s):np}const Zo=Symbol(),zo=Symbol();function D0(){return{makeReadOptions:x0,makeWriteOptions:O0,readMessage(s,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(s.typeName," from JSON: ").concat(vn(e)));r=r??new s;const o=new Map,c=n.typeRegistry;for(const[l,u]of Object.entries(e)){const h=s.fields.findJsonName(l);if(h){if(h.oneof){if(u===null&&h.kind=="scalar")continue;const p=o.get(h.oneof);if(p!==void 0)throw new Error("cannot decode message ".concat(s.typeName,' from JSON: multiple keys for oneof "').concat(h.oneof.name,'" present: "').concat(p,'", "').concat(l,'"'));o.set(h.oneof,l)}ip(r,u,h,n,s)}else{let p=!1;if(c!=null&&c.findExtension&&l.startsWith("[")&&l.endsWith("]")){const g=c.findExtension(l.substring(1,l.length-1));if(g&&g.extendee.typeName==s.typeName){p=!0;const[v,k]=dm(g);ip(v,u,g.field,n,g),I0(r,g,k(),n)}}if(!p&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(s.typeName,' from JSON: key "').concat(l,'" is unknown'))}}return r},writeMessage(s,e){const n=s.getType(),r={};let o;try{for(o of n.fields.byNumber()){if(!mm(o,s)){if(o.req)throw"required field not set";if(!e.emitDefaultValues||!N0(o))continue}const l=o.oneof?s[o.oneof.localName].value:s[o.localName],u=rp(o,l,e);u!==void 0&&(r[e.useProtoFieldName?o.name:o.jsonName]=u)}const c=e.typeRegistry;if(c!=null&&c.findExtensionFor)for(const l of n.runtime.bin.listUnknownFields(s)){const u=c.findExtensionFor(n.typeName,l.no);if(u&&fm(s,u)){const h=R0(s,u,e),p=rp(u.field,h,e);p!==void 0&&(r[u.field.jsonName]=p)}}}catch(c){const l=o?"cannot encode field ".concat(n.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),u=c instanceof Error?c.message:String(c);throw new Error(l+(u.length>0?": ".concat(u):""))}return r},readScalar(s,e,n){return ms(s,e,n??di.BIGINT,!0)},writeScalar(s,e,n){if(e!==void 0&&(n||um(s,e)))return qo(s,e)},debug:vn}}function vn(s){if(s===null)return"null";switch(typeof s){case"object":return Array.isArray(s)?"array":"object";case"string":return s.length>100?"string":'"'.concat(s.split('"').join('\\"'),'"');default:return String(s)}}function ip(s,e,n,r,o){let c=n.localName;if(n.repeated){if(Je(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(e)));const l=s[c];for(const u of e){if(u===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(u)));switch(n.kind){case"message":l.push(n.T.fromJson(u,r));break;case"enum":const h=Sl(n.T,u,r.ignoreUnknownFields,!0);h!==zo&&l.push(h);break;case"scalar":try{l.push(ms(n.T,u,n.L,!0))}catch(p){let g="cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(u));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(e)));const l=s[c];for(const[u,h]of Object.entries(e)){if(h===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: map value null"));let p;try{p=M0(n.K,u)}catch(g){let v="cannot decode map key for field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(e));throw g instanceof Error&&g.message.length>0&&(v+=": ".concat(g.message)),new Error(v)}switch(n.V.kind){case"message":l[p]=n.V.T.fromJson(h,r);break;case"enum":const g=Sl(n.V.T,h,r.ignoreUnknownFields,!0);g!==zo&&(l[p]=g);break;case"scalar":try{l[p]=ms(n.V.T,h,di.BIGINT,!0)}catch(v){let k="cannot decode map value for field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(e));throw v instanceof Error&&v.message.length>0&&(k+=": ".concat(v.message)),new Error(k)}break}}}else switch(n.oneof&&(s=s[n.oneof.localName]={case:c},c="value"),n.kind){case"message":const l=n.T;if(e===null&&l.typeName!="google.protobuf.Value")return;let u=s[c];Nn(u)?u.fromJson(e,r):(s[c]=u=l.fromJson(e,r),l.fieldWrapper&&!n.oneof&&(s[c]=l.fieldWrapper.unwrapField(u)));break;case"enum":const h=Sl(n.T,e,r.ignoreUnknownFields,!1);switch(h){case Zo:ep(n,s);break;case zo:break;default:s[c]=h;break}break;case"scalar":try{const p=ms(n.T,e,n.L,!1);switch(p){case Zo:ep(n,s);break;default:s[c]=p;break}}catch(p){let g="cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(vn(e));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}break}}function M0(s,e){if(s===B.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return ms(s,e,di.BIGINT,!0).toString()}function ms(s,e,n,r){if(e===null)return r?yr(s,n):Zo;switch(s){case B.DOUBLE:case B.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const o=Number(e);if(Number.isNaN(o)||!Number.isFinite(o))break;return s==B.FLOAT&&im(o),o;case B.INT32:case B.FIXED32:case B.SFIXED32:case B.SINT32:case B.UINT32:let c;if(typeof e=="number"?c=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(c=Number(e)),c===void 0)break;return s==B.UINT32||s==B.FIXED32?jl(c):Bo(c),c;case B.INT64:case B.SFIXED64:case B.SINT64:if(typeof e!="number"&&typeof e!="string")break;const l=ze.parse(e);return n?l.toString():l;case B.FIXED64:case B.UINT64:if(typeof e!="number"&&typeof e!="string")break;const u=ze.uParse(e);return n?u.toString():u;case B.BOOL:if(typeof e!="boolean")break;return e;case B.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case B.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return hm.dec(e)}throw new Error}function Sl(s,e,n,r){if(e===null)return s.typeName=="google.protobuf.NullValue"?0:r?s.values[0].no:Zo;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const o=s.findName(e);if(o!==void 0)return o.no;if(n)return zo;break}throw new Error("cannot decode enum ".concat(s.typeName," from JSON: ").concat(vn(e)))}function N0(s){return s.repeated||s.kind=="map"?!0:!(s.oneof||s.kind=="message"||s.opt||s.req)}function rp(s,e,n){if(s.kind=="map"){Je(typeof e=="object"&&e!=null);const r={},o=Object.entries(e);switch(s.V.kind){case"scalar":for(const[l,u]of o)r[l.toString()]=qo(s.V.T,u);break;case"message":for(const[l,u]of o)r[l.toString()]=u.toJson(n);break;case"enum":const c=s.V.T;for(const[l,u]of o)r[l.toString()]=Tl(c,u,n.enumAsInteger);break}return n.emitDefaultValues||o.length>0?r:void 0}if(s.repeated){Je(Array.isArray(e));const r=[];switch(s.kind){case"scalar":for(let o=0;o<e.length;o++)r.push(qo(s.T,e[o]));break;case"enum":for(let o=0;o<e.length;o++)r.push(Tl(s.T,e[o],n.enumAsInteger));break;case"message":for(let o=0;o<e.length;o++)r.push(e[o].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(s.kind){case"scalar":return qo(s.T,e);case"enum":return Tl(s.T,e,n.enumAsInteger);case"message":return gm(s.T,e).toJson(n)}}function Tl(s,e,n){var r;if(Je(typeof e=="number"),s.typeName=="google.protobuf.NullValue")return null;if(n)return e;const o=s.findNumber(e);return(r=o==null?void 0:o.name)!==null&&r!==void 0?r:e}function qo(s,e){switch(s){case B.INT32:case B.SFIXED32:case B.SINT32:case B.FIXED32:case B.UINT32:return Je(typeof e=="number"),e;case B.FLOAT:case B.DOUBLE:return Je(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case B.STRING:return Je(typeof e=="string"),e;case B.BOOL:return Je(typeof e=="boolean"),e;case B.UINT64:case B.FIXED64:case B.INT64:case B.SFIXED64:case B.SINT64:return Je(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case B.BYTES:return Je(e instanceof Uint8Array),hm.enc(e)}}const sr=Symbol("@bufbuild/protobuf/unknown-fields"),sp={readUnknownFields:!0,readerFactory:s=>new w0(s)},op={writeUnknownFields:!0,writerFactory:()=>new b0};function A0(s){return s?Object.assign(Object.assign({},sp),s):sp}function L0(s){return s?Object.assign(Object.assign({},op),s):op}function U0(){return{makeReadOptions:A0,makeWriteOptions:L0,listUnknownFields(s){var e;return(e=s[sr])!==null&&e!==void 0?e:[]},discardUnknownFields(s){delete s[sr]},writeUnknownFields(s,e){const r=s[sr];if(r)for(const o of r)e.tag(o.no,o.wireType).raw(o.data)},onUnknownField(s,e,n,r){const o=s;Array.isArray(o[sr])||(o[sr]=[]),o[sr].push({no:e,wireType:n,data:r})},readMessage(s,e,n,r,o){const c=s.getType(),l=o?e.len:e.pos+n;let u,h;for(;e.pos<l&&([u,h]=e.tag(),!(o===!0&&h==Xe.EndGroup));){const p=c.fields.find(u);if(!p){const g=e.skip(h,u);r.readUnknownFields&&this.onUnknownField(s,u,h,g);continue}ap(s,e,p,h,r)}if(o&&(h!=Xe.EndGroup||u!==n))throw new Error("invalid end group tag")},readField:ap,writeMessage(s,e,n){const r=s.getType();for(const o of r.fields.byNumber()){if(!mm(o,s)){if(o.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(o.name," to binary: required field not set"));continue}const c=o.oneof?s[o.oneof.localName].value:s[o.localName];cp(o,c,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(s,e),e},writeField(s,e,n,r){e!==void 0&&cp(s,e,n,r)}}}function ap(s,e,n,r,o){let{repeated:c,localName:l}=n;switch(n.oneof&&(s=s[n.oneof.localName],s.case!=l&&delete s.value,s.case=l,l="value"),n.kind){case"scalar":case"enum":const u=n.kind=="enum"?B.INT32:n.T;let h=ea;if(n.kind=="scalar"&&n.L>0&&(h=j0),c){let k=s[l];if(r==Xe.LengthDelimited&&u!=B.STRING&&u!=B.BYTES){let P=e.uint32()+e.pos;for(;e.pos<P;)k.push(h(e,u))}else k.push(h(e,u))}else s[l]=h(e,u);break;case"message":const p=n.T;c?s[l].push(Wo(e,new p,o,n)):Nn(s[l])?Wo(e,s[l],o,n):(s[l]=Wo(e,new p,o,n),p.fieldWrapper&&!n.oneof&&!n.repeated&&(s[l]=p.fieldWrapper.unwrapField(s[l])));break;case"map":let[g,v]=F0(n,e,o);s[l][g]=v;break}}function Wo(s,e,n,r){const o=e.getType().runtime.bin,c=r==null?void 0:r.delimited;return o.readMessage(e,s,c?r.no:s.uint32(),n,c),e}function F0(s,e,n){const r=e.uint32(),o=e.pos+r;let c,l;for(;e.pos<o;){const[u]=e.tag();switch(u){case 1:c=ea(e,s.K);break;case 2:switch(s.V.kind){case"scalar":l=ea(e,s.V.T);break;case"enum":l=e.int32();break;case"message":l=Wo(e,new s.V.T,n,void 0);break}break}}if(c===void 0&&(c=yr(s.K,di.BIGINT)),typeof c!="string"&&typeof c!="number"&&(c=c.toString()),l===void 0)switch(s.V.kind){case"scalar":l=yr(s.V.T,di.BIGINT);break;case"enum":l=s.V.T.values[0].no;break;case"message":l=new s.V.T;break}return[c,l]}function j0(s,e){const n=ea(s,e);return typeof n=="bigint"?n.toString():n}function ea(s,e){switch(e){case B.STRING:return s.string();case B.BOOL:return s.bool();case B.DOUBLE:return s.double();case B.FLOAT:return s.float();case B.INT32:return s.int32();case B.INT64:return s.int64();case B.UINT64:return s.uint64();case B.FIXED64:return s.fixed64();case B.BYTES:return s.bytes();case B.FIXED32:return s.fixed32();case B.SFIXED32:return s.sfixed32();case B.SFIXED64:return s.sfixed64();case B.SINT64:return s.sint64();case B.UINT32:return s.uint32();case B.SINT32:return s.sint32()}}function cp(s,e,n,r){Je(e!==void 0);const o=s.repeated;switch(s.kind){case"scalar":case"enum":let c=s.kind=="enum"?B.INT32:s.T;if(o)if(Je(Array.isArray(e)),s.packed)V0(n,c,s.no,e);else for(const l of e)gs(n,c,s.no,l);else gs(n,c,s.no,e);break;case"message":if(o){Je(Array.isArray(e));for(const l of e)lp(n,r,s,l)}else lp(n,r,s,e);break;case"map":Je(typeof e=="object"&&e!=null);for(const[l,u]of Object.entries(e))B0(n,r,s,l,u);break}}function B0(s,e,n,r,o){s.tag(n.no,Xe.LengthDelimited),s.fork();let c=r;switch(n.K){case B.INT32:case B.FIXED32:case B.UINT32:case B.SFIXED32:case B.SINT32:c=Number.parseInt(r);break;case B.BOOL:Je(r=="true"||r=="false"),c=r=="true";break}switch(gs(s,n.K,1,c),n.V.kind){case"scalar":gs(s,n.V.T,2,o);break;case"enum":gs(s,B.INT32,2,o);break;case"message":Je(o!==void 0),s.tag(2,Xe.LengthDelimited).bytes(o.toBinary(e));break}s.join()}function lp(s,e,n,r){const o=gm(n.T,r);n.delimited?s.tag(n.no,Xe.StartGroup).raw(o.toBinary(e)).tag(n.no,Xe.EndGroup):s.tag(n.no,Xe.LengthDelimited).bytes(o.toBinary(e))}function gs(s,e,n,r){Je(r!==void 0);let[o,c]=vm(e);s.tag(n,o)[c](r)}function V0(s,e,n,r){if(!r.length)return;s.tag(n,Xe.LengthDelimited).fork();let[,o]=vm(e);for(let c=0;c<r.length;c++)s[o](r[c]);s.join()}function vm(s){let e=Xe.Varint;switch(s){case B.BYTES:case B.STRING:e=Xe.LengthDelimited;break;case B.DOUBLE:case B.FIXED64:case B.SFIXED64:e=Xe.Bit64;break;case B.FIXED32:case B.SFIXED32:case B.FLOAT:e=Xe.Bit32;break}const n=B[s].toLowerCase();return[e,n]}function z0(){return{setEnumType:sm,initPartial(s,e){if(s===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const o=r.localName,c=e,l=s;if(l[o]!=null)switch(r.kind){case"oneof":const u=l[o].case;if(u===void 0)continue;const h=r.findField(u);let p=l[o].value;h&&h.kind=="message"&&!Nn(p,h.T)?p=new h.T(p):h&&h.kind==="scalar"&&h.T===B.BYTES&&(p=as(p)),c[o]={case:u,value:p};break;case"scalar":case"enum":let g=l[o];r.T===B.BYTES&&(g=r.repeated?g.map(as):as(g)),c[o]=g;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===B.BYTES)for(const[C,P]of Object.entries(l[o]))c[o][C]=as(P);else Object.assign(c[o],l[o]);break;case"message":const k=r.V.T;for(const C of Object.keys(l[o])){let P=l[o][C];k.fieldWrapper||(P=new k(P)),c[o][C]=P}break}break;case"message":const v=r.T;if(r.repeated)c[o]=l[o].map(k=>Nn(k,v)?k:new v(k));else{const k=l[o];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?c[o]=as(k):c[o]=k:c[o]=Nn(k,v)?k:new v(k)}break}}},equals(s,e,n){return e===n?!0:!e||!n?!1:s.fields.byMember().every(r=>{const o=e[r.localName],c=n[r.localName];if(r.repeated){if(o.length!==c.length)return!1;switch(r.kind){case"message":return o.every((l,u)=>r.T.equals(l,c[u]));case"scalar":return o.every((l,u)=>ii(r.T,l,c[u]));case"enum":return o.every((l,u)=>ii(B.INT32,l,c[u]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":let l=o,u=c;return r.T.fieldWrapper&&(l!==void 0&&!Nn(l)&&(l=r.T.fieldWrapper.wrapField(l)),u!==void 0&&!Nn(u)&&(u=r.T.fieldWrapper.wrapField(u))),r.T.equals(l,u);case"enum":return ii(B.INT32,o,c);case"scalar":return ii(r.T,o,c);case"oneof":if(o.case!==c.case)return!1;const h=r.findField(o.case);if(h===void 0)return!0;switch(h.kind){case"message":return h.T.equals(o.value,c.value);case"enum":return ii(B.INT32,o.value,c.value);case"scalar":return ii(h.T,o.value,c.value)}throw new Error("oneof cannot contain ".concat(h.kind));case"map":const p=Object.keys(o).concat(Object.keys(c));switch(r.V.kind){case"message":const g=r.V.T;return p.every(k=>g.equals(o[k],c[k]));case"enum":return p.every(k=>ii(B.INT32,o[k],c[k]));case"scalar":const v=r.V.T;return p.every(k=>ii(v,o[k],c[k]))}break}})},clone(s){const e=s.getType(),n=new e,r=n;for(const o of e.fields.byMember()){const c=s[o.localName];let l;if(o.repeated)l=c.map(Fo);else if(o.kind=="map"){l=r[o.localName];for(const[u,h]of Object.entries(c))l[u]=Fo(h)}else o.kind=="oneof"?l=o.findField(c.case)?{case:c.case,value:Fo(c.value)}:{case:void 0}:l=Fo(c);r[o.localName]=l}for(const o of e.runtime.bin.listUnknownFields(s))e.runtime.bin.onUnknownField(r,o.no,o.wireType,o.data);return n}}}function Fo(s){if(s===void 0)return s;if(Nn(s))return s.clone();if(s instanceof Uint8Array){const e=new Uint8Array(s.byteLength);return e.set(s),e}return s}function as(s){return s instanceof Uint8Array?s:new Uint8Array(s)}function q0(s,e,n){return{syntax:s,json:D0(),bin:U0(),util:Object.assign(Object.assign({},z0()),{newFieldList:e,initFields:n}),makeMessageType(r,o,c){return v0(this,r,o,c)},makeEnum:g0,makeEnumType:om,getEnumType:m0,makeExtension(r,o,c){return E0(this,r,o,c)}}}class W0{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function ym(s,e){const n=km(s);return e?n:$0(Q0(n))}function H0(s){return ym(s,!1)}const K0=km;function km(s){let e=!1;const n=[];for(let r=0;r<s.length;r++){let o=s.charAt(r);switch(o){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(o),e=!1;break;default:e&&(e=!1,o=o.toUpperCase()),n.push(o);break}}return n.join("")}const G0=new Set(["constructor","toString","toJSON","valueOf"]),J0=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Sm=s=>"".concat(s,"$"),Q0=s=>J0.has(s)?Sm(s):s,$0=s=>G0.has(s)?Sm(s):s;class Y0{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=H0(e)}addField(e){Je(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function X0(s,e){var n,r,o,c,l,u;const h=[];let p;for(const g of typeof s=="function"?s():s){const v=g;if(v.localName=ym(g.name,g.oneof!==void 0),v.jsonName=(n=g.jsonName)!==null&&n!==void 0?n:K0(g.name),v.repeated=(r=g.repeated)!==null&&r!==void 0?r:!1,g.kind=="scalar"&&(v.L=(o=g.L)!==null&&o!==void 0?o:di.BIGINT),v.delimited=(c=g.delimited)!==null&&c!==void 0?c:!1,v.req=(l=g.req)!==null&&l!==void 0?l:!1,v.opt=(u=g.opt)!==null&&u!==void 0?u:!1,g.packed===void 0&&(v.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=B.BYTES&&g.T!=B.STRING),g.oneof!==void 0){const k=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!p||p.name!=k)&&(p=new Y0(k)),v.oneof=p,p.addField(v)}h.push(v)}return h}const x=q0("proto3",s=>new W0(s,e=>X0(e)),s=>{for(const e of s.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=s;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=yr(e.T,e.L);break}}});class Dt extends pu{constructor(e){super(),this.seconds=ze.zero,this.nanos=0,x.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(x.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ze.parse(o/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?r="."+o.substring(0,3)+"Z":o.substring(6)==="000"?r="."+o.substring(0,6)+"Z":r="."+o+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Dt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Dt({seconds:ze.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Dt().fromBinary(e,n)}static fromJson(e,n){return new Dt().fromJson(e,n)}static fromJsonString(e,n){return new Dt().fromJsonString(e,n)}static equals(e,n){return x.util.equals(Dt,e,n)}}Dt.runtime=x;Dt.typeName="google.protobuf.Timestamp";Dt.fields=x.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Z0=x.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Dt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:ek,repeated:!0},{no:5,name:"events",kind:"message",T:nk,repeated:!0}]),ek=x.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:tk,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),tk=x.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Dt},{no:3,name:"value",kind:"scalar",T:2}]),nk=x.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Dt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Dt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Tm=x.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),on=x.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),et=x.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),gu=x.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),fs=x.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ks=x.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),ln=x.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Ri=x.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),ik=x.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),ut=x.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),fa=x.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ta,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Nm}]),ta=x.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),rk=x.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:x.getEnumType(et),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),xi=x.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:x.getEnumType(ur)},{no:4,name:"tracks",kind:"message",T:ar,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:rk},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:x.getEnumType(Ss)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:x.getEnumType(ln)},{no:18,name:"kind_details",kind:"enum",T:x.getEnumType(sk),repeated:!0}]),ur=x.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ss=x.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),sk=x.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ot=x.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),ok=x.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ci,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:x.getEnumType(Cm)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),ar=x.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:x.getEnumType(on)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:x.getEnumType(et)},{no:10,name:"layers",kind:"message",T:ci,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:ok,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:x.getEnumType(ot)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Nm},{no:19,name:"audio_features",kind:"enum",T:x.getEnumType(ut),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:x.getEnumType(Tm)}]),ci=x.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:x.getEnumType(gu)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Cm=x.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),bt=x.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:x.getEnumType(ke)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:vu,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ak,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:_m,oneof:"value"},{no:7,name:"transcription",kind:"message",T:ck,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Z0,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:na,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:yu,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:ku,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Su,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ia,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:ra,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:sa,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:bm,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ke=x.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),bm=x.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:x.getEnumType(ot)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),wm=x.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:vu,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:na,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:yu,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:ku,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Su,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:ia,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:ra,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:sa,oneof:"value"}]),ak=x.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Em,repeated:!0}]),Em=x.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),vu=x.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),_m=x.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),ck=x.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:lk,repeated:!0}]),lk=x.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),na=x.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),yu=x.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),ku=x.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Su=x.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Pm,oneof:"value"}]),Pm=x.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Rm=x.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Im=x.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:x.getEnumType(xm)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),xm=x.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Om=x.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:x.getEnumType(Dm)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Dm=x.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Mm=x.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:up},{no:2,name:"screen",kind:"message",T:up},{no:3,name:"resume_connection",kind:"enum",T:x.getEnumType(ks)},{no:4,name:"disabled_codecs",kind:"message",T:uk},{no:5,name:"force_relay",kind:"enum",T:x.getEnumType(ks)}]),up=x.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:x.getEnumType(ks)}]),uk=x.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ta,repeated:!0},{no:2,name:"publish",kind:"message",T:ta,repeated:!0}]),Nm=x.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Bl=x.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Am=x.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:x.getEnumType(Bl)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Lm=x.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ia=x.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:x.getEnumType(ot)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Am,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Lm,oneof:"content_header"}],{localName:"DataStream_Header"}),ra=x.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),sa=x.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),dk=x.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),an=x.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Vl=x.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),hk=x.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),fk=x.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:hi,oneof:"message"},{no:2,name:"answer",kind:"message",T:hi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:pa,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ts,oneof:"message"},{no:5,name:"mute",kind:"message",T:ma,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ga,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Um,oneof:"message"},{no:8,name:"leave",kind:"message",T:va,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:jm,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:zm,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Eu,oneof:"message"},{no:13,name:"simulate",kind:"message",T:gn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:bu,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Hm,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Cu,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Fm,oneof:"message"}]),dp=x.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:pk,oneof:"message"},{no:2,name:"answer",kind:"message",T:hi,oneof:"message"},{no:3,name:"offer",kind:"message",T:hi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:pa,oneof:"message"},{no:5,name:"update",kind:"message",T:vk,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Tu,oneof:"message"},{no:8,name:"leave",kind:"message",T:va,oneof:"message"},{no:9,name:"mute",kind:"message",T:ma,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:yk,oneof:"message"},{no:11,name:"room_update",kind:"message",T:kk,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Tk,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:bk,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Ek,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Pk,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:gk,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:mk,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Ik,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Dk,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Mk,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Nk,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Rk,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:Fk,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:_k,oneof:"message"}]),zl=x.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ci,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:x.getEnumType(Cm)}]),Ts=x.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:x.getEnumType(on)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:x.getEnumType(et)},{no:9,name:"layers",kind:"message",T:ci,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:zl,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:x.getEnumType(ot)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:x.getEnumType(Tm)},{no:17,name:"audio_features",kind:"enum",T:x.getEnumType(ut),repeated:!0}]),pa=x.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:x.getEnumType(an)},{no:3,name:"final",kind:"scalar",T:8}]),ma=x.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),pk=x.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:fa},{no:2,name:"participant",kind:"message",T:xi},{no:3,name:"other_participants",kind:"message",T:xi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Bm,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Mm},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Im},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ta,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),mk=x.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Bm,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Mm},{no:3,name:"server_info",kind:"message",T:Im},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Tu=x.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ar}]),gk=x.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),hi=x.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),vk=x.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:xi,repeated:!0}]),ga=x.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Rm,repeated:!0}]),Um=x.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:x.getEnumType(gu)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Cu=x.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:x.getEnumType(ut),repeated:!0}]),Fm=x.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),va=x.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:x.getEnumType(ln)},{no:3,name:"action",kind:"enum",T:x.getEnumType(dr)},{no:4,name:"regions",kind:"message",T:xk}]),dr=x.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),jm=x.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ci,repeated:!0}]),bu=x.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Bm=x.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),yk=x.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Em,repeated:!0}]),kk=x.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:fa}]),Sk=x.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:x.getEnumType(fs)},{no:3,name:"score",kind:"scalar",T:2}]),Tk=x.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Sk,repeated:!0}]),Ck=x.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:x.getEnumType(Vl)}]),bk=x.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Ck,repeated:!0}]),wu=x.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:x.getEnumType(gu)},{no:2,name:"enabled",kind:"scalar",T:8}]),wk=x.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:wu,repeated:!0}]),Ek=x.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:wu,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:wk,repeated:!0}]),_k=x.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:dk,repeated:!0}]),Vm=x.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),zm=x.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Vm,repeated:!0}]),Pk=x.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Rk=x.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:fa},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:xi},{no:4,name:"other_participants",kind:"message",T:xi,repeated:!0}]),Eu=x.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:hi},{no:2,name:"subscription",kind:"message",T:ga},{no:3,name:"publish_tracks",kind:"message",T:Tu,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Wm,repeated:!0},{no:5,name:"offer",kind:"message",T:hi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:qm,repeated:!0}]),qm=x.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Wm=x.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:x.getEnumType(an)}]),gn=x.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:x.getEnumType(hk),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Hm=x.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Ik=x.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),xk=x.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Ok,repeated:!0}]),Ok=x.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Dk=x.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:x.getEnumType(ik)}]),Mk=x.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:x.getEnumType(_u)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:pa,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Ts,oneof:"request"},{no:6,name:"mute",kind:"message",T:ma,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:bu,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Cu,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Fm,oneof:"request"}]),_u=x.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),Nk=x.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Km=x.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),Ak=x.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Om},{no:2,name:"connection_settings",kind:"message",T:Km},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Ts,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:hi},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:x.getEnumType(Ri)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Eu}]),Lk=x.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:x.getEnumType(Uk)},{no:2,name:"join_request",kind:"scalar",T:12}]),Uk=x.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),Fk=x.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function jk(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ho={exports:{}},Bk=Ho.exports,hp;function Vk(){return hp||(hp=1,(function(s){(function(e,n){s.exports?s.exports=n():e.log=n()})(Bk,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],c={},l=null;function u(_,U){var A=_[U];if(typeof A.bind=="function")return A.bind(_);try{return Function.prototype.bind.call(A,_)}catch{return function(){return Function.prototype.apply.apply(A,[_,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function p(_){return _==="debug"&&(_="log"),typeof console===n?!1:_==="trace"&&r?h:console[_]!==void 0?u(console,_):console.log!==void 0?u(console,"log"):e}function g(){for(var _=this.getLevel(),U=0;U<o.length;U++){var A=o[U];this[A]=U<_?e:this.methodFactory(A,_,this.name)}if(this.log=this.debug,typeof console===n&&_<this.levels.SILENT)return"No console available for logging"}function v(_){return function(){typeof console!==n&&(g.call(this),this[_].apply(this,arguments))}}function k(_,U,A){return p(_)||v.apply(this,arguments)}function C(_,U){var A=this,Y,H,R,M="loglevel";typeof _=="string"?M+=":"+_:typeof _=="symbol"&&(M=void 0);function F(se){var ge=(o[se]||"silent").toUpperCase();if(!(typeof window===n||!M)){try{window.localStorage[M]=ge;return}catch{}try{window.document.cookie=encodeURIComponent(M)+"="+ge+";"}catch{}}}function J(){var se;if(!(typeof window===n||!M)){try{se=window.localStorage[M]}catch{}if(typeof se===n)try{var ge=window.document.cookie,Re=encodeURIComponent(M),qe=ge.indexOf(Re+"=");qe!==-1&&(se=/^([^;]+)/.exec(ge.slice(qe+Re.length+1))[1])}catch{}return A.levels[se]===void 0&&(se=void 0),se}}function L(){if(!(typeof window===n||!M)){try{window.localStorage.removeItem(M)}catch{}try{window.document.cookie=encodeURIComponent(M)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function Z(se){var ge=se;if(typeof ge=="string"&&A.levels[ge.toUpperCase()]!==void 0&&(ge=A.levels[ge.toUpperCase()]),typeof ge=="number"&&ge>=0&&ge<=A.levels.SILENT)return ge;throw new TypeError("log.setLevel() called with invalid level: "+se)}A.name=_,A.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},A.methodFactory=U||k,A.getLevel=function(){return R??H??Y},A.setLevel=function(se,ge){return R=Z(se),ge!==!1&&F(R),g.call(A)},A.setDefaultLevel=function(se){H=Z(se),J()||A.setLevel(se,!1)},A.resetLevel=function(){R=null,L(),g.call(A)},A.enableAll=function(se){A.setLevel(A.levels.TRACE,se)},A.disableAll=function(se){A.setLevel(A.levels.SILENT,se)},A.rebuild=function(){if(l!==A&&(Y=Z(l.getLevel())),g.call(A),l===A)for(var se in c)c[se].rebuild()},Y=Z(l?l.getLevel():"WARN");var Q=J();Q!=null&&(R=Z(Q)),g.call(A)}l=new C,l.getLogger=function(U){if(typeof U!="symbol"&&typeof U!="string"||U==="")throw new TypeError("You must supply a name when creating a logger.");var A=c[U];return A||(A=c[U]=new C(U,l.methodFactory)),A};var P=typeof window!==n?window.log:void 0;return l.noConflict=function(){return typeof window!==n&&window.log===l&&(window.log=P),l},l.getLoggers=function(){return c},l.default=l,l})})(Ho)),Ho.exports}var ya=Vk(),ql;(function(s){s[s.trace=0]="trace",s[s.debug=1]="debug",s[s.info=2]="info",s[s.warn=3]="warn",s[s.error=4]="error",s[s.silent=5]="silent"})(ql||(ql={}));var un;(function(s){s.Default="livekit",s.Room="livekit-room",s.TokenSource="livekit-token-source",s.Participant="livekit-participant",s.Track="livekit-track",s.Publication="livekit-track-publication",s.Engine="livekit-engine",s.Signal="livekit-signal",s.PCManager="livekit-pc-manager",s.PCTransport="livekit-pc-transport",s.E2EE="lk-e2ee"})(un||(un={}));let ve=ya.getLogger("livekit");Object.values(un).map(s=>ya.getLogger(s));ve.setDefaultLevel(ql.info);function Un(s){const e=ya.getLogger(s);return e.setDefaultLevel(ve.getLevel()),e}const zk=ya.getLogger("lk-e2ee"),cs=7e3,qk=[0,300,4*300,9*300,16*300,cs,cs,cs,cs,cs];class Wk{constructor(e){this._retryDelays=e!==void 0?[...e]:qk}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function Hk(s,e){var n={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(n[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(s);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(s,r[o])&&(n[r[o]]=s[r[o]]);return n}function b(s,e,n,r){function o(c){return c instanceof n?c:new n(function(l){l(c)})}return new(n||(n=Promise))(function(c,l){function u(g){try{p(r.next(g))}catch(v){l(v)}}function h(g){try{p(r.throw(g))}catch(v){l(v)}}function p(g){g.done?c(g.value):o(g.value).then(u,h)}p((r=r.apply(s,e||[])).next())})}function fp(s){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&s[e],r=0;if(n)return n.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&r>=s.length&&(s=void 0),{value:s&&s[r++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function An(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],n;return e?e.call(s):(s=typeof fp=="function"?fp(s):s[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(c){n[c]=s[c]&&function(l){return new Promise(function(u,h){l=s[c](l),o(u,h,l.done,l.value)})}}function o(c,l,u,h){Promise.resolve(h).then(function(p){c({value:p,done:u})},l)}}var jo={exports:{}},pp;function Kk(){if(pp)return jo.exports;pp=1;var s=typeof Reflect=="object"?Reflect:null,e=s&&typeof s.apply=="function"?s.apply:function(M,F,J){return Function.prototype.apply.call(M,F,J)},n;s&&typeof s.ownKeys=="function"?n=s.ownKeys:Object.getOwnPropertySymbols?n=function(M){return Object.getOwnPropertyNames(M).concat(Object.getOwnPropertySymbols(M))}:n=function(M){return Object.getOwnPropertyNames(M)};function r(R){console&&console.warn&&console.warn(R)}var o=Number.isNaN||function(M){return M!==M};function c(){c.init.call(this)}jo.exports=c,jo.exports.once=A,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var l=10;function u(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(R){if(typeof R!="number"||R<0||o(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");l=R}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(M){if(typeof M!="number"||M<0||o(M))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+M+".");return this._maxListeners=M,this};function h(R){return R._maxListeners===void 0?c.defaultMaxListeners:R._maxListeners}c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(M){for(var F=[],J=1;J<arguments.length;J++)F.push(arguments[J]);var L=M==="error",Z=this._events;if(Z!==void 0)L=L&&Z.error===void 0;else if(!L)return!1;if(L){var Q;if(F.length>0&&(Q=F[0]),Q instanceof Error)throw Q;var se=new Error("Unhandled error."+(Q?" ("+Q.message+")":""));throw se.context=Q,se}var ge=Z[M];if(ge===void 0)return!1;if(typeof ge=="function")e(ge,this,F);else for(var Re=ge.length,qe=P(ge,Re),J=0;J<Re;++J)e(qe[J],this,F);return!0};function p(R,M,F,J){var L,Z,Q;if(u(F),Z=R._events,Z===void 0?(Z=R._events=Object.create(null),R._eventsCount=0):(Z.newListener!==void 0&&(R.emit("newListener",M,F.listener?F.listener:F),Z=R._events),Q=Z[M]),Q===void 0)Q=Z[M]=F,++R._eventsCount;else if(typeof Q=="function"?Q=Z[M]=J?[F,Q]:[Q,F]:J?Q.unshift(F):Q.push(F),L=h(R),L>0&&Q.length>L&&!Q.warned){Q.warned=!0;var se=new Error("Possible EventEmitter memory leak detected. "+Q.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");se.name="MaxListenersExceededWarning",se.emitter=R,se.type=M,se.count=Q.length,r(se)}return R}c.prototype.addListener=function(M,F){return p(this,M,F,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(M,F){return p(this,M,F,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(R,M,F){var J={fired:!1,wrapFn:void 0,target:R,type:M,listener:F},L=g.bind(J);return L.listener=F,J.wrapFn=L,L}c.prototype.once=function(M,F){return u(F),this.on(M,v(this,M,F)),this},c.prototype.prependOnceListener=function(M,F){return u(F),this.prependListener(M,v(this,M,F)),this},c.prototype.removeListener=function(M,F){var J,L,Z,Q,se;if(u(F),L=this._events,L===void 0)return this;if(J=L[M],J===void 0)return this;if(J===F||J.listener===F)--this._eventsCount===0?this._events=Object.create(null):(delete L[M],L.removeListener&&this.emit("removeListener",M,J.listener||F));else if(typeof J!="function"){for(Z=-1,Q=J.length-1;Q>=0;Q--)if(J[Q]===F||J[Q].listener===F){se=J[Q].listener,Z=Q;break}if(Z<0)return this;Z===0?J.shift():_(J,Z),J.length===1&&(L[M]=J[0]),L.removeListener!==void 0&&this.emit("removeListener",M,se||F)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(M){var F,J,L;if(J=this._events,J===void 0)return this;if(J.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):J[M]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete J[M]),this;if(arguments.length===0){var Z=Object.keys(J),Q;for(L=0;L<Z.length;++L)Q=Z[L],Q!=="removeListener"&&this.removeAllListeners(Q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(F=J[M],typeof F=="function")this.removeListener(M,F);else if(F!==void 0)for(L=F.length-1;L>=0;L--)this.removeListener(M,F[L]);return this};function k(R,M,F){var J=R._events;if(J===void 0)return[];var L=J[M];return L===void 0?[]:typeof L=="function"?F?[L.listener||L]:[L]:F?U(L):P(L,L.length)}c.prototype.listeners=function(M){return k(this,M,!0)},c.prototype.rawListeners=function(M){return k(this,M,!1)},c.listenerCount=function(R,M){return typeof R.listenerCount=="function"?R.listenerCount(M):C.call(R,M)},c.prototype.listenerCount=C;function C(R){var M=this._events;if(M!==void 0){var F=M[R];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function P(R,M){for(var F=new Array(M),J=0;J<M;++J)F[J]=R[J];return F}function _(R,M){for(;M+1<R.length;M++)R[M]=R[M+1];R.pop()}function U(R){for(var M=new Array(R.length),F=0;F<M.length;++F)M[F]=R[F].listener||R[F];return M}function A(R,M){return new Promise(function(F,J){function L(Q){R.removeListener(M,Z),J(Q)}function Z(){typeof R.removeListener=="function"&&R.removeListener("error",L),F([].slice.call(arguments))}H(R,M,Z,{once:!0}),M!=="error"&&Y(R,L,{once:!0})})}function Y(R,M,F){typeof R.on=="function"&&H(R,"error",M,F)}function H(R,M,F,J){if(typeof R.on=="function")J.once?R.once(M,F):R.on(M,F);else if(typeof R.addEventListener=="function")R.addEventListener(M,function L(Z){J.once&&R.removeEventListener(M,L),F(Z)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R)}return jo.exports}var Tn=Kk();let Gm=!0,Jm=!0;function ps(s,e,n){const r=s.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Mi(s,e,n){if(!s.RTCPeerConnection)return;const r=s.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(l,u){if(l!==e)return o.apply(this,arguments);const h=p=>{const g=n(p);g&&(u.handleEvent?u.handleEvent(g):u(g))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,h),o.apply(this,[l,h])};const c=r.removeEventListener;r.removeEventListener=function(l,u){if(l!==e||!this._eventMap||!this._eventMap[e])return c.apply(this,arguments);if(!this._eventMap[e].has(u))return c.apply(this,arguments);const h=this._eventMap[e].get(u);return this._eventMap[e].delete(u),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[l,h])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(l){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),l&&this.addEventListener(e,this["_on"+e]=l)},enumerable:!0,configurable:!0})}function Gk(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Gm=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function Jk(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Jm=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Qm(){if(typeof window=="object"){if(Gm)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Pu(s,e){Jm&&console.warn(s+" is deprecated, please use "+e+" instead.")}function Qk(s){const e={browser:null,version:null};if(typeof s>"u"||!s.navigator||!s.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=s;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(o=>o.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ps(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ps(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(s.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ps(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype,e._safariVersion=ps(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function mp(s){return Object.prototype.toString.call(s)==="[object Object]"}function $m(s){return mp(s)?Object.keys(s).reduce(function(e,n){const r=mp(s[n]),o=r?$m(s[n]):s[n],c=r&&!Object.keys(o).length;return o===void 0||c?e:Object.assign(e,{[n]:o})},{}):s}function Wl(s,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Wl(s,s.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(o=>{Wl(s,s.get(o),n)})}))}function gp(s,e,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;const c=[];return s.forEach(l=>{l.type==="track"&&l.trackIdentifier===e.id&&c.push(l)}),c.forEach(l=>{s.forEach(u=>{u.type===r&&u.trackId===l.id&&Wl(s,u,o)})}),o}const vp=Qm;function Ym(s,e){const n=s&&s.navigator;if(!n.mediaDevices)return;const r=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const h={};return Object.keys(u).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const g=typeof u[p]=="object"?u[p]:{ideal:u[p]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const v=function(k,C){return k?k+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(g.ideal!==void 0){h.optional=h.optional||[];let k={};typeof g.ideal=="number"?(k[v("min",p)]=g.ideal,h.optional.push(k),k={},k[v("max",p)]=g.ideal,h.optional.push(k)):(k[v("",p)]=g.ideal,h.optional.push(k))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[v("",p)]=g.exact):["min","max"].forEach(k=>{g[k]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[v(k,p)]=g[k])})}),u.advanced&&(h.optional=(h.optional||[]).concat(u.advanced)),h},o=function(u,h){if(e.version>=61)return h(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const p=function(g,v,k){v in g&&!(k in g)&&(g[k]=g[v],delete g[v])};u=JSON.parse(JSON.stringify(u)),p(u.audio,"autoGainControl","googAutoGainControl"),p(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=r(u.audio)}if(u&&typeof u.video=="object"){let p=u.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const g=e.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete u.video.facingMode;let v;if(p.exact==="environment"||p.ideal==="environment"?v=["back","rear"]:(p.exact==="user"||p.ideal==="user")&&(v=["front"]),v)return n.mediaDevices.enumerateDevices().then(k=>{k=k.filter(P=>P.kind==="videoinput");let C=k.find(P=>v.some(_=>P.label.toLowerCase().includes(_)));return!C&&k.length&&v.includes("back")&&(C=k[k.length-1]),C&&(u.video.deviceId=p.exact?{exact:C.deviceId}:{ideal:C.deviceId}),u.video=r(u.video),vp("chrome: "+JSON.stringify(u)),h(u)})}u.video=r(u.video)}return vp("chrome: "+JSON.stringify(u)),h(u)},c=function(u){return e.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},l=function(u,h,p){o(u,g=>{n.webkitGetUserMedia(g,h,v=>{p&&p(c(v))})})};if(n.getUserMedia=l.bind(n),n.mediaDevices.getUserMedia){const u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return o(h,p=>u(p).then(g=>{if(p.audio&&!g.getAudioTracks().length||p.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(c(g))))}}}function Xm(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function Zm(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let c;s.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(u=>u.track&&u.track.id===o.track.id):c={track:o.track};const l=new Event("track");l.track=o.track,l.receiver=c,l.transceiver={receiver:c},l.streams=[r.stream],this.dispatchEvent(l)}),r.stream.getTracks().forEach(o=>{let c;s.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(u=>u.track&&u.track.id===o.id):c={track:o};const l=new Event("track");l.track=o,l.receiver=c,l.transceiver={receiver:c},l.streams=[r.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Mi(s,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function eg(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const e=function(o,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=o.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:o}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(u,h){let p=o.apply(this,arguments);return p||(p=e(this,u),this._senders.push(p)),p};const c=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(u){c.apply(this,arguments);const h=this._senders.indexOf(u);h!==-1&&this._senders.splice(h,1)}}const n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],n.apply(this,[c]),c.getTracks().forEach(l=>{this._senders.push(e(this,l))})};const r=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(l=>{const u=this._senders.find(h=>h.track===l);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const e=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function tg(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const n=s.RTCPeerConnection.prototype.getSenders;n&&(s.RTCPeerConnection.prototype.getSenders=function(){const c=n.apply(this,[]);return c.forEach(l=>l._pc=this),c});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const c=r.apply(this,arguments);return c._pc=this,c}),s.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(l=>gp(l,c.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const n=s.RTCPeerConnection.prototype.getReceivers;n&&(s.RTCPeerConnection.prototype.getReceivers=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o}),Mi(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>gp(c,o.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const r=arguments[0];let o,c,l;return this.getSenders().forEach(u=>{u.track===r&&(o?l=!0:o=u)}),this.getReceivers().forEach(u=>(u.track===r&&(c?l=!0:c=u),u.track===r)),l||o&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function ng(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(l,u){if(!u)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=e.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(h)===-1&&this._shimmedLocalStreams[u.id].push(h):this._shimmedLocalStreams[u.id]=[u,h],h};const n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(v=>v.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(p=>u.indexOf(p)===-1);this._shimmedLocalStreams[l.id]=[l].concat(h)};const r=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const o=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const h=this._shimmedLocalStreams[u].indexOf(l);h!==-1&&this._shimmedLocalStreams[u].splice(h,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function ig(s,e){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65)return ng(s);const n=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const g=n.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(C=>C.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new s.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}r.apply(this,[g])};const o=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},s.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const k=[].slice.call(arguments,1);if(k.length!==1||!k[0].getTracks().find(_=>_===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _=new s.MediaStream([g]);this._streams[v.id]=_,this._reverseStreams[_.id]=v,this.addStream(_)}return this.getSenders().find(_=>_.track===g)};function c(p,g){let v=g.sdp;return Object.keys(p._reverseStreams||[]).forEach(k=>{const C=p._reverseStreams[k],P=p._streams[C.id];v=v.replace(new RegExp(P.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:v})}function l(p,g){let v=g.sdp;return Object.keys(p._reverseStreams||[]).forEach(k=>{const C=p._reverseStreams[k],P=p._streams[C.id];v=v.replace(new RegExp(C.id,"g"),P.id)}),new RTCSessionDescription({type:g.type,sdp:v})}["createOffer","createAnswer"].forEach(function(p){const g=s.RTCPeerConnection.prototype[p],v={[p](){const k=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[P=>{const _=c(this,P);k[0].apply(null,[_])},P=>{k[1]&&k[1].apply(null,P)},arguments[2]]):g.apply(this,arguments).then(P=>c(this,P))}};s.RTCPeerConnection.prototype[p]=v[p]});const u=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=l(this,arguments[0]),u.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const p=h.get.apply(this);return p.type===""?p:c(this,p)}}),s.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let k;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(_=>g.track===_)&&(k=this._streams[C])}),k&&(k.getTracks().length===1?this.removeStream(this._reverseStreams[k.id]):k.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Hl(s,e){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=s.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};s.RTCPeerConnection.prototype[n]=o[n]})}function rg(s,e){Mi(s,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var yp=Object.freeze({__proto__:null,fixNegotiationNeeded:rg,shimAddTrackRemoveTrack:ig,shimAddTrackRemoveTrackWithNative:ng,shimGetSendersWithDtmf:eg,shimGetUserMedia:Ym,shimMediaStream:Xm,shimOnTrack:Zm,shimPeerConnection:Hl,shimSenderReceiverGetStats:tg});function sg(s,e){const n=s&&s.navigator,r=s&&s.MediaStreamTrack;if(n.getUserMedia=function(o,c,l){Pu("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(c,l)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l.audio,"autoGainControl","mozAutoGainControl"),o(l.audio,"noiseSuppression","mozNoiseSuppression")),c(l)},r&&r.prototype.getSettings){const l=r.prototype.getSettings;r.prototype.getSettings=function(){const u=l.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(r&&r.prototype.applyConstraints){const l=r.prototype.applyConstraints;r.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function $k(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,s.navigator.mediaDevices.getUserMedia(r)})}function og(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Kl(s,e){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const c=s.RTCPeerConnection.prototype[o],l={[o](){return arguments[0]=new(o==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};s.RTCPeerConnection.prototype[o]=l[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[c,l,u]=arguments;return r.apply(this,[c||null]).then(h=>{if(e.version<53&&!l)try{h.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;h.forEach((g,v)=>{h.set(v,Object.assign({},g,{type:n[g.type]||g.type}))})}return h}).then(l,u)}}function ag(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const e=s.RTCPeerConnection.prototype.getSenders;e&&(s.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return o.forEach(c=>c._pc=this),o});const n=s.RTCPeerConnection.prototype.addTrack;n&&(s.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function cg(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const e=s.RTCPeerConnection.prototype.getReceivers;e&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Mi(s,"track",n=>(n.receiver._pc=n.srcElement,n)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function lg(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(n){Pu("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function ug(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function dg(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.addTransceiver;e&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const o=r.length>0;o&&r.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=e.apply(this,arguments);if(o){const{sender:l}=c,u=l.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=r,l.sendEncodings=r,this.setParametersPromises.push(l.setParameters(u).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return c})}function hg(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const e=s.RTCRtpSender.prototype.getParameters;e&&(s.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function fg(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function pg(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var kp=Object.freeze({__proto__:null,shimAddTransceiver:dg,shimCreateAnswer:pg,shimCreateOffer:fg,shimGetDisplayMedia:$k,shimGetParameters:hg,shimGetUserMedia:sg,shimOnTrack:og,shimPeerConnection:Kl,shimRTCDataChannel:ug,shimReceiverGetStats:cg,shimRemoveStream:lg,shimSenderGetStats:ag});function mg(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(o=>e.call(this,o,r)),r.getVideoTracks().forEach(o=>e.call(this,o,r))},s.RTCPeerConnection.prototype.addTrack=function(r){for(var o=arguments.length,c=new Array(o>1?o-1:0),l=1;l<o;l++)c[l-1]=arguments[l];return c&&c.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),e.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const o=n.getTracks();this.getSenders().forEach(c=>{o.includes(c.track)&&this.removeTrack(c)})})}}function gg(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,this.dispatchEvent(c)})})}});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const l=new Event("addstream");l.stream=c,r.dispatchEvent(l)})}),e.apply(r,arguments)}}}function vg(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,o=e.setLocalDescription,c=e.setRemoteDescription,l=e.addIceCandidate;e.createOffer=function(p,g){const v=arguments.length>=2?arguments[2]:arguments[0],k=n.apply(this,[v]);return g?(k.then(p,g),Promise.resolve()):k},e.createAnswer=function(p,g){const v=arguments.length>=2?arguments[2]:arguments[0],k=r.apply(this,[v]);return g?(k.then(p,g),Promise.resolve()):k};let u=function(h,p,g){const v=o.apply(this,[h]);return g?(v.then(p,g),Promise.resolve()):v};e.setLocalDescription=u,u=function(h,p,g){const v=c.apply(this,[h]);return g?(v.then(p,g),Promise.resolve()):v},e.setRemoteDescription=u,u=function(h,p,g){const v=l.apply(this,[h]);return g?(v.then(p,g),Promise.resolve()):v},e.addIceCandidate=u}function yg(s){const e=s&&s.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=o=>r(kg(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,o,c){e.mediaDevices.getUserMedia(r).then(o,c)}).bind(e))}function kg(s){return s&&s.video!==void 0?Object.assign({},s,{video:$m(s.video)}):s}function Sg(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection;s.RTCPeerConnection=function(r,o){if(r&&r.iceServers){const c=[];for(let l=0;l<r.iceServers.length;l++){let u=r.iceServers[l];u.urls===void 0&&u.url?(Pu("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,c.push(u)):c.push(r.iceServers[l])}r.iceServers=c}return new e(r,o)},s.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Tg(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cg(s){const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find(l=>l.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo===!0&&!c&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function bg(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var Sp=Object.freeze({__proto__:null,shimAudioContext:bg,shimCallbacksAPI:vg,shimConstraints:kg,shimCreateOfferLegacy:Cg,shimGetUserMedia:yg,shimLocalStreamsAPI:mg,shimRTCIceServerUrls:Sg,shimRemoteStreamsAPI:gg,shimTrackEventTransceiver:Tg}),Cl={exports:{}},Tp;function Yk(){return Tp||(Tp=1,(function(s){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(o=>o.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let c=8;c<r.length;c+=2)switch(r[c]){case"raddr":o.relatedAddress=r[c+1];break;case"rport":o.relatedPort=parseInt(r[c+1],10);break;case"tcptype":o.tcpType=r[c+1];break;case"ufrag":o.ufrag=r[c+1],o.usernameFragment=r[c+1];break;default:o[r[c]]===void 0&&(o[r[c]]=r[c+1]);break}return o},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const o=n.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const c=n.type;return r.push("typ"),r.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let o;const c=n.substring(n.indexOf(" ")+1).split(";");for(let l=0;l<c.length;l++)o=c[l].trim().split("="),r[o[0].trim()]=o[1];return r},e.writeFmtp=function(n){let r="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const c=[];Object.keys(n.parameters).forEach(l=>{n.parameters[l]!==void 0?c.push(l+"="+n.parameters[l]):c.push(l)}),r+="a=fmtp:"+o+" "+c.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{r+="a=rtcp-fb:"+o+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,r),10)},c=n.indexOf(":",r);return c>-1?(o.attribute=n.substring(r+1,c),o.value=n.substring(c+1)):o.attribute=n.substring(r+1),o},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let o="a=setup:"+r+`\r
`;return n.fingerprints.forEach(c=>{o+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),o},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const o=e.matchPrefix(n+r,"a=ice-ufrag:")[0],c=e.matchPrefix(n+r,"a=ice-pwd:")[0];return o&&c?{usernameFragment:o.substring(12),password:c.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=e.splitLines(n)[0].split(" ");r.profile=c[2];for(let u=3;u<c.length;u++){const h=c[u],p=e.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(p){const g=e.parseRtpMap(p),v=e.matchPrefix(n,"a=fmtp:"+h+" ");switch(g.parameters=v.length?e.parseFmtp(v[0]):{},g.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(e.parseRtcpFb),r.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(g.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(u=>{r.headerExtensions.push(e.parseExtmap(u))});const l=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(u=>{l.forEach(h=>{u.rtcpFeedback.find(g=>g.type===h.type&&g.parameter===h.parameter)||u.rtcpFeedback.push(h)})}),r},e.writeRtpDescription=function(n,r){let o="";o+="m="+n+" ",o+=r.codecs.length>0?"9":"0",o+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=r.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(l=>{o+=e.writeRtpMap(l),o+=e.writeFmtp(l),o+=e.writeRtcpFb(l)});let c=0;return r.codecs.forEach(l=>{l.maxptime>c&&(c=l.maxptime)}),c>0&&(o+="a=maxptime:"+c+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(l=>{o+=e.writeExtmap(l)}),o},e.parseRtpEncodingParameters=function(n){const r=[],o=e.parseRtpParameters(n),c=o.fecMechanisms.indexOf("RED")!==-1,l=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=e.matchPrefix(n,"a=ssrc:").map(k=>e.parseSsrcMedia(k)).filter(k=>k.attribute==="cname"),h=u.length>0&&u[0].ssrc;let p;const g=e.matchPrefix(n,"a=ssrc-group:FID").map(k=>k.substring(17).split(" ").map(P=>parseInt(P,10)));g.length>0&&g[0].length>1&&g[0][0]===h&&(p=g[0][1]),o.codecs.forEach(k=>{if(k.name.toUpperCase()==="RTX"&&k.parameters.apt){let C={ssrc:h,codecPayloadType:parseInt(k.parameters.apt,10)};h&&p&&(C.rtx={ssrc:p}),r.push(C),c&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},r.push(C))}}),r.length===0&&h&&r.push({ssrc:h});let v=e.matchPrefix(n,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,r.forEach(k=>{k.maxBitrate=v})),r},e.parseRtcpParameters=function(n){const r={},o=e.matchPrefix(n,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const c=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=c.length>0,r.compound=c.length===0;const l=e.matchPrefix(n,"a=rtcp-mux");return r.mux=l.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const o=e.matchPrefix(n,"a=msid:");if(o.length===1)return r=o[0].substring(7).split(" "),{stream:r[0],track:r[1]};const c=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");if(c.length>0)return r=c[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),o=e.matchPrefix(n,"a=max-message-size:");let c;o.length>0&&(c=parseInt(o[0].substring(19),10)),isNaN(c)&&(c=65536);const l=e.matchPrefix(n,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:r.fmt,maxMessageSize:c};const u=e.matchPrefix(n,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:c}}},e.writeSctpDescription=function(n,r){let o=[];return n.protocol!=="DTLS/SCTP"?o=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:o=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,o){let c;const l=r!==void 0?r:2;return n?c=n:c=e.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+c+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const o=e.splitLines(n);for(let c=0;c<o.length;c++)switch(o[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[c].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const o=e.splitLines(n)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},e.parseOLine=function(n){const o=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},s.exports=e})(Cl)),Cl.exports}var wg=Yk(),hr=jk(wg),Xk=a0({__proto__:null,default:hr},[wg]);function Ko(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const e=s.RTCIceCandidate;s.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const o=new e(r),c=hr.parseCandidate(r.candidate);for(const l in c)l in o||Object.defineProperty(o,l,{value:c[l]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(r)},s.RTCIceCandidate.prototype=e.prototype,Mi(s,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new s.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Gl(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||Mi(s,"icecandidate",e=>{if(e.candidate){const n=hr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Go(s,e){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(u){if(!u||!u.sdp)return!1;const h=hr.splitSections(u.sdp);return h.shift(),h.some(p=>{const g=hr.parseMLine(p);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},r=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const p=parseInt(h[1],10);return p!==p?-1:p},o=function(u){let h=65536;return e.browser==="firefox"&&(e.version<57?u===-1?h=16384:h=2147483637:e.version<60?h=e.version===57?65535:65536:h=2147483637),h},c=function(u,h){let p=65536;e.browser==="firefox"&&e.version===57&&(p=65535);const g=hr.matchPrefix(u.sdp,"a=max-message-size:");return g.length>0?p=parseInt(g[0].substring(19),10):e.browser==="firefox"&&h!==-1&&(p=2147483637),p},l=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=r(arguments[0]),p=o(h),g=c(arguments[0],h);let v;p===0&&g===0?v=Number.POSITIVE_INFINITY:p===0||g===0?v=Math.max(p,g):v=Math.min(p,g);const k={};Object.defineProperty(k,"maxMessageSize",{get(){return v}}),this._sctp=k}return l.apply(this,arguments)}}function Jo(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function e(r,o){const c=r.send;r.send=function(){const u=arguments[0],h=u.length||u.size||u.byteLength;if(r.readyState==="open"&&o.sctp&&h>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return c.apply(r,arguments)}}const n=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const o=n.apply(this,arguments);return e(o,this),o},Mi(s,"datachannel",r=>(e(r.channel,r.target),r))}function Jl(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const e=s.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const c=o.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const l=new Event("connectionstatechange",o);c.dispatchEvent(l)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Ql(s,e){if(!s.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(l=>l.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&o instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return n.apply(this,arguments)}}function Qo(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const n=s.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function $o(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const n=s.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(s.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return n.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?n.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(l=>n.apply(this,[l]))})}var Zk=Object.freeze({__proto__:null,removeExtmapAllowMixed:Ql,shimAddIceCandidateNullOrEmpty:Qo,shimConnectionState:Jl,shimMaxMessageSize:Go,shimParameterlessSetLocalDescription:$o,shimRTCIceCandidate:Ko,shimRTCIceCandidateRelayProtocol:Gl,shimSendThrowTypeError:Jo});function eS(){let{window:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Qm,r=Qk(s),o={browserDetails:r,commonShim:Zk,extractVersion:ps,disableLog:Gk,disableWarnings:Jk,sdp:Xk};switch(r.browser){case"chrome":if(!yp||!Hl||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=yp,Qo(s,r),$o(s),Ym(s,r),Xm(s),Hl(s,r),Zm(s),ig(s,r),eg(s),tg(s),rg(s,r),Ko(s),Gl(s),Jl(s),Go(s,r),Jo(s),Ql(s,r);break;case"firefox":if(!kp||!Kl||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=kp,Qo(s,r),$o(s),sg(s,r),Kl(s,r),og(s),lg(s),ag(s),cg(s),ug(s),dg(s),hg(s),fg(s),pg(s),Ko(s),Jl(s),Go(s,r),Jo(s);break;case"safari":if(!Sp||!e.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Sp,Qo(s,r),$o(s),Sg(s),Cg(s),vg(s),mg(s),gg(s),Tg(s),yg(s),bg(s),Ko(s),Gl(s),Go(s,r),Jo(s),Ql(s,r);break;default:n("Unsupported browser!");break}return o}eS({window:typeof window>"u"?void 0:window});const tS=/version\/(\d+(\.?_?\d+)+)/i;let bl;function Nt(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(bl===void 0||e){const r=nS.find(o=>{let{test:c}=o;return c.test(n)});bl=r==null?void 0:r.describe(n)}return bl}const nS=[{test:/firefox|iceweasel|fxios/i,describe(s){return{name:"Firefox",version:Yo(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,s),os:s.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:wl(s)}}},{test:/chrom|crios|crmo/i,describe(s){return{name:"Chrome",version:Yo(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,s),os:s.toLowerCase().includes("crios")?"iOS":void 0,osVersion:wl(s)}}},{test:/safari|applewebkit/i,describe(s){return{name:"Safari",version:Yo(tS,s),os:s.includes("mobile/")?"iOS":"macOS",osVersion:wl(s)}}}];function Yo(s,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(s);return r&&r.length>=n&&r[n]||""}function wl(s){return s.includes("mac os")?Yo(/\(.+?(\d+_\d+(:?_\d+)?)/,s,1).replace(/_/g,"."):void 0}var iS="2.16.1";const rS=iS,sS=16;class Cn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var je;(function(s){s[s.NotAllowed=0]="NotAllowed",s[s.ServerUnreachable=1]="ServerUnreachable",s[s.InternalError=2]="InternalError",s[s.Cancelled=3]="Cancelled",s[s.LeaveRequest=4]="LeaveRequest",s[s.Timeout=5]="Timeout",s[s.WebSocket=6]="WebSocket"})(je||(je={}));class me extends Cn{constructor(e,n,r,o){super(1,e),this.name="ConnectionError",this.status=r,this.reason=n,this.context=o,this.reasonName=je[n]}static notAllowed(e,n,r){return new me(e,je.NotAllowed,n,r)}static timeout(e){return new me(e,je.Timeout)}static leaveRequest(e,n){return new me(e,je.LeaveRequest,void 0,n)}static internal(e,n){return new me(e,je.InternalError,void 0,n)}static cancelled(e){return new me(e,je.Cancelled)}static serverUnreachable(e,n){return new me(e,je.ServerUnreachable,n)}static websocket(e,n,r){return new me(e,je.WebSocket,n,r)}}class Ru extends Cn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ln extends Cn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class oS extends Cn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class st extends Cn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class $l extends Cn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Cp extends Cn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class bp extends Cn{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:_u[n]}}var Ct;(function(s){s[s.AlreadyOpened=0]="AlreadyOpened",s[s.AbnormalEnd=1]="AbnormalEnd",s[s.DecodeFailed=2]="DecodeFailed",s[s.LengthExceeded=3]="LengthExceeded",s[s.Incomplete=4]="Incomplete",s[s.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",s[s.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Ct||(Ct={}));class Jt extends Cn{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Ct[n]}}class or extends Cn{constructor(e){super(18,e),this.name="SignalReconnectError"}}var oa;(function(s){s.PermissionDenied="PermissionDenied",s.NotFound="NotFound",s.DeviceInUse="DeviceInUse",s.Other="Other"})(oa||(oa={}));(function(s){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?s.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?s.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?s.DeviceInUse:s.Other}s.getFailure=e})(oa||(oa={}));class pt{}pt.setTimeout=function(){return setTimeout(...arguments)};pt.setInterval=function(){return setInterval(...arguments)};pt.clearTimeout=function(){return clearTimeout(...arguments)};pt.clearInterval=function(){return clearInterval(...arguments)};var q;(function(s){s.Connected="connected",s.Reconnecting="reconnecting",s.SignalReconnecting="signalReconnecting",s.Reconnected="reconnected",s.Disconnected="disconnected",s.ConnectionStateChanged="connectionStateChanged",s.Moved="moved",s.MediaDevicesChanged="mediaDevicesChanged",s.ParticipantConnected="participantConnected",s.ParticipantDisconnected="participantDisconnected",s.TrackPublished="trackPublished",s.TrackSubscribed="trackSubscribed",s.TrackSubscriptionFailed="trackSubscriptionFailed",s.TrackUnpublished="trackUnpublished",s.TrackUnsubscribed="trackUnsubscribed",s.TrackMuted="trackMuted",s.TrackUnmuted="trackUnmuted",s.LocalTrackPublished="localTrackPublished",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalAudioSilenceDetected="localAudioSilenceDetected",s.ActiveSpeakersChanged="activeSpeakersChanged",s.ParticipantMetadataChanged="participantMetadataChanged",s.ParticipantNameChanged="participantNameChanged",s.ParticipantAttributesChanged="participantAttributesChanged",s.ParticipantActive="participantActive",s.RoomMetadataChanged="roomMetadataChanged",s.DataReceived="dataReceived",s.SipDTMFReceived="sipDTMFReceived",s.TranscriptionReceived="transcriptionReceived",s.ConnectionQualityChanged="connectionQualityChanged",s.TrackStreamStateChanged="trackStreamStateChanged",s.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",s.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",s.AudioPlaybackStatusChanged="audioPlaybackChanged",s.VideoPlaybackStatusChanged="videoPlaybackChanged",s.MediaDevicesError="mediaDevicesError",s.ParticipantPermissionsChanged="participantPermissionsChanged",s.SignalConnected="signalConnected",s.RecordingStatusChanged="recordingStatusChanged",s.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",s.EncryptionError="encryptionError",s.DCBufferStatusChanged="dcBufferStatusChanged",s.ActiveDeviceChanged="activeDeviceChanged",s.ChatMessage="chatMessage",s.LocalTrackSubscribed="localTrackSubscribed",s.MetricsReceived="metricsReceived"})(q||(q={}));var X;(function(s){s.TrackPublished="trackPublished",s.TrackSubscribed="trackSubscribed",s.TrackSubscriptionFailed="trackSubscriptionFailed",s.TrackUnpublished="trackUnpublished",s.TrackUnsubscribed="trackUnsubscribed",s.TrackMuted="trackMuted",s.TrackUnmuted="trackUnmuted",s.LocalTrackPublished="localTrackPublished",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalTrackCpuConstrained="localTrackCpuConstrained",s.LocalSenderCreated="localSenderCreated",s.ParticipantMetadataChanged="participantMetadataChanged",s.ParticipantNameChanged="participantNameChanged",s.DataReceived="dataReceived",s.SipDTMFReceived="sipDTMFReceived",s.TranscriptionReceived="transcriptionReceived",s.IsSpeakingChanged="isSpeakingChanged",s.ConnectionQualityChanged="connectionQualityChanged",s.TrackStreamStateChanged="trackStreamStateChanged",s.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",s.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",s.TrackCpuConstrained="trackCpuConstrained",s.MediaDevicesError="mediaDevicesError",s.AudioStreamAcquired="audioStreamAcquired",s.ParticipantPermissionsChanged="participantPermissionsChanged",s.PCTrackAdded="pcTrackAdded",s.AttributesChanged="attributesChanged",s.LocalTrackSubscribed="localTrackSubscribed",s.ChatMessage="chatMessage",s.Active="active"})(X||(X={}));var $;(function(s){s.TransportsCreated="transportsCreated",s.Connected="connected",s.Disconnected="disconnected",s.Resuming="resuming",s.Resumed="resumed",s.Restarting="restarting",s.Restarted="restarted",s.SignalResumed="signalResumed",s.SignalRestarted="signalRestarted",s.Closing="closing",s.MediaTrackAdded="mediaTrackAdded",s.ActiveSpeakersUpdate="activeSpeakersUpdate",s.DataPacketReceived="dataPacketReceived",s.RTPVideoMapUpdate="rtpVideoMapUpdate",s.DCBufferStatusChanged="dcBufferStatusChanged",s.ParticipantUpdate="participantUpdate",s.RoomUpdate="roomUpdate",s.SpeakersChanged="speakersChanged",s.StreamStateChanged="streamStateChanged",s.ConnectionQualityUpdate="connectionQualityUpdate",s.SubscriptionError="subscriptionError",s.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",s.RemoteMute="remoteMute",s.SubscribedQualityUpdate="subscribedQualityUpdate",s.LocalTrackUnpublished="localTrackUnpublished",s.LocalTrackSubscribed="localTrackSubscribed",s.Offline="offline",s.SignalRequestResponse="signalRequestResponse",s.SignalConnected="signalConnected",s.RoomMoved="roomMoved"})($||($={}));var G;(function(s){s.Message="message",s.Muted="muted",s.Unmuted="unmuted",s.Restarted="restarted",s.Ended="ended",s.Subscribed="subscribed",s.Unsubscribed="unsubscribed",s.CpuConstrained="cpuConstrained",s.UpdateSettings="updateSettings",s.UpdateSubscription="updateSubscription",s.AudioPlaybackStarted="audioPlaybackStarted",s.AudioPlaybackFailed="audioPlaybackFailed",s.AudioSilenceDetected="audioSilenceDetected",s.VisibilityChanged="visibilityChanged",s.VideoDimensionsChanged="videoDimensionsChanged",s.VideoPlaybackStarted="videoPlaybackStarted",s.VideoPlaybackFailed="videoPlaybackFailed",s.ElementAttached="elementAttached",s.ElementDetached="elementDetached",s.UpstreamPaused="upstreamPaused",s.UpstreamResumed="upstreamResumed",s.SubscriptionPermissionChanged="subscriptionPermissionChanged",s.SubscriptionStatusChanged="subscriptionStatusChanged",s.SubscriptionFailed="subscriptionFailed",s.TrackProcessorUpdate="trackProcessorUpdate",s.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",s.TranscriptionReceived="transcriptionReceived",s.TimeSyncUpdate="timeSyncUpdate",s.PreConnectBufferFlushed="preConnectBufferFlushed"})(G||(G={}));function aS(s){return typeof s>"u"?s:typeof structuredClone=="function"?typeof s=="object"&&s!==null?structuredClone(Object.assign({},s)):structuredClone(s):JSON.parse(JSON.stringify(s))}class Oe{constructor(e,n,r,o,c){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:o,priority:c};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const cS=["vp8","h264"],lS=["vp8","h264","vp9","av1","h265"];function uS(s){return!!cS.find(e=>e===s)}const dS=uS;var wp;(function(s){s[s.PREFER_REGRESSION=0]="PREFER_REGRESSION",s[s.SIMULCAST=1]="SIMULCAST",s[s.REGRESSION=2]="REGRESSION"})(wp||(wp={}));var Yl;(function(s){s.telephone={maxBitrate:12e3},s.speech={maxBitrate:24e3},s.music={maxBitrate:48e3},s.musicStereo={maxBitrate:64e3},s.musicHighQuality={maxBitrate:96e3},s.musicHighQualityStereo={maxBitrate:128e3}})(Yl||(Yl={}));const Cs={h90:new Oe(160,90,9e4,20),h180:new Oe(320,180,16e4,20),h216:new Oe(384,216,18e4,20),h360:new Oe(640,360,45e4,20),h540:new Oe(960,540,8e5,25),h720:new Oe(1280,720,17e5,30),h1080:new Oe(1920,1080,3e6,30),h1440:new Oe(2560,1440,5e6,30),h2160:new Oe(3840,2160,8e6,30)},Xl={h120:new Oe(160,120,7e4,20),h180:new Oe(240,180,125e3,20),h240:new Oe(320,240,14e4,20),h360:new Oe(480,360,33e4,20),h480:new Oe(640,480,5e5,20),h540:new Oe(720,540,6e5,25),h720:new Oe(960,720,13e5,30),h1080:new Oe(1440,1080,23e5,30),h1440:new Oe(1920,1440,38e5,30)},Iu={h360fps3:new Oe(640,360,2e5,3,"medium"),h360fps15:new Oe(640,360,4e5,15,"medium"),h720fps5:new Oe(1280,720,8e5,5,"medium"),h720fps15:new Oe(1280,720,15e5,15,"medium"),h720fps30:new Oe(1280,720,2e6,30,"medium"),h1080fps15:new Oe(1920,1080,25e5,15,"medium"),h1080fps30:new Oe(1920,1080,5e6,30,"medium"),original:new Oe(0,0,7e6,30,"medium")};function Eg(s,e,n){var r,o,c,l;const{optionsWithoutProcessor:u,audioProcessor:h,videoProcessor:p}=Rg(s??{}),g=e==null?void 0:e.processor,v=n==null?void 0:n.processor,k=u??{};return k.audio===!0&&(k.audio={}),k.video===!0&&(k.video={}),k.audio&&(Zl(k.audio,e),(r=(c=k.audio).deviceId)!==null&&r!==void 0||(c.deviceId={ideal:"default"}),(h||g)&&(k.audio.processor=h??g)),k.video&&(Zl(k.video,n),(o=(l=k.video).deviceId)!==null&&o!==void 0||(l.deviceId={ideal:"default"}),(p||v)&&(k.video.processor=p??v)),k}function Zl(s,e){return Object.keys(e).forEach(n=>{s[n]===void 0&&(s[n]=e[n])}),s}function xu(s){var e,n,r,o;const c={};if(s.video)if(typeof s.video=="object"){const l={},u=l,h=s.video;Object.keys(h).forEach(p=>{switch(p){case"resolution":Zl(u,h.resolution);break;default:u[p]=h[p]}}),c.video=l,(e=(r=c.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else c.video=s.video?{deviceId:{ideal:"default"}}:!1;else c.video=!1;return s.audio?typeof s.audio=="object"?(c.audio=s.audio,(n=(o=c.audio).deviceId)!==null&&n!==void 0||(o.deviceId={ideal:"default"})):c.audio={deviceId:{ideal:"default"}}:c.audio=!1,c}function _g(s){return b(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const r=Pg();if(r){const o=r.createAnalyser();o.fftSize=2048;const c=o.frequencyBinCount,l=new Uint8Array(c);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(o),yield mt(n),o.getByteTimeDomainData(l);const h=l.some(p=>p!==128&&p!==0);return r.close(),!h}return!1})()})}function Pg(){var s;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((s=window.document)===null||s===void 0)&&s.body)){const r=()=>b(this,void 0,void 0,function*(){var o;try{n.state==="suspended"&&(yield n.resume())}catch(c){console.warn("Error trying to auto-resume audio context",c)}finally{(o=window.document.body)===null||o===void 0||o.removeEventListener("click",r)}});n.addEventListener("statechange",()=>{var o;n.state==="closed"&&((o=window.document.body)===null||o===void 0||o.removeEventListener("click",r))}),window.document.body.addEventListener("click",r)}return n}}function hS(s){return s==="audioinput"?j.Source.Microphone:s==="videoinput"?j.Source.Camera:j.Source.Unknown}function eu(s){return s===j.Source.Microphone?"audioinput":s===j.Source.Camera?"videoinput":void 0}function fS(s){var e,n;let r=(e=s.video)!==null&&e!==void 0?e:!0;return s.resolution&&s.resolution.width>0&&s.resolution.height>0&&(r=typeof r=="boolean"?{}:r,Di()?r=Object.assign(Object.assign({},r),{width:{max:s.resolution.width},height:{max:s.resolution.height},frameRate:s.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:s.resolution.width},height:{ideal:s.resolution.height},frameRate:s.resolution.frameRate})),{audio:(n=s.audio)!==null&&n!==void 0?n:!1,video:r,controller:s.controller,selfBrowserSurface:s.selfBrowserSurface,surfaceSwitching:s.surfaceSwitching,systemAudio:s.systemAudio,preferCurrentTab:s.preferCurrentTab}}function vs(s){return s.split("/")[1].toLowerCase()}function pS(s){const e=[];return s.forEach(n=>{n.track!==void 0&&e.push(new Tu({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Te(s){return"mediaStreamTrack"in s?{trackID:s.sid,source:s.source,muted:s.isMuted,enabled:s.mediaStreamTrack.enabled,kind:s.kind,streamID:s.mediaStreamID,streamTrackID:s.mediaStreamTrack.id}:{trackID:s.trackSid,enabled:s.isEnabled,muted:s.isMuted,trackInfo:Object.assign({mimeType:s.mimeType,name:s.trackName,encrypted:s.isEncrypted,kind:s.kind,source:s.source},s.track?Te(s.track):{})}}function mS(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function gS(s,e){var n;s===void 0&&(s={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(s)],o={};for(const c of r)s[c]!==e[c]&&(o[c]=(n=e[c])!==null&&n!==void 0?n:"");return o}function Rg(s){const e=Object.assign({},s);let n,r;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:aS(e)}}function vS(s){switch(s){case et.CAMERA:return j.Source.Camera;case et.MICROPHONE:return j.Source.Microphone;case et.SCREEN_SHARE:return j.Source.ScreenShare;case et.SCREEN_SHARE_AUDIO:return j.Source.ScreenShareAudio;default:return j.Source.Unknown}}function Ep(s,e){return s.width*s.height<e.width*e.height}function yS(s,e){var n;return(n=s.layers)===null||n===void 0?void 0:n.find(r=>r.quality===e)}const kS=5e3,ls=[];var Bt;(function(s){s[s.LOW=0]="LOW",s[s.MEDIUM=1]="MEDIUM",s[s.HIGH=2]="HIGH"})(Bt||(Bt={}));class j extends Tn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=j.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ve,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),kS):this.handleAppVisibilityChanged()},this.log=Un((o=r.loggerName)!==null&&o!==void 0?o:un.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=j.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Te(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===j.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===j.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(ls.forEach(c=>{c.parentElement===null&&!e&&(e=c)}),e&&ls.splice(ls.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),cr(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),o=r.some(c=>c.kind==="audio");return e.play().then(()=>{this.emit(o?G.AudioPlaybackStarted:G.VideoPlaybackStarted)}).catch(c=>{c.name==="NotAllowedError"?this.emit(o?G.AudioPlaybackFailed:G.VideoPlaybackFailed,c):c.name==="AbortError"?ve.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):ve.warn("could not playback ".concat(o?"audio":"video"),c),o&&e&&r.some(l=>l.kind==="video")&&c.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(G.ElementAttached,e),e}detach(e){try{if(e){fr(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(G.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{fr(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(G.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Un(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),ls.forEach(r=>{r.parentElement||(n=!1)}),n&&ls.push(e)}}handleAppVisibilityChanged(){return b(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===j.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Mt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Mt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function cr(s,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;s.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(s)||(r.forEach(o=>{n.removeTrack(o)}),n.addTrack(s)),(!Di()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Di()||Oi())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function fr(s,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(s),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(s){let e;(function(p){p.Audio="audio",p.Video="video",p.Unknown="unknown"})(e=s.Kind||(s.Kind={}));let n;(function(p){p.Camera="camera",p.Microphone="microphone",p.ScreenShare="screen_share",p.ScreenShareAudio="screen_share_audio",p.Unknown="unknown"})(n=s.Source||(s.Source={}));let r;(function(p){p.Active="active",p.Paused="paused",p.Unknown="unknown"})(r=s.StreamState||(s.StreamState={}));function o(p){switch(p){case e.Audio:return on.AUDIO;case e.Video:return on.VIDEO;default:return on.DATA}}s.kindToProto=o;function c(p){switch(p){case on.AUDIO:return e.Audio;case on.VIDEO:return e.Video;default:return e.Unknown}}s.kindFromProto=c;function l(p){switch(p){case n.Camera:return et.CAMERA;case n.Microphone:return et.MICROPHONE;case n.ScreenShare:return et.SCREEN_SHARE;case n.ScreenShareAudio:return et.SCREEN_SHARE_AUDIO;default:return et.UNKNOWN}}s.sourceToProto=l;function u(p){switch(p){case et.CAMERA:return n.Camera;case et.MICROPHONE:return n.Microphone;case et.SCREEN_SHARE:return n.ScreenShare;case et.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}s.sourceFromProto=u;function h(p){switch(p){case Vl.ACTIVE:return r.Active;case Vl.PAUSED:return r.Paused;default:return r.Unknown}}s.streamStateFromProto=h})(j||(j={}));const SS="|",_p="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function TS(s){const e=s.split(SS);return e.length>1?[e[0],s.substr(e[0].length+1)]:[s,""]}function mt(s){return b(this,void 0,void 0,function*(){return new Promise(e=>pt.setTimeout(e,s))})}function tu(){return"addTransceiver"in RTCPeerConnection.prototype}function nu(){return"addTrack"in RTCPeerConnection.prototype}function CS(){if(!("getCapabilities"in RTCRtpSender)||Di()||Oi())return!1;const s=RTCRtpSender.getCapabilities("video");let e=!1;if(s){for(const n of s.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function bS(){if(!("getCapabilities"in RTCRtpSender)||Oi())return!1;if(Di()){const n=Nt();if(n!=null&&n.version&&Sn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&Sn(n.osVersion,"16")<0)return!1}const s=RTCRtpSender.getCapabilities("video");let e=!1;if(s){for(const n of s.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function cn(s){return s==="av1"||s==="vp9"}function iu(s){return!document||bs()?!1:(s||(s=document.createElement("audio")),"setSinkId"in s)}function wS(){return typeof RTCPeerConnection>"u"?!1:tu()||nu()}function Oi(){var s;return((s=Nt())===null||s===void 0?void 0:s.name)==="Firefox"}function Pp(){const s=Nt();return!!s&&s.name==="Chrome"&&s.os!=="iOS"}function Di(){var s;return((s=Nt())===null||s===void 0?void 0:s.name)==="Safari"}function bs(){const s=Nt();return(s==null?void 0:s.name)==="Safari"||(s==null?void 0:s.os)==="iOS"}function ES(){const s=Nt();return(s==null?void 0:s.name)==="Safari"&&s.version.startsWith("17.")||(s==null?void 0:s.os)==="iOS"&&!!(s!=null&&s.osVersion)&&Sn(s.osVersion,"17")>=0}function _S(s){return s||(s=Nt()),(s==null?void 0:s.name)==="Safari"&&Sn(s.version,"18.3")>0||(s==null?void 0:s.os)==="iOS"&&!!(s!=null&&s.osVersion)&&Sn(s.osVersion,"18.3")>0}function Ig(){var s,e;return Mt()?(e=(s=navigator.userAgentData)===null||s===void 0?void 0:s.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function PS(){const s=Nt(),e="17.2";if(s)return s.name!=="Safari"&&s.os!=="iOS"||s.os==="iOS"&&s.osVersion&&Sn(s.osVersion,e)>=0?!0:s.name==="Safari"&&Sn(s.version,e)>=0}function Mt(){return typeof document<"u"}function kn(){return navigator.product=="ReactNative"}function kr(s){return s.hostname.endsWith(".livekit.cloud")||s.hostname.endsWith(".livekit.run")}function El(s){return kr(s)?s.hostname.split(".")[0]:null}function xg(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Og(){if(!kn())return;let s=xg();if(s)return s.platform}function Rp(){if(Mt())return window.devicePixelRatio;if(kn()){let s=xg();if(s)return s.devicePixelRatio}return 1}function Sn(s,e){const n=s.split("."),r=e.split("."),o=Math.min(n.length,r.length);for(let c=0;c<o;++c){const l=parseInt(n[c],10),u=parseInt(r[c],10);if(l>u)return 1;if(l<u)return-1;if(c===o-1&&l===u)return 0}return s===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function RS(s){for(const e of s)e.target.handleResize(e)}function IS(s){for(const e of s)e.target.handleVisibilityChanged(e)}let _l=null;const Ip=()=>(_l||(_l=new ResizeObserver(RS)),_l);let Pl=null;const xp=()=>(Pl||(Pl=new IntersectionObserver(IS,{root:null,rootMargin:"0px"})),Pl);function xS(){var s;const e=new Om({sdk:Dm.JS,protocol:sS,version:rS});return kn()&&(e.os=(s=Og())!==null&&s!==void 0?s:""),e}function Op(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=s,o.height=e;const c=o.getContext("2d");c==null||c.fillRect(0,0,o.width,o.height),r&&c&&(c.beginPath(),c.arc(s/2,e/2,50,0,Math.PI*2,!0),c.closePath(),c.fillStyle="grey",c.fill());const l=o.captureStream(),[u]=l.getTracks();if(!u)throw Error("Could not get empty media stream video track");return u.enabled=n,u}let us;function Rl(){if(!us){const s=new AudioContext,e=s.createOscillator(),n=s.createGain();n.gain.setValueAtTime(0,0);const r=s.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[us]=r.stream.getAudioTracks(),!us)throw Error("Could not get empty media stream audio track");us.enabled=!1}return us.clone()}class Qt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((r,o)=>b(this,void 0,void 0,function*(){this.resolve=r,this.reject=o,e&&(yield e(r,o))})).finally(()=>{var r;this._isResolved=!0,(r=this.onFinally)===null||r===void 0||r.call(this)})}}function OS(s){return lS.includes(s)}function li(s){if(typeof s=="string"||typeof s=="number")return s;if(Array.isArray(s))return s[0];if(s.exact!==void 0)return Array.isArray(s.exact)?s.exact[0]:s.exact;if(s.ideal!==void 0)return Array.isArray(s.ideal)?s.ideal[0]:s.ideal;throw Error("could not unwrap constraint")}function DS(s){return s.startsWith("http")?s.replace(/^(http)/,"ws"):s}function ws(s){return s.startsWith("ws")?s.replace(/^(ws)/,"http"):s}function MS(s,e){return s.segments.map(n=>{let{id:r,text:o,language:c,startTime:l,endTime:u,final:h}=n;var p;const g=(p=e.get(r))!==null&&p!==void 0?p:Date.now(),v=Date.now();return h?e.delete(r):e.set(r,g),{id:r,text:o,startTime:Number.parseInt(l.toString()),endTime:Number.parseInt(u.toString()),final:h,language:c,firstReceivedTime:g,lastReceivedTime:v}})}function NS(s){const{id:e,timestamp:n,message:r,editTimestamp:o}=s;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:r}}function Dp(s){switch(s.reason){case je.LeaveRequest:return s.context;case je.Cancelled:return ln.CLIENT_INITIATED;case je.NotAllowed:return ln.USER_REJECTED;case je.ServerUnreachable:return ln.JOIN_FAILURE;default:return ln.UNKNOWN_REASON}}function Xo(s){return s!==void 0?Number(s):void 0}function Ii(s){return s!==void 0?BigInt(s):void 0}function pr(s){return!!s&&!(s instanceof MediaStreamTrack)&&s.isLocal}function yn(s){return!!s&&s.kind==j.Kind.Audio}function fi(s){return!!s&&s.kind==j.Kind.Video}function ri(s){return pr(s)&&fi(s)}function On(s){return pr(s)&&yn(s)}function ru(s){return!!s&&!s.isLocal}function AS(s){return!!s&&!s.isLocal}function Il(s){return ru(s)&&fi(s)}function LS(s){return s.isLocal}function US(s,e){const n=[];let r=new TextEncoder().encode(s);for(;r.length>e;){let o=e;for(;o>0;){const c=r[o];if(c!==void 0&&(c&192)!==128)break;o--}n.push(r.slice(0,o)),r=r.slice(o)}return r.length>0&&n.push(r),n}function FS(s){var e;const n=s.get("Cache-Control");if(n){const r=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(r)return parseInt(r,10)}}function jS(s,e){const n=new URL(DS(s));return e.forEach((r,o)=>{n.searchParams.set(o,r)}),Mg(n,"rtc")}function BS(s){const e=new URL(ws(s));return Mg(e,"validate")}function Dg(s){return s.endsWith("/")?s:"".concat(s,"/")}function Mg(s,e){return s.pathname="".concat(Dg(s.pathname)).concat(e),s.toString()}function Mp(s){if(typeof s=="string")return dp.fromJson(JSON.parse(s),{ignoreUnknownFields:!0});if(s instanceof ArrayBuffer)return dp.fromBinary(new Uint8Array(s));throw new Error("could not decode websocket message: ".concat(typeof s))}function VS(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(s instanceof AbortSignal))return e;const n=s.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const zS=10,ds="lk_e2ee",qS="LKFrameEncryptionKey",WS={sharedKey:!1,ratchetSalt:qS,ratchetWindowSize:8,failureTolerance:zS,keyringSize:16};var ui;(function(s){s.SetKey="setKey",s.RatchetRequest="ratchetRequest",s.KeyRatcheted="keyRatcheted"})(ui||(ui={}));var Np;(function(s){s.KeyRatcheted="keyRatcheted"})(Np||(Np={}));var ai;(function(s){s.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",s.EncryptionError="encryptionError"})(ai||(ai={}));var Ap;(function(s){s.Error="cryptorError"})(Ap||(Ap={}));function HS(){return KS()||su()}function su(){return typeof window.RTCRtpScriptTransform<"u"}function KS(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function GS(s){var e,n,r,o,c;if(((e=s.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=s.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((r=s.value)===null||r===void 0?void 0:r.case)!=="speaker"&&((o=s.value)===null||o===void 0?void 0:o.case)!=="transcription"&&((c=s.value)===null||c===void 0?void 0:c.case)!=="encryptedPacket")return new wm({value:s.value})}class zC extends Tn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r,o)=>{ve.debug("key ratcheted event received",{ratchetResult:n,participantId:r,keyIndex:o})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},WS),e),this.on(ui.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const o={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),o),this.emit(ui.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(ui.RatchetRequest,e,n)}}var Lp;(function(s){s[s.InvalidKey=0]="InvalidKey",s[s.MissingKey=1]="MissingKey",s[s.InternalError=2]="InternalError"})(Lp||(Lp={}));class JS extends Tn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=r=>{var o,c;const{kind:l,data:u}=r.data;switch(l){case"error":if(ve.error(u.error.message),u.uuid){const g=this.decryptDataRequests.get(u.uuid);if(g!=null&&g.reject){g.reject(u.error);break}const v=this.encryptDataRequests.get(u.uuid);if(v!=null&&v.reject){v.reject(u.error);break}}this.emit(ai.EncryptionError,u.error,u.participantIdentity);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)});break;case"enable":if(u.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)}),this.encryptionEnabled!==u.enabled&&u.participantIdentity===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity))this.emit(ai.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const g=(c=this.room)===null||c===void 0?void 0:c.getParticipantByIdentity(u.participantIdentity);if(!g)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(ai.ParticipantEncryptionStatusChanged,u.enabled,g)}break;case"ratchetKey":this.keyProvider.emit(ui.KeyRatcheted,u.ratchetResult,u.participantIdentity,u.keyIndex);break;case"decryptDataResponse":const h=this.decryptDataRequests.get(u.uuid);h!=null&&h.resolve&&h.resolve(u);break;case"encryptDataResponse":const p=this.encryptDataRequests.get(u.uuid);p!=null&&p.resolve&&p.resolve(u);break}},this.onWorkerError=r=>{ve.error("e2ee worker encountered an error:",{error:r.error}),this.emit(ai.EncryptionError,r.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!HS())throw new Ru("tried to setup end-to-end encryption on an unsupported browser");if(ve.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:zk.getLevel()}};this.worker&&(ve.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ve.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ve.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on($.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(q.TrackPublished,(r,o)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==ot.NONE,o.identity)),e.on(q.ConnectionStateChanged,r=>{r===Pe.Connected&&e.remoteParticipants.forEach(o=>{o.trackPublications.forEach(c=>{this.setParticipantCryptorEnabled(c.trackInfo.encryption!==ot.NONE,o.identity)})})}).on(q.TrackUnsubscribed,(r,o,c)=>{var l;const u={kind:"removeTransform",data:{participantIdentity:c.identity,trackId:r.mediaStreamID}};(l=this.worker)===null||l===void 0||l.postMessage(u)}).on(q.TrackSubscribed,(r,o,c)=>{this.setupE2EEReceiver(r,c.identity,o.trackInfo)}).on(q.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(X.LocalSenderCreated,(r,o)=>b(this,void 0,void 0,function*(){this.setupE2EESender(o,r)})),e.localParticipant.on(X.LocalTrackPublished,r=>{if(!fi(r.track)||!bs())return;const o={kind:"updateCodec",data:{trackId:r.track.mediaStreamID,codec:vs(r.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o)}),n.on(ui.SetKey,r=>this.postKey(r)).on(ui.RatchetRequest,(r,o)=>this.postRatchetRequest(r,o))}encryptData(e){return b(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),r={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},o=new Qt;return o.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,o),this.worker.postMessage(r),o.promise})}handleEncryptedData(e,n,r,o){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const c=crypto.randomUUID(),l={kind:"decryptDataRequest",data:{uuid:c,payload:e,iv:n,participantIdentity:r,keyIndex:o}},u=new Qt;return u.onFinally=()=>{this.decryptDataRequests.delete(c)},this.decryptDataRequests.set(c,u),this.worker.postMessage(l),u.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:o}=e;var c;if(!this.worker)throw Error("could not set key, worker is missing");const l={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((c=this.room)===null||c===void 0?void 0:c.localParticipant.identity),key:n,keyIndex:o}};this.worker.postMessage(l)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?vs(r.mimeType):void 0)}}setupE2EESender(e,n){if(!pr(e)||!n){n||ve.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,o){return b(this,void 0,void 0,function*(){if(this.worker){if(su()&&!Pp()){const c={kind:"decode",participantIdentity:r,trackId:n,codec:o};e.transform=new RTCRtpScriptTransform(this.worker,c)}else{if(ds in e&&o){const h={kind:"updateCodec",data:{trackId:n,codec:o,participantIdentity:r}};this.worker.postMessage(h);return}let c=e.writableStream,l=e.readableStream;if(!c||!l){const h=e.createEncodedStreams();e.writableStream=h.writable,c=h.writable,e.readableStream=h.readable,l=h.readable}const u={kind:"decode",data:{readableStream:l,writableStream:c,trackId:n,codec:o,participantIdentity:r,isReuse:ds in e}};this.worker.postMessage(u,[l,c])}e[ds]=!0}})}handleSender(e,n,r){var o;if(!(ds in e||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(su()&&!Pp()){ve.info("initialize script transform");const c={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,c)}else{ve.info("initialize encoded streams");const c=e.createEncodedStreams(),l={kind:"encode",data:{readableStream:c.readable,writableStream:c.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(l,[c.readable,c.writable])}e[ds]=!0}}}const QS=500,$S=15e3;class mr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new mr),this._instance}addFailedConnectionAttempt(e){var n;const r=new URL(e),o=El(r);if(!o)return;let c=(n=this.failedConnectionAttempts.get(o))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(o,c+1),this.backOffPromises.set(o,mt(Math.min(QS*Math.pow(2,c),$S)))}getBackOffPromise(e){const n=new URL(e),r=n&&El(n);return r&&this.backOffPromises.get(r)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),r=n&&El(n);r&&(this.failedConnectionAttempts.set(r,0),this.backOffPromises.set(r,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}mr._instance=null;const xl="default";class dt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new dt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return b(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c;if(((c=dt.userMediaPromiseMap)===null||c===void 0?void 0:c.size)>0){ve.debug("awaiting getUserMedia promise");try{n?yield dt.userMediaPromiseMap.get(n):yield Promise.all(dt.userMediaPromiseMap.values())}catch{ve.warn("error waiting for media permissons")}}let l=yield navigator.mediaDevices.enumerateDevices();if(o&&!(Di()&&r.hasDeviceInUse(n))&&(l.filter(h=>h.kind===n).length===0||l.some(h=>{const p=h.label==="",g=n?h.kind===n:!0;return p&&g}))){const h={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},p=yield navigator.mediaDevices.getUserMedia(h);l=yield navigator.mediaDevices.enumerateDevices(),p.getTracks().forEach(g=>{g.stop()})}return r._previousDevices=l,n&&(l=l.filter(u=>u.kind===n)),l})()})}normalizeDeviceId(e,n,r){return b(this,void 0,void 0,function*(){if(n!==xl)return n;const o=yield this.getDevices(e),c=o.find(u=>u.deviceId===xl);if(!c){ve.warn("could not reliably determine default device");return}const l=o.find(u=>u.deviceId!==xl&&u.groupId===(r??c.groupId));if(!l){ve.warn("could not reliably determine default device");return}return l==null?void 0:l.deviceId})}hasDeviceInUse(e){return e?dt.userMediaPromiseMap.has(e):dt.userMediaPromiseMap.size>0}}dt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];dt.userMediaPromiseMap=new Map;var ys;(function(s){s[s.WAITING=0]="WAITING",s[s.RUNNING=1]="RUNNING",s[s.COMPLETED=2]="COMPLETED"})(ys||(ys={}));class YS{constructor(){this.pendingTasks=new Map,this.taskMutex=new wt,this.nextTaskIndex=0}run(e){return b(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ys.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ys.RUNNING,yield e()}finally{n.status=ys.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return b(this,void 0,void 0,function*(){return this.run(()=>b(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class XS{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r,o;if(!((r=n.signal)===null||r===void 0)&&r.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const c=new WebSocket(e,(o=n.protocols)!==null&&o!==void 0?o:[]);c.binaryType="arraybuffer",this.ws=c;const l=function(){let{closeCode:u,reason:h}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return c.close(u,h)};this.opened=new Promise((u,h)=>{c.onopen=()=>{u({readable:new ReadableStream({start(p){c.onmessage=g=>{let{data:v}=g;return p.enqueue(v)},c.onerror=g=>p.error(g)},cancel:l}),writable:new WritableStream({write(p){c.send(p)},abort(){c.close()},close:l}),protocol:c.protocol,extensions:c.extensions}),c.removeEventListener("error",h)},c.addEventListener("error",h)}),this.closed=new Promise((u,h)=>{const p=()=>b(this,void 0,void 0,function*(){const g=new Promise(k=>{c.readyState!==WebSocket.CLOSED&&c.addEventListener("close",C=>{k(C)},{once:!0})}),v=yield Promise.race([mt(250),g]);v?u(v):h(new Error("Encountered unspecified websocket error without a timely close event"))});c.onclose=g=>{let{code:v,reason:k}=g;u({closeCode:v,reason:k}),c.removeEventListener("error",p)},c.addEventListener("error",p)}),n.signal&&(n.signal.onabort=()=>c.close()),this.close=l}}const ZS=["syncState","trickle","offer","answer","simulate","leave"];function eT(s){const e=ZS.indexOf(s.case)>=0;return ve.trace("request allowed to bypass queue:",{canPass:e,req:s}),e}var Me;(function(s){s[s.CONNECTING=0]="CONNECTING",s[s.CONNECTED=1]="CONNECTED",s[s.RECONNECTING=2]="RECONNECTING",s[s.DISCONNECTING=3]="DISCONNECTING",s[s.DISCONNECTED=4]="DISCONNECTED"})(Me||(Me={}));const tT=250;class Ou{get currentState(){return this.state}get isDisconnected(){return this.state===Me.DISCONNECTING||this.state===Me.DISCONNECTED}get isEstablishingConnection(){return this.state===Me.CONNECTING||this.state===Me.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=Me.DISCONNECTED,this.log=ve,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Un((r=n.loggerName)!==null&&r!==void 0?r:un.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new YS,this.queuedRequests=[],this.closingLock=new wt,this.connectionLock=new wt,this.state=Me.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,o){return b(this,void 0,void 0,function*(){return this.state=Me.CONNECTING,this.options=r,yield this.connect(e,n,r,o)})}reconnect(e,n,r,o){return b(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Me.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:o}))})}connect(e,n,r,o){return b(this,void 0,void 0,function*(){const c=yield this.connectionLock.lock();this.connectOptions=r;const l=xS(),u=r.singlePeerConnection?iT(n,l,r):nT(n,l,r),h=jS(e,u),p=BS(h);return new Promise((g,v)=>b(this,void 0,void 0,function*(){var k,C;try{let P=!1;const _=R=>b(this,void 0,void 0,function*(){if(P)return;P=!0;const M=R instanceof Event?R.currentTarget:R,F=VS(M,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(F)).catch(J=>{this.log.error(J),this.close()}):this.close(),U(),v(me.cancelled(F))});o==null||o.addEventListener("abort",_);const U=()=>{clearTimeout(A),o==null||o.removeEventListener("abort",_)},A=setTimeout(()=>{_(me.timeout("room connection has timed out (signal)"))},r.websocketTimeout),Y=(R,M)=>{this.handleSignalConnected(R,A,M)},H=new URL(h);H.searchParams.has("access_token")&&H.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(H),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new XS(h);try{this.ws.closed.then(Q=>{var se;this.isEstablishingConnection&&v(me.internal("Websocket got closed during a (re)connection attempt: ".concat(Q.reason))),Q.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:Q.reason,code:Q.closeCode,wasClean:Q.closeCode===1e3,state:this.state})),this.state===Me.CONNECTED&&this.handleOnClose((se=Q.reason)!==null&&se!==void 0?se:"Unexpected WS error"))}).catch(Q=>{this.isEstablishingConnection&&v(me.internal("Websocket error during a (re)connection attempt: ".concat(Q)))});const R=yield this.ws.opened.catch(Q=>b(this,void 0,void 0,function*(){if(this.state!==Me.CONNECTED){this.state=Me.DISCONNECTED,clearTimeout(A);const se=yield this.handleConnectionError(Q,p);v(se);return}this.handleWSError(Q),v(Q)}));if(clearTimeout(A),!R)return;const M=R.readable.getReader();this.streamWriter=R.writable.getWriter();const F=yield M.read();if(M.releaseLock(),!F.value)throw me.internal("no message received as first message");const J=Mp(F.value),L=this.validateFirstMessage(J,(k=r.reconnect)!==null&&k!==void 0?k:!1);if(!L.isValid){v(L.error);return}((C=J.message)===null||C===void 0?void 0:C.case)==="join"&&(this.pingTimeoutDuration=J.message.value.pingTimeout,this.pingIntervalDuration=J.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const Z=L.shouldProcessFirstMessage?J:void 0;Y(R,Z),g(L.response)}catch(R){v(R)}finally{U()}}finally{c()}}))})}startReadingLoop(e,n){return b(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield mt(this.signalLatency));const{done:r,value:o}=yield e.read();if(r)break;const c=Mp(o);this.handleSignalResponse(c)}})}close(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Me.DISCONNECTING||Me.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const o=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Me.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:r});const c=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([c,mt(tT)])}}catch(c){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:c}))}finally{n&&(e.state=Me.DISCONNECTED),o()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:lr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:lr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new pa({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ma({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return b(this,arguments,void 0,function(r,o){var c=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const u=c.getNextRequestId();return yield c.sendRequest({case:"updateMetadata",value:new bu({requestId:u,metadata:r,name:o,attributes:l})}),u})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new jm({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new zm({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ze.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Hm({timestamp:ze.parse(Date.now()),rtt:ze.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Cu({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new va({reason:ln.CLIENT_INITIATED,action:dr.DISCONNECT})})}sendRequest(e){return b(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!o&&!eT(n)&&r.state===Me.RECONNECTING){r.queuedRequests.push(()=>b(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(o||(yield r.requestQueue.flush()),r.signalLatency&&(yield mt(r.signalLatency)),r.isDisconnected){r.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!r.streamWriter){r.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),r.logContext);return}const l=new fk({message:n});try{r.useJSON?yield r.streamWriter.write(l.toJsonString()):yield r.streamWriter.write(l.toBinary())}catch(u){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:u}))}})()})}handleSignalResponse(e){var n,r;const o=e.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let c=!1;if(o.case==="answer"){const l=Up(o.value);this.onAnswer&&this.onAnswer(l,o.value.id,o.value.midToTrackId)}else if(o.case==="offer"){const l=Up(o.value);this.onOffer&&this.onOffer(l,o.value.id,o.value.midToTrackId)}else if(o.case==="trickle"){const l=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(l,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=o.value.participants)!==null&&n!==void 0?n:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=o.value.speakers)!==null&&r!==void 0?r:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),c=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):o.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(o.value.token),this.onRoomMoved&&this.onRoomMoved(o.value)):o.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(o.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));c||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return b(this,void 0,void 0,function*(){if(this.state===Me.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=pt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&pt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=pt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&pt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,r){this.state=Me.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),r)}validateFirstMessage(e,n){var r,o,c,l,u;return((r=e.message)===null||r===void 0?void 0:r.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Me.RECONNECTING&&((o=e.message)===null||o===void 0?void 0:o.case)!=="leave"?((c=e.message)===null||c===void 0?void 0:c.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((l=e.message)===null||l===void 0?void 0:l.case)==="leave"?{isValid:!1,error:me.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:me.internal("Unexpected first message")}:{isValid:!1,error:me.internal("did not receive join response, got ".concat((u=e.message)===null||u===void 0?void 0:u.case," instead"))}}handleConnectionError(e,n){return b(this,void 0,void 0,function*(){try{const r=yield fetch(n);if(r.status.toFixed(0).startsWith("4")){const o=yield r.text();return me.notAllowed(o,r.status)}else return e instanceof me?e:me.internal("Encountered unknown websocket error during connection: ".concat(e),{status:r.status,statusText:r.statusText})}catch(r){return r instanceof me?r:me.serverUnreachable(r instanceof Error?r.message:"server was not reachable")}})}}function Up(s){const e={type:"offer",sdp:s.sdp};switch(s.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=s.type;break}return e}function lr(s,e){return new hi({sdp:s.sdp,type:s.type,id:e})}function nT(s,e,n){var r;const o=new URLSearchParams;return o.set("access_token",s),n.reconnect&&(o.set("reconnect","1"),n.sid&&o.set("sid",n.sid)),o.set("auto_subscribe",n.autoSubscribe?"1":"0"),o.set("sdk",kn()?"reactnative":"js"),o.set("version",e.version),o.set("protocol",e.protocol.toString()),e.deviceModel&&o.set("device_model",e.deviceModel),e.os&&o.set("os",e.os),e.osVersion&&o.set("os_version",e.osVersion),e.browser&&o.set("browser",e.browser),e.browserVersion&&o.set("browser_version",e.browserVersion),n.adaptiveStream&&o.set("adaptive_stream","1"),n.reconnectReason&&o.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&o.set("network",navigator.connection.type),o}function iT(s,e,n){const r=new URLSearchParams;r.set("access_token",s);const o=new Ak({clientInfo:e,connectionSettings:new Km({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(o.reconnectReason=n.reconnectReason);const c=new Lk({joinRequest:o.toBinary()});return r.set("join_request",btoa(new TextDecoder("utf-8").decode(c.toBinary()))),r}class Fp{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class rT{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const r=Date.now();r-this._lastCleanup>this.ttl/2&&this.cleanup();const o=r+this.ttl;return this._map.set(e,{value:n,expiresAt:o}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,r]of this._map.entries())r.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,r]of this._map.entries())r.expiresAt>=Date.now()&&e(r.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],r=this.asValueMap();for(const[o,c]of r.entries())n.push(e(c,o,r));return n}asValueMap(){const e=new Map;for(const[n,r]of this._map.entries())r.expiresAt>=Date.now()&&e.set(n,r.value);return e}}var rn={},Ol={},Dl={exports:{}},jp;function Du(){if(jp)return Dl.exports;jp=1;var s=Dl.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(s).forEach(function(e){var n=s[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),Dl.exports}var Bp;function sT(){return Bp||(Bp=1,(function(s){var e=function(u){return String(Number(u))===u?Number(u):u},n=function(u,h,p,g){if(g&&!p)h[g]=e(u[1]);else for(var v=0;v<p.length;v+=1)u[v+1]!=null&&(h[p[v]]=e(u[v+1]))},r=function(u,h,p){var g=u.name&&u.names;u.push&&!h[u.push]?h[u.push]=[]:g&&!h[u.name]&&(h[u.name]={});var v=u.push?{}:g?h[u.name]:h;n(p.match(u.reg),v,u.names,u.name),u.push&&h[u.push].push(v)},o=Du(),c=RegExp.prototype.test.bind(/^([a-z])=(.*)/);s.parse=function(u){var h={},p=[],g=h;return u.split(/(\r\n|\r|\n)/).filter(c).forEach(function(v){var k=v[0],C=v.slice(2);k==="m"&&(p.push({rtp:[],fmtp:[]}),g=p[p.length-1]);for(var P=0;P<(o[k]||[]).length;P+=1){var _=o[k][P];if(_.reg.test(C))return r(_,g,C)}}),h.media=p,h};var l=function(u,h){var p=h.split(/=(.+)/,2);return p.length===2?u[p[0]]=e(p[1]):p.length===1&&h.length>1&&(u[p[0]]=void 0),u};s.parseParams=function(u){return u.split(/;\s?/).reduce(l,{})},s.parseFmtpConfig=s.parseParams,s.parsePayloads=function(u){return u.toString().split(" ").map(Number)},s.parseRemoteCandidates=function(u){for(var h=[],p=u.split(" ").map(e),g=0;g<p.length;g+=3)h.push({component:p[g],ip:p[g+1],port:p[g+2]});return h},s.parseImageAttributes=function(u){return u.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(l,{})})},s.parseSimulcastStreamList=function(u){return u.split(";").map(function(h){return h.split(",").map(function(p){var g,v=!1;return p[0]!=="~"?g=e(p):(g=e(p.substring(1,p.length)),v=!0),{scid:g,paused:v}})})}})(Ol)),Ol}var Ml,Vp;function oT(){if(Vp)return Ml;Vp=1;var s=Du(),e=/%[sdv%]/g,n=function(l){var u=1,h=arguments,p=h.length;return l.replace(e,function(g){if(u>=p)return g;var v=h[u];switch(u+=1,g){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},r=function(l,u,h){var p=u.format instanceof Function?u.format(u.push?h:h[u.name]):u.format,g=[l+"="+p];if(u.names)for(var v=0;v<u.names.length;v+=1){var k=u.names[v];u.name?g.push(h[u.name][k]):g.push(h[u.names[v]])}else g.push(h[u.name]);return n.apply(null,g)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];return Ml=function(l,u){u=u||{},l.version==null&&(l.version=0),l.name==null&&(l.name=" "),l.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var h=u.outerOrder||o,p=u.innerOrder||c,g=[];return h.forEach(function(v){s[v].forEach(function(k){k.name in l&&l[k.name]!=null?g.push(r(v,k,l)):k.push in l&&l[k.push]!=null&&l[k.push].forEach(function(C){g.push(r(v,k,C))})})}),l.media.forEach(function(v){g.push(r("m",s.m[0],v)),p.forEach(function(k){s[k].forEach(function(C){C.name in v&&v[C.name]!=null?g.push(r(k,C,v)):C.push in v&&v[C.push]!=null&&v[C.push].forEach(function(P){g.push(r(k,C,P))})})})}),g.join(`\r
`)+`\r
`},Ml}var zp;function aT(){if(zp)return rn;zp=1;var s=sT(),e=oT(),n=Du();return rn.grammar=n,rn.write=e,rn.parse=s.parse,rn.parseParams=s.parseParams,rn.parseFmtpConfig=s.parseFmtpConfig,rn.parsePayloads=s.parsePayloads,rn.parseRemoteCandidates=s.parseRemoteCandidates,rn.parseImageAttributes=s.parseImageAttributes,rn.parseSimulcastStreamList=s.parseSimulcastStreamList,rn}var si=aT();function Mu(s,e,n){var r,o,c;e===void 0&&(e=50),n===void 0&&(n={});var l=(r=n.isImmediate)!=null&&r,u=(o=n.callback)!=null&&o,h=n.maxWait,p=Date.now(),g=[];function v(){if(h!==void 0){var C=Date.now()-p;if(C+e>=h)return h-C}return e}var k=function(){var C=[].slice.call(arguments),P=this;return new Promise(function(_,U){var A=l&&c===void 0;if(c!==void 0&&clearTimeout(c),c=setTimeout(function(){if(c=void 0,p=Date.now(),!l){var H=s.apply(P,C);u&&u(H),g.forEach(function(R){return(0,R.resolve)(H)}),g=[]}},v()),A){var Y=s.apply(P,C);return u&&u(Y),_(Y)}g.push({resolve:_,reject:U})})};return k.cancel=function(C){c!==void 0&&clearTimeout(c),g.forEach(function(P){return(0,P.reject)(C)}),g=[]},k}const cT=.7,lT=20,gr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class qp extends Tn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=ve,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Mu(o=>b(this,void 0,void 0,function*(){this.emit(gr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(c){if(o)o(c);else throw c}}),lT),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Un((r=n.loggerName)!==null&&r!==void 0?r:un.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new wt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return b(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return b(this,void 0,void 0,function*(){var r;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let o;if(e.type==="offer"){let{stereoMids:c,nackMids:l}=uT(e);this.remoteStereoMids=c,this.remoteNackMids=l}else if(e.type==="answer"){const c=si.parse((r=e.sdp)!==null&&r!==void 0?r:"");c.media.forEach(l=>{const u=Nu(l.mid);l.type==="audio"&&this.trackBitrates.some(h=>{if(!h.transceiver||u!=h.transceiver.mid)return!1;let p=0;if(l.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(p=v.payload,!0):!1),p===0)return!0;let g=!1;for(const v of l.fmtp)if(v.payload===p){v.config=v.config.split(";").filter(k=>!k.includes("maxaveragebitrate")).join(";"),h.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(h.maxbr*1e3)),g=!0;break}return g||h.maxbr>0&&l.fmtp.push({payload:p,config:"maxaveragebitrate=".concat(h.maxbr*1e3)}),!0})}),o=si.write(c)}return yield this.setMungedSDP(e,o,!0),this.pendingCandidates.forEach(c=>{this.pc.addIceCandidate(c)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(gr.NegotiationComplete),e.sdp&&si.parse(e.sdp).media.forEach(l=>{l.type==="video"&&this.emit(gr.RTPVideoPayloadTypes,l.rtp)})),!0})}createAndSendOffer(e){return b(this,void 0,void 0,function*(){var n;const r=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const u=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&u)yield this._pc.setRemoteDescription(u);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=this.latestOfferId+1;this.latestOfferId=o;const c=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:c.sdp},this.logContext));const l=si.parse((n=c.sdp)!==null&&n!==void 0?n:"");if(l.media.forEach(u=>{Hp(u),u.type==="audio"?Wp(u,["all"],[]):u.type==="video"&&this.trackBitrates.some(h=>{if(!u.msid||!h.cid||!u.msid.includes(h.cid))return!1;let p=0;if(u.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(p=v.payload,!0):!1),p===0||(cn(h.codec)&&!Di()&&this.ensureVideoDDExtensionForSVC(u,l),!cn(h.codec)))return!0;const g=Math.round(h.maxbr*cT);for(const v of u.fmtp)if(v.payload===p){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(g));break}return!0})}),this.latestOfferId>o){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:o}));return}yield this.setMungedSDP(c,si.write(l)),this.onOffer(c,this.latestOfferId)}finally{r()}})}createAndSetAnswer(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=si.parse((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(o=>{Hp(o),o.type==="audio"&&Wp(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,si.write(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new st("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new st("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return b(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,o=new Map;if((yield this._pc.getStats()).forEach(u=>{switch(u.type){case"transport":n=u.selectedCandidatePairId;break;case"candidate-pair":n===""&&u.selected&&(n=u.id),r.set(u.id,u);break;case"remote-candidate":o.set(u.id,"".concat(u.address,":").concat(u.port));break}}),n==="")return;const l=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(l!==void 0)return o.get(l)})}setMungedSDP(e,n,r){return b(this,void 0,void 0,function*(){if(n){const o=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(c){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:c,sdp:n})),e.sdp=o}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(o){let c="unknown error";o instanceof Error?c=o.message:typeof o=="string"&&(c=o);const l={error:c,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(l.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:l})),new $l(c)}})}ensureVideoDDExtensionForSVC(e,n){var r,o;if(!((r=e.ext)===null||r===void 0?void 0:r.some(l=>l.uri===_p))){if(this.ddExtID===0){let l=0;n.media.forEach(u=>{var h;u.type==="video"&&((h=u.ext)===null||h===void 0||h.forEach(p=>{p.value>l&&(l=p.value)}))}),this.ddExtID=l+1}(o=e.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:_p})}}}function Wp(s,e,n){const r=Nu(s.mid);let o=0;s.rtp.some(c=>c.codec==="opus"?(o=c.payload,!0):!1),o>0&&(s.rtcpFb||(s.rtcpFb=[]),n.includes(r)&&!s.rtcpFb.some(c=>c.payload===o&&c.type==="nack")&&s.rtcpFb.push({payload:o,type:"nack"}),(e.includes(r)||e.length===1&&e[0]==="all")&&s.fmtp.some(c=>c.payload===o?(c.config.includes("stereo=1")||(c.config+=";stereo=1"),!0):!1))}function uT(s){var e;const n=[],r=[],o=si.parse((e=s.sdp)!==null&&e!==void 0?e:"");let c=0;return o.media.forEach(l=>{var u;const h=Nu(l.mid);l.type==="audio"&&(l.rtp.some(p=>p.codec==="opus"?(c=p.payload,!0):!1),!((u=l.rtcpFb)===null||u===void 0)&&u.some(p=>p.payload===c&&p.type==="nack")&&r.push(h),l.fmtp.some(p=>p.payload===c?(p.config.includes("sprop-stereo=1")&&n.push(h),!0):!1))}),{stereoMids:n,nackMids:r}}function Hp(s){if(s.connection){const e=s.connection.ip.indexOf(":")>=0;(s.connection.version===4&&e||s.connection.version===6&&!e)&&(s.connection.ip="0.0.0.0",s.connection.version=4)}}function Nu(s){return typeof s=="number"?s.toFixed(0):s}const ou="vp8",dT={audioPreset:Yl.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Iu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:ou,backupCodec:!0,preConnectBuffer:!1},Ng={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ag={deviceId:{ideal:"default"},resolution:Cs.h720.resolution},hT={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Wk,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Au={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ge;(function(s){s[s.NEW=0]="NEW",s[s.CONNECTING=1]="CONNECTING",s[s.CONNECTED=2]="CONNECTED",s[s.FAILED=3]="FAILED",s[s.CLOSING=4]="CLOSING",s[s.CLOSED=5]="CLOSED"})(Ge||(Ge={}));class fT{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var o;this.peerConnectionTimeout=Au.peerConnectionTimeout,this.log=ve,this.updateState=()=>{var c,l;const u=this.state,h=this.requiredTransports.map(p=>p.getConnectionState());h.every(p=>p==="connected")?this.state=Ge.CONNECTED:h.some(p=>p==="failed")?this.state=Ge.FAILED:h.some(p=>p==="connecting")?this.state=Ge.CONNECTING:h.every(p=>p==="closed")?this.state=Ge.CLOSED:h.some(p=>p==="closed")?this.state=Ge.CLOSING:h.every(p=>p==="new")&&(this.state=Ge.NEW),u!==this.state&&(this.log.debug("pc state change: from ".concat(Ge[u]," to ").concat(Ge[this.state]),this.logContext),(c=this.onStateChange)===null||c===void 0||c.call(this,this.state,this.publisher.getConnectionState(),(l=this.subscriber)===null||l===void 0?void 0:l.getConnectionState()))},this.log=Un((o=r.loggerName)!==null&&o!==void 0?o:un.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new qp(e,r),n!=="publisher-only"&&(this.subscriber=new qp(e,r),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=c=>{var l;(l=this.onIceCandidate)===null||l===void 0||l.call(this,c,an.SUBSCRIBER)},this.subscriber.onDataChannel=c=>{var l;(l=this.onDataChannel)===null||l===void 0||l.call(this,c)},this.subscriber.onTrack=c=>{var l;(l=this.onTrack)===null||l===void 0||l.call(this,c)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=c=>{var l;(l=this.onIceCandidate)===null||l===void 0||l.call(this,c,an.PUBLISHER)},this.publisher.onTrack=c=>{var l;(l=this.onTrack)===null||l===void 0||l.call(this,c)},this.publisher.onOffer=(c,l)=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,c,l)},this.state=Ge.NEW,this.connectionLock=new wt,this.remoteOfferLock=new wt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return b(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const r of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(r)}catch(o){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:o}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return b(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return b(this,void 0,void 0,function*(){var r;n===an.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(r=this.subscriber)===null||r===void 0?void 0:r.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return b(this,void 0,void 0,function*(){var r,o,c;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(r=this.subscriber)===null||r===void 0?void 0:r.getSignallingState().toString()}));const l=yield this.remoteOfferLock.lock();try{return(yield(o=this.subscriber)===null||o===void 0?void 0:o.setRemoteDescription(e,n))?yield(c=this.subscriber)===null||c===void 0?void 0:c.createAndSetAnswer():void 0}finally{l()}})}updateConfiguration(e,n){var r;this.publisher.setConfiguration(e),(r=this.subscriber)===null||r===void 0||r.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return b(this,void 0,void 0,function*(){var r;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(c=>this.ensureTransportConnected(c,e,n)))}finally{o()}})}negotiate(e){return b(this,void 0,void 0,function*(){return new Promise((n,r)=>b(this,void 0,void 0,function*(){const o=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),c=()=>{clearTimeout(o),r("negotiation aborted")};e.signal.addEventListener("abort",c),this.publisher.once(gr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(gr.NegotiationComplete,()=>{clearTimeout(o),n()})}),yield this.publisher.negotiate(l=>{clearTimeout(o),r(l)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const r=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(o=>o.receiver===e);return r==null?void 0:r.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===an.PUBLISHER?this.publisher.getConnectedAddress():e===an.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return b(this,arguments,void 0,function(r,o){var c=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(r.getConnectionState()!=="connected")return new Promise((h,p)=>b(c,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),pt.clearTimeout(v),p(me.cancelled("room connection has been cancelled"))};o!=null&&o.signal.aborted&&g(),o==null||o.signal.addEventListener("abort",g);const v=pt.setTimeout(()=>{o==null||o.signal.removeEventListener("abort",g),p(me.internal("could not establish pc connection"))},l);for(;this.state!==Ge.CONNECTED;)if(yield mt(50),o!=null&&o.signal.aborted){p(me.cancelled("room connection has been cancelled"));return}pt.clearTimeout(v),o==null||o.signal.removeEventListener("abort",g),h()}))})()})}}const Lg=5e3,pT=3e4;class Ee{static fetchRegionSettings(e,n,r){return b(this,void 0,void 0,function*(){const o=yield Ee.fetchLock.lock();try{const c=yield fetch("".concat(mT(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:r});if(c.ok){const l=FS(c.headers),u=l?l*1e3:Lg;return{regionSettings:yield c.json(),updatedAtInMs:Date.now(),maxAgeInMs:u}}else throw c.status===401?me.notAllowed("Could not fetch region settings: ".concat(c.statusText),c.status):me.internal("Could not fetch region settings: ".concat(c.statusText))}catch(c){throw c instanceof me?c:r!=null&&r.aborted?me.cancelled("Region fetching was aborted"):me.serverUnreachable("Could not fetch region settings, ".concat(c instanceof Error?"".concat(c.name,": ").concat(c.message):c))}finally{o()}})}static scheduleRefetch(e,n,r){return b(this,void 0,void 0,function*(){const o=Ee.settingsTimeouts.get(e.hostname);clearTimeout(o),Ee.settingsTimeouts.set(e.hostname,setTimeout(()=>b(this,void 0,void 0,function*(){try{const c=yield Ee.fetchRegionSettings(e,n);Ee.updateCachedRegionSettings(e,n,c)}catch(c){if(c instanceof me&&c.reason===je.NotAllowed){ve.debug("token is not valid, cancelling auto region refresh");return}ve.debug("auto refetching of region settings failed",{error:c}),Ee.scheduleRefetch(e,n,r)}}),r))})}static updateCachedRegionSettings(e,n,r){Ee.cache.set(e.hostname,r),Ee.scheduleRefetch(e,n,r.maxAgeInMs)}static stopRefetch(e){const n=Ee.settingsTimeouts.get(e);n&&(clearTimeout(n),Ee.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Ee.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const r=Ee.connectionTrackers.get(e);r&&r.connectionCount===0&&(ve.debug("stopping region refetch after disconnect delay",{hostname:e}),Ee.stopRefetch(e)),r&&(r.cleanupTimeout=void 0)},pT))}static cancelCleanup(e){const n=Ee.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Ee.connectionTrackers.get(e);n||(n={connectionCount:0},Ee.connectionTrackers.set(e,n)),n.connectionCount++,Ee.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Ee.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Ee.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return kr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return b(this,void 0,void 0,function*(){return Ee.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return b(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Ee.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Ee.updateCachedRegionSettings(this.serverUrl,this.token,n));const r=n.regionSettings.regions.filter(o=>!this.attemptedRegions.find(c=>c.url===o.url));if(r.length>0){const o=r[0];return this.attemptedRegions.push(o),ve.debug("next region: ".concat(o.region)),o.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Ee.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Ee.cache=new Map;Ee.settingsTimeouts=new Map;Ee.connectionTrackers=new Map;Ee.fetchLock=new wt;function mT(s){return"".concat(s.protocol.replace("ws","http"),"//").concat(s.host,"/settings")}class Qe extends Error{constructor(e,n,r){super(n),this.code=e,this.message=Kp(n,Qe.MAX_MESSAGE_BYTES),this.data=r?Kp(r,Qe.MAX_DATA_BYTES):void 0}static fromProto(e){return new Qe(e.code,e.message,e.data)}toProto(){return new Pm({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Qe(Qe.ErrorCode[e],Qe.ErrorMessage[e],n)}}Qe.MAX_MESSAGE_BYTES=256;Qe.MAX_DATA_BYTES=15360;Qe.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Qe.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Ug=15360;function Lu(s){return new TextEncoder().encode(s).length}function Kp(s,e){if(Lu(s)<=e)return s;let n=0,r=s.length;const o=new TextEncoder;for(;n<r;){const c=Math.floor((n+r+1)/2);o.encode(s.slice(0,c)).length<=e?n=c:r=c-1}return s.slice(0,n)}const Uu=2e3;function ka(s,e){if(!e)return 0;let n,r;return"bytesReceived"in s?(n=s.bytesReceived,r=e.bytesReceived):"bytesSent"in s&&(n=s.bytesSent,r=e.bytesSent),n===void 0||r===void 0||s.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(s.timestamp-e.timestamp)}const Fu=typeof MediaRecorder<"u";class gT{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const vT=Fu?MediaRecorder:gT;class yT extends vT{constructor(e,n){if(!Fu)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let r,o;const c=()=>o===void 0,l=()=>{this.removeEventListener("dataavailable",r),this.removeEventListener("stop",l),this.removeEventListener("error",u),o==null||o.close(),o=void 0},u=h=>{o==null||o.error(h),this.removeEventListener("dataavailable",r),this.removeEventListener("stop",l),this.removeEventListener("error",u),o=void 0};this.byteStream=new ReadableStream({start:h=>{o=h,r=p=>b(this,void 0,void 0,function*(){let g;if(p.data.arrayBuffer){const v=yield p.data.arrayBuffer();g=new Uint8Array(v)}else if(p.data.byteArray)g=p.data.byteArray;else throw new Error("no data available!");c()||h.enqueue(g)}),this.addEventListener("dataavailable",r)},cancel:()=>{l()}}),this.addEventListener("stop",l),this.addEventListener("error",u)}}function kT(){return Fu}const ST=1e3,TT=1e4;class Fg extends j{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,c=arguments.length>4?arguments[4]:void 0;super(e,n,c),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Mu(()=>b(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>b(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(G.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new wt,this.pauseUpstreamLock=new wt,this.trackChangeLock=new wt,this.trackChangeLock.lock().then(l=>b(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{l()}})),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==j.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return b(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(c=>{fr(this._mediaStreamTrack,c)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let o;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(cr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(o??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(c=>{cr(o??e,c)}))})}waitForDimensions(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ST;return(function*(){var r;if(e.kind===j.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=Nt())===null||r===void 0?void 0:r.os)==="iOS"&&(yield mt(10));const o=Date.now();for(;Date.now()-o<n;){const c=e.dimensions;if(c)return c;yield mt(50)}throw new Ln("unable to get track dimensions after timeout")})()})}setDeviceId(e){return b(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===li(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),li(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===j.Source.ScreenShare)return;const{deviceId:r,groupId:o}=e._mediaStreamTrack.getSettings(),c=e.kind===j.Kind.Audio?"audioinput":"videoinput";return n?dt.getInstance().normalizeDeviceId(c,r,o):r})()})}mute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return b(this,void 0,void 0,function*(){const r=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Ln("unable to replace an unpublished track");let o,c;return typeof n=="boolean"?o=n:n!==void 0&&(o=n.userProvidedTrack,c=n.stopProcessor),this.providedByUser=o??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),c&&this.processor&&(yield this.internalStopProcessor()),this}finally{r()}})}restart(e){return b(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:o}=e,c=Hk(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const l={audio:!1,video:!1};this.kind===j.Kind.Video?l.video=r||o?{deviceId:r,facingMode:o}:!0:l.audio=r?Object.assign({deviceId:r},c):!0,this.attachedElements.forEach(p=>{fr(this.mediaStreamTrack,p)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const h=(yield navigator.mediaDevices.getUserMedia(l)).getTracks()[0];return this.kind===j.Kind.Video&&(yield h.applyConstraints(c)),h.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(h),this._constraints=e,this.emit(G.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?G.Muted:G.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Ig()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(G.UpstreamPaused,this);const r=Nt();if((r==null?void 0:r.name)==="Safari"&&Sn(r.version,"12.0")<0)throw new Ru("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(G.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return b(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c;const l=yield r.trackChangeLock.lock();try{r.log.debug("setting up processor",r.logContext);const u=document.createElement(r.kind),h={kind:r.kind,track:r._mediaStreamTrack,element:u,audioContext:r.audioContext};if(yield n.init(h),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.internalStopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(cr(r._mediaStreamTrack,u),u.muted=!0,u.play().catch(p=>{p instanceof DOMException&&p.name==="AbortError"?(r.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},r.logContext),{error:p})),setTimeout(()=>{u.play().catch(g=>{r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{err:g}))})},100)):r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:p}))}),r.processor=n,r.processorElement=u,r.processor.processedTrack){for(const p of r.attachedElements)p!==r.processorElement&&o&&(fr(r._mediaStreamTrack,p),cr(r.processor.processedTrack,p));yield(c=r.sender)===null||c===void 0?void 0:c.replaceTrack(r.processor.processedTrack)}r.emit(G.TrackProcessorUpdate,r.processor)}finally{l()}})()})}getProcessor(){return this.processor}stopProcessor(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const r=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{r()}})()})}internalStopProcessor(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var r,o;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((o=e.processorElement)===null||o===void 0||o.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(G.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!kT()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new yT(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},TT)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class aa extends Fg{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;super(e,j.Kind.Audio,n,r,c),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(u){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}l&&this.prevStats&&(this._currentBitrate=ka(l,this.prevStats)),this.prevStats=l}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(G.AudioTrackFeatureUpdate,this,ut.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(G.AudioTrackFeatureUpdate,this,ut.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===j.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==li(this._constraints.deviceId);return this.source===j.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return b(this,void 0,void 0,function*(){let n;if(e){const r=xu({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return b(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){Mt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Uu)))}setProcessor(e){return b(this,void 0,void 0,function*(){var n;const r=yield this.trackChangeLock.lock();try{if(!kn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(o),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(G.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(o=>{o.type==="outbound-rtp"&&(r={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),r})}checkForSilence(){return b(this,void 0,void 0,function*(){const e=yield _g(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(G.AudioSilenceDetected)),e})}}function CT(s,e,n){switch(s.kind){case"audio":return new aa(s,e,!1,void 0,n);case"video":return new ca(s,e,!1,n);default:throw new Ln("unsupported track type: ".concat(s.kind))}}const bT=Object.values(Cs),wT=Object.values(Xl),ET=Object.values(Iu),_T=[Cs.h180,Cs.h360],PT=[Xl.h180,Xl.h360],RT=s=>[{scaleResolutionDownBy:2,fps:s.encoding.maxFramerate}].map(n=>{var r,o;return new Oe(Math.floor(s.width/n.scaleResolutionDownBy),Math.floor(s.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(s.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=s.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((o=n.fps)!==null&&o!==void 0?o:30))))),n.fps,s.encoding.priority)}),au=["q","h","f"];function cu(s,e,n,r){var o,c;let l=r==null?void 0:r.videoEncoding;s&&(l=r==null?void 0:r.screenShareEncoding);const u=r==null?void 0:r.simulcast,h=r==null?void 0:r.scalabilityMode,p=r==null?void 0:r.videoCodec;if(!l&&!u&&!h||!e||!n)return[{}];l||(l=xT(s,e,n,p),ve.debug("using video encoding",l));const g=l.maxFramerate,v=new Oe(e,n,l.maxBitrate,l.maxFramerate,l.priority);if(h&&cn(p)){const P=new jg(h),_=[];if(P.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(h));const U=Nt();if(bs()||kn()||(U==null?void 0:U.name)==="Chrome"&&Sn(U==null?void 0:U.version,"113")<0){const A=P.suffix=="h"?2:3,Y=_S(U);for(let H=0;H<P.spatial;H+=1)_.push({rid:au[2-H],maxBitrate:l.maxBitrate/Math.pow(A,H),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:Y?Math.pow(2,H):void 0});_[0].scalabilityMode=h}else _.push({maxBitrate:l.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:h});return v.encoding.priority&&(_[0].priority=v.encoding.priority,_[0].networkPriority=v.encoding.priority),ve.debug("using svc encoding",{encodings:_}),_}if(!u)return[l];let k=[];s?k=(o=Jp(r==null?void 0:r.screenShareSimulcastLayers))!==null&&o!==void 0?o:Gp(s,v):k=(c=Jp(r==null?void 0:r.videoSimulcastLayers))!==null&&c!==void 0?c:Gp(s,v);let C;if(k.length>0){const P=k[0];k.length>1&&([,C]=k);const _=Math.max(e,n);if(_>=960&&C)return Nl(e,n,[P,C,v],g);if(_>=480)return Nl(e,n,[P,v],g)}return Nl(e,n,[v])}function IT(s,e,n){var r,o,c,l;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ve.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const u=s.mediaStreamTrack.getSettings(),h=(r=u.width)!==null&&r!==void 0?r:(o=s.dimensions)===null||o===void 0?void 0:o.width,p=(c=u.height)!==null&&c!==void 0?c:(l=s.dimensions)===null||l===void 0?void 0:l.height;return s.source===j.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),cu(s.source===j.Source.ScreenShare,h,p,n)}function xT(s,e,n,r){const o=OT(s,e,n);let{encoding:c}=o[0];const l=Math.max(e,n);for(let u=0;u<o.length;u+=1){const h=o[u];if(c=h.encoding,h.width>=l)break}if(r)switch(r){case"av1":case"h265":c=Object.assign({},c),c.maxBitrate=c.maxBitrate*.7;break;case"vp9":c=Object.assign({},c),c.maxBitrate=c.maxBitrate*.85;break}return c}function OT(s,e,n){if(s)return ET;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?bT:wT}function Gp(s,e){if(s)return RT(e);const{width:n,height:r}=e,o=n>r?n/r:r/n;return Math.abs(o-16/9)<Math.abs(o-4/3)?_T:PT}function Nl(s,e,n,r){const o=[];if(n.forEach((c,l)=>{if(l>=au.length)return;const u=Math.min(s,e),p={rid:au[l],scaleResolutionDownBy:Math.max(1,u/Math.min(c.width,c.height)),maxBitrate:c.encoding.maxBitrate},g=r&&c.encoding.maxFramerate?Math.min(r,c.encoding.maxFramerate):c.encoding.maxFramerate;g&&(p.maxFramerate=g);const v=Oi()||l===0;c.encoding.priority&&v&&(p.priority=c.encoding.priority,p.networkPriority=c.encoding.priority),o.push(p)}),kn()&&Og()==="ios"){let c;o.forEach(u=>{c?u.maxFramerate&&u.maxFramerate>c&&(c=u.maxFramerate):c=u.maxFramerate});let l=!0;o.forEach(u=>{var h;u.maxFramerate!=c&&(l&&(l=!1,ve.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ve.info('Setting framerate of encoding "'.concat((h=u.rid)!==null&&h!==void 0?h:"",'" to ').concat(c)),u.maxFramerate=c)})}return o}function Jp(s){if(s)return s.sort((e,n)=>{const{encoding:r}=e,{encoding:o}=n;return r.maxBitrate>o.maxBitrate?1:r.maxBitrate<o.maxBitrate?-1:r.maxBitrate===o.maxBitrate&&r.maxFramerate&&o.maxFramerate?r.maxFramerate>o.maxFramerate?1:-1:0})}class jg{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function DT(s){return s.source===j.Source.ScreenShare||s.constraints.height&&li(s.constraints.height)>=1080?"maintain-resolution":"balanced"}const MT=5e3;class ca extends Fg{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(e,j.Kind.Video,n,r,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(h){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:h}));return}const l=new Map(c.map(h=>[h.rid,h])),u=c.some(h=>h.qualityLimitationReason==="cpu");if(u!==this.isCpuConstrained&&(this.isCpuConstrained=u,this.isCpuConstrained&&this.emit(G.CpuConstrained)),this.prevStats){let h=0;l.forEach((p,g)=>{var v;const k=(v=this.prevStats)===null||v===void 0?void 0:v.get(g);h+=ka(p,k)}),this._currentBitrate=h}this.prevStats=l}),this.senderLock=new wt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Mt())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Uu))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return b(this,void 0,void 0,function*(){var n,r,o,c,l;yield e.pauseUpstream.call(this);try{for(var u=!0,h=An(this.simulcastCodecs.values()),p;p=yield h.next(),n=p.done,!n;u=!0)c=p.value,u=!1,yield(l=c.sender)===null||l===void 0?void 0:l.replaceTrack(null)}catch(g){r={error:g}}finally{try{!u&&!n&&(o=h.return)&&(yield o.call(h))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return b(this,void 0,void 0,function*(){var n,r,o,c,l;yield e.resumeUpstream.call(this);try{for(var u=!0,h=An(this.simulcastCodecs.values()),p;p=yield h.next(),n=p.done,!n;u=!0){c=p.value,u=!1;const g=c;yield(l=g.sender)===null||l===void 0?void 0:l.replaceTrack(g.mediaStreamTrack)}}catch(g){r={error:g}}finally{try{!u&&!n&&(o=h.return)&&(yield o.call(h))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===j.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===j.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(o=>{var c;if(o.type==="outbound-rtp"){const l={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(c=o.rid)!==null&&c!==void 0?c:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},u=r.get(o.remoteId);u&&(l.jitter=u.jitter,l.packetsLost=u.packetsLost,l.roundTripTime=u.roundTripTime),n.push(l)}}),n.sort((o,c)=>{var l,u;return((l=c.frameWidth)!==null&&l!==void 0?l:0)-((u=o.frameWidth)!==null&&u!==void 0?u:0)}),n})}setPublishingQuality(e){const n=[];for(let r=Bt.LOW;r<=Bt.HIGH;r+=1)n.push(new wu({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(cn(this.codec),n)}restartTrack(e){return b(this,void 0,void 0,function*(){var n,r,o,c,l;let u;if(e){const v=xu({video:e});typeof v.video!="boolean"&&(u=v.video)}yield this.restart(u),this.isCpuConstrained=!1;try{for(var h=!0,p=An(this.simulcastCodecs.values()),g;g=yield p.next(),n=g.done,!n;h=!0){c=g.value,h=!1;const v=c;v.sender&&((l=v.sender.transport)===null||l===void 0?void 0:l.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){r={error:v}}finally{try{!h&&!n&&(o=p.return)&&(yield o.call(p))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return b(this,arguments,void 0,function(r){var o=this;let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l,u,h,p,g,v;if(yield n.setProcessor.call(o,r,c),!((g=o.processor)===null||g===void 0)&&g.processedTrack)try{for(var k=!0,C=An(o.simulcastCodecs.values()),P;P=yield C.next(),l=P.done,!l;k=!0)p=P.value,k=!1,yield(v=p.sender)===null||v===void 0?void 0:v.replaceTrack(o.processor.processedTrack)}catch(_){u={error:_}}finally{try{!k&&!l&&(h=C.return)&&(yield h.call(C))}finally{if(u)throw u.error}}})()})}setDegradationPreference(e){return b(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},MT))}setPublishingCodecs(e){return b(this,void 0,void 0,function*(){var n,r,o,c,l,u,h;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(cn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const p=[];try{for(n=!0,r=An(e);o=yield r.next(),c=o.done,!c;n=!0){h=o.value,n=!1;const g=h;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(cn(g.codec),g.qualities);else{const v=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const k of g.qualities)if(k.enabled){p.push(g.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield Qp(v.sender,v.encodings,g.qualities,this.senderLock,cn(g.codec),this.log,this.logContext))}}}catch(g){l={error:g}}finally{try{!n&&!c&&(u=r.return)&&(yield u.call(r))}finally{if(l)throw l.error}}return p})}setPublishingLayers(e,n){return b(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Qp(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return b(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((r,o)=>{var c;return Object.assign(Object.assign({},r),{active:o===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((c=this.mediaStreamTrack.getSettings().height)!==null&&c!==void 0?c:360)/360)),scalabilityMode:o===0&&cn(this.codec)?"L1T3":void 0,maxFramerate:o===0?15:0,maxBitrate:o===0?r.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Ig()&&this.isInBackground&&this.source===j.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Qp(s,e,n,r,o,c,l){return b(this,void 0,void 0,function*(){const u=yield r.lock();c.debug("setPublishingLayersForSender",Object.assign(Object.assign({},l),{sender:s,qualities:n,senderEncodings:e}));try{const h=s.getParameters(),{encodings:p}=h;if(!p)return;if(p.length!==e.length){c.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},l),{encodings:p,senderEncodings:e}));return}let g=!1;!1&&p[0].scalabilityMode||(o&&n.some(C=>C.enabled)&&n.forEach(C=>C.enabled=!0),p.forEach((k,C)=>{var P;let _=(P=k.rid)!==null&&P!==void 0?P:"";_===""&&(_="q");const U=Bg(_),A=n.find(Y=>Y.quality===U);A&&k.active!==A.enabled&&(g=!0,k.active=A.enabled,c.debug("setting layer ".concat(A.quality," to ").concat(k.active?"enabled":"disabled"),l),Oi()&&(A.enabled?(k.scaleResolutionDownBy=e[C].scaleResolutionDownBy,k.maxBitrate=e[C].maxBitrate,k.maxFrameRate=e[C].maxFrameRate):(k.scaleResolutionDownBy=4,k.maxBitrate=10,k.maxFrameRate=2)))})),g&&(h.encodings=p,c.debug("setting encodings",Object.assign(Object.assign({},l),{encodings:h.encodings})),yield s.setParameters(h))}finally{u()}})}function Bg(s){switch(s){case"f":return Bt.HIGH;case"h":return Bt.MEDIUM;case"q":return Bt.LOW;default:return Bt.HIGH}}function $p(s,e,n,r){if(!n)return[new ci({quality:Bt.HIGH,width:s,height:e,bitrate:0,ssrc:0})];if(r){const o=n[0].scalabilityMode,c=new jg(o),l=[],u=c.suffix=="h"?1.5:2,h=c.suffix=="h"?2:3;for(let p=0;p<c.spatial;p+=1)l.push(new ci({quality:Math.min(Bt.HIGH,c.spatial-1)-p,width:Math.ceil(s/Math.pow(u,p)),height:Math.ceil(e/Math.pow(u,p)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(h,p)):0,ssrc:0}));return l}return n.map(o=>{var c,l,u;const h=(c=o.scaleResolutionDownBy)!==null&&c!==void 0?c:1;let p=Bg((l=o.rid)!==null&&l!==void 0?l:"");return new ci({quality:p,width:Math.ceil(s/h),height:Math.ceil(e/h),bitrate:(u=o.maxBitrate)!==null&&u!==void 0?u:0,ssrc:0})})}const Yp="_lossy",Xp="_reliable",NT=2*1e3,Al="leave-reconnect",AT=3e4,LT=8*1024,UT=256*1024;var Gt;(function(s){s[s.New=0]="New",s[s.Connected=1]="Connected",s[s.Disconnected=2]="Disconnected",s[s.Reconnecting=3]="Reconnecting",s[s.Closed=4]="Closed"})(Gt||(Gt={}));class FT extends Tn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Au.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Gt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ve,this.reliableDataSequence=1,this.reliableMessageBuffer=new Fp,this.reliableReceivedState=new rT(AT),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=r=>b(this,[r],void 0,function(o){var c=this;let{channel:l}=o;return(function*(){if(l){if(l.label===Xp)c.reliableDCSub=l;else if(l.label===Yp)c.lossyDCSub=l;else return;c.log.debug("on data channel ".concat(l.id,", ").concat(l.label),c.logContext),l.onmessage=c.handleDataMessage}})()}),this.handleDataMessage=r=>b(this,void 0,void 0,function*(){var o,c,l,u,h;const p=yield this.dataProcessLock.lock();try{let g;if(r.data instanceof ArrayBuffer)g=r.data;else if(r.data instanceof Blob)g=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const v=bt.fromBinary(new Uint8Array(g));if(v.sequence>0&&v.participantSid!==""){const k=this.reliableReceivedState.get(v.participantSid);if(k&&v.sequence<=k)return;this.reliableReceivedState.set(v.participantSid,v.sequence)}if(((o=v.value)===null||o===void 0?void 0:o.case)==="speaker")this.emit($.ActiveSpeakersUpdate,v.value.value.speakers);else if(((c=v.value)===null||c===void 0?void 0:c.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const k=yield(l=this.e2eeManager)===null||l===void 0?void 0:l.handleEncryptedData(v.value.value.encryptedValue,v.value.value.iv,v.participantIdentity,v.value.value.keyIndex),C=wm.fromBinary(k.payload),P=new bt({value:C.value,participantIdentity:v.participantIdentity,participantSid:v.participantSid});((u=P.value)===null||u===void 0?void 0:u.case)==="user"&&Zp(P,P.value.value),this.emit($.DataPacketReceived,P,v.value.value.encryptionType)}else((h=v.value)===null||h===void 0?void 0:h.case)==="user"&&Zp(v,v.value.value),this.emit($.DataPacketReceived,v,ot.NONE)}finally{p()}}),this.handleDataError=r=>{const c=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:l}=r.error;this.log.error("DataChannel error on ".concat(c,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:l}))}else this.log.error("Unknown DataChannel error on ".concat(c),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const c=r.currentTarget.maxRetransmits===0?ke.LOSSY:ke.RELIABLE;this.updateAndEmitDCBufferStatus(c)},this.handleDisconnect=(r,o)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const c=h=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(h,"ms. giving up"),this.logContext),this.emit($.Disconnected),this.close()},l=Date.now()-this.reconnectStart;let u=this.getNextRetryDelay({elapsedMs:l,retryCount:this.reconnectAttempts});if(u===null){c(l);return}r===Al&&(u=0),this.log.debug("reconnecting in ".concat(u,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=pt.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),u)},this.waitForRestarted=()=>new Promise((r,o)=>{this.pcState===Gt.Connected&&r();const c=()=>{this.off($.Disconnected,l),r()},l=()=>{this.off($.Restarted,c),o()};this.once($.Restarted,c),this.once($.Disconnected,l)}),this.updateAndEmitDCBufferStatus=r=>{if(r===ke.RELIABLE){const c=this.dataChannelForKind(r);c&&this.reliableMessageBuffer.alignBufferedAmount(c.bufferedAmount)}const o=this.isBufferStatusLow(r);typeof o<"u"&&o!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,o),this.emit($.DCBufferStatusChanged,o,r))},this.isBufferStatusLow=r=>{const o=this.dataChannelForKind(r);if(o)return o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>b(this,void 0,void 0,function*(){!this.url||!(yield fetch(ws(this.url),{method:"HEAD"}).then(o=>o.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Me.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Me.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Ri.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>b(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(ws(this.url),{method:"HEAD"}),mt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Un((n=e.loggerName)!==null&&n!==void 0?n:un.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Ou(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new wt,this.dataProcessLock=new wt,this.dcBufferStatus=new Map([[ke.LOSSY,!0],[ke.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit($.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit($.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit($.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit($.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit($.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit($.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit($.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit($.SignalRequestResponse,r)}get logContext(){var e,n,r,o,c,l;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(o=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||o===void 0?void 0:o.sid,participant:(l=(c=this.latestJoinResponse)===null||c===void 0?void 0:c.participant)===null||l===void 0?void 0:l.identity,pID:this.participantSid}}join(e,n,r,o){return b(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const c=yield this.client.join(e,n,r,o);return this._isClosed=!1,this.latestJoinResponse=c,this.subscriberPrimary=c.subscriberPrimary,this.pcManager||(yield this.configure(c)),(!this.subscriberPrimary||c.fastPublish)&&this.negotiate().catch(l=>{ve.error(l,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=c.clientConfiguration,this.emit($.SignalConnected,c),c}catch(c){if(c instanceof me&&c.reason===je.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,o);throw c}})}close(){return b(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit($.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return b(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Fp,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return b(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ln("a track with the same ID has already been published");return new Promise((n,r)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(me.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:c=>{clearTimeout(o),n(c)},reject:()=>{clearTimeout(o),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return b(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return b(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==Ge.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const o=this.makeRTCConfiguration(e);this.pcManager=new fT(o,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit($.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(c,l)=>{this.client.sendIceCandidate(c,l)},this.pcManager.onPublisherOffer=(c,l)=>{this.client.sendOffer(c,l)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(c,l,u)=>b(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(c),this.logContext),["closed","disconnected","failed"].includes(l)&&(this.publisherConnectionPromise=void 0),c===Ge.CONNECTED){const g=this.pcState===Gt.New;this.pcState=Gt.Connected,g&&this.emit($.Connected,e)}else c===Ge.FAILED&&(this.pcState===Gt.Connected||this.pcState===Gt.Reconnecting)&&(this.pcState=Gt.Disconnected,this.handleDisconnect("peerconnection failed",u==="failed"?Ri.RR_SUBSCRIBER_FAILED:Ri.RR_PUBLISHER_FAILED));const h=this.client.isDisconnected||this.client.currentState===Me.RECONNECTING,p=[Ge.FAILED,Ge.CLOSING,Ge.CLOSED].includes(c);h&&p&&!this._isClosed&&this.emit($.Offline)}),this.pcManager.onTrack=c=>{c.streams.length!==0&&this.emit($.MediaTrackAdded,c.track,c.streams[0],c.receiver)},jT((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,r)=>b(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:r})),this.midToTrackId=r,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,r)=>b(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=r;const o=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);o&&this.client.sendAnswer(o,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit($.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit($.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit($.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit($.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit($.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,r;const o={direction:"recvonly"};for(let c=0;c<e.numAudios;c++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",o);for(let c=0;c<e.numVideos;c++)(r=this.pcManager)===null||r===void 0||r.addPublisherTransceiverOfKind("video",o);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Ri.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Lg,regionSettings:e.regions})),e.action){case dr.DISCONNECT:this.emit($.Disconnected,e==null?void 0:e.reason),this.close();break;case dr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Al);break;case dr.RESUME:this.handleDisconnect(Al)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const o=[];e.iceServers.forEach(c=>{const l={urls:c.urls};c.username&&(l.username=c.username),c.credential&&(l.credential=c.credential),o.push(l)}),r.iceServers=o}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ks.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Yp,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Xp,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(ke.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,LT),UT)}},1e3))}createSender(e,n,r){return b(this,void 0,void 0,function*(){if(tu())return yield this.createTransceiverRTCRtpSender(e,n,r);if(nu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new st("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,o){return b(this,void 0,void 0,function*(){if(tu())return this.createSimulcastTransceiverSender(e,n,r,o);if(nu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new st("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new st("publisher is closed");const o=[];e.mediaStream&&o.push(e.mediaStream),fi(e)&&(e.codec=n.videoCodec);const c={direction:"sendonly",streams:o};return r&&(c.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,c)).sender})}createSimulcastTransceiverSender(e,n,r,o){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new st("publisher is closed");const c={direction:"sendonly"};o&&(c.sendEncodings=o);const l=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,c);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,l.sender),l.sender})}createRTCRtpSender(e){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new st("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return b(this,void 0,void 0,function*(){var n,r,o;if(!this._isClosed){if(this.attemptingReconnect){ve.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===ks.DISABLED||((o=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&o!==void 0?o:Ge.NEW)===Ge.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(c){this.reconnectAttempts+=1;let l=!0;c instanceof st?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:c})),l=!1):c instanceof or||(this.fullReconnectOnNext=!0),l?this.handleDisconnect("reconnect",Ri.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit($.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return b(this,void 0,void 0,function*(){var n,r,o;try{if(!this.url||!this.token)throw new st("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit($.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let c;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new or;c=yield this.join(e??this.url,this.token,this.signalOpts)}catch(l){throw l instanceof me&&l.reason===je.NotAllowed?new st("could not reconnect, token might be expired"):new or}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit($.SignalRestarted,c),yield this.waitForPCReconnected(),this.client.currentState!==Me.CONNECTED)throw new or("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit($.Restarted)}catch(c){const l=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(l){yield this.restartConnection(l);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),c}})}resumeConnection(e){return b(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new st("could not reconnect, url or token not saved");if(!this.pcManager)throw new st("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit($.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(o){let c="";throw o instanceof Error&&(c=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof me&&o.reason===je.NotAllowed?new st("could not reconnect, token might be expired"):o instanceof me&&o.reason===je.LeaveRequest?o:new or(c)}if(this.emit($.SignalResumed),r){const o=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(o),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=r.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Me.CONNECTED)throw new or("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),r!=null&&r.lastMessageSeq&&this.resendReliableMessagesForResume(r.lastMessageSeq),this.emit($.Resumed)})}waitForPCInitialConnection(e,n){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new st("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return b(this,void 0,void 0,function*(){this.pcState=Gt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield mt(NT),!this.pcManager)throw new st("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Gt.Connected}catch(e){throw this.pcState=Gt.Disconnected,me.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,r,o){return b(this,void 0,void 0,function*(){const c=new bt({destinationIdentities:[e],kind:ke.RELIABLE,value:{case:"rpcResponse",value:new Su({requestId:n,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(c,ke.RELIABLE)})}publishRpcAck(e,n){return b(this,void 0,void 0,function*(){const r=new bt({destinationIdentities:[e],kind:ke.RELIABLE,value:{case:"rpcAck",value:new ku({requestId:n})}});yield this.sendDataPacket(r,ke.RELIABLE)})}sendDataPacket(e,n){return b(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const c=GS(e);if(c){const l=yield this.e2eeManager.encryptData(c.toBinary());e.value={case:"encryptedPacket",value:new bm({encryptedValue:l.payload,iv:l.iv,keyIndex:l.keyIndex})}}}n===ke.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const r=e.toBinary(),o=this.dataChannelForKind(n);if(o){if(n===ke.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:r,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=r.byteLength}if(this.attemptingReconnect)return;o.send(r)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return b(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ke.RELIABLE);const n=this.dataChannelForKind(ke.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(r=>{n.send(r.data)})),this.updateAndEmitDCBufferStatus(ke.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,r)=>b(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const o=()=>r("Engine closed");for(this.once($.Closing,o);!this.dcBufferStatus.get(e);)yield mt(10);this.off($.Closing,o),n()}}))}ensureDataTransportConnected(e){return b(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var c;if(!r.pcManager)throw new st("PC manager is closed");const l=o?r.pcManager.subscriber:r.pcManager.publisher,u=o?"Subscriber":"Publisher";if(!l)throw me.internal("".concat(u," connection not set"));let h=!1;!o&&!r.dataChannelForKind(n,o)&&(r.createDataChannels(),h=!0),!h&&!o&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(h=!0),h&&r.negotiate().catch(v=>{ve.error(v,r.logContext)});const p=r.dataChannelForKind(n,o);if((p==null?void 0:p.readyState)==="open")return;const g=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<g;){if(l.isICEConnected&&((c=r.dataChannelForKind(n,o))===null||c===void 0?void 0:c.readyState)==="open")return;yield mt(50)}throw me.internal("could not establish ".concat(u," connection, state: ").concat(l.getICEConnectionState()))})()})}ensurePublisherConnected(e){return b(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Ge.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return b(this,void 0,void 0,function*(){return new Promise((e,n)=>b(this,void 0,void 0,function*(){if(!this.pcManager){n(new $l("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,o=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on($.Closing,o),this.pcManager.publisher.once(gr.RTPVideoPayloadTypes,c=>{const l=new Map;c.forEach(u=>{const h=u.codec.toLowerCase();OS(h)&&l.set(u.payload,h)}),this.emit($.RTPVideoMapUpdate,l)});try{yield this.pcManager.negotiate(r),e()}catch(c){c instanceof $l&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ri.RR_UNKNOWN),n(c)}finally{this.off($.Closing,o)}}))})}dataChannelForKind(e,n){if(n){if(e===ke.LOSSY)return this.lossyDCSub;if(e===ke.RELIABLE)return this.reliableDCSub}else{if(e===ke.LOSSY)return this.lossyDC;if(e===ke.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,o,c,l;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const u=this.pcManager.publisher.getLocalDescription(),h=this.pcManager.publisher.getRemoteDescription(),p=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getRemoteDescription(),g=(o=this.pcManager.subscriber)===null||o===void 0?void 0:o.getLocalDescription(),v=(l=(c=this.signalOpts)===null||c===void 0?void 0:c.autoSubscribe)!==null&&l!==void 0?l:!0,k=new Array,C=new Array;e.forEach(P=>{P.isDesired!==v&&k.push(P.trackSid),P.isEnabled||C.push(P.trackSid)}),this.client.sendSyncState(new Eu({answer:this.options.singlePeerConnection?h?lr({sdp:h.sdp,type:h.type}):void 0:g?lr({sdp:g.sdp,type:g.type}):void 0,offer:this.options.singlePeerConnection?u?lr({sdp:u.sdp,type:u.type}):void 0:p?lr({sdp:p.sdp,type:p.type}):void 0,subscription:new ga({trackSids:k,subscribe:!v,participantTracks:[]}),publishTracks:pS(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:C,datachannelReceiveStates:this.reliableReceivedState.map((P,_)=>new qm({publisherSid:_,lastSeq:P}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,o)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new Wm({label:r.label,id:r.id,target:o}))};return n(this.dataChannelForKind(ke.LOSSY),an.PUBLISHER),n(this.dataChannelForKind(ke.RELIABLE),an.PUBLISHER),n(this.dataChannelForKind(ke.LOSSY,!0),an.SUBSCRIBER),n(this.dataChannelForKind(ke.RELIABLE,!0),an.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&pt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Mt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Mt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const r=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(r){const o=Object.entries(this.midToTrackId).find(c=>{let[l]=c;return l===r});if(o)return o[1]}}}function jT(s){return s!==void 0&&s>13}function Zp(s,e){const n=s.participantIdentity?s.participantIdentity:e.participantIdentity;s.participantIdentity=n,e.participantIdentity=n;const r=s.destinationIdentities.length!==0?s.destinationIdentities:e.destinationIdentities;s.destinationIdentities=r,e.destinationIdentities=r}class Vg{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Jt("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Ct.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Jt("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Ct.LengthExceeded)}}constructor(e,n,r,o){this.reader=n,this.totalByteSize=r,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=o}}class BT extends Vg{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Qt,r=null,o=null;if(this.signal){const l=this.signal;o=()=>{var u;(u=n.reject)===null||u===void 0||u.call(n,l.reason)},l.addEventListener("abort",o),r=l}const c=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>b(this,void 0,void 0,function*(){var l,u;try{const{done:h,value:p}=yield Promise.race([e.read(),n.promise,(u=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);return h?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(p),{done:!1,value:p.content})}catch(h){throw c(),h}}),return(){return b(this,void 0,void 0,function*(){return c(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,o,c,l;let u=new Set;const h=n.signal?e.withAbortSignal(n.signal):e;try{for(var p=!0,g=An(h),v;v=yield g.next(),r=v.done,!r;p=!0){l=v.value,p=!1;const k=l;u.add(k)}}catch(k){o={error:k}}finally{try{!p&&!r&&(c=g.return)&&(yield c.call(g))}finally{if(o)throw o.error}}return Array.from(u)})()})}}class VT extends Vg{constructor(e,n,r,o){super(e,n,r,o),this.receivedChunks=new Map}handleChunkReceived(e){var n;const r=Xo(e.chunkIndex),o=this.receivedChunks.get(r);if(o&&o.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const c=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,c)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let r=new Qt,o=null,c=null;if(this.signal){const u=this.signal;c=()=>{var h;(h=r.reject)===null||h===void 0||h.call(r,u.reason)},u.addEventListener("abort",c),o=u}const l=()=>{e.releaseLock(),o&&c&&o.removeEventListener("abort",c),this.signal=void 0};return{next:()=>b(this,void 0,void 0,function*(){var u,h;try{const{done:p,value:g}=yield Promise.race([e.read(),r.promise,(h=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&h!==void 0?h:new Promise(()=>{})]);if(p)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(g);let v;try{v=n.decode(g.content)}catch(k){throw new Jt("Cannot decode datastream chunk ".concat(g.chunkIndex," as text: ").concat(k),Ct.DecodeFailed)}return{done:!1,value:v}}}catch(p){throw l(),p}}),return(){return b(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,o,c,l;let u="";const h=n.signal?e.withAbortSignal(n.signal):e;try{for(var p=!0,g=An(h),v;v=yield g.next(),r=v.done,!r;p=!0)l=v.value,p=!1,u+=l}catch(k){o={error:k}}finally{try{!p&&!r&&(c=g.return)&&(yield c.call(g))}finally{if(o)throw o.error}}return u})()})}}class zT{constructor(){this.log=ve,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Jt('A text stream handler for topic "'.concat(e,'" has already been set.'),Ct.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Jt('A byte stream handler for topic "'.concat(e,'" has already been set.'),Ct.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,r,o,c;const l=Array.from(this.textStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e),u=Array.from(this.byteStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e);if(l.length>0||u.length>0){const h=new Jt("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Ct.AbnormalEnd);for(const[p,g]of u)(r=(n=g.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(n,h),this.byteStreamControllers.delete(p);for(const[p,g]of l)(c=(o=g.outOfBandFailureRejectingFuture).reject)===null||c===void 0||c.call(o,h),this.textStreamControllers.delete(p)}}handleDataStreamPacket(e,n){return b(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,r){return b(this,void 0,void 0,function*(){var o;if(e.contentHeader.case==="byteHeader"){const c=this.byteStreamHandlers.get(e.topic);if(!c){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let l;const u=new Qt;u.promise.catch(g=>{this.log.error(g)});const h={id:e.streamId,name:(o=e.contentHeader.value.name)!==null&&o!==void 0?o:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Xo(e.timestamp),attributes:e.attributes,encryptionType:r},p=new ReadableStream({start:g=>{if(l=g,this.textStreamControllers.has(e.streamId))throw new Jt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Ct.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:h,controller:l,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:u})}});c(new BT(h,p,Xo(e.totalLength),u),{identity:n})}else if(e.contentHeader.case==="textHeader"){const c=this.textStreamHandlers.get(e.topic);if(!c){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let l;const u=new Qt;u.promise.catch(g=>{this.log.error(g)});const h={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:r},p=new ReadableStream({start:g=>{if(l=g,this.textStreamControllers.has(e.streamId))throw new Jt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Ct.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:h,controller:l,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:u})}});c(new VT(h,p,Xo(e.totalLength),u),{identity:n})}})}handleStreamChunk(e,n){const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Jt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Ct.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e));const o=this.textStreamControllers.get(e.streamId);o&&(o.info.encryptionType!==n?(o.controller.error(new Jt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(o.info.encryptionType),Ct.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&o.controller.enqueue(e))}handleStreamTrailer(e,n){const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Jt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Ct.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.textStreamControllers.delete(e.streamId)));const o=this.byteStreamControllers.get(e.streamId);o&&(o.info.encryptionType!==n?o.controller.error(new Jt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(o.info.encryptionType),Ct.EncryptionTypeMismatch)):(o.info.attributes=Object.assign(Object.assign({},o.info.attributes),e.attributes),o.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class zg{constructor(e,n,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return b(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class qT extends zg{}class WT extends zg{}const em=15e3;class HT{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return b(this,void 0,void 0,function*(){var r;const o=crypto.randomUUID(),l=new TextEncoder().encode(e).byteLength,u=(r=n==null?void 0:n.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),h=new Array(u?u.length+1:1).fill(0),p=(v,k)=>{var C;h[k]=v;const P=h.reduce((_,U)=>_+U,0);(C=n==null?void 0:n.onProgress)===null||C===void 0||C.call(n,P)},g=yield this.streamText({streamId:o,totalSize:l,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:u,attributes:n==null?void 0:n.attributes});return yield g.write(e),p(1,0),yield g.close(),n!=null&&n.attachments&&u&&(yield Promise.all(n.attachments.map((v,k)=>b(this,void 0,void 0,function*(){return this._sendFile(u[k],v,{topic:n.topic,mimeType:v.type,onProgress:C=>{p(C,k+1)}})})))),g.info})}streamText(e){return b(this,void 0,void 0,function*(){var n,r,o;const c=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l={id:c,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?ot.GCM:ot.NONE},u=new ia({streamId:c,mimeType:l.mimeType,topic:l.topic,timestamp:Ii(l.timestamp),totalLength:Ii(e==null?void 0:e.totalSize),attributes:l.attributes,contentHeader:{case:"textHeader",value:new Am({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Bl.UPDATE:Bl.CREATE})}}),h=e==null?void 0:e.destinationIdentities,p=new bt({destinationIdentities:h,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(p,ke.RELIABLE);let g=0;const v=this.engine,k=new WritableStream({write(_){return b(this,void 0,void 0,function*(){for(const U of US(_,em)){const A=new ra({content:U,streamId:c,chunkIndex:Ii(g)}),Y=new bt({destinationIdentities:h,value:{case:"streamChunk",value:A}});yield v.sendDataPacket(Y,ke.RELIABLE),g+=1}})},close(){return b(this,void 0,void 0,function*(){const _=new sa({streamId:c}),U=new bt({destinationIdentities:h,value:{case:"streamTrailer",value:_}});yield v.sendDataPacket(U,ke.RELIABLE)})},abort(_){console.log("Sink error:",_)}});let C=()=>b(this,void 0,void 0,function*(){yield P.close()});v.once($.Closing,C);const P=new qT(k,l,()=>this.engine.off($.Closing,C));return P})}sendFile(e,n){return b(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,n),{id:r}})}_sendFile(e,n,r){return b(this,void 0,void 0,function*(){var o;const c=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(o=r==null?void 0:r.mimeType)!==null&&o!==void 0?o:n.type,topic:r==null?void 0:r.topic,destinationIdentities:r==null?void 0:r.destinationIdentities}),l=n.stream().getReader();for(;;){const{done:u,value:h}=yield l.read();if(u)break;yield c.write(h)}return yield c.close(),c.info})}streamBytes(e){return b(this,void 0,void 0,function*(){var n,r,o,c,l,u;const h=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),p=e==null?void 0:e.destinationIdentities,g={id:h,mimeType:(r=e==null?void 0:e.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(o=e==null?void 0:e.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(c=e==null?void 0:e.name)!==null&&c!==void 0?c:"unknown",encryptionType:!((l=this.engine.e2eeManager)===null||l===void 0)&&l.isDataChannelEncryptionEnabled?ot.GCM:ot.NONE},v=new ia({totalLength:Ii((u=g.size)!==null&&u!==void 0?u:0),mimeType:g.mimeType,streamId:h,topic:g.topic,timestamp:Ii(Date.now()),attributes:g.attributes,contentHeader:{case:"byteHeader",value:new Lm({name:g.name})}}),k=new bt({destinationIdentities:p,value:{case:"streamHeader",value:v}});yield this.engine.sendDataPacket(k,ke.RELIABLE);let C=0;const P=new wt,_=this.engine,U=this.log,A=new WritableStream({write(H){return b(this,void 0,void 0,function*(){const R=yield P.lock();let M=0;try{for(;M<H.byteLength;){const F=H.slice(M,M+em),J=new bt({destinationIdentities:p,value:{case:"streamChunk",value:new ra({content:F,streamId:h,chunkIndex:Ii(C)})}});yield _.sendDataPacket(J,ke.RELIABLE),C+=1,M+=F.byteLength}}finally{R()}})},close(){return b(this,void 0,void 0,function*(){const H=new sa({streamId:h}),R=new bt({destinationIdentities:p,value:{case:"streamTrailer",value:H}});yield _.sendDataPacket(R,ke.RELIABLE)})},abort(H){U.error("Sink error:",H)}});return new WT(A,g)})}}class qg extends j{constructor(e,n,r,o,c){super(e,r,c),this.sid=n,this.receiver=o}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?G.Muted:G.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(G.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Uu)),mS()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:o,rtpTimestamp:c}=r;c&&this.rtpTimestamp!==c&&(this.emit(G.TimeSyncUpdate,{timestamp:o,rtpTimestamp:c}),this.rtpTimestamp=c)}};e()}}class KT extends qg{constructor(e,n,r,o,c,l){super(e,n,j.Kind.Audio,r,l),this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=ka(u,this.prevStats)),this.prevStats=u}),this.audioContext=o,this.webAudioPluginNodes=[],c&&(this.sinkId=c.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;kn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(kn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return b(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(iu(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&iu(e)&&e.setSinkId(this.sinkId).catch(r=>{this.log.error("Failed to set sink id on remote audio track",r,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{r.connect(o),r=o}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(G.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(G.AudioPlaybackFailed,o)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const Ll=100;class GT extends qg{constructor(e,n,r,o,c){super(e,n,j.Kind.Video,r,c),this.elementInfos=[],this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=ka(l,this.prevStats)),this.prevStats=l}),this.debouncedHandleResize=Mu(()=>{this.updateDimensions()},Ll),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===j.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?fr(this._mediaStreamTrack,n):cr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new JT(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",o=new Map;return e.forEach(c=>{c.type==="inbound-rtp"?(r=c.codecId,n={type:"video",streamId:c.id,framesDecoded:c.framesDecoded,framesDropped:c.framesDropped,framesReceived:c.framesReceived,packetsReceived:c.packetsReceived,packetsLost:c.packetsLost,frameWidth:c.frameWidth,frameHeight:c.frameHeight,pliCount:c.pliCount,firCount:c.firCount,nackCount:c.nackCount,jitter:c.jitter,timestamp:c.timestamp,bytesReceived:c.bytesReceived,decoderImplementation:c.decoderImplementation}):c.type==="codec"&&o.set(c.id,c)}),n&&r!==""&&o.get(r)&&(n.mimeType=o.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,r;const o=this.elementInfos.reduce((h,p)=>Math.max(h,p.visibilityChangedAt||0),0),c=!((r=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&r!==void 0)||r?this.isInBackground:!1,l=this.elementInfos.some(h=>h.pictureInPicture),u=this.elementInfos.some(h=>h.visible)&&!c||l;if(!(this.lastVisible===u&&!e)){if(!u&&Date.now()-o<Ll){pt.setTimeout(()=>{this.updateVisibility()},Ll);return}this.lastVisible=u,this.emit(G.VisibilityChanged,u,this)}}updateDimensions(){var e,n;let r=0,o=0;const c=this.getPixelDensity();for(const l of this.elementInfos){const u=l.width()*c,h=l.height()*c;u+h>r+o&&(r=u,o=h)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===o||(this.lastDimensions={width:r,height:o},this.emit(G.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Rp():n||(Rp()>2?2:1)}}class JT{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var o;const{target:c,isIntersecting:l}=r;c===this.element&&(this.isIntersecting=l,this.isPiP=hs(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var r,o,c;(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=hs(this.element),(c=this.handleVisibilityChanged)===null||c===void 0||c.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=hs(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??lu(e),this.isPiP=Mt()&&hs(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,r;this.isIntersecting=lu(this.element),this.isPiP=hs(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,xp().observe(this.element),Ip().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,r,o,c;(e=xp())===null||e===void 0||e.unobserve(this.element),(n=Ip())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(c=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||c===void 0||c.removeEventListener("pagehide",this.onLeavePiP)}}function hs(s){var e,n;return document.pictureInPictureElement===s?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?lu(s,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function lu(s,e){const n=e||window;let r=s.offsetTop,o=s.offsetLeft;const c=s.offsetWidth,l=s.offsetHeight,{hidden:u}=s,{display:h}=getComputedStyle(s);for(;s.offsetParent;)s=s.offsetParent,r+=s.offsetTop,o+=s.offsetLeft;return r<n.pageYOffset+n.innerHeight&&o<n.pageXOffset+n.innerWidth&&r+l>n.pageYOffset&&o+c>n.pageXOffset&&!u&&h!=="none"}class Dn extends Tn.EventEmitter{constructor(e,n,r,o){var c;super(),this.metadataMuted=!1,this.encryption=ot.NONE,this.log=ve,this.handleMuted=()=>{this.emit(G.Muted)},this.handleUnmuted=()=>{this.emit(G.Unmuted)},this.log=Un((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:un.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=j.Source.Unknown}setTrack(e){this.track&&(this.track.off(G.Muted,this.handleMuted),this.track.off(G.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(G.Muted,this.handleMuted),e.on(G.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Te(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ot.NONE}get audioTrack(){if(yn(this.track))return this.track}get videoTrack(){if(fi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=j.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===j.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(s){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(s.SubscriptionStatus||(s.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(s.PermissionStatus||(s.PermissionStatus={}))})(Dn||(Dn={}));class uu extends Dn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,o){super(e,n.sid,n.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(G.Ended)},this.handleCpuConstrained=()=>{this.track&&fi(this.track)&&this.emit(G.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&(this.track.off(G.Ended,this.handleTrackEnded),this.track.off(G.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(G.Ended,this.handleTrackEnded),e.on(G.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(yn(this.track)){const n=this.track.getSourceTrackSettings(),r=new Set;return n.autoGainControl&&r.add(ut.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(ut.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(ut.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(ut.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(ut.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(ut.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function Sa(s,e){return b(this,void 0,void 0,function*(){s??(s={});let n=!1;const{audioProcessor:r,videoProcessor:o,optionsWithoutProcessor:c}=Rg(s);let l=c.audio,u=c.video;if(r&&typeof c.audio=="object"&&(c.audio.processor=r),o&&typeof c.video=="object"&&(c.video.processor=o),s.audio&&typeof c.audio=="object"&&typeof c.audio.deviceId=="string"){const v=c.audio.deviceId;c.audio.deviceId={exact:v},n=!0,l=Object.assign(Object.assign({},c.audio),{deviceId:{ideal:v}})}if(c.video&&typeof c.video=="object"&&typeof c.video.deviceId=="string"){const v=c.video.deviceId;c.video.deviceId={exact:v},n=!0,u=Object.assign(Object.assign({},c.video),{deviceId:{ideal:v}})}c.audio===!0?c.audio={deviceId:"default"}:typeof c.audio=="object"&&c.audio!==null&&(c.audio=Object.assign(Object.assign({},c.audio),{deviceId:c.audio.deviceId||"default"})),c.video===!0?c.video={deviceId:"default"}:typeof c.video=="object"&&!c.video.deviceId&&(c.video.deviceId="default");const h=Eg(c,Ng,Ag),p=xu(h),g=navigator.mediaDevices.getUserMedia(p);c.audio&&(dt.userMediaPromiseMap.set("audioinput",g),g.catch(()=>dt.userMediaPromiseMap.delete("audioinput"))),c.video&&(dt.userMediaPromiseMap.set("videoinput",g),g.catch(()=>dt.userMediaPromiseMap.delete("videoinput")));try{const v=yield g;return yield Promise.all(v.getTracks().map(k=>b(this,void 0,void 0,function*(){const C=k.kind==="audio";let P=C?h.audio:h.video;(typeof P=="boolean"||!P)&&(P={});let _;const U=C?p.audio:p.video;typeof U!="boolean"&&(_=U);const A=k.getSettings().deviceId;_!=null&&_.deviceId&&li(_.deviceId)!==A?_.deviceId=A:_||(_={deviceId:A});const Y=CT(k,_,e);return Y.kind===j.Kind.Video?Y.source=j.Source.Camera:Y.kind===j.Kind.Audio&&(Y.source=j.Source.Microphone),Y.mediaStream=v,yn(Y)&&r?yield Y.setProcessor(r):fi(Y)&&o&&(yield Y.setProcessor(o)),Y})))}catch(v){if(!n)throw v;return Sa(Object.assign(Object.assign({},s),{audio:l,video:u}),e)}})}function QT(s){return b(this,void 0,void 0,function*(){return(yield Sa({audio:!1,video:!0}))[0]})}function $T(s){return b(this,void 0,void 0,function*(){return(yield Sa({audio:!0,video:!1}))[0]})}var oi;(function(s){s.Excellent="excellent",s.Good="good",s.Poor="poor",s.Lost="lost",s.Unknown="unknown"})(oi||(oi={}));function YT(s){switch(s){case fs.EXCELLENT:return oi.Excellent;case fs.GOOD:return oi.Good;case fs.POOR:return oi.Poor;case fs.LOST:return oi.Lost;default:return oi.Unknown}}class Wg extends Tn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Ss.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===ur.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,o,c,l){let u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ss.STANDARD;var h;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=oi.Unknown,this.log=ve,this.log=Un((h=l==null?void 0:l.loggerName)!==null&&h!==void 0?h:un.Participant),this.loggerOptions=l,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=u,this._attributes=c??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Qt,this.once(X.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(j.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(j.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(j.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===ur.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==ur.ACTIVE&&this.emit(X.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(X.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(X.ParticipantNameChanged,e)}_setAttributes(e){const n=gS(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(X.AttributesChanged,n)}setPermissions(e){var n,r,o,c,l,u;const h=this.permissions,p=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||e.hidden!==((c=this.permissions)===null||c===void 0?void 0:c.hidden)||e.recorder!==((l=this.permissions)===null||l===void 0?void 0:l.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((g,v)=>{var k;return g!==((k=this.permissions)===null||k===void 0?void 0:k.canPublishSources[v])})||e.canSubscribeMetrics!==((u=this.permissions)===null||u===void 0?void 0:u.canSubscribeMetrics);return this.permissions=e,p&&this.emit(X.ParticipantPermissionsChanged,h),p}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(X.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=YT(e),n!==this._connectionQuality&&this.emit(X.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>yn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(G.Muted,()=>{this.emit(X.TrackMuted,e)}),e.on(G.Unmuted,()=>{this.emit(X.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case j.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case j.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function XT(s){var e,n,r;if(!s.participantSid&&!s.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Vm({participantIdentity:(e=s.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=s.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=s.allowAll)!==null&&r!==void 0?r:!1,trackSids:s.allowedTrackSids||[]})}class ZT extends Wg{constructor(e,n,r,o,c,l){super(e,n,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ot.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Qt)},this.handleReconnected=()=>{var u,h;(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||h===void 0||h.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var u,h,p,g,v,k;this.reconnectFuture&&(this.reconnectFuture.promise.catch(C=>this.log.warn(C.message,this.logContext)),(h=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||h===void 0||h.call(u,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((g=(p=this.signalConnectedFuture).reject)===null||g===void 0||g.call(p,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(k=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||k===void 0||k.call(v,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=u=>{var h,p;u.participant&&this.updateInfo(u.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Qt),(p=(h=this.signalConnectedFuture).resolve)===null||p===void 0||p.call(h)},this.handleSignalRequestResponse=u=>{const{requestId:h,reason:p,message:g}=u,v=this.pendingSignalRequests.get(h);v&&(p!==_u.OK&&v.reject(new bp(g,p)),this.pendingSignalRequests.delete(h))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let h=u.value.value,p=null,g=null;h.value.case==="payload"?p=h.value.value:h.value.case==="error"&&(g=Qe.fromProto(h.value.value)),this.handleIncomingRpcResponse(h.requestId,p,g);break;case"rpcAck":let v=u.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>XT(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,h)=>{if(h===void 0&&(h=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Te(u)));return}this.engine.updateMuteStatus(u.sid,h)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Te(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Te(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const h=this.audioTrackPublications.get(u.sid);if(!h){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(h.trackSid,h.getTrackFeatures())},this.onTrackCpuConstrained=(u,h)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Te(h))),this.emit(X.LocalTrackCpuConstrained,u,h)},this.handleSubscribedQualityUpdate=u=>b(this,void 0,void 0,function*(){var h,p,g,v,k;if(!(!((k=this.roomOptions)===null||k===void 0)&&k.dynacast))return;const C=this.videoTrackPublications.get(u.trackSid);if(!C){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(!C.videoTrack)return;const P=yield C.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var _=!0,U=An(P),A;A=yield U.next(),h=A.done,!h;_=!0){v=A.value,_=!1;const Y=v;dS(Y)&&(this.log.debug("publish ".concat(Y," for ").concat(C.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Te(C))),yield this.publishAdditionalCodecForTrack(C.videoTrack,Y,C.options))}}catch(Y){p={error:Y}}finally{try{!_&&!h&&(g=U.return)&&(yield g.call(U))}finally{if(p)throw p.error}}}),this.handleLocalTrackUnpublished=u=>{const h=this.trackPublications.get(u.trackSid);if(!h){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(h.track)},this.handleTrackEnded=u=>b(this,void 0,void 0,function*(){if(u.source===j.Source.ScreenShare||u.source===j.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Te(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(On(u)||ri(u))try{if(Mt())try{const h=yield navigator==null?void 0:navigator.permissions.query({name:u.source===j.Source.Camera?"camera":"microphone"});if(h&&h.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Te(u))),h.onchange=()=>{h.state!=="denied"&&(u.isMuted||u.restartTrack(),h.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Te(u))),On(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Te(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=o,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=c,this.roomOutgoingDataStreamManager=l}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ot.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on($.RemoteMute,(r,o)=>{const c=this.trackPublications.get(r);!c||!c.track||(o?c.mute():c.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on($.Connected,this.handleReconnected).on($.SignalConnected,this.handleSignalConnected).on($.SignalRestarted,this.handleReconnected).on($.SignalResumed,this.handleReconnected).on($.Restarting,this.handleReconnecting).on($.Resuming,this.handleReconnecting).on($.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on($.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on($.Closing,this.handleClosing).on($.SignalRequestResponse,this.handleSignalRequestResponse).on($.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return b(this,arguments,void 0,function(n){var r=this;let{metadata:o,name:c,attributes:l}=n;return(function*(){return new Promise((u,h)=>b(r,void 0,void 0,function*(){var p,g;try{let v=!1;const k=yield this.engine.client.sendUpdateLocalMetadata((p=o??this.metadata)!==null&&p!==void 0?p:"",(g=c??this.name)!==null&&g!==void 0?g:"",l),C=performance.now();for(this.pendingSignalRequests.set(k,{resolve:u,reject:P=>{h(P),v=!0},values:{name:c,metadata:o,attributes:l}});performance.now()-C<5e3&&!v;){if((!c||this.name===c)&&(!o||this.metadata===o)&&(!l||Object.entries(l).every(P=>{let[_,U]=P;return this.attributes[_]===U||U===""&&!this.attributes[_]}))){this.pendingSignalRequests.delete(k),u();return}yield mt(50)}h(new bp("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error&&h(v)}}))})()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(j.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(j.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(j.Source.ScreenShare,e,n,r)}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){this.encryptionType=e?ot.GCM:ot.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,o){return b(this,void 0,void 0,function*(){var c,l;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let u=this.getTrackPublication(e);if(n)if(u)yield u.unmute();else{let h;if(this.pendingPublishing.has(e)){const p=yield this.waitForPendingPublicationOfSource(e);return p||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield p==null?void 0:p.unmute(),p}this.pendingPublishing.add(e);try{switch(e){case j.Source.Camera:h=yield this.createTracks({video:(c=r)!==null&&c!==void 0?c:!0});break;case j.Source.Microphone:h=yield this.createTracks({audio:(l=r)!==null&&l!==void 0?l:!0});break;case j.Source.ScreenShare:h=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Ln(e)}}catch(p){throw h==null||h.forEach(g=>{g.stop()}),p instanceof Error&&this.emit(X.MediaDevicesError,p,eu(e)),this.pendingPublishing.delete(e),p}for(const p of h){const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),r);e===j.Source.Microphone&&yn(p)&&g.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),p.startPreConnectBuffer())}try{const p=[];for(const v of h)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Te(v))),p.push(this.publishTrack(v,o));[u]=yield Promise.all(p)}catch(p){throw h==null||h.forEach(g=>{g.stop()}),p}finally{this.pendingPublishing.delete(e)}}else if(!(u!=null&&u.track)&&this.pendingPublishing.has(e)&&(u=yield this.waitForPendingPublicationOfSource(e),u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),u&&u.track)if(e===j.Source.ScreenShare){u=yield this.unpublishTrack(u.track);const h=this.getTrackPublication(j.Source.ScreenShareAudio);h&&h.track&&this.unpublishTrack(h.track)}else yield u.mute();return u})}enableCameraAndMicrophone(){return b(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(j.Source.Camera)||this.pendingPublishing.has(j.Source.Microphone))){this.pendingPublishing.add(j.Source.Camera),this.pendingPublishing.add(j.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(j.Source.Camera),this.pendingPublishing.delete(j.Source.Microphone)}}})}createTracks(e){return b(this,void 0,void 0,function*(){var n,r;e??(e={});const o=Eg(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield Sa(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(u=>(yn(u)&&(this.microphoneError=void 0,u.setAudioContext(this.audioContext),u.source=j.Source.Microphone,this.emit(X.AudioStreamAcquired)),fi(u)&&(this.cameraError=void 0,u.source=j.Source.Camera),u))}catch(c){throw c instanceof Error&&(e.audio&&(this.microphoneError=c),e.video&&(this.cameraError=c)),c}})}createScreenTracks(e){return b(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Ru("getDisplayMedia not supported");e.resolution===void 0&&!ES()&&(e.resolution=Iu.h1080fps30.resolution);const n=fS(e),r=yield navigator.mediaDevices.getDisplayMedia(n),o=r.getVideoTracks();if(o.length===0)throw new Ln("no video track found");const c=new ca(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});c.source=j.Source.ScreenShare,e.contentHint&&(c.mediaStreamTrack.contentHint=e.contentHint);const l=[c];if(r.getAudioTracks().length>0){this.emit(X.AudioStreamAcquired);const u=new aa(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});u.source=j.Source.ScreenShareAudio,l.push(u)}return l})}publishTrack(e,n){return b(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return b(this,arguments,void 0,function(r,o){var c=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var u,h,p,g;On(r)&&r.setAudioContext(c.audioContext),yield(u=c.reconnectFuture)===null||u===void 0?void 0:u.promise,c.republishPromise&&!l&&(yield c.republishPromise),pr(r)&&c.pendingPublishPromises.has(r)&&(yield c.pendingPublishPromises.get(r));let v;if(r instanceof MediaStreamTrack)v=r.getConstraints();else{v=r.constraints;let A;switch(r.source){case j.Source.Microphone:A="audioinput";break;case j.Source.Camera:A="videoinput"}A&&c.activeDeviceMap.has(A)&&(v=Object.assign(Object.assign({},v),{deviceId:c.activeDeviceMap.get(A)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new aa(r,v,!0,c.audioContext,{loggerName:c.roomOptions.loggerName,loggerContextCb:()=>c.logContext});break;case"video":r=new ca(r,v,!0,{loggerName:c.roomOptions.loggerName,loggerContextCb:()=>c.logContext});break;default:throw new Ln("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:c.roomOptions.loggerName,loggerContextCb:()=>c.logContext});let k;if(c.trackPublications.forEach(A=>{A.track&&A.track===r&&(k=A)}),k)return c.log.warn("track has already been published, skipping",Object.assign(Object.assign({},c.logContext),Te(k))),k;const C=Object.assign(Object.assign({},c.roomOptions.publishDefaults),o),P="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,_=(h=C.forceStereo)!==null&&h!==void 0?h:P;_&&(C.dtx===void 0&&c.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},c.logContext),Te(r))),C.red===void 0&&c.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(p=C.dtx)!==null&&p!==void 0||(C.dtx=!1),(g=C.red)!==null&&g!==void 0||(C.red=!1)),!PS()&&c.roomOptions.e2ee&&(c.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},c.logContext)),C.simulcast=!1),C.source&&(r.source=C.source);const U=new Promise((A,Y)=>b(c,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Me.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Te(r)}));let H=!1;const R=setTimeout(()=>{H=!0,r.stop(),Y(new Cp("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(R),H)return;const M=yield this.publish(r,C,_);A(M)}else try{const H=yield this.publish(r,C,_);A(H)}catch(H){Y(H)}}catch(H){Y(H)}}));c.pendingPublishPromises.set(r,U);try{return yield U}catch(A){throw A}finally{c.pendingPublishPromises.delete(r)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Qt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Te(e))),!1;const{canPublish:n,canPublishSources:r}=this.permissions;return n&&(r.length===0||r.map(o=>vS(o)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Te(e))),!1)}publish(e,n,r){return b(this,void 0,void 0,function*(){var o,c,l,u,h,p,g,v,k,C;if(!this.hasPermissionsToPublish(e))throw new Cp("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(Z=>pr(e)&&Z.source===e.source)&&e.source!==j.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Te(e))),n.stopMicTrackOnMute&&yn(e)&&(e.stopOnMute=!0),e.source===j.Source.ScreenShare&&Oi()&&(n.simulcast=!1),n.videoCodec==="av1"&&!CS()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!bS()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=ou),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(Z=>n.videoCodec===vs(Z.mime))||(n.videoCodec=vs(this.enabledPublishVideoCodecs[0].mime)));const _=n.videoCodec;e.on(G.Muted,this.onTrackMuted),e.on(G.Unmuted,this.onTrackUnmuted),e.on(G.Ended,this.handleTrackEnded),e.on(G.UpstreamPaused,this.onTrackUpstreamPaused),e.on(G.UpstreamResumed,this.onTrackUpstreamResumed),e.on(G.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const U=[],A=!(!((o=n.dtx)!==null&&o!==void 0)||o),Y=e.getSourceTrackSettings();Y.autoGainControl&&U.push(ut.TF_AUTO_GAIN_CONTROL),Y.echoCancellation&&U.push(ut.TF_ECHO_CANCELLATION),Y.noiseSuppression&&U.push(ut.TF_NOISE_SUPPRESSION),Y.channelCount&&Y.channelCount>1&&U.push(ut.TF_STEREO),A&&U.push(ut.TF_NO_DTX),On(e)&&e.hasPreConnectBuffer&&U.push(ut.TF_PRECONNECT_BUFFER);const H=new Ts({cid:e.mediaStreamTrack.id,name:n.name,type:j.kindToProto(e.kind),muted:e.isMuted,source:j.sourceToProto(e.source),disableDtx:A,encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((c=n.red)!==null&&c!==void 0)||c),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:U});let R;if(e.kind===j.Kind.Video){let Z={width:0,height:0};try{Z=yield e.waitForDimensions()}catch{const se=(u=(l=this.roomOptions.videoCaptureDefaults)===null||l===void 0?void 0:l.resolution)!==null&&u!==void 0?u:Cs.h720.resolution;Z={width:se.width,height:se.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Te(e)),{dims:Z}))}H.width=Z.width,H.height=Z.height,ri(e)&&(cn(_)&&(e.source===j.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Te(e))))),n.scalabilityMode=(h=n.scalabilityMode)!==null&&h!==void 0?h:"L3T3_KEY"),H.simulcastCodecs=[new zl({codec:_,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:ou}),n.backupCodec&&_!==n.backupCodec.codec&&H.encryption===ot.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),H.simulcastCodecs.push(new zl({codec:n.backupCodec.codec,cid:""})))),R=cu(e.source===j.Source.ScreenShare,H.width,H.height,n),H.layers=$p(H.width,H.height,R,cn(n.videoCodec))}else e.kind===j.Kind.Audio&&(R=[{maxBitrate:(p=n.audioPreset)===null||p===void 0?void 0:p.maxBitrate,priority:(v=(g=n.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&v!==void 0?v:"high",networkPriority:(C=(k=n.audioPreset)===null||k===void 0?void 0:k.priority)!==null&&C!==void 0?C:"high"}]);if(!this.engine||this.engine.isClosed)throw new st("cannot publish track when not connected");const M=()=>b(this,void 0,void 0,function*(){var Z,Q,se;if(!this.engine.pcManager)throw new st("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,R),this.emit(X.LocalSenderCreated,e.sender,e),ri(e)&&((Z=n.degradationPreference)!==null&&Z!==void 0||(n.degradationPreference=DT(e)),e.setDegradationPreference(n.degradationPreference)),R)if(Oi()&&e.kind===j.Kind.Audio){let ge;for(const Re of this.engine.pcManager.publisher.getTransceivers())if(Re.sender===e.sender){ge=Re;break}ge&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ge,codec:"opus",maxbr:!((Q=R[0])===null||Q===void 0)&&Q.maxBitrate?R[0].maxBitrate/1e3:0})}else e.codec&&cn(e.codec)&&(!((se=R[0])===null||se===void 0)&&se.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:H.cid,codec:e.codec,maxbr:R[0].maxBitrate/1e3});yield this.engine.negotiate()});let F;const J=new Promise((Z,Q)=>b(this,void 0,void 0,function*(){var se;try{F=yield this.engine.addTrack(H),Z(F)}catch(ge){e.sender&&(!((se=this.engine.pcManager)===null||se===void 0)&&se.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Re=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Te(e)),{error:Re}))})),Q(ge)}}));if(this.enabledPublishVideoCodecs.length>0)F=(yield Promise.all([J,M()]))[0];else{F=yield J;let Z;if(F.codecs.forEach(Q=>{Z===void 0&&(Z=Q.mimeType)}),Z&&e.kind===j.Kind.Video){const Q=vs(Z);Q!==_&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Te(e)),{codec:Q})),n.videoCodec=Q,R=cu(e.source===j.Source.ScreenShare,H.width,H.height,n))}yield M()}const L=new uu(e.kind,F,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(L.on(G.CpuConstrained,Z=>this.onTrackCpuConstrained(Z,L)),L.options=n,e.sid=F.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:R,trackInfo:F})),ri(e)?e.startMonitor(this.engine.client):On(e)&&e.startMonitor(),this.addTrackPublication(L),this.emit(X.LocalTrackPublished,L),On(e)&&F.audioFeatures.includes(ut.TF_PRECONNECT_BUFFER)){const Z=e.getPreConnectBuffer(),Q=e.getPreConnectBufferMimeType();this.on(X.LocalTrackSubscribed,se=>{if(se.trackSid===F.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Te(e))),e.stopPreConnectBuffer()}}),Z&&new Promise((ge,Re)=>b(this,void 0,void 0,function*(){var qe,tt,nt,De,ee,ue;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Te(e)));const te=setTimeout(()=>{Re(new Error("agent not active within 10 seconds"))},1e4),de=yield this.waitUntilActiveAgentPresent();clearTimeout(te),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Te(e)));const Se=yield this.streamBytes({name:"preconnect-buffer",mimeType:Q,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[de.identity],attributes:{trackId:L.trackSid,sampleRate:String((ee=Y.sampleRate)!==null&&ee!==void 0?ee:"48000"),channels:String((ue=Y.channelCount)!==null&&ue!==void 0?ue:"1")}});try{for(var ie=!0,S=An(Z),D;D=yield S.next(),qe=D.done,!qe;ie=!0){De=D.value,ie=!1;const be=De;yield Se.write(be)}}catch(be){tt={error:be}}finally{try{!ie&&!qe&&(nt=S.return)&&(yield nt.call(S))}finally{if(tt)throw tt.error}}yield Se.close(),ge()}catch(te){Re(te)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Te(e)))}).catch(ge=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Te(e)),{error:ge}))})}return L})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return b(this,void 0,void 0,function*(){var o;if(this.encryptionType!==ot.NONE)return;let c;if(this.trackPublications.forEach(C=>{C.track&&C.track===e&&(c=C)}),!c)throw new Ln("track is not published");if(!ri(e))throw new Ln("track is not a video track");const l=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),r),u=IT(e,n,l);if(!u){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Te(e)));return}const h=e.addSimulcastTrack(n,u);if(!h)return;const p=new Ts({cid:h.mediaStreamTrack.id,type:j.kindToProto(e.kind),muted:e.isMuted,source:j.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:l.videoCodec,cid:h.mediaStreamTrack.id}]});if(p.layers=$p(p.width,p.height,u),!this.engine||this.engine.isClosed)throw new st("cannot publish track when not connected");const g=()=>b(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,h,l,u),yield this.engine.negotiate()}),k=(yield Promise.all([this.engine.addTrack(p),g()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:u,trackInfo:k}))})}unpublishTrack(e,n){return b(this,void 0,void 0,function*(){var r,o;if(pr(e)){const p=this.pendingPublishPromises.get(e);p&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Te(e))),yield p)}const c=this.getPublicationForTrack(e),l=c?Te(c):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),l)),!c||!c.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),l));return}e=c.track,e.off(G.Muted,this.onTrackMuted),e.off(G.Unmuted,this.onTrackUnmuted),e.off(G.Ended,this.handleTrackEnded),e.off(G.UpstreamPaused,this.onTrackUpstreamPaused),e.off(G.UpstreamResumed,this.onTrackUpstreamResumed),e.off(G.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(o=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),n?e.stop():e.stopMonitor();let u=!1;const h=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ge.FAILED&&h)try{for(const p of this.engine.pcManager.publisher.getTransceivers())p.sender===h&&(p.direction="inactive",u=!0);if(this.engine.removeTrack(h)&&(u=!0),ri(e)){for(const[,p]of e.simulcastCodecs)p.sender&&(this.engine.removeTrack(p.sender)&&(u=!0),p.sender=void 0);e.simulcastCodecs.clear()}}catch(p){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),l),{error:p}))}switch(this.trackPublications.delete(c.trackSid),c.kind){case j.Kind.Audio:this.audioTrackPublications.delete(c.trackSid);break;case j.Kind.Video:this.videoTrackPublications.delete(c.trackSid);break}return this.emit(X.LocalTrackUnpublished,c),c.setTrack(void 0),u&&(yield this.engine.negotiate()),c})}unpublishTracks(e){return b(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return b(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((c,l)=>b(r,void 0,void 0,function*(){try{const u=[];this.trackPublications.forEach(h=>{h.track&&(n&&(h.options=Object.assign(Object.assign({},h.options),n)),u.push(h))}),yield Promise.all(u.map(h=>b(this,void 0,void 0,function*(){const p=h.track;yield this.unpublishTrack(p,!1),o&&!p.isMuted&&p.source!==j.Source.ScreenShare&&p.source!==j.Source.ScreenShareAudio&&(On(p)||ri(p))&&!p.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:h.trackSid})),yield p.restartTrack()),yield this.publishOrRepublishTrack(p,h.options,!0)}))),c()}catch(u){l(u)}finally{this.republishPromise=void 0}})),yield r.republishPromise})()})}publishData(e){return b(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const c=o.reliable?ke.RELIABLE:ke.LOSSY,l=o.destinationIdentities,u=o.topic;let h=new vu({participantIdentity:r.identity,payload:n,destinationIdentities:l,topic:u});const p=new bt({kind:c,value:{case:"user",value:h}});yield r.engine.sendDataPacket(p,c)})()})}publishDtmf(e,n){return b(this,void 0,void 0,function*(){const r=new bt({kind:ke.RELIABLE,value:{case:"sipDtmf",value:new _m({code:e,digit:n})}});yield this.engine.sendDataPacket(r,ke.RELIABLE)})}sendChatMessage(e,n){return b(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},o=new bt({value:{case:"chatMessage",value:new na(Object.assign(Object.assign({},r),{timestamp:ze.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(o,ke.RELIABLE),this.emit(X.ChatMessage,r),r})}editChatMessage(e,n){return b(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),o=new bt({value:{case:"chatMessage",value:new na(Object.assign(Object.assign({},r),{timestamp:ze.parse(r.timestamp),editTimestamp:ze.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,ke.RELIABLE),this.emit(X.ChatMessage,r),r})}sendText(e,n){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return b(this,arguments,void 0,function(n){var r=this;let{destinationIdentity:o,method:c,payload:l,responseTimeout:u=15e3}=n;return(function*(){return new Promise((g,v)=>b(r,void 0,void 0,function*(){var k,C,P,_;if(Lu(l)>Ug){v(Qe.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((C=(k=this.engine.latestJoinResponse)===null||k===void 0?void 0:k.serverInfo)===null||C===void 0)&&C.version&&Sn((_=(P=this.engine.latestJoinResponse)===null||P===void 0?void 0:P.serverInfo)===null||_===void 0?void 0:_.version,"1.8.0")<0){v(Qe.builtIn("UNSUPPORTED_SERVER"));return}const U=Math.max(u,8e3),A=crypto.randomUUID();yield this.publishRpcRequest(o,A,c,l,U);const Y=setTimeout(()=>{this.pendingAcks.delete(A),v(Qe.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(A),clearTimeout(H)},7e3);this.pendingAcks.set(A,{resolve:()=>{clearTimeout(Y)},participantIdentity:o});const H=setTimeout(()=>{this.pendingResponses.delete(A),v(Qe.builtIn("RESPONSE_TIMEOUT"))},u);this.pendingResponses.set(A,{resolve:(R,M)=>{clearTimeout(H),this.pendingAcks.has(A)&&(this.log.warn("RPC response received before ack",A),this.pendingAcks.delete(A),clearTimeout(Y)),M?v(M):g(R??"")},participantIdentity:o})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,r){const o=this.pendingResponses.get(e);o?(o.resolve(n,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,r,o,c){return b(this,void 0,void 0,function*(){const l=new bt({destinationIdentities:[e],kind:ke.RELIABLE,value:{case:"rpcRequest",value:new yu({id:n,method:r,payload:o,responseTimeoutMs:c,version:1})}});yield this.engine.sendDataPacket(l,ke.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:r,resolve:o}]of this.pendingResponses)r===e&&(o(null,Qe.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var r,o;const c=this.trackPublications.get(n.sid);if(c){const l=c.isMuted||((o=(r=c.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&o!==void 0?o:!1);l!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Te(c)),{mutedOnServer:l})),this.engine.client.sendMuteTrack(n.sid,l))}}),!0):!1}setActiveAgent(e){var n,r,o,c;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(r=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||r===void 0||r.call(n,e):(c=(o=this.activeAgentFuture)===null||o===void 0?void 0:o.reject)===null||c===void 0||c.call(o,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Qt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const o=r.track;o&&(e instanceof MediaStreamTrack?(On(o)||ri(o))&&o.mediaStreamTrack===e&&(n=r):e===o&&(n=r))}),n}waitForPendingPublicationOfSource(e){return b(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(c=>{let[l]=c;return l.source===e});if(o)return o[1];yield mt(20)}})}}class eC extends Dn{constructor(e,n,r,o){super(e,n.sid,n.name,o),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=c=>{this.setTrack(void 0),this.emit(G.Ended,c)},this.handleVisibilityChange=c=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(c),this.logContext),this.visible=c,this.emitTrackUpdate()},this.handleVideoDimensionsChange=c=>{this.log.debug("adaptivestream video dimensions ".concat(c.width,"x").concat(c.height),this.logContext),this.videoDimensionsAdaptiveStream=c,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const o=new ga({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Rm({participantSid:"",trackSids:[this.trackSid]})]});this.emit(G.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Dn.SubscriptionStatus.Unsubscribed:super.isSubscribed?Dn.SubscriptionStatus.Subscribed:Dn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Dn.PermissionStatus.Allowed:Dn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.requestedVideoDimensions)===null||r===void 0?void 0:r.height)===e.height||(Il(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Il(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Bt.HIGH}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,o=this.track;o!==e&&(o&&(o.off(G.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(G.VisibilityChanged,this.handleVisibilityChange),o.off(G.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(G.Unsubscribed,o)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(G.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(G.VisibilityChanged,this.handleVisibilityChange),e.on(G.Ended,this.handleEnded),this.emit(G.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(G.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?G.Muted:G.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(G.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(G.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Il(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Um({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===j.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Ep(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const r=yS(this.trackInfo,this.requestedMaxQuality);r&&Ep(this.videoDimensionsAdaptiveStream,r)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Bt.HIGH})),e.quality=Bt.HIGH)}this.emit(G.UpdateSettings,e)}}class la extends Wg{static fromParticipantInfo(e,n,r){return new la(e,n.sid,n.identity,n.name,n.metadata,n.attributes,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,o,c,l,u){let h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ss.STANDARD;super(n,r||"",o,c,l,u,h),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(G.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Te(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(G.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(G.SubscriptionPermissionChanged,n=>{this.emit(X.TrackSubscriptionPermissionChanged,e,n)}),e.on(G.SubscriptionStatusChanged,n=>{this.emit(X.TrackSubscriptionStatusChanged,e,n)}),e.on(G.Subscribed,n=>{this.emit(X.TrackSubscribed,n,e)}),e.on(G.Unsubscribed,n=>{this.emit(X.TrackUnsubscribed,n,e)}),e.on(G.SubscriptionFailed,n=>{this.emit(X.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:j.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,o,c,l){let u=this.getTrackPublicationBySid(n);if(u||n.startsWith("TR")||this.trackPublications.forEach(g=>{!u&&e.kind===g.kind.toString()&&(u=g)}),!u){if(l===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(X.TrackSubscriptionFailed,n);return}l===void 0&&(l=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,o,c,l-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Te(u))),this.emit(X.TrackSubscriptionFailed,n);return}const h=e.kind==="video";let p;return h?p=new GT(e,n,o,c):p=new KT(e,n,o,this.audioContext,this.audioOutput),p.source=u.source,p.isMuted=u.isMuted,p.setMediaStream(r),p.start(),u.setTrack(p),this.volumeMap.has(u.source)&&ru(p)&&yn(p)&&p.setVolume(this.volumeMap.get(u.source)),u}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(o=>{var c,l;let u=this.getTrackPublicationBySid(o.sid);if(u)u.updateInfo(o);else{const h=j.kindFromProto(o.type);if(!h)return;u=new eC(h,o,(c=this.signalClient.connectOptions)===null||c===void 0?void 0:c.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(l=this.loggerOptions)===null||l===void 0?void 0:l.loggerName}),u.updateInfo(o),r.set(o.sid,u);const p=Array.from(this.trackPublications.values()).find(g=>g.source===(u==null?void 0:u.source));p&&u.source!==j.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(u.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Te(p),newTrack:Te(u)})),this.addTrackPublication(u)}n.set(o.sid,u)}),this.trackPublications.forEach(o=>{n.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Te(o))),this.unpublishTrack(o.trackSid,!0))}),r.forEach(o=>{this.emit(X.TrackPublished,o)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:o}=r;switch(o&&(o.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case j.Kind.Audio:this.audioTrackPublications.delete(e);break;case j.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(X.TrackUnpublished,r)}setAudioOutput(e){return b(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var o;yn(r.track)&&ru(r.track)&&n.push(r.track.setSinkId((o=e.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Pe;(function(s){s.Disconnected="disconnected",s.Connecting="connecting",s.Connected="connected",s.Reconnecting="reconnecting",s.SignalReconnecting="signalReconnecting"})(Pe||(Pe={}));const tC=4*1e3;class Sr extends Tn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,r,o,c;if(super(),n=this,this.state=Pe.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ve,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(l,u,h)=>b(this,void 0,void 0,function*(){var p;if(!wS())throw kn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const g=yield this.disconnectLock.lock();if(this.state===Pe.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),Promise.resolve();if(this.connectFuture)return g(),this.connectFuture.promise;this.setAndEmitConnectionState(Pe.Connecting),((p=this.regionUrlProvider)===null||p===void 0?void 0:p.getServerUrl().toString())!==Dg(l)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),kr(new URL(l))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ee(l,u):this.regionUrlProvider.updateToken(u),this.regionUrlProvider.fetchRegionSettings().then(C=>{var P;(P=this.regionUrlProvider)===null||P===void 0||P.setServerReportedRegions(C)}).catch(C=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:C}))}));const v=(C,P,_)=>b(this,void 0,void 0,function*(){var U,A;this.abortController&&this.abortController.abort();const Y=new AbortController;this.abortController=Y,g==null||g();try{if(yield mr.getInstance().getBackOffPromise(l),Y.signal.aborted)throw me.cancelled("Connection attempt aborted");yield this.attemptConnection(_??l,u,h,Y),this.abortController=void 0,C()}catch(H){if(this.regionUrlProvider&&H instanceof me&&H.reason!==je.Cancelled&&H.reason!==je.NotAllowed){let R=null;try{this.log.debug("Fetching next region"),R=yield this.regionUrlProvider.getNextBestRegionUrl((U=this.abortController)===null||U===void 0?void 0:U.signal)}catch(M){if(M instanceof me&&(M.status===401||M.reason===je.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),P(M);return}}[je.InternalError,je.ServerUnreachable,je.Timeout].includes(H.reason)&&(this.log.debug("Adding failed connection attempt to back off"),mr.getInstance().addFailedConnectionAttempt(l)),R&&!(!((A=this.abortController)===null||A===void 0)&&A.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(H.message,". Retrying with another region: ").concat(R),this.logContext),this.recreateEngine(),yield v(C,P,R)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Dp(H)),P(H))}else{let R=ln.UNKNOWN_REASON;H instanceof me&&(R=Dp(H)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,R),P(H)}}}),k=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Qt((C,P)=>{v(C,P,k)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(l,u,h,p,g,v)=>b(this,void 0,void 0,function*(){var k,C,P;const _=yield h.join(l,u,{autoSubscribe:p.autoSubscribe,adaptiveStream:typeof g.adaptiveStream=="object"?!0:g.adaptiveStream,maxRetries:p.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:p.websocketTimeout,singlePeerConnection:g.singlePeerConnection},v.signal);let U=_.serverInfo;if(U||(U={version:_.serverVersion,region:_.serverRegion}),this.serverInfo=U,this.log.debug("connected to Livekit Server ".concat(Object.entries(U).map(A=>{let[Y,H]=A;return"".concat(Y,": ").concat(H)}).join(", ")),{room:(k=_.room)===null||k===void 0?void 0:k.name,roomSid:(C=_.room)===null||C===void 0?void 0:C.sid,identity:(P=_.participant)===null||P===void 0?void 0:P.identity}),!U.version)throw new oS("unknown server version");return U.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),g.dynacast=!1),_}),this.applyJoinResponse=l=>{const u=l.participant;if(this.localParticipant.sid=u.sid,this.localParticipant.identity=u.identity,this.localParticipant.setEnabledPublishCodecs(l.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(l.sifTrailer)}catch(h){this.log.error(h instanceof Error?h.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:h}))}this.handleParticipantUpdates([u,...l.otherParticipants]),l.room&&this.handleRoomUpdate(l.room)},this.attemptConnection=(l,u,h,p)=>b(this,void 0,void 0,function*(){var g,v;this.state===Pe.Reconnecting||this.isResuming||!((g=this.engine)===null||g===void 0)&&g.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((v=this.regionUrlProvider)===null||v===void 0)&&v.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Au),h),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const k=yield this.connectSignal(l,u,this.engine,this.connOptions,this.options,p);this.applyJoinResponse(k),this.setupLocalParticipantEvents(),this.emit(q.SignalConnected)}catch(k){yield this.engine.close(),this.recreateEngine();const C=p.signal.aborted?me.cancelled("Signal connection aborted"):me.serverUnreachable("could not establish signal connection");throw k instanceof Error&&(C.message="".concat(C.message,": ").concat(k.message)),k instanceof me&&(C.reason=k.reason,C.status=k.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:k})),C}if(p.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),me.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,p)}catch(k){throw yield this.engine.close(),this.recreateEngine(),k}Mt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Mt()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Pe.Connected),this.emit(q.Connected),mr.getInstance().resetFailedConnectionAttempts(l),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return b(n,[...u],void 0,function(){var p=this;let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var v,k,C;const P=yield p.disconnectLock.lock();try{if(p.state===Pe.Disconnected){p.log.debug("already disconnected",p.logContext);return}if(p.log.info("disconnect from room",Object.assign({},p.logContext)),p.state===Pe.Connecting||p.state===Pe.Reconnecting||p.isResuming){const _="Abort connection attempt due to user initiated disconnect";p.log.warn(_,p.logContext),(v=p.abortController)===null||v===void 0||v.abort(_),(C=(k=p.connectFuture)===null||k===void 0?void 0:k.reject)===null||C===void 0||C.call(k,me.cancelled("Client initiated disconnect")),p.connectFuture=void 0}p.engine&&(p.engine.client.isDisconnected||(yield p.engine.client.sendLeave()),yield p.engine.close()),p.handleDisconnect(g,ln.CLIENT_INITIATED),p.engine=void 0}finally{P()}})()})},this.onPageLeave=()=>b(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>b(this,void 0,void 0,function*(){const l=[],u=Nt();if(u&&u.os==="iOS"){const h="livekit-dummy-audio-el";let p=document.getElementById(h);if(!p){p=document.createElement("audio"),p.id=h,p.autoplay=!0,p.hidden=!0;const g=Rl();g.enabled=!0;const v=new MediaStream([g]);p.srcObject=v,document.addEventListener("visibilitychange",()=>{p&&(p.srcObject=document.hidden?null:v,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(p),this.once(q.Disconnected,()=>{p==null||p.remove(),p=null})}l.push(p)}this.remoteParticipants.forEach(h=>{h.audioTrackPublications.forEach(p=>{p.track&&p.track.attachedElements.forEach(g=>{l.push(g)})})});try{yield Promise.all([this.acquireAudioContext(),...l.map(h=>(h.muted=!1,h.play()))]),this.handleAudioPlaybackStarted()}catch(h){throw this.handleAudioPlaybackFailed(h),h}}),this.startVideo=()=>b(this,void 0,void 0,function*(){const l=[];for(const u of this.remoteParticipants.values())u.videoTrackPublications.forEach(h=>{var p;(p=h.track)===null||p===void 0||p.attachedElements.forEach(g=>{l.includes(g)||l.push(g)})});yield Promise.all(l.map(u=>u.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(u=>{u.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const l of this.remoteParticipants.values())this.handleParticipantDisconnected(l.identity,l);this.setAndEmitConnectionState(Pe.Reconnecting)&&this.emit(q.Reconnecting)},this.handleSignalRestarted=l=>b(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(l.serverRegion),Object.assign(Object.assign({},this.logContext),{region:l.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(l);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(u){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:u}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:l.serverRegion}))}catch{return}this.setAndEmitConnectionState(Pe.Connected),this.emit(q.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=l=>{l.forEach(u=>{var h;if(u.identity===this.localParticipant.identity){this.localParticipant.updateInfo(u);return}u.identity===""&&(u.identity=(h=this.sidToIdentity.get(u.sid))!==null&&h!==void 0?h:"");let p=this.remoteParticipants.get(u.identity);u.state===ur.DISCONNECTED?this.handleParticipantDisconnected(u.identity,p):p=this.getOrCreateParticipant(u.identity,u)})},this.handleActiveSpeakersUpdate=l=>{const u=[],h={};l.forEach(p=>{if(h[p.sid]=!0,p.sid===this.localParticipant.sid)this.localParticipant.audioLevel=p.level,this.localParticipant.setIsSpeaking(!0),u.push(this.localParticipant);else{const g=this.getRemoteParticipantBySid(p.sid);g&&(g.audioLevel=p.level,g.setIsSpeaking(!0),u.push(g))}}),h[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(p=>{h[p.sid]||(p.audioLevel=0,p.setIsSpeaking(!1))}),this.activeSpeakers=u,this.emitWhenConnected(q.ActiveSpeakersChanged,u)},this.handleSpeakersChanged=l=>{const u=new Map;this.activeSpeakers.forEach(p=>{const g=this.remoteParticipants.get(p.identity);g&&g.sid!==p.sid||u.set(p.sid,p)}),l.forEach(p=>{let g=this.getRemoteParticipantBySid(p.sid);p.sid===this.localParticipant.sid&&(g=this.localParticipant),g&&(g.audioLevel=p.level,g.setIsSpeaking(p.active),p.active?u.set(p.sid,g):u.delete(p.sid))});const h=Array.from(u.values());h.sort((p,g)=>g.audioLevel-p.audioLevel),this.activeSpeakers=h,this.emitWhenConnected(q.ActiveSpeakersChanged,h)},this.handleStreamStateUpdate=l=>{l.streamStates.forEach(u=>{const h=this.getRemoteParticipantBySid(u.participantSid);if(!h)return;const p=h.getTrackPublicationBySid(u.trackSid);if(!p||!p.track)return;const g=j.streamStateFromProto(u.state);p.track.setStreamState(g),g!==p.track.streamState&&(h.emit(X.TrackStreamStateChanged,p,p.track.streamState),this.emitWhenConnected(q.TrackStreamStateChanged,p,p.track.streamState,h))})},this.handleSubscriptionPermissionUpdate=l=>{const u=this.getRemoteParticipantBySid(l.participantSid);if(!u)return;const h=u.getTrackPublicationBySid(l.trackSid);h&&h.setAllowed(l.allowed)},this.handleSubscriptionError=l=>{const u=Array.from(this.remoteParticipants.values()).find(p=>p.trackPublications.has(l.trackSid));if(!u)return;const h=u.getTrackPublicationBySid(l.trackSid);h&&h.setSubscriptionError(l.err)},this.handleDataPacket=(l,u)=>{const h=this.remoteParticipants.get(l.participantIdentity);if(l.value.case==="user")this.handleUserPacket(h,l.value.value,l.kind,u);else if(l.value.case==="transcription")this.handleTranscription(h,l.value.value);else if(l.value.case==="sipDtmf")this.handleSipDtmf(h,l.value.value);else if(l.value.case==="chatMessage")this.handleChatMessage(h,l.value.value);else if(l.value.case==="metrics")this.handleMetrics(l.value.value,h);else if(l.value.case==="streamHeader"||l.value.case==="streamChunk"||l.value.case==="streamTrailer")this.handleDataStream(l,u);else if(l.value.case==="rpcRequest"){const p=l.value.value;this.handleIncomingRpcRequest(l.participantIdentity,p.id,p.method,p.payload,p.responseTimeoutMs,p.version)}},this.handleUserPacket=(l,u,h,p)=>{this.emit(q.DataReceived,u.payload,l,h,u.topic,p),l==null||l.emit(X.DataReceived,u.payload,h,p)},this.handleSipDtmf=(l,u)=>{this.emit(q.SipDTMFReceived,u,l),l==null||l.emit(X.SipDTMFReceived,u)},this.handleTranscription=(l,u)=>{const h=u.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(u.transcribedParticipantIdentity),p=h==null?void 0:h.trackPublications.get(u.trackId),g=MS(u,this.transcriptionReceivedTimes);p==null||p.emit(G.TranscriptionReceived,g),h==null||h.emit(X.TranscriptionReceived,g,p),this.emit(q.TranscriptionReceived,g,h,p)},this.handleChatMessage=(l,u)=>{const h=NS(u);this.emit(q.ChatMessage,h,l)},this.handleMetrics=(l,u)=>{this.emit(q.MetricsReceived,l,u)},this.handleDataStream=(l,u)=>{this.incomingDataStreamManager.handleDataStreamPacket(l,u)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(q.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=l=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:l})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(q.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(q.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(q.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>b(this,void 0,void 0,function*(){var l;((l=Nt())===null||l===void 0?void 0:l.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(q.MediaDevicesChanged)}),this.handleRoomUpdate=l=>{const u=this.roomInfo;this.roomInfo=l,u&&u.metadata!==l.metadata&&this.emitWhenConnected(q.RoomMetadataChanged,l.metadata),(u==null?void 0:u.activeRecording)!==l.activeRecording&&this.emitWhenConnected(q.RecordingStatusChanged,l.activeRecording)},this.handleConnectionQualityUpdate=l=>{l.updates.forEach(u=>{if(u.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(u.quality);return}const h=this.getRemoteParticipantBySid(u.participantSid);h&&h.setConnectionQuality(u.quality)})},this.onLocalParticipantMetadataChanged=l=>{this.emit(q.ParticipantMetadataChanged,l,this.localParticipant)},this.onLocalParticipantNameChanged=l=>{this.emit(q.ParticipantNameChanged,l,this.localParticipant)},this.onLocalAttributesChanged=l=>{this.emit(q.ParticipantAttributesChanged,l,this.localParticipant)},this.onLocalTrackMuted=l=>{this.emit(q.TrackMuted,l,this.localParticipant)},this.onLocalTrackUnmuted=l=>{this.emit(q.TrackUnmuted,l,this.localParticipant)},this.onTrackProcessorUpdate=l=>{var u;(u=l==null?void 0:l.onPublish)===null||u===void 0||u.call(l,this)},this.onLocalTrackPublished=l=>b(this,void 0,void 0,function*(){var u,h,p,g,v,k;(u=l.track)===null||u===void 0||u.on(G.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=l.track)===null||h===void 0||h.on(G.Restarted,this.onLocalTrackRestarted),(v=(g=(p=l.track)===null||p===void 0?void 0:p.getProcessor())===null||g===void 0?void 0:g.onPublish)===null||v===void 0||v.call(g,this),this.emit(q.LocalTrackPublished,l,this.localParticipant),On(l.track)&&(yield l.track.checkForSilence())&&this.emit(q.LocalAudioSilenceDetected,l);const C=yield(k=l.track)===null||k===void 0?void 0:k.getDeviceId(!1),P=eu(l.source);P&&C&&C!==this.localParticipant.activeDeviceMap.get(P)&&(this.localParticipant.activeDeviceMap.set(P,C),this.emit(q.ActiveDeviceChanged,P,C))}),this.onLocalTrackUnpublished=l=>{var u,h;(u=l.track)===null||u===void 0||u.off(G.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=l.track)===null||h===void 0||h.off(G.Restarted,this.onLocalTrackRestarted),this.emit(q.LocalTrackUnpublished,l,this.localParticipant)},this.onLocalTrackRestarted=l=>b(this,void 0,void 0,function*(){const u=yield l.getDeviceId(!1),h=eu(l.source);h&&u&&u!==this.localParticipant.activeDeviceMap.get(h)&&(this.log.debug("local track restarted, setting ".concat(h," ").concat(u," active"),this.logContext),this.localParticipant.activeDeviceMap.set(h,u),this.emit(q.ActiveDeviceChanged,h,u))}),this.onLocalConnectionQualityChanged=l=>{this.emit(q.ConnectionQualityChanged,l,this.localParticipant)},this.onMediaDevicesError=(l,u)=>{this.emit(q.MediaDevicesError,l,u)},this.onLocalParticipantPermissionsChanged=l=>{this.emit(q.ParticipantPermissionsChanged,l,this.localParticipant)},this.onLocalChatMessageSent=l=>{this.emit(q.ChatMessage,l,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},hT),e),this.log=Un((r=this.options.loggerName)!==null&&r!==void 0?r:un.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Ng),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ag),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},dT),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new zT,this.outgoingDataStreamManager=new HT(this.engine,this.log),this.disconnectLock=new wt,this.localParticipant=new ZT("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",li(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",li(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",li(this.options.audioOutput.deviceId)).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),Mt()){const l=new AbortController;(c=navigator.mediaDevices)===null||c===void 0||c.addEventListener("devicechange",this.handleDeviceChange,{signal:l.signal}),Sr.cleanupRegistry&&Sr.cleanupRegistry.register(this,()=>{l.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,r=this.options.encryption||this.options.e2ee;r&&("e2eeManager"in r?(this.e2eeManager=r.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new JS(r,n),this.e2eeManager.on(ai.ParticipantEncryptionStatusChanged,(o,c)=>{LS(c)&&(this.isE2EEEnabled=o),this.emit(q.ParticipantEncryptionStatusChanged,o,c)}),this.e2eeManager.on(ai.EncryptionError,(o,c)=>{const l=c?this.getParticipantByIdentity(c):void 0;this.emit(q.EncryptionError,o,l)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return b(this,void 0,void 0,function*(){return this.state===Pe.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=o=>{o.sid!==""&&(this.engine.off($.RoomUpdate,r),e(o.sid))};this.engine.on($.RoomUpdate,r),this.once(q.Disconnected,()=>{this.engine.off($.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new FT(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on($.ParticipantUpdate,this.handleParticipantUpdates).on($.RoomUpdate,this.handleRoomUpdate).on($.SpeakersChanged,this.handleSpeakersChanged).on($.StreamStateChanged,this.handleStreamStateUpdate).on($.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on($.SubscriptionError,this.handleSubscriptionError).on($.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on($.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on($.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on($.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on($.DataPacketReceived,this.handleDataPacket).on($.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Pe.SignalReconnecting)&&this.emit(q.SignalReconnecting)}).on($.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Pe.Connected)&&this.emit(q.Reconnected)}).on($.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Pe.Reconnecting||this.isResuming)&&this.sendSyncState()}).on($.Restarting,this.handleRestarting).on($.SignalRestarted,this.handleSignalRestarted).on($.Offline,()=>{this.setAndEmitConnectionState(Pe.Reconnecting)&&this.emit(q.Reconnecting)}).on($.DCBufferStatusChanged,(e,n)=>{this.emit(q.DCBufferStatusChanged,e,n)}).on($.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:o}=r;return o===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(X.LocalTrackSubscribed,n),this.emitWhenConnected(q.LocalTrackSubscribed,n,this.localParticipant)}).on($.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,r)=>{this.handleParticipantDisconnected(r,n)}),this.emit(q.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return dt.getInstance().getDevices(e,n)}prepareConnection(e,n){return b(this,void 0,void 0,function*(){if(this.state===Pe.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(kr(new URL(e))&&n){this.regionUrlProvider=new Ee(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Pe.Disconnected&&(this.regionUrl=r,yield fetch(ws(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(ws(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return b(this,void 0,void 0,function*(){let r=()=>b(this,void 0,void 0,function*(){}),o;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new gn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new gn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new gn({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new gn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new gn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new gn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new gn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>b(this,void 0,void 0,function*(){const c=this.engine.client.onLeave;c&&c(new va({reason:ln.CLIENT_INITIATED,action:dr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new gn({scenario:{case:"subscriberBandwidth",value:Ii(n)}});break;case"leave-full-reconnect":o=new gn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return b(this,arguments,void 0,function(r,o){var c=this;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var u,h,p,g,v,k,C;let P=!0,_=!1;const U=l?{exact:o}:o;if(r==="audioinput"){_=c.localParticipant.audioTrackPublications.size===0;const A=(u=c.getActiveDevice(r))!==null&&u!==void 0?u:c.options.audioCaptureDefaults.deviceId;c.options.audioCaptureDefaults.deviceId=U;const Y=Array.from(c.localParticipant.audioTrackPublications.values()).filter(R=>R.source===j.Source.Microphone);try{P=(yield Promise.all(Y.map(R=>{var M;return(M=R.audioTrack)===null||M===void 0?void 0:M.setDeviceId(U)}))).every(R=>R===!0)}catch(R){throw c.options.audioCaptureDefaults.deviceId=A,R}const H=Y.some(R=>{var M,F;return(F=(M=R.track)===null||M===void 0?void 0:M.isMuted)!==null&&F!==void 0?F:!1});P&&H&&(_=!0)}else if(r==="videoinput"){_=c.localParticipant.videoTrackPublications.size===0;const A=(h=c.getActiveDevice(r))!==null&&h!==void 0?h:c.options.videoCaptureDefaults.deviceId;c.options.videoCaptureDefaults.deviceId=U;const Y=Array.from(c.localParticipant.videoTrackPublications.values()).filter(R=>R.source===j.Source.Camera);try{P=(yield Promise.all(Y.map(R=>{var M;return(M=R.videoTrack)===null||M===void 0?void 0:M.setDeviceId(U)}))).every(R=>R===!0)}catch(R){throw c.options.videoCaptureDefaults.deviceId=A,R}const H=Y.some(R=>{var M,F;return(F=(M=R.track)===null||M===void 0?void 0:M.isMuted)!==null&&F!==void 0?F:!1});P&&H&&(_=!0)}else if(r==="audiooutput"){if(_=!0,!iu()&&!c.options.webAudioMix||c.options.webAudioMix&&c.audioContext&&!("setSinkId"in c.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");c.options.webAudioMix&&(o=(p=yield dt.getInstance().normalizeDeviceId("audiooutput",o))!==null&&p!==void 0?p:""),(g=(C=c.options).audioOutput)!==null&&g!==void 0||(C.audioOutput={});const A=(v=c.getActiveDevice(r))!==null&&v!==void 0?v:c.options.audioOutput.deviceId;c.options.audioOutput.deviceId=o;try{c.options.webAudioMix&&((k=c.audioContext)===null||k===void 0||k.setSinkId(o)),yield Promise.all(Array.from(c.remoteParticipants.values()).map(Y=>Y.setAudioOutput({deviceId:o})))}catch(Y){throw c.options.audioOutput.deviceId=A,Y}}return _&&(c.localParticipant.activeDeviceMap.set(r,o),c.emit(q.ActiveDeviceChanged,r,o)),P})()})}setupLocalParticipantEvents(){this.localParticipant.on(X.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(X.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(X.AttributesChanged,this.onLocalAttributesChanged).on(X.TrackMuted,this.onLocalTrackMuted).on(X.TrackUnmuted,this.onLocalTrackUnmuted).on(X.LocalTrackPublished,this.onLocalTrackPublished).on(X.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(X.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(X.MediaDevicesError,this.onMediaDevicesError).on(X.AudioStreamAcquired,this.startAudio).on(X.ChatMessage,this.onLocalChatMessageSent).on(X.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===Pe.Connecting||this.state===Pe.Reconnecting){const v=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(C=>C.id)}),this.onTrackAdded(e,n,r),k()},k=()=>{this.off(q.Reconnected,v),this.off(q.Connected,v),this.off(q.Disconnected,k)};this.once(q.Reconnected,v),this.once(q.Connected,v),this.once(q.Disconnected,k);return}if(this.state===Pe.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=TS(n.id),c=o[0];let l=o[1],u=e.id;if(l&&l.startsWith("TR")&&(u=l),c===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const h=Array.from(this.remoteParticipants.values()).find(v=>v.sid===c);if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(c),this.logContext);return}if(!u.startsWith("TR")){const v=this.engine.getTrackIdForReceiver(r);if(!v){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(c),this.logContext);return}u=v}u.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(c,", streamId: ").concat(l,", trackId: ").concat(u),Object.assign(Object.assign({},this.logContext),{rpID:c,streamId:l,trackId:u}));let p;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?p=this.options.adaptiveStream:p={});const g=h.addSubscribedMediaTrack(e,u,n,r,p);g!=null&&g.isEncrypted&&!this.e2eeManager&&this.emit(q.EncryptionError,new Error("Encrypted ".concat(g.source," track received from participant ").concat(h.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Pe.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(c=>{o.unpublishTrack(c.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var c,l,u;o.track&&this.localParticipant.unpublishTrack(o.track,e),e?((c=o.track)===null||c===void 0||c.detach(),(l=o.track)===null||l===void 0||l.stop()):(u=o.track)===null||u===void 0||u.stopMonitor()}),this.localParticipant.off(X.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(X.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(X.AttributesChanged,this.onLocalAttributesChanged).off(X.TrackMuted,this.onLocalTrackMuted).off(X.TrackUnmuted,this.onLocalTrackUnmuted).off(X.LocalTrackPublished,this.onLocalTrackPublished).off(X.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(X.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(X.MediaDevicesError,this.onMediaDevicesError).off(X.AudioStreamAcquired,this.startAudio).off(X.ChatMessage,this.onLocalChatMessageSent).off(X.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Mt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Pe.Disconnected),this.emit(q.Disconnected,n)}}}handleParticipantDisconnected(e,n){var r;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(o=>{n.unpublishTrack(o.trackSid,!0)}),this.emit(q.ParticipantDisconnected,n),n.setDisconnected(),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,r,o,c,l){return b(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),l!==1){yield this.engine.publishRpcResponse(e,n,null,Qe.builtIn("UNSUPPORTED_VERSION"));return}const u=this.rpcHandlers.get(r);if(!u){yield this.engine.publishRpcResponse(e,n,null,Qe.builtIn("UNSUPPORTED_METHOD"));return}let h=null,p=null;try{const g=yield u({requestId:n,callerIdentity:e,payload:o,responseTimeout:c});Lu(g)>Ug?(h=Qe.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(r))):p=g}catch(g){g instanceof Qe?h=g:(this.log.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),g),h=Qe.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,p,h)})}selectDefaultDevices(){return b(this,void 0,void 0,function*(){var e,n,r;const o=dt.getInstance().previousDevices,c=yield dt.getInstance().getDevices(void 0,!1),l=Nt();if((l==null?void 0:l.name)==="Chrome"&&l.os!=="iOS")for(let h of c){const p=o.find(g=>g.deviceId===h.deviceId);p&&p.label!==""&&p.kind===h.kind&&p.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(q.ActiveDeviceChanged,h.kind,h.deviceId)}const u=["audiooutput","audioinput","videoinput"];for(let h of u){const p=hS(h),g=this.localParticipant.getTrackPublication(p);if(g&&(!((e=g.track)===null||e===void 0)&&e.isUserProvided))continue;const v=c.filter(C=>C.kind===h),k=this.getActiveDevice(h);if(k===((n=o.filter(C=>C.kind===h)[0])===null||n===void 0?void 0:n.deviceId)&&v.length>0&&((r=v[0])===null||r===void 0?void 0:r.deviceId)!==k){yield this.switchActiveDevice(h,v[0].deviceId);continue}h==="audioinput"&&!bs()||h==="videoinput"||v.length>0&&!v.find(C=>C.deviceId===this.getActiveDevice(h))&&(h!=="audiooutput"||!bs())&&(yield this.switchActiveDevice(h,v[0].deviceId))}})}acquireAudioContext(){return b(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Pg())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),mt(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(q.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let o;return n?o=la.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new la(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(c=>this.log.warn("Could not set audio output: ".concat(c.message),this.logContext)),o}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const o=this.remoteParticipants.get(e);return n&&o.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),o}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(q.ParticipantConnected,r),r.on(X.TrackPublished,o=>{this.emitWhenConnected(q.TrackPublished,o,r)}).on(X.TrackSubscribed,(o,c)=>{o.kind===j.Kind.Audio?(o.on(G.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(G.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===j.Kind.Video&&(o.on(G.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(G.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(q.TrackSubscribed,o,c,r)}).on(X.TrackUnpublished,o=>{this.emit(q.TrackUnpublished,o,r)}).on(X.TrackUnsubscribed,(o,c)=>{this.emit(q.TrackUnsubscribed,o,c,r)}).on(X.TrackMuted,o=>{this.emitWhenConnected(q.TrackMuted,o,r)}).on(X.TrackUnmuted,o=>{this.emitWhenConnected(q.TrackUnmuted,o,r)}).on(X.ParticipantMetadataChanged,o=>{this.emitWhenConnected(q.ParticipantMetadataChanged,o,r)}).on(X.ParticipantNameChanged,o=>{this.emitWhenConnected(q.ParticipantNameChanged,o,r)}).on(X.AttributesChanged,o=>{this.emitWhenConnected(q.ParticipantAttributesChanged,o,r)}).on(X.ConnectionQualityChanged,o=>{this.emitWhenConnected(q.ConnectionQualityChanged,o,r)}).on(X.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(q.ParticipantPermissionsChanged,o,r)}).on(X.TrackSubscriptionStatusChanged,(o,c)=>{this.emitWhenConnected(q.TrackSubscriptionStatusChanged,o,c,r)}).on(X.TrackSubscriptionFailed,(o,c)=>{this.emit(q.TrackSubscriptionFailed,o,r,c)}).on(X.TrackSubscriptionPermissionChanged,(o,c)=>{this.emitWhenConnected(q.TrackSubscriptionPermissionChanged,o,c,r)}).on(X.Active,()=>{this.emitWhenConnected(q.ParticipantActive,r),r.kind===Ss.AGENT&&this.localParticipant.setActiveAgent(r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,o)=>(r.push(...o.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&AS(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=pt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ln.STATE_MISMATCH))):e=0},tC)}clearConnectionReconcile(){this.connectionReconcileInterval&&pt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(q.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(this.state===Pe.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Pe.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return b(this,void 0,void 0,function*(){var n,r;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),c=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new fa({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ze.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new xi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(q.SignalConnected),this.emit(q.Connected),this.setAndEmitConnectionState(Pe.Connected),o.video){const l=new uu(j.Kind.Video,new ar({source:et.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:on.AUDIO,name:"video-dummy"}),new ca(o.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Op(160*((n=c.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(X.LocalTrackPublished,l)}if(o.audio){const l=new uu(j.Kind.Audio,new ar({source:et.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:on.AUDIO}),new aa(o.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Rl(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(X.LocalTrackPublished,l)}for(let l=0;l<c.count-1;l+=1){let u=new xi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(l),state:ur.ACTIVE,tracks:[],joinedAt:ze.parse(Date.now())});const h=this.getOrCreateParticipant(u.identity,u);if(c.video){const p=Op(160*((r=c.aspectRatios[l%c.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),g=new ar({source:et.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:on.AUDIO});h.addSubscribedMediaTrack(p,g.sid,new MediaStream([p]),new RTCRtpReceiver),u.tracks=[...u.tracks,g]}if(c.audio){const p=Rl(),g=new ar({source:et.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:on.AUDIO});h.addSubscribedMediaTrack(p,g.sid,new MediaStream([p]),new RTCRtpReceiver),u.tracks=[...u.tracks,g]}h.updateInfo(u)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(e!==q.ActiveSpeakersChanged&&e!==q.TranscriptionReceived){const c=Hg(r).filter(l=>l!==void 0);(e===q.TrackSubscribed||e===q.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:c})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:c}))}return super.emit(e,...r)}}Sr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(s=>{s()});function Hg(s){return s.map(e=>{if(e)return Array.isArray(e)?Hg(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var sn;(function(s){s[s.IDLE=0]="IDLE",s[s.RUNNING=1]="RUNNING",s[s.SKIPPED=2]="SKIPPED",s[s.SUCCESS=3]="SUCCESS",s[s.FAILED=4]="FAILED"})(sn||(sn={}));class pi extends Tn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=sn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Sr(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return b(this,void 0,void 0,function*(){if(this.status!==sn.IDLE)throw Error("check is running already");this.setStatus(sn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==sn.SKIPPED&&this.setStatus(this.isSuccess()?sn.SUCCESS:sn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return b(this,void 0,void 0,function*(){return this.room.state===Pe.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return b(this,void 0,void 0,function*(){this.room&&this.room.state!==Pe.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(sn.SKIPPED)}switchProtocol(e){return b(this,void 0,void 0,function*(){let n=!1,r=!1;if(this.room.on(q.Reconnecting,()=>{n=!0}),this.room.once(q.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(c=>setTimeout(c,1e3)),!n)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(r)return;yield mt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class nC extends pi{get description(){return"Cloud regions"}perform(){return b(this,void 0,void 0,function*(){const e=new Ee(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],r=new Set;for(let c=0;c<3;c++){const l=yield e.getNextBestRegionUrl();if(!l)break;if(r.has(l))continue;r.add(l);const u=yield this.checkCloudRegion(l);this.appendMessage("".concat(u.region," RTT: ").concat(u.rtt,"ms, duration: ").concat(u.duration,"ms")),n.push(u)}n.sort((c,l)=>(c.duration-l.duration)*.5+(c.rtt-l.rtt)*.5);const o=n[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return b(this,void 0,void 0,function*(){var n,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!o)throw new Error("Region not found");const c=yield this.room.localParticipant.streamText({topic:"test"}),l=1e3,h=1e6/l,p="A".repeat(l),g=Date.now();for(let P=0;P<h;P++)yield c.write(p);yield c.close();const v=Date.now(),k=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),C={region:o,rtt:1e4,duration:v-g};return k==null||k.forEach(P=>{P.type==="candidate-pair"&&P.nominated&&(C.rtt=P.currentRoundTripTime*1e3)}),yield this.disconnect(),C})}}const Ul=1e4;class iC extends pi{get description(){return"Connection via UDP vs TCP"}perform(){return b(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(Ul/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(Ul/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return b(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const r=n.getContext("2d");if(!r)throw new Error("Could not get canvas context");let o=0;const c=()=>{o=(o+1)%360,r.fillStyle="hsl(".concat(o,", 100%, 50%)"),r.fillRect(0,0,n.width,n.height),requestAnimationFrame(c)};c();const u=n.captureStream(30).getVideoTracks()[0],p=(yield this.room.localParticipant.publishTrack(u,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>b(this,void 0,void 0,function*(){const k=yield p.getRTCStatsReport();k==null||k.forEach(C=>{C.type==="outbound-rtp"?(g.packetsSent=C.packetsSent,g.qualityLimitationDurations=C.qualityLimitationDurations,g.bitrateTotal+=C.targetBitrate,g.count++):C.type==="remote-inbound-rtp"&&(g.packetsLost=C.packetsLost,g.rttTotal+=C.roundTripTime,g.jitterTotal+=C.jitter)})}),1e3);return yield new Promise(k=>setTimeout(k,Ul)),clearInterval(v),u.stop(),n.remove(),yield this.disconnect(),g})}}class rC extends pi{get description(){return"Can publish audio"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield $T();if(yield _g(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(r),yield new Promise(u=>setTimeout(u,3e3));const c=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!c)throw new Error("Could not get RTCStats");let l=0;if(c.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="audio"||!u.kind&&u.mediaType==="audio")&&(l=u.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," audio packets"))})}}class sC extends pi{get description(){return"Can publish video"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield QT();yield this.checkForVideo(r.mediaStreamTrack),n.localParticipant.publishTrack(r),yield new Promise(l=>setTimeout(l,5e3));const o=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let c=0;if(o.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="video"||!l.kind&&l.mediaType==="video")&&(c+=l.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," video packets"))})}checkForVideo(e){return b(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const r=document.createElement("video");r.srcObject=n,r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.setAttribute("playsinline","true"),document.body.appendChild(r),yield new Promise(o=>{r.onplay=()=>{setTimeout(()=>{var c,l,u,h;const p=document.createElement("canvas"),g=e.getSettings(),v=(l=(c=g.width)!==null&&c!==void 0?c:r.videoWidth)!==null&&l!==void 0?l:1280,k=(h=(u=g.height)!==null&&u!==void 0?u:r.videoHeight)!==null&&h!==void 0?h:720;p.width=v,p.height=k;const C=p.getContext("2d");C.drawImage(r,0,0);const _=C.getImageData(0,0,p.width,p.height).data;let U=!0;for(let A=0;A<_.length;A+=4)if(_[A]!==0||_[A+1]!==0||_[A+2]!==0){U=!1;break}U?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},r.play()}),n.getTracks().forEach(o=>o.stop()),r.remove()})}}class oC extends pi{get description(){return"Resuming connection after interruption"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,o=!1,c;const l=new Promise(p=>{setTimeout(p,5e3),c=p}),u=()=>{r=!0};n.on(q.SignalReconnecting,u).on(q.Reconnecting,u).on(q.Reconnected,()=>{o=!0,c(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const h=n.engine.client.onClose;if(h&&h(""),yield l,r){if(!o||n.state!==Pe.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class aC extends pi{get description(){return"Can connect via TURN"}perform(){return b(this,void 0,void 0,function*(){var e,n,r;kr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Ee(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const o=new Ou,c=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let l=!1,u=!1,h=!1;for(let p of c.iceServers)for(let g of p.urls)g.startsWith("turn:")?(u=!0,h=!0):g.startsWith("turns:")&&(u=!0,h=!0,l=!0),g.startsWith("stun:")&&(h=!0);h?u&&!l&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield o.close(),!((r=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||r===void 0)&&r.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(p=>setTimeout(p,0)))})}}class cC extends pi{get description(){return"Establishing WebRTC connection"}perform(){return b(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(q.SignalConnected,()=>{var r;const o=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(c,l)=>{if(c.candidate){const u=new RTCIceCandidate(c);let h="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(lC(u.address)?h+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(e=!0,h+=" (passive)"):u.protocol==="udp"&&(n=!0)),this.appendMessage(h)}o&&o(c,l)},!((r=this.room.engine.pcManager)===null||r===void 0)&&r.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=c=>{c instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(c.errorCode," ").concat(c.errorText," ").concat(c.url))})});try{yield this.connect(),ve.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function lC(s){const e=s.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class uC extends pi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return b(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new Ou,c;try{c=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(l){if(kr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(l.message,". Retrying with region fallback"));const h=yield new Ee(this.url,this.token).getNextBestRegionUrl();h&&(c=yield o.join(h,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}c?(this.appendMessage("Connected to server, version ".concat(c.serverVersion,".")),((e=c.serverInfo)===null||e===void 0?void 0:e.edition)===xm.Cloud&&(!((n=c.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=c.serverInfo)===null||r===void 0?void 0:r.region))):this.appendError("Websocket connection could not be established"),yield o.close()})}}class qC extends Tn.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:sn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==sn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return b(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),o=l=>{this.updateCheck(n,l)};r.on("update",o);const c=yield r.run();return r.off("update",o),c})}checkWebsocket(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(uC)})}checkWebRTC(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(cC)})}checkTURN(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(aC)})}checkReconnect(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(oC)})}checkPublishAudio(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(rC)})}checkPublishVideo(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(sC)})}checkConnectionProtocol(){return b(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(iC);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(nC)})}}function Ce(s,e,n){return(e=hC(e))in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}function dC(s,e){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var r=n.call(s,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function hC(s){var e=dC(s,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Et extends Error{constructor(e,n){var r;super(e,n),Ce(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}}Ce(Et,"code","ERR_JOSE_GENERIC");class fC extends Et{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:o,payload:n}}),Ce(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ce(this,"claim",void 0),Ce(this,"reason",void 0),Ce(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=n}}Ce(fC,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class pC extends Et{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:o,payload:n}}),Ce(this,"code","ERR_JWT_EXPIRED"),Ce(this,"claim",void 0),Ce(this,"reason",void 0),Ce(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=n}}Ce(pC,"code","ERR_JWT_EXPIRED");class mC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ce(mC,"code","ERR_JOSE_ALG_NOT_ALLOWED");class gC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ce(gC,"code","ERR_JOSE_NOT_SUPPORTED");class vC extends Et{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ce(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ce(vC,"code","ERR_JWE_DECRYPTION_FAILED");class yC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JWE_INVALID")}}Ce(yC,"code","ERR_JWE_INVALID");class kC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JWS_INVALID")}}Ce(kC,"code","ERR_JWS_INVALID");class SC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JWT_INVALID")}}Ce(SC,"code","ERR_JWT_INVALID");class TC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JWK_INVALID")}}Ce(TC,"code","ERR_JWK_INVALID");class CC extends Et{constructor(){super(...arguments),Ce(this,"code","ERR_JWKS_INVALID")}}Ce(CC,"code","ERR_JWKS_INVALID");class bC extends Et{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ce(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ce(bC,"code","ERR_JWKS_NO_MATCHING_KEY");class wC extends Et{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ce(this,Symbol.asyncIterator,void 0),Ce(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ce(wC,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class EC extends Et{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ce(this,"code","ERR_JWKS_TIMEOUT")}}Ce(EC,"code","ERR_JWKS_TIMEOUT");class _C extends Et{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ce(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ce(_C,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function ua(){return ua=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(s[r]=n[r])}return s},ua.apply(null,arguments)}const tm=new Uint8Array(0);class Es{static getFullOptions(e){return ua({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{}},e)}constructor(e,n){var r=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=1,this.canSendFeedback=!1,this.endSessionWithDetails=async function(o){r.status!=="connected"&&r.status!=="connecting"||(r.updateStatus("disconnecting"),await r.handleEndSession(),r.updateStatus("disconnected"),r.options.onDisconnect(o))},this.onMessage=async function(o){switch(o.type){case"interruption":return void r.handleInterruption(o);case"agent_response":return void r.handleAgentResponse(o);case"user_transcript":return void r.handleUserTranscript(o);case"internal_tentative_agent_response":return void r.handleTentativeAgentResponse(o);case"client_tool_call":return void await r.handleClientToolCall(o);case"audio":return void r.handleAudio(o);case"ping":return void r.connection.sendMessage({type:"pong",event_id:o.ping_event.event_id});default:return void r.options.onDebug(o)}},this.setVolume=({volume:o})=>{this.volume=o},this.options=e,this.connection=n,this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id)}handleAgentResponse(e){this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const r=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",o=typeof r=="object"?JSON.stringify(r):String(r);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:o,is_error:!1})}catch(r){this.onError(`Client tool execution failed with following error: ${r==null?void 0:r.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${r==null?void 0:r.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}onError(e,n){console.error(e,n),this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){}getInputByteFrequencyData(){return tm}getOutputByteFrequencyData(){return tm}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}class Kg{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function da(s){const[e,n]=s.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${s}`);const r=Number.parseInt(n);if(Number.isNaN(r))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:r}}function du(s){return!!s.type}const Gg="conversation_initiation_client_data";function Jg(s){const e={type:Gg};var n,r,o,c,l;return s.overrides&&(e.conversation_config_override={agent:{prompt:(n=s.overrides.agent)==null?void 0:n.prompt,first_message:(r=s.overrides.agent)==null?void 0:r.firstMessage,language:(o=s.overrides.agent)==null?void 0:o.language},tts:{voice_id:(c=s.overrides.tts)==null?void 0:c.voiceId},conversation:{text_only:(l=s.overrides.conversation)==null?void 0:l.textOnly}}),s.customLlmExtraBody&&(e.custom_llm_extra_body=s.customLlmExtraBody),s.dynamicVariables&&(e.dynamic_variables=s.dynamicVariables),s.userId&&(e.user_id=s.userId),e}class ju extends Kg{constructor(e,n,r,o){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=r,this.outputFormat=o,this.socket.addEventListener("error",c=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:c}),0)}),this.socket.addEventListener("close",c=>{this.disconnect(c.code===1e3?{reason:"agent",context:c}:{reason:"error",message:c.reason||"The connection was closed by the server.",context:c})}),this.socket.addEventListener("message",c=>{try{const l=JSON.parse(c.data);if(!du(l))return;this.handleMessage(l)}catch{}})}static async create(e){let n=null;try{var r;const c=(r=e.origin)!=null?r:"wss://api.elevenlabs.io",l=e.signedUrl?e.signedUrl:c+"/v1/convai/conversation?agent_id="+e.agentId,u=["convai"];e.authorization&&u.push(`bearer.${e.authorization}`),n=new WebSocket(l,u);const h=await new Promise((P,_)=>{n.addEventListener("open",()=>{var U;const A=Jg(e);(U=n)==null||U.send(JSON.stringify(A))},{once:!0}),n.addEventListener("error",U=>{setTimeout(()=>_(U),0)}),n.addEventListener("close",_),n.addEventListener("message",U=>{const A=JSON.parse(U.data);du(A)&&(A.type==="conversation_initiation_metadata"?P(A.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:p,agent_output_audio_format:g,user_input_audio_format:v}=h,k=da(v??"pcm_16000"),C=da(g);return new ju(n,p,k,C)}catch(c){var o;throw(o=n)==null||o.close(),c}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}}class Bu extends Kg{constructor(e,n,r,o,c={}){super(c),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.room=e,this.conversationId=n,this.inputFormat=r,this.outputFormat=o,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{const o=await fetch(`https://api.elevenlabs.io/v1/convai/conversation/token?agent_id=${e.agentId}`);if(!o.ok)throw new Error(`ElevenLabs API returned ${o.status} ${o.statusText}`);if(n=(await o.json()).token,!n)throw new Error("No conversation token received from API")}catch(o){let c=o instanceof Error?o.message:String(o);throw o instanceof Error&&o.message.includes("401")&&(c="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${c}`)}}const r=new Sr;try{const o=`webrtc-${Date.now()}`,c=da("pcm_48000"),l=da("pcm_48000"),u=new Bu(r,o,c,l,e),h=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";await r.connect(h,n),await new Promise(g=>{if(u.isConnected)g();else{const v=()=>{r.off(q.Connected,v),g()};r.on(q.Connected,v)}}),r.name&&(u.conversationId=r.name),await r.localParticipant.setMicrophoneEnabled(!0);const p=Jg(e);return u.debug({type:Gg,message:p}),await u.sendMessage(p),u}catch(o){throw await r.disconnect(),o}}setupRoomEventListeners(){var e=this;this.room.on(q.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(q.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(q.ConnectionStateChanged,n=>{n===Pe.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(q.DataReceived,(n,r)=>{try{const o=JSON.parse(new TextDecoder().decode(n));if(o.type==="audio")return;du(o)?this.handleMessage(o):console.warn("Invalid socket event received:",o)}catch(o){console.warn("Failed to parse incoming data message:",o),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(q.TrackSubscribed,async function(n,r,o){if(n.kind===j.Kind.Audio&&o.identity.includes("agent")){const c=n.attach();c.autoplay=!0,c.controls=!1,c.style.display="none",document.body.appendChild(c)}})}close(){this.isConnected&&this.room.disconnect()}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}}async function Qg(s){const e=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(s);switch(e){case"websocket":return ju.create(s);case"webrtc":return Bu.create(s);default:throw new Error(`Unknown connection type: ${e}`)}}function $g(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Yg(s={default:0,android:3e3}){let e=s.default;var n;if(/android/i.test(navigator.userAgent))e=(n=s.android)!=null?n:e;else if($g()){var r;e=(r=s.ios)!=null?r:e}e>0&&await new Promise(o=>setTimeout(o,e))}class Vu extends Es{static async startSession(e){const n=Es.getFullOptions(e);n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange({canSendFeedback:!1});let r=null;try{return await Yg(n.connectionDelay),r=await Qg(e),new Vu(n,r)}catch(c){var o;throw n.onStatusChange({status:"disconnected"}),(o=r)==null||o.close(),c}}}function PC(s){const e=new Uint8Array(s);return window.btoa(String.fromCharCode(...e))}function RC(s){const e=window.atob(s),n=e.length,r=new Uint8Array(n);for(let o=0;o<n;o++)r[o]=e.charCodeAt(o);return r.buffer}const Fl=new Map;function Xg(s,e){return async n=>{const r=Fl.get(s);if(r)return n.addModule(r);const o=new Blob([e],{type:"application/javascript"}),c=URL.createObjectURL(o);try{return await n.addModule(c),void Fl.set(s,c)}catch{URL.revokeObjectURL(c)}try{const l=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(l),Fl.set(s,l)}catch{throw new Error(`Failed to load the ${s} worklet module. Make sure the browser supports AudioWorklets.`)}}}const IC=Xg("raw-audio-processor",`
const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("raw-audio-processor", RawAudioProcessor);
`);class zu{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:r}){let o=null,c=null;try{const h={sampleRate:{ideal:e},echoCancellation:{ideal:!0},noiseSuppression:{ideal:!0}};if($g()&&r){const C=(await window.navigator.mediaDevices.enumerateDevices()).find(P=>P.kind==="audioinput"&&["airpod","headphone","earphone"].find(_=>P.label.toLowerCase().includes(_)));C&&(h.deviceId={ideal:C.deviceId})}const p=navigator.mediaDevices.getSupportedConstraints().sampleRate;o=new window.AudioContext(p?{sampleRate:e}:{});const g=o.createAnalyser();p||await o.audioWorklet.addModule("https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js"),await IC(o.audioWorklet),c=await navigator.mediaDevices.getUserMedia({audio:h});const v=o.createMediaStreamSource(c),k=new AudioWorkletNode(o,"raw-audio-processor");return k.port.postMessage({type:"setFormat",format:n,sampleRate:e}),v.connect(g),g.connect(k),await o.resume(),new zu(o,g,k,c)}catch(h){var l,u;throw(l=c)==null||l.getTracks().forEach(p=>p.stop()),(u=o)==null||u.close(),h}}constructor(e,n,r,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.context=e,this.analyser=n,this.worklet=r,this.inputStream=o}async close(){this.inputStream.getTracks().forEach(e=>e.stop()),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}}const xC=Xg("audio-concat-processor",`
const decodeTable = [0,132,396,924,1980,4092,8316,16764];

export function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audio-concat-processor", AudioConcatProcessor);
`);class qu{static async create({sampleRate:e,format:n}){let r=null;try{r=new AudioContext({sampleRate:e});const c=r.createAnalyser(),l=r.createGain();l.connect(c),c.connect(r.destination),await xC(r.audioWorklet);const u=new AudioWorkletNode(r,"audio-concat-processor");return u.port.postMessage({type:"setFormat",format:n}),u.connect(l),await r.resume(),new qu(r,c,l,u)}catch(c){var o;throw(o=r)==null||o.close(),c}}constructor(e,n,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.context=e,this.analyser=n,this.gain=r,this.worklet=o}async close(){await this.context.close()}}class Wu extends Es{static async startSession(e){var n;const r=Es.getFullOptions(e);r.onStatusChange({status:"connecting"}),r.onCanSendFeedbackChange({canSendFeedback:!1});let o=null,c=null,l=null,u=null,h=null;if((n=e.useWakeLock)==null||n)try{h=await navigator.wakeLock.request("screen")}catch{}try{var p;return u=await navigator.mediaDevices.getUserMedia({audio:!0}),await Yg(r.connectionDelay),c=await Qg(e),[o,l]=await Promise.all([zu.create(ua({},c.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices})),qu.create(c.outputFormat)]),(p=u)==null||p.getTracks().forEach(_=>_.stop()),u=null,new Wu(r,c,o,l,h)}catch(_){var g,v,k,C;r.onStatusChange({status:"disconnected"}),(g=u)==null||g.getTracks().forEach(U=>U.stop()),(v=c)==null||v.close(),await((k=o)==null?void 0:k.close()),await((C=l)==null?void 0:C.close());try{var P;await((P=h)==null?void 0:P.release()),h=null}catch{}throw _}}constructor(e,n,r,o,c){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=l=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:PC(l.data[0].buffer)})},this.onOutputWorkletMessage=({data:l})=>{l.type==="process"&&this.updateMode(l.finished?"listening":"speaking")},this.addAudioBase64Chunk=l=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:RC(l)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=l=>{if(l.length===0)return 0;let u=0;for(let h=0;h<l.length;h++)u+=l[h]/255;return u/=l.length,u<0?0:u>1?1:u},this.input=r,this.output=o,this.wakeLock=c,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){this.lastInterruptTimestamp<=e.audio_event.event_id&&(this.options.onAudio(e.audio_event.audio_base_64),this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}}class OC extends Es{static startSession(e){return e.textOnly?Vu.startSession(e):Wu.startSession(e)}}function hu(){return hu=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(s[r]=n[r])}return s},hu.apply(null,arguments)}const DC=["micMuted","volume"];function MC(s={}){const{micMuted:e,volume:n}=s,r=(function(k,C){if(k==null)return{};var P={};for(var _ in k)if({}.hasOwnProperty.call(k,_)){if(C.includes(_))continue;P[_]=k[_]}return P})(s,DC),o=Fe.useRef(null),c=Fe.useRef(null),[l,u]=Fe.useState("disconnected"),[h,p]=Fe.useState(!1),[g,v]=Fe.useState("listening");return Fe.useEffect(()=>{var k;e!==void 0&&(o==null||(k=o.current)==null||k.setMicMuted(e))},[e]),Fe.useEffect(()=>{var k;n!==void 0&&(o==null||(k=o.current)==null||k.setVolume({volume:n}))},[n]),Fe.useEffect(()=>()=>{var k;(k=o.current)==null||k.endSession()},[]),{startSession:async k=>{var C;if((C=o.current)!=null&&C.isOpen())return o.current.getId();if(c.current)return(await c.current).getId();try{return c.current=OC.startSession(hu({},r??{},k??{},{onModeChange:({mode:P})=>{v(P)},onStatusChange:({status:P})=>{u(P)},onCanSendFeedbackChange:({canSendFeedback:P})=>{p(P)}})),o.current=await c.current,e!==void 0&&o.current.setMicMuted(e),n!==void 0&&o.current.setVolume({volume:n}),o.current.getId()}finally{c.current=null}},endSession:async()=>{const k=o.current;o.current=null,await(k==null?void 0:k.endSession())},setVolume:({volume:k})=>{var C;(C=o.current)==null||C.setVolume({volume:k})},getInputByteFrequencyData:()=>{var k;return(k=o.current)==null?void 0:k.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var k;return(k=o.current)==null?void 0:k.getOutputByteFrequencyData()},getInputVolume:()=>{var k,C;return(k=(C=o.current)==null?void 0:C.getInputVolume())!=null?k:0},getOutputVolume:()=>{var k,C;return(k=(C=o.current)==null?void 0:C.getOutputVolume())!=null?k:0},sendFeedback:k=>{var C;(C=o.current)==null||C.sendFeedback(k)},getId:()=>{var k;return(k=o.current)==null?void 0:k.getId()},sendContextualUpdate:k=>{var C;(C=o.current)==null||C.sendContextualUpdate(k)},sendUserMessage:k=>{var C;(C=o.current)==null||C.sendUserMessage(k)},sendUserActivity:()=>{var k;(k=o.current)==null||k.sendUserActivity()},sendMCPToolApprovalResult:(k,C)=>{var P;(P=o.current)==null||P.sendMCPToolApprovalResult(k,C)},status:l,canSendFeedback:h,micMuted:e,isSpeaking:g==="speaking"}}async function NC(s){const{backendUrl:e,sessionId:n,url:r,cleanedText:o}=s,c=await fetch(`${e.replace(/\/$/,"")}/page/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:n,url:r,cleanedText:o})});if(!c.ok){const l=await c.text();throw new Error(`Backend error (${c.status}): ${l}`)}return await c.json()}async function AC(){const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!s)throw new Error("No active tab found.");return s}async function Zg(s,e){return await chrome.tabs.sendMessage(s,e)}async function LC(s){const e=s.url||"";if(e.startsWith("chrome://")||e.startsWith("chrome-extension://")||e.startsWith("edge://")||e.startsWith("about:")||e.startsWith("view-source:"))throw new Error("Chrome blocks extensions on this page. Open a normal https webpage and try again.");try{await Zg(s.id,{type:"PING"});return}catch{await chrome.scripting.executeScript({target:{tabId:s.id},files:["content.js"]})}}async function UC(){const s=await AC();await LC(s);const e=await Zg(s.id,{type:"EXTRACT_PAGE"});return{cleanedText:e.cleanedText||"",url:e.url||s.url||""}}const vr={backendUrl:"https://voice-ai-study-companion-801406519570.us-central1.run.app",sessionId:"demo1",agentId:""};async function FC(){const s=await chrome.storage.sync.get(["backendUrl","sessionId","agentId"]);return{backendUrl:s.backendUrl||vr.backendUrl,sessionId:s.sessionId||vr.sessionId,agentId:s.agentId||vr.agentId}}async function jC(s){await chrome.storage.sync.set(s)}function BC(){const[s,e]=Fe.useState(vr),[n,r]=Fe.useState("Ready."),[o,c]=Fe.useState([]),[l,u]=Fe.useState([]),[h,p]=Fe.useState(!1),[g,v]=Fe.useState("unknown"),k=Fe.useMemo(()=>{var S;return((S=chrome==null?void 0:chrome.runtime)==null?void 0:S.id)||""},[]),[C,P]=Fe.useState(1),[_,U]=Fe.useState(0),[A,Y]=Fe.useState(0),[H,R]=Fe.useState(!0),[M,F]=Fe.useState(!1);Fe.useEffect(()=>{FC().then(e).catch(()=>{})},[]);async function J(){var S,D;try{const te=await((D=(S=navigator.permissions)==null?void 0:S.query)==null?void 0:D.call(S,{name:"microphone"})),de=((te==null?void 0:te.state)||"").toString();v(de==="granted"||de==="denied"||de==="prompt"?de:"unknown")}catch{v("unknown")}}Fe.useEffect(()=>{J()},[]);const L=MC({agentId:s.agentId||void 0,volume:C,onAudio:()=>{U(S=>S+1)},onMessage:S=>{const D=((S==null?void 0:S.role)||(S==null?void 0:S.speaker)||"").toString().toLowerCase(),te=((S==null?void 0:S.text)||(S==null?void 0:S.message)||(S==null?void 0:S.content)||"").toString();te&&u(de=>[...de,{role:D.includes("user")?"user":"agent",text:te}])},onError:S=>{r(`Agent error: ${(S==null?void 0:S.message)||String(S)}`)}}),Z=!!(L!=null&&L.isSessionActive),Q=((L==null?void 0:L.status)||"unknown").toString(),se=!!(L!=null&&L.isSpeaking);Fe.useEffect(()=>{var S;if(Z&&H)try{(S=L==null?void 0:L.setMicMuted)==null||S.call(L,!!se),F(!!se)}catch{}},[H,Z,se,L]),Fe.useEffect(()=>{const S=window.setInterval(()=>{var D;try{const te=(D=L==null?void 0:L.getOutputVolume)==null?void 0:D.call(L);typeof te=="number"&&!Number.isNaN(te)&&Y(te)}catch{}},250);return()=>window.clearInterval(S)},[L]);async function ge(){await jC(s),r("Saved settings.")}async function Re(){p(!0),c([]);try{r("Extracting main content");const{cleanedText:S,url:D}=await UC();if(!S||S.length<50)throw new Error("Couldnt extract enough readable text from this page.");r("Sending to backend for analysis");const te=await NC({backendUrl:s.backendUrl,sessionId:s.sessionId,url:D,cleanedText:S});c(((te==null?void 0:te.topics)||[]).slice(0,12)),r("Analyzed! Start the voice tutor, or click Speak summary.")}catch(S){r(`Analyze error: ${(S==null?void 0:S.message)||String(S)}`)}finally{p(!1)}}async function qe(){try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(D=>D.stop()),await J()}catch(S){await J();const D=(S==null?void 0:S.name)||"UnknownError",te=(S==null?void 0:S.message)||String(S);throw new Error(`${D}: ${te}`)}}async function tt(){var S,D,te;try{if(!s.agentId){r("Please paste your ElevenLabs Agent ID first, then Save.");return}await qe(),r("Starting voice session"),await((S=L.startSession)==null?void 0:S.call(L)),await((D=L.setVolume)==null?void 0:D.call(L,{volume:C})),await((te=L.setMicMuted)==null?void 0:te.call(L,!1)),F(!1),r("Voice session started. Say: Summarize this page.")}catch(de){r(`Start error: ${(de==null?void 0:de.message)||String(de)}`)}}async function nt(){var S;try{r("Stopping voice session"),await((S=L.stopSession)==null?void 0:S.call(L)),r("Stopped.")}catch(D){r(`Stop error: ${(D==null?void 0:D.message)||String(D)}`)}}async function De(S=8e3){const D=Date.now();for(;Date.now()-D<S;){const te=(Q||"").toLowerCase();if(te==="connected"||L!=null&&L.isSessionActive&&te!=="disconnected")return;await new Promise(de=>setTimeout(de,200))}throw new Error(`Timed out waiting for connection (status=${Q}).`)}function ee(){const S=chrome.runtime.getURL("dist/index.html");chrome.tabs.create({url:S}),r("Opened in a new tab. Try Start voice tutor there (mic prompts are often more reliable).")}async function ue(){var S,D;try{if(!s.agentId){r("Please paste your ElevenLabs Agent ID first, then Save.");return}if(!Z||(Q||"").toLowerCase()!=="connected"){try{await((S=L.stopSession)==null?void 0:S.call(L))}catch{}await tt(),await De()}r("Asking the tutor to summarize (spoken) "),await((D=L.sendUserMessage)==null?void 0:D.call(L,"Summarize this page in 4 to 6 sentences, then ask me which topic I want to start with."))}catch(te){r(`Speak summary error: ${(te==null?void 0:te.message)||String(te)}`)}}async function ie(){try{r("Playing test tone (If you hear nothing, check Sound permission for the extension page.)");const S=new(window.AudioContext||window.webkitAudioContext),D=S.createOscillator(),te=S.createGain();D.type="sine",D.frequency.value=440,te.gain.value=.2,D.connect(te),te.connect(S.destination);const de=S.state;await S.resume();const Se=S.state;D.start(),r(`Test tone playing. AudioContext state: ${de} -> ${Se} (sampleRate=${S.sampleRate}).`),setTimeout(async()=>{D.stop(),await S.close(),r("Test tone finished. If you didnt hear it, check system/Chrome audio output.")},400)}catch(S){r(`Test tone error: ${(S==null?void 0:S.message)||String(S)}`)}}return ne.jsxs("div",{className:"container",children:[ne.jsxs("div",{className:"card",children:[ne.jsx("div",{style:{fontWeight:800,fontSize:14},children:"Voice AI Study Companion"}),ne.jsx("div",{className:"muted",style:{marginTop:4},children:"Analyze the current page, then talk to your ElevenLabs Agentinside this side panel."})]}),ne.jsxs("div",{className:"card",children:[ne.jsx("div",{className:"row",style:{gap:10},children:ne.jsxs("div",{style:{flex:1},children:[ne.jsx("label",{children:"Backend URL (Cloud Run)"}),ne.jsx("input",{value:s.backendUrl,onChange:S=>e(D=>({...D,backendUrl:S.target.value})),placeholder:vr.backendUrl})]})}),ne.jsx("div",{className:"row",style:{marginTop:10},children:ne.jsxs("div",{style:{flex:1},children:[ne.jsx("label",{children:"Session ID (must match your Agent tool)"}),ne.jsx("input",{value:s.sessionId,onChange:S=>e(D=>({...D,sessionId:S.target.value})),placeholder:vr.sessionId})]})}),ne.jsx("div",{className:"row",style:{marginTop:10},children:ne.jsxs("div",{style:{flex:1},children:[ne.jsx("label",{children:"ElevenLabs Agent ID"}),ne.jsx("input",{value:s.agentId,onChange:S=>e(D=>({...D,agentId:S.target.value})),placeholder:"Paste from ElevenLabs dashboard"})]})}),ne.jsxs("div",{className:"row",style:{marginTop:10},children:[ne.jsx("button",{className:"secondary",onClick:ge,children:"Save"}),ne.jsx("button",{onClick:Re,disabled:h,children:h?"Analyzing":"Analyze page"})]})]}),ne.jsxs("div",{className:"card",children:[ne.jsx("div",{style:{fontWeight:800,fontSize:13},children:"Mic diagnostics"}),ne.jsxs("div",{className:"muted",style:{marginTop:6},children:["Permission state: ",ne.jsx("code",{children:g})]}),ne.jsxs("div",{className:"muted",style:{marginTop:6},children:["If you never see a mic prompt and it stays ",ne.jsx("code",{children:"denied"}),", reset permissions here:",ne.jsx("div",{style:{marginTop:6},children:ne.jsxs("code",{children:["chrome://settings/content/siteDetails?site=chrome-extension%3A%2F%2F",k]})}),"Then set Microphone to ",ne.jsx("code",{children:"Allow"}),", reload the extension, and try again."]}),ne.jsxs("div",{className:"row",style:{marginTop:10},children:[ne.jsx("button",{className:"secondary",onClick:async()=>{try{r("Requesting microphone permission"),await qe(),r("Microphone permission looks OK. Now start the voice tutor.")}catch(S){r(`Mic test error: ${(S==null?void 0:S.message)||String(S)}`)}},children:"Test microphone"}),ne.jsx("button",{className:"secondary",onClick:J,children:"Refresh"})]})]}),ne.jsxs("div",{className:"card",children:[ne.jsxs("div",{className:"row",children:[ne.jsx("button",{onClick:tt,disabled:Z,children:"Start voice tutor"}),ne.jsx("button",{className:"secondary",onClick:nt,disabled:!Z,children:"Stop"})]}),ne.jsxs("div",{className:"row",style:{marginTop:10},children:[ne.jsx("button",{className:"secondary",onClick:ue,children:"Speak summary"}),ne.jsxs("div",{style:{flex:1},children:[ne.jsx("label",{children:"Volume"}),ne.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C,onChange:S=>P(parseFloat(S.target.value))})]})]}),ne.jsxs("div",{className:"row",style:{marginTop:10},children:[ne.jsx("button",{className:"secondary",onClick:ie,children:"Play test tone"}),ne.jsxs("div",{className:"muted",style:{flex:1},children:["Agent: ",ne.jsx("code",{children:Q}),"  Speaking: ",ne.jsx("code",{children:String(se)}),"  Audio events:"," ",ne.jsx("code",{children:_}),"  Output level: ",ne.jsx("code",{children:A.toFixed(2)})]})]}),ne.jsxs("div",{className:"row",style:{marginTop:10,alignItems:"flex-end"},children:[ne.jsxs("div",{style:{flex:1},children:[ne.jsx("label",{children:"Auto-mute mic while agent speaks (recommended)"}),ne.jsx("input",{type:"checkbox",checked:H,onChange:S=>R(S.target.checked)})]}),ne.jsx("button",{className:"secondary",disabled:!Z||H,onClick:async()=>{var S;try{const D=!M;await((S=L==null?void 0:L.setMicMuted)==null?void 0:S.call(L,D)),F(D),r(D?"Mic muted.":"Mic unmuted.")}catch(D){r(`Mic toggle error: ${(D==null?void 0:D.message)||String(D)}`)}},children:M?"Unmute mic":"Mute mic"})]}),ne.jsxs("div",{className:"row",style:{marginTop:10},children:[ne.jsx("button",{className:"secondary",disabled:!Z,onMouseDown:async()=>{var S;if(!H)try{await((S=L==null?void 0:L.setMicMuted)==null?void 0:S.call(L,!1)),F(!1)}catch{}},onMouseUp:async()=>{var S;if(!H)try{await((S=L==null?void 0:L.setMicMuted)==null?void 0:S.call(L,!0)),F(!0)}catch{}},children:"Hold to talk (push-to-talk)"}),ne.jsx("div",{className:"muted",style:{flex:1},children:"Tip: use headphones for best full-duplex conversation."})]}),ne.jsx("div",{className:"row",style:{marginTop:10},children:ne.jsx("button",{className:"secondary",onClick:ee,children:"Open UI in a tab (mic fallback)"})}),ne.jsxs("div",{className:"muted",style:{marginTop:10},children:["After analyzing, try: ",ne.jsx("code",{children:"Summarize this page"}),"  ",ne.jsx("code",{children:"Start with DNS"})," "," ",ne.jsx("code",{children:"Quiz me"}),"."]}),ne.jsx("div",{className:"status",style:{marginTop:10},children:n}),o.length>0&&ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{className:"muted",style:{marginTop:10,fontWeight:700},children:"Topics"}),ne.jsx("ul",{className:"topics",children:o.map(S=>ne.jsx("li",{children:S},S))})]}),l.length>0&&ne.jsx("div",{className:"chat",children:l.slice(-20).map((S,D)=>ne.jsxs("div",{className:`msg ${S.role}`,children:[ne.jsxs("strong",{style:{textTransform:"capitalize"},children:[S.role,":"]})," ",S.text]},D))})]})]})}(()=>{var r,o,c,l;const s=(o=(r=chrome==null?void 0:chrome.runtime)==null?void 0:r.getURL)==null?void 0:o.call(r,"worklets/elevenlabs-worklets.js");if(!s)return;const e=(l=(c=chrome==null?void 0:chrome.runtime)==null?void 0:c.getURL)==null?void 0:l.call(c,"worklets/libsamplerate.worklet.js"),n=AudioWorklet.prototype.addModule;AudioWorklet.prototype.addModule=function(u,h){try{if(typeof u=="string"&&u.startsWith("blob:"))return n.call(this,s,h);if(typeof u=="string"&&u.includes("@alexanderolsen/libsamplerate-js")&&e)return n.call(this,e,h)}catch{}return n.call(this,u,h)}})();o0.createRoot(document.getElementById("root")).render(ne.jsx(Zy.StrictMode,{children:ne.jsx(BC,{})}));
